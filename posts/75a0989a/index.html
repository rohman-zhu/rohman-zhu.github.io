<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="常用脚本与指令合集ping检测1234# 每一个ping动作仅做2次；-n X表示for($i&#x3D;1;$i -lt 250;$i++)&#123;  ping 192.168.1.$i -n 2;&#125;  12345678910111213141516171819202122232425262728293031用法: ping [-t] [-a] [-n count] [-l size] [-">
<meta property="og:type" content="article">
<meta property="og:title" content="常用Powershell脚本汇总">
<meta property="og:url" content="http://github.com/rohman-zhu/posts/75a0989a/index.html">
<meta property="og:site_name" content="诺曼实验室">
<meta property="og:description" content="常用脚本与指令合集ping检测1234# 每一个ping动作仅做2次；-n X表示for($i&#x3D;1;$i -lt 250;$i++)&#123;  ping 192.168.1.$i -n 2;&#125;  12345678910111213141516171819202122232425262728293031用法: ping [-t] [-a] [-n count] [-l size] [-">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-05-10T00:15:36.000Z">
<meta property="article:modified_time" content="2025-12-01T16:48:25.782Z">
<meta property="article:author" content="Rohman.Zhu">
<meta property="article:tag" content="常用指令">
<meta property="article:tag" content="脚本">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://github.com/rohman-zhu/posts/75a0989a/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh_cn","comments":true,"permalink":"http://github.com/rohman-zhu/posts/75a0989a/","path":"posts/75a0989a/","title":"常用Powershell脚本汇总"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>常用Powershell脚本汇总 | 诺曼实验室</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">诺曼实验室</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC%E4%B8%8E%E6%8C%87%E4%BB%A4%E5%90%88%E9%9B%86"><span class="nav-number">1.</span> <span class="nav-text">常用脚本与指令合集</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ping%E6%A3%80%E6%B5%8B"><span class="nav-number">1.1.</span> <span class="nav-text">ping检测</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DNS%E6%B3%A8%E5%86%8C"><span class="nav-number">1.2.</span> <span class="nav-text">DNS注册</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E5%87%BAcsv"><span class="nav-number">1.3.</span> <span class="nav-text">导出csv</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E8%BD%AC%E6%84%8F"><span class="nav-number">1.4.</span> <span class="nav-text">特殊字符转意</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E6%97%B6%E9%97%B4"><span class="nav-number">1.5.</span> <span class="nav-text">获取系统启动时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Invoke-Command-%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"><span class="nav-number">1.6.</span> <span class="nav-text">Invoke-Command 传递参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4"><span class="nav-number">1.7.</span> <span class="nav-text">获取当前时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#While-%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.8.</span> <span class="nav-text">While 语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Switch-%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.9.</span> <span class="nav-text">Switch 语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E8%BD%AC%E5%8D%81%E8%BF%9B%E5%88%B6%E6%95%B0%E5%AD%97"><span class="nav-number">1.10.</span> <span class="nav-text">字符转十进制数字</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%87%E5%89%B2%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">1.11.</span> <span class="nav-text">切割字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%8F%98%E9%87%8F%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.12.</span> <span class="nav-text">获取变量的类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%B7%E8%B4%9D%E6%96%87%E4%BB%B6%E5%88%B0%E8%BF%9C%E7%AB%AF%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.13.</span> <span class="nav-text">拷贝文件到远端的方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%B7%E8%B4%9D%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="nav-number">1.14.</span> <span class="nav-text">拷贝文件夹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8BPowershell%E7%89%88%E6%9C%AC"><span class="nav-number">1.15.</span> <span class="nav-text">查看Powershell版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%9A%84%E7%94%A8%E6%88%B7%E6%95%B0"><span class="nav-number">1.16.</span> <span class="nav-text">获取当前登录的用户数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5%E6%AF%94%E8%BE%83"><span class="nav-number">1.17.</span> <span class="nav-text">条件语句比较</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#match-%E7%94%A8%E6%B3%95%E5%AE%9E%E4%BE%8B"><span class="nav-number">1.17.1.</span> <span class="nav-text">-match 用法实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E7%9B%AE%E6%A0%87%E8%A1%A5%E4%B8%81%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85"><span class="nav-number">1.18.</span> <span class="nav-text">检查目标补丁是否安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E7%BD%91%E5%8D%A1"><span class="nav-number">1.19.</span> <span class="nav-text">设置网卡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AEDNS"><span class="nav-number">1.19.1.</span> <span class="nav-text">设置DNS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%87%E5%89%B2IP%E4%BF%A1%E6%81%AF"><span class="nav-number">1.20.</span> <span class="nav-text">切割IP信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%87%E5%89%B2IP%E4%BF%A1%E6%81%AF-%E5%9F%BA%E4%BA%8EIP%E5%81%9A%E4%B8%BB%E6%9C%BA%E5%90%8D%E4%BF%AE%E6%94%B9"><span class="nav-number">1.20.1.</span> <span class="nav-text">切割IP信息-基于IP做主机名修改</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E8%BF%9B%E7%A8%8B"><span class="nav-number">1.21.</span> <span class="nav-text">检查端口占用进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E8%A3%85%E8%A7%92%E8%89%B2"><span class="nav-number">1.22.</span> <span class="nav-text">服务器安装角色</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Remote-Desktop-Host-Session"><span class="nav-number">1.22.1.</span> <span class="nav-text">安装Remote Desktop Host Session</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E5%9F%9F"><span class="nav-number">1.23.</span> <span class="nav-text">加域</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E6%96%87%E6%9C%AC%E5%90%8E%E9%9D%A2%E8%BF%BD%E5%8A%A0%E5%86%85%E5%AE%B9"><span class="nav-number">1.24.</span> <span class="nav-text">在文本后面追加内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A6%81%E7%94%A8%E6%9C%AC%E5%9C%B0%E8%B4%A6%E6%88%B7"><span class="nav-number">1.25.</span> <span class="nav-text">禁用本地账户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E6%9C%AC%E5%9C%B0%E7%94%A8%E6%88%B7%E7%BB%84%E5%A2%9E%E5%8A%A0%E7%94%A8%E6%88%B7"><span class="nav-number">1.26.</span> <span class="nav-text">为本地用户组增加用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0"><span class="nav-number">1.27.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E4%B8%8E%E8%AE%BE%E7%BD%AE%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.28.</span> <span class="nav-text">启动服务与设置服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.29.</span> <span class="nav-text">循环语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%AB%AF%E5%8F%A3%E6%98%AF%E5%90%A6%E8%BF%9E%E9%80%9A"><span class="nav-number">1.30.</span> <span class="nav-text">测试端口是否连通</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.31.</span> <span class="nav-text">删除用户配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96AD%E5%AE%89%E5%85%A8%E7%BB%84%E7%9A%84SID"><span class="nav-number">1.32.</span> <span class="nav-text">获取AD安全组的SID</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%94%B9%E8%BF%9B%E7%89%88%E6%9C%AC"><span class="nav-number">1.32.1.</span> <span class="nav-text">删除用户配置文件改进版本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-WINRM"><span class="nav-number">1.33.</span> <span class="nav-text">启动 WINRM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8BWINRM%E7%9B%91%E5%90%AC%E7%AB%AF%E5%8F%A3"><span class="nav-number">1.34.</span> <span class="nav-text">查看WINRM监听端口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9WINRM%E7%9B%91%E5%90%AC%E7%AB%AF%E5%8F%A3"><span class="nav-number">1.35.</span> <span class="nav-text">更改WINRM监听端口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%90%E8%A1%8C%E8%AF%BB%E5%8F%96"><span class="nav-number">1.36.</span> <span class="nav-text">逐行读取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3"><span class="nav-number">1.37.</span> <span class="nav-text">时间戳</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E6%B3%A8%E5%86%8C%E8%A1%A8"><span class="nav-number">1.38.</span> <span class="nav-text">设置注册表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%80%BC"><span class="nav-number">1.39.</span> <span class="nav-text">获取注册表值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%80%BC"><span class="nav-number">1.40.</span> <span class="nav-text">设置注册表值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%9EPowershell%E2%80%93Chrome%E5%BF%BD%E7%95%A5%E8%AF%81%E4%B9%A6"><span class="nav-number">1.41.</span> <span class="nav-text">非Powershell–Chrome忽略证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%85%E9%99%A4%E5%89%AA%E8%B4%B4%E6%9D%BF"><span class="nav-number">1.42.</span> <span class="nav-text">清除剪贴板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5Windows%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E5%9B%A0%E4%B8%BA%E8%A1%A5%E4%B8%81%E9%87%8D%E5%90%AF"><span class="nav-number">1.43.</span> <span class="nav-text">检查Windows是否需要因为补丁重启</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%99%E9%BB%98%E5%AE%89%E8%A3%85Chrome"><span class="nav-number">1.44.</span> <span class="nav-text">静默安装Chrome</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%99%E9%BB%98%E5%AE%89%E8%A3%85%E7%81%AB%E7%8B%90%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="nav-number">1.45.</span> <span class="nav-text">静默安装火狐浏览器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chrome%E6%B5%8F%E8%A7%88%E5%99%A8%E5%88%B6%E5%AE%9A%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95"><span class="nav-number">1.46.</span> <span class="nav-text">Chrome浏览器制定用户数据目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85cab%E6%96%87%E4%BB%B6"><span class="nav-number">1.47.</span> <span class="nav-text">离线安装cab文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99%E7%AD%96%E7%95%A5"><span class="nav-number">2.</span> <span class="nav-text">设置防火墙策略</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%B3%E9%97%AD%E6%9C%AC%E5%9C%B0%E9%98%B2%E7%81%AB%E5%A2%99"><span class="nav-number">3.</span> <span class="nav-text">关闭本地防火墙</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E9%98%B2%E7%81%AB%E5%A2%99%E7%AD%96%E7%95%A5%E5%90%8D%E7%A7%B0"><span class="nav-number">4.</span> <span class="nav-text">常用防火墙策略名称</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%BB%B6%E8%BF%9F"><span class="nav-number">5.</span> <span class="nav-text">系统延迟</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E9%80%9A%E7%9F%A5"><span class="nav-number">6.</span> <span class="nav-text">发送邮件通知</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E2%80%93%E9%80%90%E8%A1%8C%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="nav-number">7.</span> <span class="nav-text">模板–逐行读取文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AEWSUS%E4%B8%8B%E8%BD%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%9C%B0%E5%9D%80%E2%80%93%E6%B3%A8%E5%86%8C%E8%A1%A8%E9%A1%B9"><span class="nav-number">8.</span> <span class="nav-text">设置WSUS下载服务器的地址–注册表项</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0%E4%B8%8E%E5%8F%82%E6%95%B0"><span class="nav-number">9.</span> <span class="nav-text">定义函数与参数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="nav-number">9.1.</span> <span class="nav-text">删除软件包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%8F%97%E4%BF%A1%E4%BB%BB%E4%B8%BB%E6%9C%BA%E5%88%97%E8%A1%A8"><span class="nav-number">9.2.</span> <span class="nav-text">设置受信任主机列表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%8C%87%E4%BB%A4%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="nav-number">9.3.</span> <span class="nav-text">输出控制台指令日志记录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%81%8D%E5%8E%86%E6%96%87%E4%BB%B6%E5%A4%B9%E5%B9%B6%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6"><span class="nav-number">9.4.</span> <span class="nav-text">遍历文件夹并传输文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Write-Host-%E4%B8%8E-Write-Output-%E5%8C%BA%E5%88%AB"><span class="nav-number">9.5.</span> <span class="nav-text">Write-Host 与 Write-Output 区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5AD%E8%B4%A6%E6%88%B7%E6%98%AF%E5%90%A6%E5%90%AF%E7%94%A8"><span class="nav-number">9.6.</span> <span class="nav-text">检查AD账户是否启用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86"><span class="nav-number">10.</span> <span class="nav-text">文件处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E9%87%8D%E5%91%BD%E5%90%8D%EF%BC%8CRename-Item"><span class="nav-number">10.1.</span> <span class="nav-text">文件重命名，Rename-Item</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#json%E5%A4%84%E7%90%86"><span class="nav-number">11.</span> <span class="nav-text">json处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8%E4%B8%8E%E6%95%B0%E7%BB%84"><span class="nav-number">11.1.</span> <span class="nav-text">哈希表与数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8BJson%E5%AE%9E%E4%BE%8B%EF%BC%8C%E6%8C%81%E7%BB%AD%E5%BD%95%E5%85%A5%E6%97%B6%E9%97%B4%E4%B8%8E%E9%87%87%E9%9B%86%E6%95%B0%E6%8D%AE"><span class="nav-number">11.2.</span> <span class="nav-text">实例Json实例，持续录入时间与采集数据</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">12.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Rohman.Zhu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">461</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">151</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh_cn">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/75a0989a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="常用Powershell脚本汇总 | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          常用Powershell脚本汇总
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-10 00:15:36" itemprop="dateCreated datePublished" datetime="2022-05-10T00:15:36+00:00">2022-05-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-12-01 16:48:25" itemprop="dateModified" datetime="2025-12-01T16:48:25+00:00">2025-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows-Server/" itemprop="url" rel="index"><span itemprop="name">Windows Server</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows-Server/Powershell/" itemprop="url" rel="index"><span itemprop="name">Powershell</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="常用脚本与指令合集"><a href="#常用脚本与指令合集" class="headerlink" title="常用脚本与指令合集"></a>常用脚本与指令合集</h1><h2 id="ping检测"><a href="#ping检测" class="headerlink" title="ping检测"></a>ping检测</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每一个ping动作仅做2次；-n X表示</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">1</span>;<span class="variable">$i</span> <span class="operator">-lt</span> <span class="number">250</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">  ping <span class="number">192.168</span>.<span class="number">1</span>.<span class="variable">$i</span> <span class="literal">-n</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">用法: ping [-t] [-a] [-n count] [-l size] [-f] [-i TTL] [-v TOS]</span><br><span class="line">            [-r count] [-s count] [[-j host-list] | [-k host-list]]</span><br><span class="line">            [-w timeout] [-R] [-S srcaddr] [-c compartment] [-p]</span><br><span class="line">            [-4] [-6] target_name</span><br><span class="line"></span><br><span class="line">选项:</span><br><span class="line">    -t             Ping 指定的主机，直到停止。</span><br><span class="line">                   若要查看统计信息并继续操作，请键入 Ctrl+Break；</span><br><span class="line">                   若要停止，请键入 Ctrl+C。</span><br><span class="line">    -a             将地址解析为主机名。</span><br><span class="line">    -n count       要发送的回显请求数。</span><br><span class="line">    -l size        发送缓冲区大小。</span><br><span class="line">    -f             在数据包中设置“不分段”标记(仅适用于 IPv4)。</span><br><span class="line">    -i TTL         生存时间。</span><br><span class="line">    -v TOS         服务类型(仅适用于 IPv4。该设置已被弃用，</span><br><span class="line">                   对 IP 标头中的服务类型字段没有任何</span><br><span class="line">                   影响)。</span><br><span class="line">    -r count       记录计数跃点的路由(仅适用于 IPv4)。</span><br><span class="line">    -s count       计数跃点的时间戳(仅适用于 IPv4)。</span><br><span class="line">    -j host-list   与主机列表一起使用的松散源路由(仅适用于 IPv4)。</span><br><span class="line">    -k host-list    与主机列表一起使用的严格源路由(仅适用于 IPv4)。</span><br><span class="line">    -w timeout     等待每次回复的超时时间(毫秒)。</span><br><span class="line">    -R             同样使用路由标头测试反向路由(仅适用于 IPv6)。</span><br><span class="line">                   根据 RFC 5095，已弃用此路由标头。</span><br><span class="line">                   如果使用此标头，某些系统可能丢弃</span><br><span class="line">                   回显请求。</span><br><span class="line">    -S srcaddr     要使用的源地址。</span><br><span class="line">    -c compartment 路由隔离舱标识符。</span><br><span class="line">    -p             Ping Hyper-V 网络虚拟化提供程序地址。</span><br><span class="line">    -4             强制使用 IPv4。</span><br><span class="line">    -6             强制使用 IPv6。</span><br></pre></td></tr></table></figure>
<h2 id="DNS注册"><a href="#DNS注册" class="headerlink" title="DNS注册"></a>DNS注册</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /registerdns</span><br></pre></td></tr></table></figure>

<blockquote>
<p>组策略控制：计算机配置 – 策略 – 管理模板 – 网络 – DNS 客户端—动态更新 DNS 记录—注册刷新间隔;</p>
</blockquote>
<h2 id="导出csv"><a href="#导出csv" class="headerlink" title="导出csv"></a>导出csv</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Export-Csv</span> [目标文件名] </span><br><span class="line"><span class="built_in">Export-Csv</span> [目标文件名] <span class="literal">-Delimiter</span> <span class="string">&quot;分隔符&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="特殊字符转意"><a href="#特殊字符转意" class="headerlink" title="特殊字符转意"></a>特殊字符转意</h2><p>需要使用单引号转意 &#96;</p>
<h2 id="获取系统启动时间"><a href="#获取系统启动时间" class="headerlink" title="获取系统启动时间"></a>获取系统启动时间</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">Get-Process</span> wininit).StartTime</span><br></pre></td></tr></table></figure>

<h2 id="Invoke-Command-传递参数"><a href="#Invoke-Command-传递参数" class="headerlink" title="Invoke-Command 传递参数"></a>Invoke-Command 传递参数</h2><p>Invoke-Command指令，需要带上-ArgumentList 传递参数<br>代码块使用Param()捕获参数</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-Command</span> xxxxxxx <span class="literal">-ArgumentList</span> 参数<span class="number">1</span> <span class="literal">-ScriptBlock</span> &#123;<span class="keyword">Param</span>(<span class="variable">$</span>捕获参数<span class="number">1</span>) ; xxx使用 <span class="variable">$</span>捕获参数<span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure>

<p>传递多个参数</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Invoke-Command</span> <span class="literal">-ArgumentList</span> [<span class="variable">$</span>参数<span class="number">1</span>],[<span class="variable">$</span>参数<span class="number">2</span>],[<span class="variable">$</span>参数<span class="number">3</span>] <span class="literal">-ScriptBlock</span> &#123;<span class="keyword">Param</span>(<span class="variable">$</span>参数<span class="number">1</span>,<span class="variable">$</span>参数<span class="number">2</span>,<span class="variable">$</span>参数<span class="number">3</span>)&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="获取当前时间"><a href="#获取当前时间" class="headerlink" title="获取当前时间"></a>获取当前时间</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-Date</span> <span class="literal">-Format</span> <span class="string">&quot;[yyyy-MM-dd][hh:mm]&quot;</span></span><br></pre></td></tr></table></figure>

<p>常用于打印Log</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetLog</span><span class="params">(<span class="variable">$logLevel</span>,<span class="variable">$logInfo</span>)</span></span>&#123;</span><br><span class="line">  <span class="string">&quot;<span class="variable">$</span>(Get-Date -Format &quot;</span>[<span class="type">yyyy</span>-<span class="type">MM</span>-<span class="type">dd</span>][<span class="type">hh</span>:<span class="type">mm</span>]<span class="string">&quot;)[<span class="variable">$logLevel</span>],[<span class="variable">$logInfo</span>]&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="While-语句"><a href="#While-语句" class="headerlink" title="While 语句"></a>While 语句</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (&lt;condition&gt;)&#123;&lt;statement list&gt;&#125;</span><br><span class="line"></span><br><span class="line">Example:</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$val</span> <span class="operator">-ne</span> <span class="number">3</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$val</span>++</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="variable">$val</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Switch-语句"><a href="#Switch-语句" class="headerlink" title="Switch 语句"></a>Switch 语句</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Switch</span> (&lt;<span class="built_in">test-expression</span>&gt;)</span><br><span class="line">&#123;</span><br><span class="line">    &lt;result1<span class="literal">-to-be-matched</span>&gt; &#123;&lt;action&gt;&#125;;</span><br><span class="line">    &lt;result2<span class="literal">-to-be-matched</span>&gt; &#123;&lt;action&gt;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Examples:</span></span><br><span class="line"><span class="keyword">switch</span> (<span class="number">3</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="number">1</span> &#123;<span class="string">&quot;It is one.&quot;</span>&#125;</span><br><span class="line">    <span class="number">2</span> &#123;<span class="string">&quot;It is two.&quot;</span>&#125;</span><br><span class="line">    <span class="number">3</span> &#123;<span class="string">&quot;It is three.&quot;</span>&#125;</span><br><span class="line">    <span class="number">4</span> &#123;<span class="string">&quot;It is four.&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="字符转十进制数字"><a href="#字符转十进制数字" class="headerlink" title="字符转十进制数字"></a>字符转十进制数字</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$targetNumber</span>=[<span class="type">convert</span>]::ToInt32(<span class="variable">$targetString</span>,<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<h2 id="切割字符串"><a href="#切割字符串" class="headerlink" title="切割字符串"></a>切割字符串</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$stringArray</span>=<span class="variable">$targetString</span> <span class="operator">-Split</span> <span class="string">&quot;[切割字符]&quot;</span> </span><br></pre></td></tr></table></figure>

<p>一般配合.Trim()方法，来去除空格。</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$noSpaceKey</span>=<span class="variable">$targetString</span>.Trim()</span><br></pre></td></tr></table></figure>

<h2 id="获取变量的类型"><a href="#获取变量的类型" class="headerlink" title="获取变量的类型"></a>获取变量的类型</h2><p>一般用于识别当前参数的类型；</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$targetArgs</span>.GetType()</span><br></pre></td></tr></table></figure>

<h2 id="拷贝文件到远端的方法"><a href="#拷贝文件到远端的方法" class="headerlink" title="拷贝文件到远端的方法"></a>拷贝文件到远端的方法</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$remoteSession</span>=<span class="built_in">New-PSSession</span> <span class="literal">-ComputerName</span> <span class="variable">$targetServerHostName</span></span><br><span class="line"><span class="built_in">Copy-Item</span> [<span class="type">Local</span> <span class="type">Target</span> <span class="type">File</span>] <span class="literal">-Destination</span> [<span class="type">Remote</span> <span class="type">Target</span> <span class="type">File</span> <span class="type">Path</span>] <span class="literal">-ToSession</span> <span class="variable">$remoteSession</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ToSession参数需要PS 5.1以上版本才可以使用。</p>
</blockquote>
<h2 id="拷贝文件夹"><a href="#拷贝文件夹" class="headerlink" title="拷贝文件夹"></a>拷贝文件夹</h2><p>需要加参数-Recurse</p>
<blockquote>
<p>最简单的复制一个文件到另一个文件夹内，如果目标文件夹不存在会自动创建。</p>
</blockquote>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Copy-Item</span> <span class="string">&quot;E:\PowerShell\form\*&quot;</span> <span class="literal">-Destination</span> <span class="string">&quot;E:\PowerShell\to\&quot;</span> <span class="literal">-Recurse</span></span><br></pre></td></tr></table></figure>

<h2 id="查看Powershell版本"><a href="#查看Powershell版本" class="headerlink" title="查看Powershell版本"></a>查看Powershell版本</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$PSVersionTable</span> | Findstr PSVersion</span><br></pre></td></tr></table></figure>

<h2 id="获取当前登录的用户数"><a href="#获取当前登录的用户数" class="headerlink" title="获取当前登录的用户数"></a>获取当前登录的用户数</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$userTempInfo1</span>=query user | <span class="built_in">Measure-Object</span> | Findstr Count;</span><br><span class="line"><span class="variable">$userTempInfo2</span>=<span class="variable">$userTempInfo1</span> <span class="operator">-Split</span> <span class="string">&quot;:&quot;</span>;</span><br><span class="line"><span class="variable">$userTempInfo3</span>=<span class="variable">$userTempInfo2</span>[<span class="number">1</span>].Trim();</span><br><span class="line"><span class="variable">$userTempAmount</span>=[<span class="type">Convert</span>]::ToInt32(<span class="variable">$userTempInfo3</span>,<span class="number">10</span>);</span><br><span class="line"><span class="variable">$userAmount</span>=<span class="variable">$userTempAmount</span><span class="literal">-1</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当服务器未有用户会话时，query user指令会返回“无用户登录”。</p>
</blockquote>
<h2 id="条件语句比较"><a href="#条件语句比较" class="headerlink" title="条件语句比较"></a>条件语句比较</h2><p>数字比较</p>
<table>
<thead>
<tr>
<th align="center">字符</th>
<th align="center">说明</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-gt</td>
<td align="center">大于</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">-ge</td>
<td align="center">大于等于</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">-lt</td>
<td align="center">小于</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">-le</td>
<td align="center">小于等于</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">-eq</td>
<td align="center">等于</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">-ne</td>
<td align="center">不等于</td>
<td align="center"></td>
</tr>
</tbody></table>
<p>字符串比较</p>
<table>
<thead>
<tr>
<th align="center">字符</th>
<th align="center">说明</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-like</td>
<td align="center">字符串匹配通配符模式</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">-match</td>
<td align="center">字符串匹配正则表达式模式</td>
<td align="center"></td>
</tr>
</tbody></table>
<blockquote>
<p>注意，所有字符串都能 match 空值 $null</p>
</blockquote>
<h3 id="match-用法实例"><a href="#match-用法实例" class="headerlink" title="-match 用法实例"></a>-match 用法实例</h3><p>关于IP匹配，常规.符号是一个匹配符，需要进行转移；</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$IP</span> = <span class="string">&quot;192.168.1.1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转义操作</span></span><br><span class="line"><span class="variable">$IP_regex</span>=[<span class="type">regex</span>]::Escape(<span class="variable">$IP</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 确认一段文字中是否带目标IP，可以用这个</span></span><br><span class="line"><span class="variable">$IP_Content</span>=<span class="string">&quot;this ip 192.168.1.1xxxxx is a ip string&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$IP_Content</span> <span class="operator">-match</span> <span class="variable">$IP</span>)&#123;</span><br><span class="line">  <span class="built_in">Write-Host</span> <span class="string">&quot;True,Match&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="built_in">Write-Host</span> <span class="string">&quot;False&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本次会输出 &quot;True,Match&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 但无法精确匹配，如下面这段</span></span><br><span class="line"><span class="variable">$IP_Content_2</span>=<span class="string">&quot;this ip 1192.168.1.1xxxxx is a ip string&quot;</span>;</span><br><span class="line"><span class="variable">$IP_Content_3</span>=<span class="string">&quot;this ip 192.168.1.11xxxxx is a ip string&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为精确匹配，需要对IP的前后加(?&lt;![0-9.]),表示匹配位置前面不能是数字与点号；</span></span><br><span class="line"><span class="variable">$IP_regex_2</span>=<span class="string">&quot;(?&lt;![0-9.])&quot;</span>+[<span class="type">regex</span>]::Escape(<span class="variable">$IP</span>)+<span class="string">&quot;(?&lt;![0-9.])&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="检查目标补丁是否安装"><a href="#检查目标补丁是否安装" class="headerlink" title="检查目标补丁是否安装"></a>检查目标补丁是否安装</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#目标补丁KB号</span></span><br><span class="line">TargetHotFixIDArray=<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ( <span class="variable">$i</span>=<span class="number">0</span> ; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$TargetHotFixIDArray</span>.length ; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">  <span class="variable">$isInstalled</span>=<span class="built_in">Get-HotFix</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.HotFixID=<span class="variable">$TargetHotFixIDArray</span>[<span class="variable">$i</span>]&#125; ;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$isInstalled</span> <span class="operator">-eq</span> <span class="variable">$null</span>)&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$TargetHotFixIDArray</span>[<span class="variable">$i</span>] don&#x27;t installed.&quot;</span> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="设置网卡"><a href="#设置网卡" class="headerlink" title="设置网卡"></a>设置网卡</h2><p>静态IP设置</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改IP</span></span><br><span class="line">netsh interface ipv4 address [网卡名] <span class="keyword">static</span> [<span class="type">IP</span>] [<span class="type">NETMASK</span>] [<span class="type">Gateway</span>]</span><br><span class="line"><span class="comment"># 修改DNS</span></span><br><span class="line"><span class="comment"># 主DNS</span></span><br><span class="line">netsh interface ipv4 dns [网卡名] <span class="keyword">static</span> [<span class="type">DNS</span>] primary</span><br><span class="line"><span class="comment"># 副DNS</span></span><br><span class="line">netsh interface ipv4 add dns [网卡名] [<span class="type">DNS</span>]</span><br></pre></td></tr></table></figure>

<p>DHCP设置</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netsh interface ipv4 <span class="built_in">set</span> address [网卡名] dhcp</span><br><span class="line">netsh interface ipv4 <span class="built_in">set</span> dns [网卡名] dhcp</span><br></pre></td></tr></table></figure>

<h3 id="设置DNS"><a href="#设置DNS" class="headerlink" title="设置DNS"></a>设置DNS</h3><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$NICNAMESET</span>=<span class="built_in">Get-NetAdapter</span> <span class="literal">-Physical</span>;</span><br><span class="line"><span class="variable">$PRIMARYDNS</span>=<span class="string">&quot;8.8.8.8&quot;</span>;</span><br><span class="line"><span class="variable">$SECONDDNS</span>=<span class="string">&quot;8.8.4.4&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$NICNAMESET</span>.Name.GetType().BaseType.Name <span class="operator">-match</span> <span class="string">&quot;Object&quot;</span>)&#123;</span><br><span class="line">    <span class="comment"># 单网卡设置DNS；</span></span><br><span class="line">    <span class="variable">$NICNAME</span>=<span class="variable">$NICNAMESET</span>.Name;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Set-DnsClientServerAddress</span> <span class="literal">-InterfaceAlias</span> <span class="variable">$NICNAME</span> <span class="literal">-ServerAddresses</span> <span class="variable">$PRIMARYDNS</span>,<span class="variable">$SECONDDNS</span>;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">elseif</span> (<span class="variable">$NICNAMESET</span>.Name.GetType().BaseType.Name <span class="operator">-match</span> <span class="string">&quot;Array&quot;</span>) &#123;</span><br><span class="line">    <span class="comment"># 多网卡设置DNS</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$NICNAMESET</span>.Length;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="variable">$NICNAME</span>=<span class="variable">$NICNAMESET</span>.Name[<span class="variable">$i</span>];</span><br><span class="line">        <span class="built_in">Set-DnsClientServerAddress</span> <span class="literal">-InterfaceAlias</span> <span class="variable">$NICNAME</span> <span class="literal">-ServerAddresses</span> <span class="variable">$PRIMARYDNS</span>,<span class="variable">$SECONDDNS</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="切割IP信息"><a href="#切割IP信息" class="headerlink" title="切割IP信息"></a>切割IP信息</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取IP信息</span></span><br><span class="line"><span class="variable">$IPInfo</span>=<span class="variable">$</span>(<span class="variable">$</span>(ipconfig | findstr <span class="string">&quot;IPv4&quot;</span>) <span class="operator">-Split</span> <span class="string">&quot;[:]&quot;</span>)[<span class="number">1</span>].Trim();</span><br></pre></td></tr></table></figure>

<h3 id="切割IP信息-基于IP做主机名修改"><a href="#切割IP信息-基于IP做主机名修改" class="headerlink" title="切割IP信息-基于IP做主机名修改"></a>切割IP信息-基于IP做主机名修改</h3><p>格式为：主机名[IP第四位的序号]</p>
<p>如：</p>
<ul>
<li>主机名001</li>
<li>主机名010</li>
<li>主机名111</li>
</ul>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$baseHostname</span>=<span class="string">&quot;【设置的主机名基本格式】&quot;</span>;</span><br><span class="line"><span class="variable">$IPInfo</span>=<span class="variable">$</span>(<span class="variable">$</span>(ipconfig | findstr <span class="string">&quot;IPv4&quot;</span>) <span class="operator">-Split</span> <span class="string">&quot;[:]&quot;</span>)[<span class="number">1</span>].Trim();</span><br><span class="line"><span class="variable">$index</span>=<span class="variable">$</span>(<span class="variable">$IPInfo</span> <span class="operator">-Split</span> <span class="string">&quot;[.]&quot;</span>)[<span class="number">3</span>].Trim();</span><br><span class="line"></span><br><span class="line"><span class="comment">#将字符型转为整型 </span></span><br><span class="line"><span class="variable">$flag</span>=[<span class="type">convert</span>]::ToInt32(<span class="variable">$index</span>,<span class="number">10</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$</span>(<span class="variable">$flag</span> <span class="operator">-ge</span> <span class="number">1</span>) <span class="operator">-and</span> <span class="variable">$</span>(<span class="variable">$flag</span> <span class="operator">-le</span> <span class="number">9</span>) )&#123;</span><br><span class="line">  <span class="comment"># 在 001 与 009 区间</span></span><br><span class="line">  <span class="variable">$newHostname</span>=<span class="variable">$baseHostname</span> + <span class="string">&quot;00&quot;</span> + <span class="variable">$index</span>;</span><br><span class="line">&#125;<span class="keyword">elseif</span>(<span class="variable">$</span>(<span class="variable">$flag</span> <span class="operator">-ge</span> <span class="number">10</span>) <span class="operator">-and</span> <span class="variable">$</span>(<span class="variable">$flag</span> <span class="operator">-le</span> <span class="number">99</span>))&#123;</span><br><span class="line">  <span class="comment"># 在 100 与 99 区间</span></span><br><span class="line">  <span class="variable">$newHostname</span>=<span class="variable">$baseHostname</span> + <span class="string">&quot;0&quot;</span> + <span class="variable">$index</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="comment"># 大于100</span></span><br><span class="line">  <span class="variable">$newHostname</span>=<span class="variable">$baseHostname</span> + <span class="variable">$index</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 两种改名方式</span></span><br><span class="line"><span class="comment"># 方式1：非加域</span></span><br><span class="line"><span class="built_in">Rename-Computer</span> <span class="literal">-NewName</span> <span class="variable">$newHostname</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式2：加域</span></span><br><span class="line"><span class="built_in">Add-Computer</span> <span class="literal">-DomainName</span> <span class="string">&quot;【目标域名】&quot;</span> <span class="literal">-Credential</span> <span class="string">&quot;加域用的账户&quot;</span> <span class="literal">-NewName</span> <span class="variable">$newHostname</span>;</span><br></pre></td></tr></table></figure>
<h2 id="检查端口占用进程"><a href="#检查端口占用进程" class="headerlink" title="检查端口占用进程"></a>检查端口占用进程</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat <span class="literal">-ab</span></span><br></pre></td></tr></table></figure>

<h2 id="服务器安装角色"><a href="#服务器安装角色" class="headerlink" title="服务器安装角色"></a>服务器安装角色</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取安装的功能</span></span><br><span class="line"><span class="built_in">Get-WindowsFeature</span> <span class="literal">-ComputerName</span> [主机名]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装功能</span></span><br><span class="line"><span class="built_in">Install-WindowsFeature</span> <span class="literal">-Name</span> [功能名]</span><br></pre></td></tr></table></figure>

<h3 id="安装Remote-Desktop-Host-Session"><a href="#安装Remote-Desktop-Host-Session" class="headerlink" title="安装Remote Desktop Host Session"></a>安装Remote Desktop Host Session</h3><p>远程桌面会话主机： RDS-RD-Server</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自动重启需要加参数 -Restart</span></span><br><span class="line"><span class="built_in">Install-WindowsFeature</span> <span class="literal">-Name</span> <span class="string">&quot;RDS-RD-Server&quot;</span> <span class="literal">-Restart</span></span><br></pre></td></tr></table></figure>

<h2 id="加域"><a href="#加域" class="headerlink" title="加域"></a>加域</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$Cred</span>=<span class="built_in">Get-Credential</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Add-Computer</span> <span class="literal">-DomainName</span> <span class="variable">$Domain</span> <span class="literal">-Credential</span> <span class="variable">$Cred</span> <span class="literal">-NewName</span> <span class="variable">$NewComputerName</span></span><br></pre></td></tr></table></figure>

<h2 id="在文本后面追加内容"><a href="#在文本后面追加内容" class="headerlink" title="在文本后面追加内容"></a>在文本后面追加内容</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Add-Content</span> [<span class="type">FilePath</span>] [<span class="type">Content</span>]</span><br></pre></td></tr></table></figure>

<h2 id="禁用本地账户"><a href="#禁用本地账户" class="headerlink" title="禁用本地账户"></a>禁用本地账户</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Disable-LocalUser</span> <span class="literal">-Name</span> [<span class="type">UserName</span>]</span><br></pre></td></tr></table></figure>

<h2 id="为本地用户组增加用户"><a href="#为本地用户组增加用户" class="headerlink" title="为本地用户组增加用户"></a>为本地用户组增加用户</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Add-LocalGroupMember</span> <span class="literal">-Name</span> <span class="string">&quot;组名&quot;</span>  <span class="literal">-Member</span> <span class="string">&quot;用户&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.\脚本.ps1  [参数1文件]</span><br><span class="line"><span class="variable">$FILE</span>=<span class="variable">$args</span>[0];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数1文件名获取 </span></span><br><span class="line"><span class="variable">$FILE</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="启动服务与设置服务"><a href="#启动服务与设置服务" class="headerlink" title="启动服务与设置服务"></a>启动服务与设置服务</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Start-Service</span> <span class="string">&quot;Zabbix Agent&quot;</span></span><br><span class="line"><span class="built_in">Set-Service</span> <span class="string">&quot;Zabbix Agent&quot;</span> <span class="literal">-StartupType</span> Automatic</span><br></pre></td></tr></table></figure>

<h2 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span> ; <span class="variable">$i</span> <span class="operator">-le</span> <span class="number">10</span> ; <span class="variable">$i</span>++ )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试端口是否连通"><a href="#测试端口是否连通" class="headerlink" title="测试端口是否连通"></a>测试端口是否连通</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TCP</span>=<span class="built_in">New-Object</span> Net.Sockets.TcpClient</span><br><span class="line"><span class="variable">$TCP</span>.Connect(<span class="string">&quot;192.168.1.1&quot;</span>,<span class="number">80</span>)</span><br><span class="line"><span class="variable">$TCP</span>.Close();</span><br></pre></td></tr></table></figure>

<h2 id="删除用户配置文件"><a href="#删除用户配置文件" class="headerlink" title="删除用户配置文件"></a>删除用户配置文件</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#requires -RunAsAdministrator</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$domain</span> = <span class="string">&#x27;ccie&#x27;</span></span><br><span class="line"><span class="variable">$username</span> = <span class="string">&#x27;user01&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get user SID</span></span><br><span class="line"><span class="variable">$sid</span> = (<span class="built_in">New-Object</span> Security.Principal.NTAccount(<span class="variable">$domain</span>, <span class="variable">$username</span>)).Translate([<span class="type">Security.Principal.SecurityIdentifier</span>]).Value</span><br><span class="line"></span><br><span class="line"><span class="built_in">Get-WmiObject</span> <span class="literal">-ClassName</span> Win32_UserProfile <span class="literal">-Filter</span> <span class="string">&quot;SID=&#x27;<span class="variable">$sid</span>&#x27;&quot;</span> |</span><br><span class="line">  <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">    <span class="variable">$_</span>.Delete()</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="获取AD安全组的SID"><a href="#获取AD安全组的SID" class="headerlink" title="获取AD安全组的SID"></a>获取AD安全组的SID</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$groupDisplayName</span> = <span class="string">&quot;xxx.sec&quot;</span></span><br><span class="line"><span class="variable">$searcher</span> = <span class="built_in">New-Object</span> System.DirectoryServices.DirectorySearcher</span><br><span class="line"><span class="variable">$searcher</span>.Filter = <span class="string">&quot;(&amp;(objectCategory=group)(name=<span class="variable">$groupDisplayName</span>))&quot;</span></span><br><span class="line"><span class="variable">$searcher</span>.PropertiesToLoad.Add(<span class="string">&quot;samAccountName&quot;</span>) | <span class="built_in">Out-Null</span></span><br><span class="line"><span class="variable">$searcher</span>.PropertiesToLoad.Add(<span class="string">&quot;objectSid&quot;</span>) | <span class="built_in">Out-Null</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$searcher</span>.FindOne()</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span> <span class="operator">-ne</span> <span class="variable">$null</span>) &#123;</span><br><span class="line">    <span class="variable">$samAccountName</span> = <span class="variable">$result</span>.Properties[<span class="string">&quot;samAccountName&quot;</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="variable">$sid</span> = <span class="built_in">New-Object</span> System.Security.Principal.SecurityIdentifier(<span class="variable">$result</span>.Properties[<span class="string">&quot;objectSid&quot;</span>][<span class="number">0</span>], <span class="number">0</span>)</span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="string">&quot;组显示名称: <span class="variable">$groupDisplayName</span>&quot;</span></span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="string">&quot;组账户名: <span class="variable">$samAccountName</span>&quot;</span></span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="string">&quot;SID: <span class="variable">$sid</span>&quot;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">Write-Warning</span> <span class="string">&quot;未找到显示名称为 &#x27;<span class="variable">$groupDisplayName</span>&#x27; 的组&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除用户配置文件改进版本"><a href="#删除用户配置文件改进版本" class="headerlink" title="删除用户配置文件改进版本"></a>删除用户配置文件改进版本</h3><p>场景：读取本地RDSH内的所有已登录的用户AD，并识别出已经停用的AD，对状态为“已停用”的AD账户配置删除。</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#requires -RunAsAdministrator</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始信息，需要输入AD域名</span></span><br><span class="line"><span class="variable">$domain</span> = <span class="string">&#x27;ccie&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户目录位置</span></span><br><span class="line"><span class="variable">$fpath</span>=<span class="string">&quot;C:\Users&quot;</span></span><br><span class="line"><span class="variable">$childPath</span>=<span class="built_in">Get-ChildItem</span> <span class="literal">-Path</span> <span class="variable">$fpath</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$tempPath</span> <span class="keyword">in</span> <span class="variable">$childPath</span> )&#123;</span><br><span class="line">  <span class="variable">$userName</span>=<span class="variable">$tempPath</span>.Name.Trim()</span><br><span class="line">  <span class="variable">$userInfo</span>=net user <span class="variable">$userName</span> /domain</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$userInfo</span>[<span class="number">7</span>] <span class="operator">-match</span> <span class="string">&quot;Yes&quot;</span>)&#123;</span><br><span class="line">    <span class="comment">#&quot;$userName is ACTIVE.&quot;</span></span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$userName</span> is INACTIVE.Deleting...&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># get user SID</span></span><br><span class="line">    <span class="variable">$sid</span> = (<span class="built_in">New-Object</span> Security.Principal.NTAccount(<span class="variable">$domain</span>, <span class="variable">$username</span>)).Translate([<span class="type">Security.Principal.SecurityIdentifier</span>]).Value</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Get-WmiObject</span> <span class="literal">-ClassName</span> Win32_UserProfile <span class="literal">-Filter</span> <span class="string">&quot;SID=&#x27;<span class="variable">$sid</span>&#x27;&quot;</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">      <span class="variable">$_</span>.Delete()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="启动-WINRM"><a href="#启动-WINRM" class="headerlink" title="启动 WINRM"></a>启动 WINRM</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Enable-PSRemoting</span> <span class="literal">-Force</span></span><br></pre></td></tr></table></figure>


<h2 id="查看WINRM监听端口"><a href="#查看WINRM监听端口" class="headerlink" title="查看WINRM监听端口"></a>查看WINRM监听端口</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winrm enumerate winrm/config/listener</span><br></pre></td></tr></table></figure>

<h2 id="更改WINRM监听端口"><a href="#更改WINRM监听端口" class="headerlink" title="更改WINRM监听端口"></a>更改WINRM监听端口</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set-item</span> wsman:\localhost\listener\listener*\port <span class="number">5895</span></span><br></pre></td></tr></table></figure>

<h2 id="逐行读取"><a href="#逐行读取" class="headerlink" title="逐行读取"></a>逐行读取</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-Content</span> [<span class="type">FILEPATH</span>] | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">  <span class="comment">#line = $_</span></span><br><span class="line">  <span class="variable">$_</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-Timespan</span> [更早的时间]  [更晚的时间]</span><br><span class="line"></span><br><span class="line"><span class="built_in">New-Timespan</span> <span class="variable">$</span>(<span class="built_in">Get-Date</span>) <span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;target date&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="设置注册表"><a href="#设置注册表" class="headerlink" title="设置注册表"></a>设置注册表</h2><p>注意：如果设置本地组策略或者有域策略的覆盖策略情况下，注册表写入的值会被覆盖。可以使用 rsop.msc 查看。</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#主要使用的指令</span></span><br><span class="line"><span class="built_in">Set-ItemProperty</span> <span class="literal">-Path</span> <span class="string">&#x27;HKCU:\xxx\&#x27;</span> <span class="literal">-Name</span> [<span class="type">xxx</span>] <span class="literal">-Value</span> [<span class="type">xxx</span>]</span><br><span class="line"><span class="built_in">New-ItemProperty</span> <span class="literal">-Path</span> <span class="string">&#x27;HKLM:\xxx\&#x27;</span> <span class="literal">-Name</span> [<span class="type">xxx</span>] <span class="literal">-Value</span> [<span class="type">xxx</span>]</span><br><span class="line"><span class="built_in">Get-ItemProperty</span> <span class="literal">-Path</span> <span class="string">&#x27;HKCU:\xxx\&#x27;</span> <span class="literal">-Name</span> [<span class="type">xxxx</span>]</span><br><span class="line"><span class="built_in">Get-ChildItem</span> <span class="literal">-Path</span> <span class="string">&#x27;HKLM:\xxx\&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建项</span></span><br><span class="line"><span class="comment"># -Force 会强制创建路径</span></span><br><span class="line"><span class="built_in">New-Item</span> <span class="literal">-Path</span> <span class="string">&#x27;HKLM:\xxx\&#x27;</span> <span class="literal">-Force</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 隐藏所有盘符</span></span><br><span class="line"><span class="built_in">Set-ItemProperty</span> <span class="literal">-Path</span> <span class="string">&#x27;HKCU:\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer&#x27;</span> <span class="literal">-Name</span> NoDrives <span class="literal">-Value</span> <span class="number">61708863</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 除了设置常规的注册表项 （admx.help 获取） ，还可以关注WOW6432node注册表项</span><br><span class="line"># 参照</span><br><span class="line">When the 32-bit app performs a registry query on HKEY_LOCAL_MACHINE\SOFTWARE\&lt;company&gt;\&lt;product&gt;, Windows automatically redirects the query to HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\&lt;company&gt;\&lt;product&gt;</span><br><span class="line"></span><br><span class="line">There’s no need to take into account Wow6432 during the development of a 32-bit application. The management of Wow6432 is totally transparent for the developer. Kombustor, for example, modifies Afterburner registry entry:</span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\MSI\Afterburner. During the dev of Kombustor, I never made a reference to Wow6432.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看对应的注册表项 <a target="_blank" rel="noopener" href="https://admx.help/">https://admx.help</a></p>
</blockquote>
<h2 id="获取注册表值"><a href="#获取注册表值" class="headerlink" title="获取注册表值"></a>获取注册表值</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-ItemPropertyValue</span> <span class="literal">-Path</span> HKLM:\xxxxx\xxxx <span class="literal">-Name</span> [<span class="type">ItemName</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：如果注册表路径带有空格，则需要将整个路径用” “</p>
</blockquote>
<h2 id="设置注册表值"><a href="#设置注册表值" class="headerlink" title="设置注册表值"></a>设置注册表值</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ItemProperty</span> <span class="literal">-Path</span> HKLM:\路径 <span class="literal">-Name</span> [<span class="type">ItemName</span>] <span class="literal">-value</span> [具体的值]</span><br></pre></td></tr></table></figure>

<h2 id="非Powershell–Chrome忽略证书"><a href="#非Powershell–Chrome忽略证书" class="headerlink" title="非Powershell–Chrome忽略证书"></a>非Powershell–Chrome忽略证书</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 增加参数</span><br><span class="line">–ignore-certificate-errors</span><br></pre></td></tr></table></figure>

<h2 id="清除剪贴板"><a href="#清除剪贴板" class="headerlink" title="清除剪贴板"></a>清除剪贴板</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cmd</span>.exe /c &quot;<span class="built_in">echo</span> off | clip&quot;</span><br></pre></td></tr></table></figure>

<h2 id="检查Windows是否需要因为补丁重启"><a href="#检查Windows是否需要因为补丁重启" class="headerlink" title="检查Windows是否需要因为补丁重启"></a>检查Windows是否需要因为补丁重启</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#The RebootPending value at</span><br><span class="line">#HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Component Based Servicing</span><br><span class="line">#The RebootRequired value at</span><br><span class="line">#HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update</span><br><span class="line">#The PendingFileRenameOperations value at</span><br><span class="line">#HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager</span><br></pre></td></tr></table></figure>

<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">isRebootRequired=<span class="built_in">Get-Item</span> <span class="literal">-Path</span> <span class="string">&quot;HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update\RebootRequired&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$isRebootRequired</span> <span class="operator">-eq</span> <span class="variable">$null</span>)&#123;</span><br><span class="line">  <span class="string">&quot;Current server don&#x27;t need Reboot.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="string">&quot;Current server need Reboot.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="静默安装Chrome"><a href="#静默安装Chrome" class="headerlink" title="静默安装Chrome"></a>静默安装Chrome</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 会话需要保持几分钟，用于Chrome完成安装；</span></span><br><span class="line">Chrome<span class="literal">-xxxxx</span>.msi  /passive /norestart; <span class="built_in">Start-Sleep</span> <span class="literal">-Seconds</span> <span class="number">200</span>;</span><br></pre></td></tr></table></figure>

<p>Chrome 下载地址</p>
<p>x64位下载地址</p>
<p><a target="_blank" rel="noopener" href="http://www.google.com/intl/zh-CN/chrome/business/browser/admin/thankyou.html?platform=win64&msi=true&installdataindex=defaultbrowser&standalone=1">http://www.google.com/intl/zh-CN/chrome/business/browser/admin/thankyou.html?platform=win64&amp;msi=true&amp;installdataindex=defaultbrowser&amp;standalone=1</a></p>
<p>x86位下载地址<br><a target="_blank" rel="noopener" href="http://www.google.com/intl/zh-CN/chrome/business/browser/admin/thankyou.html?platform=win&msi=true&installdataindex=defaultbrowser&standalone=1">http://www.google.com/intl/zh-CN/chrome/business/browser/admin/thankyou.html?platform=win&amp;msi=true&amp;installdataindex=defaultbrowser&amp;standalone=1</a></p>
<h2 id="静默安装火狐浏览器"><a href="#静默安装火狐浏览器" class="headerlink" title="静默安装火狐浏览器"></a>静默安装火狐浏览器</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Firefox<span class="literal">-xxxxx</span>.msi  /passive /norestart; <span class="built_in">Start-Sleep</span> <span class="literal">-Seconds</span> <span class="number">200</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Chrome浏览器制定用户数据目录"><a href="#Chrome浏览器制定用户数据目录" class="headerlink" title="Chrome浏览器制定用户数据目录"></a>Chrome浏览器制定用户数据目录</h2><p>增加参数–user-data-dir&#x3D;”xxxx%username%\ChromeData”</p>
<h2 id="离线安装cab文件"><a href="#离线安装cab文件" class="headerlink" title="离线安装cab文件"></a>离线安装cab文件</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dism.exe  /online /<span class="built_in">add-package</span> /packagepath:<span class="string">&quot;路径&quot;</span>  /Quiet</span><br></pre></td></tr></table></figure>

<ul>
<li>会自动重启 &#x2F;Quiet</li>
<li>不用自动重启 &#x2F;Norestart</li>
</ul>
<h1 id="设置防火墙策略"><a href="#设置防火墙策略" class="headerlink" title="设置防火墙策略"></a>设置防火墙策略</h1><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建策略</span></span><br><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-Name</span> [防火墙策略名] <span class="literal">-DisplayName</span> [防火墙策略显示名称] <span class="literal">-Enabled</span> True <span class="literal">-Direction</span> Inbound <span class="literal">-Action</span> [<span class="type">ALLOW</span>\<span class="type">BLOCK</span>] <span class="literal">-LocalPort</span> [<span class="type">PORT</span>] <span class="literal">-Protocol</span> [<span class="type">TCP</span>/<span class="type">UDP</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用策略</span></span><br><span class="line"><span class="built_in">Get-NetFirewallRule</span> <span class="literal">-Name</span> [防火墙策略名] | <span class="built_in">Set-NetFirewallRule</span> <span class="literal">-Enabled</span>;</span><br><span class="line"><span class="comment"># 设置目标策略的作用域,&#123;IP1&#125;,&#123;IP2&#125;,&#123;IP3&#125;</span></span><br><span class="line"><span class="built_in">Get-NetfirewallRule</span> <span class="literal">-Name</span> [防火墙策略名] | <span class="built_in">Get-NetFirewallAddressFilter</span> | <span class="built_in">Set-NetFirewallAddressFilter</span> <span class="literal">-RemoteAddress</span> &#123;IP1&#125;,&#123;IP2&#125;,&#123;IP3&#125;</span><br></pre></td></tr></table></figure>
<h1 id="关闭本地防火墙"><a href="#关闭本地防火墙" class="headerlink" title="关闭本地防火墙"></a>关闭本地防火墙</h1><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Powershell指令</span></span><br><span class="line"><span class="comment"># 查看主机防火墙状态</span></span><br><span class="line"><span class="built_in">Get-NetFirewallProfile</span></span><br><span class="line"><span class="comment"># 将所有类型的防火墙开启</span></span><br><span class="line"><span class="built_in">Set-NetFirewallProfile</span> <span class="literal">-Profile</span> Domain,Public,Private <span class="literal">-Enabled</span> True</span><br><span class="line"><span class="comment"># 将所有类型的防火墙关闭</span></span><br><span class="line"><span class="built_in">Set-NetFirewallProfile</span> <span class="literal">-Profile</span> Domain,Public,Private <span class="literal">-Enabled</span> False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#CMD指令</span></span><br><span class="line"><span class="comment"># 关闭</span></span><br><span class="line">netsh advfirewall <span class="built_in">set</span> allprofiles state off</span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">netsh advfirewall <span class="built_in">set</span> allprofiles state on</span><br></pre></td></tr></table></figure>

<h1 id="常用防火墙策略名称"><a href="#常用防火墙策略名称" class="headerlink" title="常用防火墙策略名称"></a>常用防火墙策略名称</h1><table>
<thead>
<tr>
<th align="center">策略显示名(Display)</th>
<th align="center">策略名(Name)</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Windows 远程管理(HTTP-In)</td>
<td align="center">WINRM-HTTP-IN-TCP</td>
</tr>
<tr>
<td align="center">Windows 远程管理(HTTP-In)</td>
<td align="center">WINRM-HTTP-IN-TCP-PUBLIC</td>
</tr>
<tr>
<td align="center">远程计划任务管理(RPC)</td>
<td align="center">RemoteTask-In-TCP</td>
</tr>
<tr>
<td align="center">远程计划任务管理(RPC-EPMAP)</td>
<td align="center">RemoteTask-RPCSS-In-TCP</td>
</tr>
</tbody></table>
<h1 id="系统延迟"><a href="#系统延迟" class="headerlink" title="系统延迟"></a>系统延迟</h1><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Start-Sleep</span> <span class="literal">-Seconds</span> [单位为秒];</span><br></pre></td></tr></table></figure>

<h1 id="发送邮件通知"><a href="#发送邮件通知" class="headerlink" title="发送邮件通知"></a>发送邮件通知</h1><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Send-MailMessage</span> <span class="literal">-From</span> [发件人] <span class="literal">-To</span> [收件人] <span class="literal">-Cc</span> [抄送人] <span class="literal">-Subject</span> [邮件主题] <span class="literal">-Body</span> [邮件内容] <span class="literal">-Credential</span> [邮箱服务器认证账户] <span class="literal">-SmtpServer</span> [目标邮箱服务器地址]</span><br><span class="line"></span><br><span class="line"><span class="variable">$mailbody</span>=<span class="string">@&quot;</span></span><br><span class="line"><span class="string">......邮件内容</span></span><br><span class="line"><span class="string">&quot;@</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>中文邮件要注意编码，指令末尾需要加上 -Encoding ([System.Text.Encoding]::UTF8)</p>
</blockquote>
<h1 id="模板–逐行读取文件"><a href="#模板–逐行读取文件" class="headerlink" title="模板–逐行读取文件"></a>模板–逐行读取文件</h1><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Description:</span></span><br><span class="line"><span class="comment"># Version:</span></span><br><span class="line"><span class="comment"># Date:</span></span><br><span class="line"><span class="comment"># Author:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入文件</span></span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$args</span>[<span class="number">0</span>];</span><br><span class="line"><span class="variable">$index</span>=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span> <span class="operator">-match</span> <span class="string">&quot;.\\&quot;</span>)&#123;</span><br><span class="line">  <span class="comment"># 如果输入的参数是文件，则逐行读取</span></span><br><span class="line">  <span class="built_in">Get-Content</span> <span class="variable">$file</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">  <span class="variable">$target</span>=<span class="variable">$_</span>.Trim();</span><br><span class="line">  <span class="string">&quot;[<span class="variable">$index</span>][<span class="variable">$target</span>]&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># TODO HERE：</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">$index</span>++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="comment"># 如果是单独一行字符串；</span></span><br><span class="line">  <span class="variable">$target</span>=<span class="variable">$file</span>.Trim();</span><br><span class="line">  <span class="string">&quot;[<span class="variable">$index</span>][<span class="variable">$target</span>]&quot;</span></span><br><span class="line">  <span class="comment"># TODO HERE;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="设置WSUS下载服务器的地址–注册表项"><a href="#设置WSUS下载服务器的地址–注册表项" class="headerlink" title="设置WSUS下载服务器的地址–注册表项"></a>设置WSUS下载服务器的地址–注册表项</h1><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$targetWSUS</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Set-ItemProperty</span> <span class="literal">-Path</span> HKLM:Software\Policies\Microsoft\Windows\WindowsUpdate <span class="literal">-Name</span> WUServer <span class="literal">-Value</span> <span class="variable">$targetWSUS</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Set-ItemProperty</span> <span class="literal">-Path</span> HKLM:Software\Policies\Microsoft\Windows\WindowsUpdate <span class="literal">-Name</span> WUStatusServer <span class="literal">-Value</span> <span class="variable">$targetWSUS</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="定义函数与参数"><a href="#定义函数与参数" class="headerlink" title="定义函数与参数"></a>定义函数与参数</h1><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TEST</span></span>&#123;</span><br><span class="line">  <span class="comment"># 参数写法,这里传入的是形参；</span></span><br><span class="line">  <span class="keyword">param</span>(<span class="variable">$</span>参数<span class="number">1</span>,<span class="variable">$</span>参数<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 函数内调用的参数与变更，仅在函数内有效；</span></span><br><span class="line">  <span class="variable">$</span>参数<span class="number">1</span>=[<span class="type">New</span> <span class="type">Value</span>];</span><br><span class="line">  <span class="variable">$</span>参数<span class="number">2</span>=[<span class="type">New</span> <span class="type">Value</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [返回值];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用函数</span></span><br><span class="line"><span class="comment"># 参数对应关系 $参数1=$传入参数1,$参数2=$传入参数2;</span></span><br><span class="line"><span class="comment"># 不抓取返回值的写法</span></span><br><span class="line">TEST <span class="variable">$</span>传入参数<span class="number">1</span> <span class="variable">$</span>传入参数<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 抓取返回值的写法</span></span><br><span class="line"><span class="variable">$GETRETURN</span>=TEST <span class="variable">$</span>传入参数<span class="number">1</span> <span class="variable">$</span>传入参数<span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h2 id="删除软件包"><a href="#删除软件包" class="headerlink" title="删除软件包"></a>删除软件包</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-Package</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.Name <span class="operator">-like</span> <span class="string">&quot;包名&quot;</span>&#125; | <span class="built_in">Uninstall-Package</span></span><br></pre></td></tr></table></figure>

<h2 id="设置受信任主机列表"><a href="#设置受信任主机列表" class="headerlink" title="设置受信任主机列表"></a>设置受信任主机列表</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-Item</span> WSman:\localhost\Client\TrustedHosts <span class="literal">-value</span> [列表]</span><br></pre></td></tr></table></figure>

<h2 id="输出控制台指令日志记录"><a href="#输出控制台指令日志记录" class="headerlink" title="输出控制台指令日志记录"></a>输出控制台指令日志记录</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Start-Transcript</span> <span class="literal">-Path</span> [<span class="type">Log</span> <span class="type">file</span> <span class="type">path</span>];</span><br><span class="line"><span class="built_in">Stop-Transcript</span>;</span><br></pre></td></tr></table></figure>
<h2 id="遍历文件夹并传输文件"><a href="#遍历文件夹并传输文件" class="headerlink" title="遍历文件夹并传输文件"></a>遍历文件夹并传输文件</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ps1</span></span><br><span class="line"><span class="comment"># Description: 迁移文件至执行脚本所在的目录</span></span><br><span class="line"><span class="comment"># Version:v1</span></span><br><span class="line"><span class="comment"># Date:2024-10-04</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 脚本的第一个参数为0 ， 这个跟Shell脚本有差异，Bash Shell脚本是 $1;Windows Shell 脚本是$args[0];</span></span><br><span class="line"><span class="variable">$target_directoryName</span>=<span class="variable">$args</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Move-FileToParentDir</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$target_DirName</span>,<span class="variable">$dir_depth</span>,<span class="variable">$is_move</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Current parent folder is <span class="variable">$target_DirName</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Current depth is <span class="variable">$dir_depth</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Current is_move flag is <span class="variable">$is_move</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$target_dirtoryItem</span>=<span class="built_in">get-Item</span> <span class="variable">$target_DirName</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Get-ChildItem</span> <span class="variable">$target_dirtoryItem</span> | <span class="built_in">Foreach-Object</span> &#123;</span><br><span class="line">        <span class="variable">$item_object</span>=<span class="variable">$_</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$item_object</span> | <span class="built_in">where-object</span> &#123;<span class="variable">$_</span>.mode <span class="operator">-match</span> <span class="string">&quot;d&quot;</span>&#125;)&#123;</span><br><span class="line">            <span class="comment"># Is directory</span></span><br><span class="line">            <span class="comment"># Powershell允许参数自加，LinuxShell没有此规则，需要$(($目标参数+1))</span></span><br><span class="line">            <span class="built_in">Move-FileToParentDir</span> <span class="string">&quot;<span class="variable">$target_dirtoryItem</span>\<span class="variable">$item_object</span>&quot;</span> <span class="variable">$</span>(<span class="variable">$dir_depth</span>+<span class="number">1</span>) <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;<span class="variable">$target_DirName</span>\<span class="variable">$</span>(<span class="variable">$item_object</span>.Name) is a file&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$is_move</span> <span class="operator">-eq</span> <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment"># 这个是执行脚本所在的目录，.\等价于脚本所在的目录，而不是递归到所到的文件层级；</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$item_object</span>.Name) is a file which under a directory , need to move to parent directory.&quot;</span></span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="variable">$target_DirName</span>;</span><br><span class="line">                <span class="variable">$parent_path</span>=<span class="built_in">Split-Path</span> <span class="literal">-Parent</span> <span class="variable">$target_DirName</span>;</span><br><span class="line">                <span class="built_in">move-item</span> <span class="string">&quot;<span class="variable">$target_DirName</span>\<span class="variable">$</span>(<span class="variable">$item_object</span>.Name)&quot;</span> <span class="variable">$parent_path</span></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$dir_depth</span>=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Move-FileToParentDir</span> <span class="variable">$target_directoryName</span> <span class="number">0</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>注意点：</p>
<ol>
<li>父目录，需要用Split-Path获取；</li>
</ol>
<h2 id="Write-Host-与-Write-Output-区别"><a href="#Write-Host-与-Write-Output-区别" class="headerlink" title="Write-Host 与 Write-Output 区别"></a>Write-Host 与 Write-Output 区别</h2><table>
<thead>
<tr>
<th align="center">指令</th>
<th align="center">说明</th>
<th align="center">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Write-Host</td>
<td align="center">Write-Host 是直接将信息输出到控制台，而不管信息是什么类型，都会将其转换成字符串，并且不会将输出发送到管道。</td>
<td align="center">Write-Host “Hello world”</td>
</tr>
<tr>
<td align="center">Write-Output</td>
<td align="center">Write-Output 则会将输出发送到管道，以便在管道中的其他命令或过程中使用。它可以输出对象或文本，并且它不会将输出直接发送到控制台，除非您将输出发送到控制台。</td>
<td align="center">Get-ChildItem| Write-Output</td>
</tr>
</tbody></table>
<h2 id="检查AD账户是否启用"><a href="#检查AD账户是否启用" class="headerlink" title="检查AD账户是否启用"></a>检查AD账户是否启用</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;#</span></span><br><span class="line"><span class="comment">Version:v1</span></span><br><span class="line"><span class="comment">Date:2025-06-07</span></span><br><span class="line"><span class="comment">Description:检查AD账户，如果是禁用的账户，则单独记录。</span></span><br><span class="line"><span class="comment">#&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;# Temp user list , type here manually #&gt;</span></span><br><span class="line"><span class="built_in">Add-Content</span> global_userlist_temp <span class="string">&quot;</span></span><br><span class="line"><span class="string">AD1</span></span><br><span class="line"><span class="string">AD2</span></span><br><span class="line"><span class="string">AD3</span></span><br><span class="line"><span class="string">AD4</span></span><br><span class="line"><span class="string">AD5</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;# Global variable #&gt;</span></span><br><span class="line"><span class="variable">$GLOBAL_USERLIST_CHECKED_STATUS_FILE</span>=<span class="string">&quot;result-userlist-<span class="variable">$</span>(Get-Date -Format &quot;</span>yyyy<span class="literal">-MM-dd--HH-mm-ss</span><span class="string">&quot;).list&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;# Log Function #&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Get-Log</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$LOGTYPE</span>,<span class="variable">$LOG_CONTENT_TEMP</span>);</span><br><span class="line">    <span class="variable">$CURRENT_PATH</span>=(<span class="built_in">Get-Location</span>).Path;</span><br><span class="line">    <span class="variable">$LOGFILE</span>=<span class="string">&quot;<span class="variable">$</span>(<span class="variable">$CURRENT_PATH</span>)\\runtime.log&quot;</span>;</span><br><span class="line">    <span class="variable">$LOG_CONTENT_FIN</span>=<span class="string">&quot;<span class="variable">$</span>(Get-Date -Format &quot;</span>[<span class="type">yyyy</span>-<span class="type">MM</span>-<span class="type">dd</span>][<span class="type">HH</span>:<span class="type">mm</span>:<span class="type">ss</span>]<span class="string">&quot;)[<span class="variable">$LOGTYPE</span>],<span class="variable">$LOG_CONTENT_TEMP</span>;&quot;</span>;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$LOGTYPE</span>):<span class="variable">$</span>(<span class="variable">$LOG_CONTENT_FIN</span>)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$null</span> <span class="operator">-eq</span> <span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$LOGFILE</span>))&#123;</span><br><span class="line">        <span class="built_in">Add-Content</span> <span class="variable">$LOGFILE</span> <span class="string">&quot;<span class="variable">$</span>(Get-Date -Format &quot;</span>[<span class="type">yyyy</span>-<span class="type">MM</span>-<span class="type">dd</span>][<span class="type">HH</span>:<span class="type">mm</span>:<span class="type">ss</span>]<span class="string">&quot;)[INFO],Start create log file;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Add-Content</span> <span class="variable">$LOGFILE</span> <span class="variable">$LOG_CONTENT_FIN</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;# Check account Function #&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Check-UserActive</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$USERNAME</span>);</span><br><span class="line">    <span class="variable">$IS_ACTIVE</span>=<span class="variable">$FALSE</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;[<span class="variable">$USERNAME</span>]Checking account status&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$CHECK_CONTENT</span>=<span class="variable">$</span>(net user <span class="variable">$USERNAME</span> /domain);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$CHECK_CONTENT</span>[<span class="number">7</span>] <span class="operator">-match</span> <span class="string">&quot;YES&quot;</span>)&#123;</span><br><span class="line">        <span class="comment"># account status is enabled</span></span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$USERNAME</span> is active&quot;</span>;</span><br><span class="line">        <span class="variable">$IS_ACTIVE</span>=<span class="variable">$TRUE</span>;</span><br><span class="line">    &#125;<span class="keyword">elseif</span>(<span class="variable">$CHECK_CONTENT</span>[<span class="number">7</span>] <span class="operator">-match</span> <span class="string">&quot;NO&quot;</span>)&#123;</span><br><span class="line">        <span class="comment"># account status is disabled</span></span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$USERNAME</span> is inactive&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment"># locked status , etc.</span></span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$USERNAME</span> status unknow&quot;</span>;</span><br><span class="line">        <span class="variable">$IS_ACTIVE</span>=<span class="variable">$TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$IS_ACTIVE</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;# Record Function #&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Start-Record</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$INDEX</span>,<span class="variable">$USERNAME</span>,<span class="variable">$ACCOUNT_STATUS</span>);</span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$GLOBAL_USERLIST_CHECKED_STATUS_FILE</span> <span class="variable">$INDEX</span>;<span class="variable">$USERNAME</span>;<span class="variable">$ACCOUNT_STATUS</span>;&quot;</span>;</span><br><span class="line">    <span class="built_in">Add-Content</span> <span class="string">&quot;<span class="variable">$GLOBAL_USERLIST_CHECKED_STATUS_FILE</span> <span class="variable">$INDEX</span>;<span class="variable">$USERNAME</span>;<span class="variable">$ACCOUNT_STATUS</span>;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;# Main Function #&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Start-Main</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$USERLIST</span>);</span><br><span class="line">    <span class="variable">$INDEX</span>=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Get-Content</span> <span class="variable">$USERLIST</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">        <span class="variable">$USERNAME</span>=<span class="variable">$_</span>.Trim();</span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Current select : <span class="variable">$</span>(<span class="variable">$USERNAME</span>)&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>( Check<span class="literal">-UserActive</span> <span class="variable">$USERNAME</span> )&#123;</span><br><span class="line">            <span class="comment">&lt;# Handle actived user #&gt;</span></span><br><span class="line">            <span class="built_in">Start-Record</span> <span class="variable">$INDEX</span> <span class="variable">$USERNAME</span> <span class="string">&quot;ENABLED&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">&lt;# Handle inactived user #&gt;</span></span><br><span class="line">            <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$USERNAME</span> is inactive&quot;</span>;</span><br><span class="line">            <span class="built_in">Start-Record</span> <span class="variable">$INDEX</span> <span class="variable">$USERNAME</span> <span class="string">&quot;DISABLED&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$INDEX</span>=<span class="variable">$INDEX</span>+<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">Remove-Item</span> <span class="variable">$USERLIST</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;# Start Main Function #&gt;</span></span><br><span class="line"><span class="built_in">Start-Main</span> global_userlist_temp;</span><br></pre></td></tr></table></figure>

<h1 id="文件处理"><a href="#文件处理" class="headerlink" title="文件处理"></a>文件处理</h1><h2 id="文件重命名，Rename-Item"><a href="#文件重命名，Rename-Item" class="headerlink" title="文件重命名，Rename-Item"></a>文件重命名，Rename-Item</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Rename-Item</span> [原文件名] [新文件名]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果原文件名带有特殊字符，需要使用转义字符与单引号</span></span><br><span class="line"><span class="comment"># 比如文件名为 [test].csv 改为 test.csv</span></span><br><span class="line"><span class="comment"># 处理方式一，转义字符</span></span><br><span class="line"><span class="built_in">Get-Item</span> <span class="string">&#x27;.\`[test`].csv&#x27;</span> | <span class="built_in">Rename-Item</span> <span class="literal">-NewName</span> test.csv</span><br><span class="line"><span class="comment"># 处理方式二</span></span><br><span class="line"><span class="comment"># LiteralPath 用途 字面意义处理路径，特殊字符会被视为普通字符；</span></span><br><span class="line"><span class="comment"># LiteralPath 是 精确匹配路径</span></span><br><span class="line"><span class="comment"># Path模式可以使用通配符匹配；</span></span><br><span class="line"><span class="built_in">Rename-Item</span> <span class="literal">-LiteralPath</span>  [<span class="type">test</span>].csv test.csv</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="json处理"><a href="#json处理" class="headerlink" title="json处理"></a>json处理</h1><p>powershell中有两个关键的函数，可以将哈希表（键值对，key-value形式，powershell中用@{}新建）转化成json格式；也可以将数组转成json格式；<br>对于Json格式的文档或者内容，也可以转化成数组或者对象；</p>
<ul>
<li>ConvertTo-Json , 将内容转化成Json；</li>
<li>ConvertFrom-Json ， 读取Json内容转化成数组或对象；</li>
</ul>
<p>如果是读取一个文本，并转化成Json格式，使用的是Get-Content指令，需要带上-Raw，否则会逐行读取并转成Json格式，容易报错；</p>
<h2 id="哈希表与数组"><a href="#哈希表与数组" class="headerlink" title="哈希表与数组"></a>哈希表与数组</h2><p>数组与Json操作强关联</p>
<table>
<thead>
<tr>
<th align="center">特性</th>
<th align="center">哈希表</th>
<th align="center">数组</th>
</tr>
</thead>
<tbody><tr>
<td align="center">创建方式</td>
<td align="center">@{}</td>
<td align="center">@()</td>
</tr>
<tr>
<td align="center">数据结构</td>
<td align="center">键值对集合</td>
<td align="center">有序值集合</td>
</tr>
<tr>
<td align="center">访问方式</td>
<td align="center">通过键名</td>
<td align="center">通过索引（从0开始）</td>
</tr>
<tr>
<td align="center">顺序</td>
<td align="center">默认无序（可有序）</td>
<td align="center">保持插入顺序</td>
</tr>
<tr>
<td align="center">语法</td>
<td align="center">@{Key1&#x3D;Value1; Key2&#x3D;Value2}</td>
<td align="center">@(Value1, Value2, Value3)</td>
</tr>
<tr>
<td align="center">性能</td>
<td align="center">按键查找快</td>
<td align="center">按索引查找快</td>
</tr>
<tr>
<td align="center">重复项</td>
<td align="center">键必须唯一，值可重复</td>
<td align="center">值可重复</td>
</tr>
</tbody></table>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建与调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 哈希表示例</span></span><br><span class="line"><span class="variable">$hashTable</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">    Name = <span class="string">&quot;张三&quot;</span></span><br><span class="line">    Age = <span class="number">25</span></span><br><span class="line">    City = <span class="string">&quot;北京&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过键名访问</span></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;姓名: <span class="variable">$</span>(<span class="variable">$hashTable</span>.Name)&quot;</span></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;年龄: <span class="variable">$</span>(<span class="variable">$hashTable</span>[&#x27;Age&#x27;])&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组示例</span></span><br><span class="line"><span class="variable">$array</span> = <span class="selector-tag">@</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">25</span>, <span class="string">&quot;北京&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过索引访问</span></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;姓名: <span class="variable">$</span>(<span class="variable">$array</span>[0])&quot;</span></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;年龄: <span class="variable">$</span>(<span class="variable">$array</span>[1])&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加元素比对</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 哈希表添加元素</span></span><br><span class="line"><span class="variable">$hashTable</span> = <span class="selector-tag">@</span>&#123;&#125;</span><br><span class="line"><span class="variable">$hashTable</span>[<span class="string">&quot;Name&quot;</span>] = <span class="string">&quot;李四&quot;</span>        <span class="comment"># 方法1</span></span><br><span class="line"><span class="variable">$hashTable</span>.Add(<span class="string">&quot;Age&quot;</span>, <span class="number">30</span>)         <span class="comment"># 方法2</span></span><br><span class="line"><span class="variable">$hashTable</span>.City = <span class="string">&quot;上海&quot;</span>          <span class="comment"># 方法3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组添加元素</span></span><br><span class="line"><span class="variable">$array</span> = <span class="selector-tag">@</span>()</span><br><span class="line"><span class="variable">$array</span> += <span class="string">&quot;李四&quot;</span>                  <span class="comment"># 方法1（创建新数组）</span></span><br><span class="line"><span class="variable">$array</span> += <span class="number">30</span></span><br><span class="line"><span class="variable">$array</span> += <span class="string">&quot;上海&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更高效的数组添加方式</span></span><br><span class="line"><span class="variable">$arrayList</span> = [<span class="type">System.Collections.ArrayList</span>]::new()</span><br><span class="line"><span class="variable">$arrayList</span>.Add(<span class="string">&quot;李四&quot;</span>) | <span class="built_in">Out-Null</span></span><br><span class="line"><span class="variable">$arrayList</span>.Add(<span class="number">30</span>) | <span class="built_in">Out-Null</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 遍历方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 哈希表遍历</span></span><br><span class="line"><span class="variable">$person</span> = <span class="selector-tag">@</span>&#123;Name=<span class="string">&quot;王五&quot;</span>; Age=<span class="number">28</span>; City=<span class="string">&quot;广州&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;=== 哈希表遍历 ===&quot;</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$key</span> <span class="keyword">in</span> <span class="variable">$person</span>.Keys) &#123;</span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="string">&quot;<span class="variable">$key</span> : <span class="variable">$</span>(<span class="variable">$person</span>[<span class="variable">$key</span>])&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"><span class="variable">$person</span>.GetEnumerator() | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$_</span>.Key) : <span class="variable">$</span>(<span class="variable">$_</span>.Value)&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组遍历</span></span><br><span class="line"><span class="variable">$colors</span> = <span class="selector-tag">@</span>(<span class="string">&quot;红色&quot;</span>, <span class="string">&quot;绿色&quot;</span>, <span class="string">&quot;蓝色&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;=== 数组遍历 ===&quot;</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$colors</span>.Length; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="string">&quot;索引 <span class="variable">$i</span> : <span class="variable">$</span>(<span class="variable">$colors</span>[<span class="variable">$i</span>])&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用foreach</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$color</span> <span class="keyword">in</span> <span class="variable">$colors</span>) &#123;</span><br><span class="line">    <span class="built_in">Write-Output</span> <span class="string">&quot;颜色: <span class="variable">$color</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 转化成Json的差异</span></span><br><span class="line"><span class="comment"># 哈希表转JSON -&gt; 对象形式</span></span><br><span class="line"><span class="variable">$hashTable</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">    Name = <span class="string">&quot;张三&quot;</span></span><br><span class="line">    Age = <span class="number">25</span></span><br><span class="line">    Hobbies = <span class="selector-tag">@</span>(<span class="string">&quot;游泳&quot;</span>, <span class="string">&quot;阅读&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$hashJson</span> = <span class="variable">$hashTable</span> | <span class="built_in">ConvertTo-Json</span></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;哈希表JSON:&quot;</span></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="variable">$hashJson</span></span><br><span class="line"><span class="comment"># 输出: &#123;&quot;Name&quot;: &quot;张三&quot;, &quot;Age&quot;: 25, &quot;Hobbies&quot;: [&quot;游泳&quot;, &quot;阅读&quot;]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组转JSON -&gt; 数组形式</span></span><br><span class="line"><span class="variable">$array</span> = <span class="selector-tag">@</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">25</span>, <span class="selector-tag">@</span>(<span class="string">&quot;游泳&quot;</span>, <span class="string">&quot;阅读&quot;</span>))</span><br><span class="line"><span class="variable">$arrayJson</span> = <span class="variable">$array</span> | <span class="built_in">ConvertTo-Json</span></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="string">&quot;数组JSON:&quot;</span></span><br><span class="line"><span class="built_in">Write-Output</span> <span class="variable">$arrayJson</span></span><br><span class="line"><span class="comment"># 输出: [&quot;张三&quot;, 25, [&quot;游泳&quot;, &quot;阅读&quot;]]</span></span><br></pre></td></tr></table></figure>

<h2 id="实例Json实例，持续录入时间与采集数据"><a href="#实例Json实例，持续录入时间与采集数据" class="headerlink" title="实例Json实例，持续录入时间与采集数据"></a>实例Json实例，持续录入时间与采集数据</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 变量：时间，date</span></span><br><span class="line"><span class="comment"># 变量：采集数据，collectDate</span></span><br><span class="line"><span class="comment"># 期望的记录形式是: date=&#x27;2025-09-24&#x27;,collectDate=&#x27;0&#x27;;</span></span><br><span class="line"><span class="comment"># 非常标准的哈希表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建第一个数据点，并记录至jsonDemo.log文件中</span></span><br><span class="line"><span class="variable">$object_1</span>=<span class="selector-tag">@</span>&#123;<span class="string">&quot;date&quot;</span>=<span class="string">&quot;1&quot;</span>;<span class="string">&quot;collectDate&quot;</span>=<span class="string">&quot;1&quot;</span>&#125;;</span><br><span class="line"><span class="comment"># 转化成Json格式</span></span><br><span class="line"><span class="variable">$json_1</span>=<span class="variable">$object_1</span> | <span class="built_in">ConvertTo-Json</span> ;</span><br><span class="line"><span class="comment"># 记录至文件</span></span><br><span class="line"><span class="built_in">Add-Content</span> jsonDemo.log <span class="variable">$json_1</span>  <span class="literal">-Encoding</span> UTF8;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时jsonDemo.log的内容如下：</span></span><br><span class="line"><span class="comment">#&#123;</span></span><br><span class="line"><span class="comment">#    &quot;collectDate&quot;:  &quot;1&quot;,</span></span><br><span class="line"><span class="comment">#    &quot;date&quot;:  &quot;1&quot;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建第二个数据点，并添加到jsonDemo.log文件中</span></span><br><span class="line"><span class="variable">$object_2</span>=<span class="selector-tag">@</span>&#123;<span class="string">&quot;date&quot;</span>=<span class="string">&quot;2&quot;</span>;<span class="string">&quot;collectDate&quot;</span>=<span class="string">&quot;2&quot;</span>&#125;;</span><br><span class="line"><span class="comment"># 读取jsonDemo.log文件，并转化成powershell的对象</span></span><br><span class="line"><span class="variable">$pre_object</span>=<span class="built_in">Get-Content</span> jsonDemo.log | <span class="built_in">ConvertFrom-Json</span>;</span><br><span class="line"><span class="comment"># 此时因为jsonDemo.log里面只有一条记录，转化出来的是PowerShell Object，并非数组，无法做添加操作</span></span><br><span class="line"><span class="comment"># 需要将此对象转化成数组</span></span><br><span class="line"><span class="variable">$pre_object</span>=<span class="selector-tag">@</span>(<span class="variable">$pre_object</span>);</span><br><span class="line"><span class="comment"># 将第二个数据点进行添加操作</span></span><br><span class="line"><span class="variable">$new_object</span>=<span class="variable">$pre_object</span>+<span class="variable">$object_2</span></span><br><span class="line"><span class="comment"># 将数据转化成Json格式</span></span><br><span class="line"><span class="variable">$json_2</span>=<span class="variable">$new_object</span> | <span class="built_in">ConvertTo-Json</span>;</span><br><span class="line"><span class="comment"># 清除原先的内容，记录新内容至文件jsonDemo.log</span></span><br><span class="line"><span class="built_in">Clear-Content</span> jsonDemo.log;</span><br><span class="line"><span class="built_in">Add-Content</span> jsonDemo.log <span class="variable">$json_2</span>  <span class="literal">-Encoding</span> UTF8;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时jsonDemo.log的内容如下：</span></span><br><span class="line"><span class="comment">#[</span></span><br><span class="line"><span class="comment">#    &#123;</span></span><br><span class="line"><span class="comment">#        &quot;collectDate&quot;:  &quot;1&quot;,</span></span><br><span class="line"><span class="comment">#        &quot;date&quot;:  &quot;1&quot;</span></span><br><span class="line"><span class="comment">#    &#125;,</span></span><br><span class="line"><span class="comment">#    &#123;</span></span><br><span class="line"><span class="comment">#        &quot;collectDate&quot;:  &quot;2&quot;,</span></span><br><span class="line"><span class="comment">#        &quot;date&quot;:  &quot;2&quot;</span></span><br><span class="line"><span class="comment">#    &#125;</span></span><br><span class="line"><span class="comment">#]</span></span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>获取系统启动时间：<a target="_blank" rel="noopener" href="https://www.pstips.net/system-running-time.html">https://www.pstips.net/system-running-time.html</a></li>
<li>PS中的比较：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/powershell/module/microsoft.powershell.core/about/about_comparison_operators?view=powershell-7.2">https://docs.microsoft.com/zh-cn/powershell/module/microsoft.powershell.core/about/about_comparison_operators?view=powershell-7.2</a></li>
<li>测试端口是否连通： <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_33737134/article/details/85544432">https://blog.csdn.net/weixin_33737134/article/details/85544432</a></li>
<li>删除用户配置文件： <a target="_blank" rel="noopener" href="https://blog.vichamp.com/2017/12/27/deleting-user-profiles/">https://blog.vichamp.com/2017/12/27/deleting-user-profiles/</a></li>
<li>更改WINRM监听端口： <a target="_blank" rel="noopener" href="https://blog.51cto.com/281816327/1394801">https://blog.51cto.com/281816327/1394801</a></li>
<li>Chrome 修改用户数据目录：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40364421/article/details/82769021">https://blog.csdn.net/weixin_40364421/article/details/82769021</a></li>
<li>获取已安装的补丁： <a target="_blank" rel="noopener" href="https://www.winhelponline.com/blog/how-to-check-if-a-windows-update-kb-is-installed/">https://www.winhelponline.com/blog/how-to-check-if-a-windows-update-kb-is-installed/</a></li>
<li>检查Windows是否需要因为安装补丁重启：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/answers/questions/675843/from-the-command-line-how-can-i-tell-if-a-reboot-i.html">https://docs.microsoft.com/en-us/answers/questions/675843/from-the-command-line-how-can-i-tell-if-a-reboot-i.html</a></li>
<li>Copy-Item 复制文件和文件夹：<a target="_blank" rel="noopener" href="https://0x400.net/post/powershell-copy-item.html">https://0x400.net/post/powershell-copy-item.html</a></li>
<li>组策略与注册表项查询：<a target="_blank" rel="noopener" href="https://admx.help/?Category=Windows_8.1_2012R2&Policy=Microsoft.Policies.WindowsUpdate::CorpWuURL">https://admx.help/?Category=Windows_8.1_2012R2&amp;Policy=Microsoft.Policies.WindowsUpdate::CorpWuURL</a></li>
<li>Start-Transcript: <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.host/start-transcript?view=powershell-7.4">https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.host/start-transcript?view=powershell-7.4</a></li>
<li>Write-Host与Write-Output区别： <a target="_blank" rel="noopener" href="https://juejin.cn/s/powershell%20write-host%20write-output">https://juejin.cn/s/powershell%20write-host%20write-output</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/" rel="tag"># 常用指令</a>
              <a href="/tags/%E8%84%9A%E6%9C%AC/" rel="tag"># 脚本</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/403570ec/" rel="prev" title="基于Invoke-Command远程更新VMware Horizon View Agent">
                  <i class="fa fa-angle-left"></i> 基于Invoke-Command远程更新VMware Horizon View Agent
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/afb69a33/" rel="next" title="记录一次Ubuntu2004下的kdump配置与测试">
                  记录一次Ubuntu2004下的kdump配置与测试 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Rohman.Zhu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":"light","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
