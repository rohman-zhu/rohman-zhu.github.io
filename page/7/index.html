<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="诺曼实验室">
<meta property="og:url" content="http://github.com/rohman-zhu/page/7/index.html">
<meta property="og:site_name" content="诺曼实验室">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Rohman.Zhu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://github.com/rohman-zhu/page/7/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh_cn","comments":"","permalink":"","path":"page/7/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>诺曼实验室</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">诺曼实验室</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Rohman.Zhu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">444</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">144</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/c153b50a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/c153b50a/" class="post-title-link" itemprop="url">Python程序实例-Selenium应用-获取页面信息</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-16 18:11:15" itemprop="dateCreated datePublished" datetime="2024-03-16T18:11:15+00:00">2024-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">基础知识</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%BC%96%E7%A8%8B/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h1><p>需要进入多个页面获取信息内容，并输出至文本，用于后期Excel数据展示。</p>
<h1 id="涉及知识点"><a href="#涉及知识点" class="headerlink" title="涉及知识点"></a>涉及知识点</h1><h2 id="Python-逐行读取文件"><a href="#Python-逐行读取文件" class="headerlink" title="Python 逐行读取文件"></a>Python 逐行读取文件</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方案1</span></span><br><span class="line"><span class="comment"># 全部读取</span></span><br><span class="line">FILE=<span class="built_in">open</span>(<span class="string">&quot;TEST.demo&quot;</span>)</span><br><span class="line"><span class="comment"># read()表示一次性读取文件全部内容</span></span><br><span class="line">LINE=FILE.read()</span><br><span class="line"><span class="built_in">print</span>(LINE)</span><br><span class="line">FILE.<span class="built_in">open</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方案2</span></span><br><span class="line"><span class="comment"># 逐行读取</span></span><br><span class="line">FILE=<span class="built_in">open</span>(<span class="string">&quot;TEST.demo&quot;</span>)</span><br><span class="line">LINE=FILE.readline()</span><br><span class="line"><span class="keyword">while</span> LINE:</span><br><span class="line">    <span class="built_in">print</span>(LINE)</span><br><span class="line">    LINE=FILE.readline()</span><br><span class="line">FILE.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方案3</span></span><br><span class="line"><span class="comment"># 读取所有行</span></span><br><span class="line">FILE=<span class="built_in">open</span>(<span class="string">&quot;TEST.demo&quot;</span>)</span><br><span class="line">LINES=FILE.readlines()</span><br><span class="line"><span class="keyword">for</span> LINE <span class="keyword">in</span> LINES:</span><br><span class="line">    <span class="built_in">print</span>(LINE)</span><br><span class="line">    LINE=FILE.readline()</span><br><span class="line">FILE.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="程序休眠"><a href="#程序休眠" class="headerlink" title="程序休眠"></a>程序休眠</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># 休眠</span></span><br><span class="line">time.sleep([SECONDS])</span><br></pre></td></tr></table></figure>

<h2 id="for-循环逐行读取"><a href="#for-循环逐行读取" class="headerlink" title="for 循环逐行读取"></a>for 循环逐行读取</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> iterating_var <span class="keyword">in</span> sequence:</span><br><span class="line">    statements(s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历字符串：</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> <span class="string">&#x27;Python&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Current char $s&quot;</span>% char)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历0-100的数字：</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 等效于 Powershell 语言</span></span><br><span class="line"><span class="comment"># for ($i=0;$i -lt 100;$i ++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历50-100的数字：</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<h2 id="数字整型转换成字符型"><a href="#数字整型转换成字符型" class="headerlink" title="数字整型转换成字符型"></a>数字整型转换成字符型</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TARGET_INT=<span class="number">10</span></span><br><span class="line">TARGET_STRING=<span class="built_in">str</span>(TARGET_INT)</span><br></pre></td></tr></table></figure>

<h2 id="字符型转换为整型"><a href="#字符型转换为整型" class="headerlink" title="字符型转换为整型"></a>字符型转换为整型</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认十进制</span></span><br><span class="line">TARGET_NUMBER=<span class="built_in">int</span>(<span class="string">&quot;20&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改为十六进制</span></span><br><span class="line">TARGET_NUMBER=<span class="built_in">int</span>(<span class="string">&quot;20&quot;</span>,<span class="number">16</span>)</span><br></pre></td></tr></table></figure>

<h2 id="文件输出"><a href="#文件输出" class="headerlink" title="文件输出"></a>文件输出</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 覆盖文件内容，作用相当于 echo &quot;&quot; &gt; test.demo</span></span><br><span class="line">FILE=<span class="built_in">open</span>(<span class="string">&#x27;test.demo&#x27;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line">FILE.write(<span class="string">&quot;TARGET CONTENT&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 追加文件内容，作用相当于 echo &quot;&quot; &gt;&gt; test.demo</span></span><br><span class="line"><span class="comment"># 等价于 Powershell 的 Add-Content</span></span><br><span class="line">FILE=<span class="built_in">open</span>(<span class="string">&#x27;test.demo&#x27;</span>,<span class="string">&quot;a&quot;</span>)</span><br><span class="line">FILE.write(<span class="string">&quot;TARGET CONTENT&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="字符比较判断"><a href="#字符比较判断" class="headerlink" title="字符比较判断"></a>字符比较判断</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 汉字比较</span></span><br><span class="line">TEST_CHAT=<span class="string">&quot;用于测试的字符&quot;</span></span><br><span class="line">TARGET_CHAT=<span class="string">&quot;用于匹配判断的字符&quot;</span></span><br><span class="line"><span class="keyword">if</span> TEST_CHAT <span class="keyword">in</span> TARGET_CHAT:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;匹配成功&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TARGET_STRING1=<span class="string">&#x27;字符串1&#x27;</span></span><br><span class="line">TARGET_STRING2=<span class="string">&#x27;字符串2&#x27;</span></span><br><span class="line">TARGET_STRING3=<span class="string">&#x27;字符串3&#x27;</span></span><br><span class="line">TOTAL_STRING=TARGET_STRING1 + TARGET_STRING2 + TARGET_STRING3</span><br></pre></td></tr></table></figure>

<h2 id="字符串替代"><a href="#字符串替代" class="headerlink" title="字符串替代"></a>字符串替代</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_STRING=<span class="string">&quot;DEFUALTSTRING&quot;</span></span><br><span class="line">TEMP_STRING=<span class="string">&quot;I need to replace DEFUALTSTRING&quot;</span></span><br><span class="line">NEW_STRING=TEMP_STRING(<span class="string">&quot;DEFAULTSTRING&quot;</span>,<span class="string">&quot;NEWSTRING&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="异常处理或异常"><a href="#异常处理或异常" class="headerlink" title="异常处理或异常"></a>异常处理或异常</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    Code_Block</span><br><span class="line"><span class="keyword">except</span> [Except_type]:</span><br><span class="line">    Handle_EXCEPT_CODE_Block</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    Code Block</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">    <span class="built_in">print</span>(ex)</span><br></pre></td></tr></table></figure>

<h1 id="脚本内容"><a href="#脚本内容" class="headerlink" title="脚本内容"></a>脚本内容</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> selenium.webdriver <span class="keyword">as</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver。common.keys <span class="keyword">import</span> Keys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">WriteLog</span>(<span class="params">INFO</span>):</span><br><span class="line">    FILE=<span class="built_in">open</span>(<span class="string">&quot;Output.log&quot;</span>,<span class="string">&quot;a&quot;</span>)</span><br><span class="line">    FILE.write(INFO)</span><br><span class="line">    FILE.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GetXPATHELEM</span>(<span class="params">DRIVER,TARGET_XPATH</span>):</span><br><span class="line">    ELEM=DRIVER.find_element(By.XPATH,TARGET_XPATH)</span><br><span class="line">    <span class="keyword">return</span> ELEM</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">HandleElementInfo</span>(<span class="params">DRIVER</span>):</span><br><span class="line">    TARGET_ELEM_XPATH=<span class="string">&quot;&quot;</span></span><br><span class="line">    TARGET_CONTENT=GetXPATHELEM(DRIVER,TARGET_ELEM_XPATH).text</span><br><span class="line">    <span class="keyword">return</span> TARGET_CONTENT</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">HandleURL</span>(<span class="params">DRIVER,TARGET_URL</span>):</span><br><span class="line">    <span class="comment"># 避免被服务端禁用，需要暂停10s再执行</span></span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line">    DEFAULT_URL=<span class="string">&quot;&quot;</span></span><br><span class="line">    NEW_URL=DEFAULT_URL.replace(<span class="string">&quot;&quot;</span>,TARGET_URL)</span><br><span class="line">    DRIVER.get(NEW_URL)</span><br><span class="line"></span><br><span class="line">driver=webdriver.Chrome()</span><br><span class="line">HandleURL(driver,<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Chrome-Driver-下载"><a href="#Chrome-Driver-下载" class="headerlink" title="Chrome Driver 下载"></a>Chrome Driver 下载</h1><p><a target="_blank" rel="noopener" href="https://googlechromelabs.github.io/chrome-for-testing">https://googlechromelabs.github.io/chrome-for-testing</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/81fd687e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/81fd687e/" class="post-title-link" itemprop="url">VCSA-VSAN页面显示故障</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-15 22:09:39" itemprop="dateCreated datePublished" datetime="2024-03-15T22:09:39+00:00">2024-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/vSphere/" itemprop="url" rel="index"><span itemprop="name">vSphere</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障描述"><a href="#故障描述" class="headerlink" title="故障描述"></a>故障描述</h1><p>在 VCSA 中，进入到vSAN相关的页面选项时，会出现“无法提取请求的数据。有关详细信息，请查看vSphere Client日志”</p>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>最近 VCSA 更换证书，导致底层证书不匹配。<br>关联业务只要托管 VCSA 的地址，均需要重新认证新SSL证书链接，比如vRops、Horizon等。</p>
<p>查看 VCSA的日志 （路径：&#x2F;var&#x2F;log&#x2F;vmware&#x2F;vsphere-ui&#x2F;logs&#x2F;vsphere_client_virgo.log）,显示Server certificate chain is not trusted and thumbprint doesn’t match 。</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><ol>
<li>SSH至目标 VCSA；</li>
<li>创建脚本并执行；执行指令 .&#x2F;脚本名  -cmlf</li>
<li>记录有问题的证书指纹；匹配字段 SHA1 Fingerprint&#x3D;</li>
<li>在提示 Proceed with updateing trust anchors?[Y&#x2F;N] ; 输入 Y</li>
<li>在提示 Enter SSO admin [<a href="mailto:&#x61;&#100;&#109;&#x69;&#110;&#x69;&#x73;&#x74;&#x72;&#x61;&#x74;&#x6f;&#x72;&#x40;&#118;&#115;&#x70;&#104;&#x65;&#x72;&#x65;&#46;&#x6c;&#x6f;&#99;&#97;&#108;">&#x61;&#100;&#109;&#x69;&#110;&#x69;&#x73;&#x74;&#x72;&#x61;&#x74;&#x6f;&#x72;&#x40;&#118;&#115;&#x70;&#104;&#x65;&#x72;&#x65;&#46;&#x6c;&#x6f;&#99;&#97;&#108;</a>] ; 输入 <a href="mailto:&#97;&#x64;&#109;&#105;&#x6e;&#x69;&#x73;&#x74;&#x72;&#x61;&#116;&#111;&#x72;&#64;&#x76;&#x73;&#112;&#x68;&#101;&#114;&#101;&#46;&#108;&#111;&#x63;&#97;&#x6c;">&#97;&#x64;&#109;&#105;&#x6e;&#x69;&#x73;&#x74;&#x72;&#x61;&#116;&#111;&#x72;&#64;&#x76;&#x73;&#112;&#x68;&#101;&#114;&#101;&#46;&#108;&#111;&#x63;&#97;&#x6c;</a> </li>
<li>在提示 Enter fingerprint of trust anchor(s) to update: ; 输入 No.3 记录的指纹</li>
<li>在提示 Enter the FQDN of the node to update: ; 输入 VCSA 的 FQDN 或者 IP</li>
<li>等待更新即可；</li>
</ol>
<p>关于脚本的参数</p>
<blockquote>
<p>-c ; 文本高亮，包含SHA1 Fingerprint<br>-m ; 显示当前设备的SSL 证书<br>-l ；与-m合用，显示所有节点的证书<br>-f ; 修复</p>
</blockquote>
<p>脚本文件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">setOptionColorize</span></span>() &#123;</span><br><span class="line">   RED=$(tput setaf 1)</span><br><span class="line">   GREEN=$(tput setaf 2)</span><br><span class="line">   YELLOW=$(tput setaf 3)</span><br><span class="line">   CYAN=$(tput setaf 6)</span><br><span class="line">   NORMAL=$(tput sgr0)</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">unknownOption</span></span>() &#123;</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;Unknown option &#x27;<span class="variable">$2</span>&#x27;. Please see &#x27;<span class="variable">$1</span> --help&#x27; for usage and available options&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">CURRENT_SERVICE_ID=<span class="string">&#x27;&#x27;</span></span><br><span class="line">SHOW_SERVICE_IDS=0</span><br><span class="line">SHOW_ENDPOINTS=0</span><br><span class="line">SHOW_DUPLICATE_ENDPOINTS=0</span><br><span class="line">LIVE_CHECK=0</span><br><span class="line">VIEW_MACHINE_SSL=0</span><br><span class="line">DEBUG=0</span><br><span class="line">FIX=0</span><br><span class="line">TP_ALGORITHM=<span class="string">&quot;sha1&quot;</span></span><br><span class="line">TP_REGEX_ITER=<span class="string">&quot;19&quot;</span></span><br><span class="line">CERT_TEXT=0</span><br><span class="line">CERT_COUNT=1</span><br><span class="line">RED=<span class="string">&#x27;&#x27;</span></span><br><span class="line">GREEN=<span class="string">&#x27;&#x27;</span></span><br><span class="line">YELLOW=<span class="string">&#x27;&#x27;</span></span><br><span class="line">CYAN=<span class="string">&#x27;&#x27;</span></span><br><span class="line">NORMAL=<span class="string">&#x27;&#x27;</span></span><br><span class="line">LSTOOL_FILE=<span class="string">&#x27;lstool.txt&#x27;</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;LIVE_CHECK&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">   VC_VERSION=$(grep <span class="string">&#x27;CLOUDVM_VERSION:&#x27;</span> /etc/vmware/.buildInfo | awk -F<span class="string">&#x27;:&#x27;</span> <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span> | awk -F<span class="string">&#x27;.&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   VC_VERSION=$(grep <span class="string">&#x27;CLOUDVM_VERSION:&#x27;</span> ../etc/vmware/.buildInfo | awk -F<span class="string">&#x27;:&#x27;</span> <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span> | awk -F<span class="string">&#x27;.&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;VC_VERSION&#125;</span> -eq 7 ]]; <span class="keyword">then</span></span><br><span class="line">   LS_PORT=<span class="string">&#x27;7090&#x27;</span></span><br><span class="line">   LSTOOL_SCRIPT=<span class="string">&#x27;/usr/lib/vmware-lookupsvc/tools/lstool.py&#x27;</span></span><br><span class="line">   LSUPDATE_SCRIPT=<span class="string">&#x27;/usr/lib/vmware-lookupsvc/tools/ls_update_certs.py&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   LS_PORT=<span class="string">&#x27;7080&#x27;</span></span><br><span class="line">   LSTOOL_SCRIPT=<span class="string">&#x27;/usr/lib/vmidentity/tools/scripts/lstool.py&#x27;</span></span><br><span class="line">   LSUPDATE_SCRIPT=<span class="string">&#x27;/usr/lib/vmidentity/tools/scripts/ls_update_certs.py&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [ -f /usr/bin/ldapsearch ]; <span class="keyword">then</span></span><br><span class="line">   LDAPSEARCH=<span class="string">&#x27;/usr/bin/ldapsearch&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   LDAPSEARCH=<span class="string">&#x27;/opt/likewise/bin/ldapsearch&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$#</span>&quot;</span> -ge 1 ]; <span class="keyword">then</span></span><br><span class="line">   <span class="keyword">for</span> arg <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">case</span> <span class="variable">$&#123;arg&#125;</span> <span class="keyword">in</span></span><br><span class="line">         -h|--<span class="built_in">help</span>)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;SSL Trust Anchor Verification Script&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> [options]&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Options:&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -s | --show-service-ids   Shows the Service IDs that are using a particular SSL certificate.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -e | --show-endpoints     Shows the Endpoing URIs that are using a particular SSL certificate.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -c | --colorize           Colorizes text for quick identification of Subject field, SHA1 Fingerprint, or&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             expired certificates. Do not use if passing output to a paginator or file.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -l | --live-check         Used in conjunction with the &#x27;-m|--machine-ssl&#x27; option, will indicate the script&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             is running on a live system, and will display current Machine SSL certificates&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             for all nodes with endpoints in the current SSO Site.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -m | --machine-ssl        Will display information on the current Machine SSL ceritifcate. Cannot be run on&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             a support bundle from an external Platform Services Controller.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -t | --cert-text          Will provide full output of each certificate similar to &#x27;openssl x509 -text&#x27;&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -f | --fix                Will prompt for SSO credentials, thumbprint of a trust anchor cert to update, and the IP/FQDN&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             of a node to update.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -d | --debug              Will include the raw certificate hash to see if there are any extra characters&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             (sometimes the lstool.py script has connection issues and STDERR gets randomly&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             inserted in the output).&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -h | --help               Prints this help menu.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -2 | --sha256             Outputs the SHA256 thumbprint of the certificates instead of the SHA1 thumbprint&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Parses the output of the following command from the Platform Services Controller:&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;LSTOOL_SCRIPT&#125;</span> list --url http://localhost:<span class="variable">$&#123;LS_PORT&#125;</span>/lookupservice/sdk 2&gt;/dev/null&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Can be run from the &#x27;commands/&#x27; directory of a support bundle, or live on a PSC node&quot;</span></span><br><span class="line">            <span class="built_in">exit</span></span><br><span class="line">            ;;</span><br><span class="line">  </span><br><span class="line">         --show-service-ids)</span><br><span class="line">            SHOW_SERVICE_IDS=1</span><br><span class="line">            ;;</span><br><span class="line">  </span><br><span class="line">         --show-endpoints)</span><br><span class="line">            SHOW_ENDPOINTS=1</span><br><span class="line">            ;;</span><br><span class="line">         --colorize)</span><br><span class="line">            setOptionColorize</span><br><span class="line">            ;;</span><br><span class="line">         --live-check)</span><br><span class="line">            LIVE_CHECK=1</span><br><span class="line">            ;;</span><br><span class="line">         --machine-ssl)</span><br><span class="line">            VIEW_MACHINE_SSL=1</span><br><span class="line">            ;;</span><br><span class="line">         --debug)</span><br><span class="line">            DEBUG=1</span><br><span class="line">            ;;</span><br><span class="line">         --cert-text)</span><br><span class="line">            CERT_TEXT=1</span><br><span class="line">            ;;</span><br><span class="line">         --fix)</span><br><span class="line">            FIX=1</span><br><span class="line">            ;;</span><br><span class="line">         --sha256)</span><br><span class="line">            TP_ALGORITHM=<span class="string">&quot;sha256&quot;</span></span><br><span class="line">            TP_REGEX_ITER=<span class="string">&quot;31&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">         -[seclmfdt2]*)</span><br><span class="line">        OPT=$(<span class="built_in">echo</span> <span class="string">&quot;z<span class="variable">$&#123;arg&#125;</span>&quot;</span> | sed <span class="string">&#x27;s/z-//&#x27;</span>)</span><br><span class="line">            <span class="keyword">for</span> (( i=<span class="number">0</span>; i&lt;<span class="variable">$&#123;#OPT&#125;</span>; i++ )); <span class="keyword">do</span></span><br><span class="line">               <span class="keyword">case</span> <span class="variable">$&#123;OPT:$i:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">                  s)</span><br><span class="line">                     SHOW_SERVICE_IDS=1</span><br><span class="line">                     ;;</span><br><span class="line">                  e)</span><br><span class="line">                     SHOW_ENDPOINTS=1</span><br><span class="line">                     ;;</span><br><span class="line">                  c)</span><br><span class="line">                     setOptionColorize</span><br><span class="line">                     ;;</span><br><span class="line">                  d)</span><br><span class="line">                     DEBUG=1</span><br><span class="line">                     ;;</span><br><span class="line">                  l)</span><br><span class="line">                     LIVE_CHECK=1</span><br><span class="line">                     ;;</span><br><span class="line">                  m)</span><br><span class="line">                     VIEW_MACHINE_SSL=1</span><br><span class="line">                     ;;</span><br><span class="line">                  t)</span><br><span class="line">                     CERT_TEXT=1</span><br><span class="line">                     ;;                 </span><br><span class="line">                  f)</span><br><span class="line">                     FIX=1</span><br><span class="line">                     ;;</span><br><span class="line">                  2)</span><br><span class="line">                     TP_ALGORITHM=<span class="string">&quot;sha256&quot;</span></span><br><span class="line">                     TP_REGEX_ITER=<span class="string">&quot;31&quot;</span></span><br><span class="line">                     ;;</span><br><span class="line">                  *)</span><br><span class="line">                     unknownOption <span class="variable">$0</span> <span class="string">&#x27;-$&#123;OPT:$i:1&#125;&#x27;</span></span><br><span class="line">                     <span class="built_in">exit</span></span><br><span class="line">                     ;;</span><br><span class="line">               <span class="keyword">esac</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">            ;;</span><br><span class="line">         *)</span><br><span class="line">            unknownOption <span class="variable">$0</span> <span class="variable">$&#123;arg&#125;</span></span><br><span class="line">            <span class="built_in">exit</span></span><br><span class="line">            ;;</span><br><span class="line">      <span class="keyword">esac</span></span><br><span class="line">   <span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;LIVE_CHECK&#125;</span> -eq 0 ]]; <span class="keyword">then</span></span><br><span class="line">   <span class="keyword">if</span> [ ! -f <span class="variable">$&#123;LSTOOL_FILE&#125;</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">if</span> [ ! -f <span class="string">&quot;python.exe_VMWARE_CIS_HOMEVMwareIdentityServiceslstoolscriptslstoolpy-list---url-httplocalhost7080lo[...].txt&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>No output from &#x27;lstool.py list&#x27; found in this bundle.&quot;</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         LSTOOL_FILE=<span class="string">&#x27;python.exe_VMWARE_CIS_HOMEVMwareIdentityServiceslstoolscriptslstoolpy-list---url-httplocalhost7080lo[...].txt&#x27;</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">if</span> [ -f ../etc/vmware/deployment.node.type ]; <span class="keyword">then</span></span><br><span class="line">      NODE_TYPE=$(<span class="built_in">cat</span> ../etc/vmware/deployment.node.type)</span><br><span class="line">   <span class="keyword">elif</span> [ -f ../ProgramData/VMware/vCenterServer/cfg/deployment.node.type ]; <span class="keyword">then</span></span><br><span class="line">      NODE_TYPE=$(<span class="built_in">cat</span> ../ProgramData/VMware/vCenterServer/cfg/deployment.node.type)</span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   NODE_TYPE=$(<span class="built_in">cat</span> /etc/vmware/deployment.node.type)</span><br><span class="line">   <span class="keyword">if</span> [ <span class="variable">$&#123;NODE_TYPE&#125;</span> == <span class="string">&#x27;management&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>Operation not supported on a Management Node. Please run this live on a PSC node. Exiting...<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">      <span class="built_in">exit</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">   <span class="keyword">if</span> [ ! -f <span class="variable">$&#123;LSTOOL_FILE&#125;</span> ]; <span class="keyword">then</span> LSTOOL_FILE=<span class="string">&#x27;/tmp/lstool.txt&#x27;</span>; <span class="keyword">fi</span></span><br><span class="line">       </span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>No &#x27;lstool.txt&#x27; file found in this directory. Dumping service registrations to <span class="variable">$&#123;LSTOOL_FILE&#125;</span>...<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">   <span class="variable">$&#123;LSTOOL_SCRIPT&#125;</span> list --url http://localhost:<span class="variable">$&#123;LS_PORT&#125;</span>/lookupservice/sdk 2&gt;/tmp/lstool_stderr &gt; <span class="variable">$&#123;LSTOOL_FILE&#125;</span>     </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">DATA=$(<span class="built_in">cat</span> <span class="variable">$&#123;LSTOOL_FILE&#125;</span> | grep -vE <span class="string">&#x27;^[0-9]&#123;4&#125;-[0-9]&#123;2&#125;-[0-9]&#123;2&#125;&#x27;</span> | grep -E <span class="string">&#x27;Service ID:|URL:|SSL trust:|^[0-9A-Za-z/\+]&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27; &#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;\n&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;\t&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;\r\n&#x27;</span> | sed -e <span class="string">&#x27;s/ServiceID:/\nServiceID:/g&#x27;</span> -e <span class="string">&#x27;s/URL:/\nURL:/g&#x27;</span> -e <span class="string">&#x27;s/SSLtrust:/\nSSLtrust:/g&#x27;</span>)</span><br><span class="line">TRUST_ANCHORS=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;DATA&#125;</span>&quot;</span> | grep <span class="string">&#x27;SSLtrust&#x27;</span> | sed -e <span class="string">&#x27;s/SSLtrust://g&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span>)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> RAW_HASH <span class="keyword">in</span> <span class="variable">$&#123;TRUST_ANCHORS&#125;</span>; <span class="keyword">do</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>-----Endpoint Certificate <span class="variable">$&#123;CERT_COUNT&#125;</span>-----<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">  </span><br><span class="line">   <span class="keyword">if</span> [[ <span class="variable">$&#123;RAW_HASH&#125;</span> =~ [0-9]&#123;4&#125;-[0-9]&#123;2&#125;-[0-9]&#123;2&#125; ]]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;RED&#125;</span>Malformed hash detected<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">      BAD=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;RAW_HASH&#125;</span>&quot;</span> | grep -oE <span class="string">&#x27;[0-9]&#123;4&#125;-[0-9]&#123;2&#125;-[0-9]&#123;2&#125;(.)+&#x27;</span>)</span><br><span class="line">      HASH=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$&#123;RAW_HASH&#125;</span>&quot;</span> | sed -e &#x27;s/$&#123;BAD&#125;//&#x27;)</span>&quot;</span></span><br><span class="line">      CHARS=<span class="variable">$&#123;#HASH&#125;</span></span><br><span class="line">      MOD=$((<span class="variable">$&#123;CHARS&#125;</span> % <span class="number">4</span>))</span><br><span class="line">      <span class="keyword">case</span> <span class="variable">$&#123;MOD&#125;</span> <span class="keyword">in</span></span><br><span class="line">         3)</span><br><span class="line">            HASH=<span class="string">&quot;<span class="variable">$&#123;HASH&#125;</span>=&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">         2)</span><br><span class="line">            HASH=<span class="string">&quot;<span class="variable">$&#123;HASH&#125;</span>==&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">      <span class="keyword">esac</span></span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">      HASH=<span class="variable">$&#123;RAW_HASH&#125;</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">   CURRENT_CERT=<span class="string">&quot;-----BEGIN CERTIFICATE-----&quot;</span>$<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">   CURRENT_CERT+=$(<span class="built_in">echo</span> <span class="variable">$&#123;HASH&#125;</span> | <span class="built_in">fold</span> -c64)</span><br><span class="line">   CURRENT_CERT+=$<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;-----END CERTIFICATE-----&quot;</span></span><br><span class="line">  </span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT&#125;</span>&quot;</span> | openssl x509 -text &gt; /dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">if</span> [[ <span class="variable">$&#123;CERT_TEXT&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">         CURRENT_CERT_INFO=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT&#125;</span>&quot;</span> | openssl x509 -text -noout -fingerprint -<span class="variable">$&#123;TP_ALGORITHM&#125;</span> | sed -e <span class="string">&#x27;s/SHA[0-9]* Fingerprint/\t&amp;/g&#x27;</span> -e <span class="string">&quot;s/Subject:/<span class="variable">$&#123;GREEN&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span> -e <span class="string">&quot;s/[[:xdigit:]]\&#123;2\&#125;\(:[[:xdigit:]]\&#123;2\&#125;\)\&#123;<span class="variable">$&#123;TP_REGEX_ITER&#125;</span>\&#125;/<span class="variable">$&#123;YELLOW&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span> -e <span class="string">&quot;s/X509v3 Subject Alternative Name/<span class="variable">$&#123;GREEN&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span>)</span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT_INFO&#125;</span>&quot;</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         CURRENT_CERT_INFO=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT&#125;</span>&quot;</span> | openssl x509 -text -noout -fingerprint -<span class="variable">$&#123;TP_ALGORITHM&#125;</span> | grep -E <span class="string">&#x27;Issuer:|Subject:|Validity|Not Before:|Not After :|Fingerprint&#x27;</span> | sed -e <span class="string">&#x27;s/SHA[0-9]* Fingerprint/\t&amp;/g&#x27;</span> -e <span class="string">&quot;s/Subject:/<span class="variable">$&#123;GREEN&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span> -e <span class="string">&quot;s/[[:xdigit:]]\&#123;2\&#125;\(:[[:xdigit:]]\&#123;2\&#125;\)\&#123;<span class="variable">$&#123;TP_REGEX_ITER&#125;</span>\&#125;/<span class="variable">$&#123;YELLOW&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span>)</span><br><span class="line">  </span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;Certificate Info:&quot;</span></span><br><span class="line">         <span class="keyword">if</span> <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT&#125;</span>&quot;</span> | openssl x509 -noout -checkend 0; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT_INFO&#125;</span>&quot;</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT_INFO&#125;</span>&quot;</span> | sed -e <span class="string">&quot;s/Not Before/<span class="variable">$&#123;RED&#125;</span>&amp;/&quot;</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">         <span class="keyword">if</span> [[ <span class="variable">$&#123;DEBUG&#125;</span> -gt 0 ]]; <span class="keyword">then</span> <span class="built_in">echo</span> $<span class="string">&#x27;\t&#x27;</span><span class="string">&quot;Certificate Hash: <span class="variable">$&#123;HASH&#125;</span>&quot;</span>; <span class="keyword">fi</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;RED&#125;</span>Unable to parse certificate hash<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">      <span class="keyword">if</span> [[ <span class="variable">$&#123;DEBUG&#125;</span> -gt 0 ]]; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;HASH&#125;</span>&quot;</span>; <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">   <span class="keyword">if</span> [[ <span class="variable">$&#123;SHOW_SERVICE_IDS&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">      REGEX_HASH=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;RAW_HASH&#125;</span>&quot;</span> | sed -e <span class="string">&#x27;s/\+/\\+/g&#x27;</span> -e <span class="string">&#x27;s/\$/\\$/g&#x27;</span>)</span><br><span class="line">      FOUND_SERVICE_IDS=<span class="string">&#x27;&#x27;</span></span><br><span class="line">  </span><br><span class="line">      <span class="keyword">for</span> line <span class="keyword">in</span> $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;DATA&#125;</span>&quot;</span> | grep -vE <span class="string">&#x27;^URL:&#x27;</span> | <span class="built_in">uniq</span> | grep -E <span class="string">&quot;ServiceID|<span class="variable">$&#123;REGEX_HASH&#125;</span>&quot;</span> | grep -B1 <span class="variable">$&#123;RAW_HASH&#125;</span>); <span class="keyword">do</span></span><br><span class="line">         <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;line&#125;</span>&quot;</span> =~ ^ServiceID ]]; <span class="keyword">then</span></span><br><span class="line">            CURRENT_SERVICE_ID=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;line&#125;</span>&quot;</span> | sed -e <span class="string">&#x27;s/ServiceID://g&#x27;</span>)</span><br><span class="line">         <span class="keyword">elif</span> $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;line&#125;</span>&quot;</span> | grep <span class="variable">$&#123;RAW_HASH&#125;</span> &gt; /dev/null); <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$&#123;FOUND_SERVICE_IDS&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">               FOUND_SERVICE_IDS=$<span class="string">&#x27;\t&#x27;</span><span class="string">&quot;<span class="variable">$&#123;CURRENT_SERVICE_ID&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">               FOUND_SERVICE_IDS+=$<span class="string">&#x27;\n\t&#x27;</span><span class="string">&quot;<span class="variable">$&#123;CURRENT_SERVICE_ID&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">      <span class="keyword">done</span></span><br><span class="line">  </span><br><span class="line">      NUM_FOUND_SERVICE_IDS=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;FOUND_SERVICE_IDS&#125;</span>&quot;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">  </span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;Service IDs (<span class="variable">$&#123;NUM_FOUND_SERVICE_IDS&#125;</span>):&quot;</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;FOUND_SERVICE_IDS&#125;</span>&quot;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">   <span class="keyword">if</span> [[ <span class="variable">$&#123;SHOW_ENDPOINTS&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">      ENDPOINTS=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;DATA&#125;</span>&quot;</span> | grep -vE <span class="string">&#x27;^ServiceID&#x27;</span> | grep -B1 <span class="variable">$&#123;RAW_HASH&#125;</span> | grep -E <span class="string">&#x27;^URL:&#x27;</span> | sed -e <span class="string">&#x27;s/URL:/\t/g&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span>)</span><br><span class="line">      NUM_ENDPOINTS=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;ENDPOINTS&#125;</span>&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">  </span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;Endpoints (<span class="variable">$&#123;NUM_ENDPOINTS&#125;</span>):&quot;</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;ENDPOINTS&#125;</span>&quot;</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>--------------------------------<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">   ((++CERT_COUNT))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;VIEW_MACHINE_SSL&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">   <span class="keyword">if</span> [[ <span class="variable">$&#123;LIVE_CHECK&#125;</span> -eq 0 ]]; <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;NODE_TYPE&#125;</span>&quot;</span> = <span class="string">&#x27;infrastructure&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">         <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>The Machine SSL certificate is not included in an external PSC support bundle.<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         <span class="keyword">if</span> [ -f ../etc/vmware-vpx/ssl/rui.crt ]; <span class="keyword">then</span></span><br><span class="line">            MACHINE_SSL_FILE=<span class="string">&#x27;../etc/vmware-vpx/ssl/rui.crt&#x27;</span></span><br><span class="line">         <span class="keyword">elif</span> [ -f ../ProgramData/VMware/vCenterServer/cfg/vmware-vpx/ssl/rui.crt ]; <span class="keyword">then</span></span><br><span class="line">            MACHINE_SSL_FILE=<span class="string">&#x27;../ProgramData/VMware/vCenterServer/cfg/vmware-vpx/ssl/rui.crt&#x27;</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">         <span class="keyword">if</span> [ ! -z <span class="variable">$&#123;MACHINE_SSL_FILE&#125;</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>-----Machine SSL Certificate-----<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">            CURRENT_MACHINE_SSL_CERT_INFO=$(<span class="built_in">cat</span> <span class="variable">$&#123;MACHINE_SSL_FILE&#125;</span> | openssl x509 -text -noout -fingerprint -<span class="variable">$&#123;TP_ALGORITHM&#125;</span> | grep -E <span class="string">&#x27;Issuer:|Subject:|Validity|Not Before:|Not After :|Fingerprint&#x27;</span> | sed -e <span class="string">&#x27;s/SHA[0-9]* Fingerprint/\t&amp;/g&#x27;</span> -e <span class="string">&quot;s/Subject:/<span class="variable">$&#123;GREEN&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span> -e <span class="string">&quot;s/[[:xdigit:]]\&#123;2\&#125;\(:[[:xdigit:]]\&#123;2\&#125;\)\&#123;<span class="variable">$&#123;TP_REGEX_ITER&#125;</span>\&#125;/<span class="variable">$&#123;YELLOW&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span>)</span><br><span class="line">  </span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Certificate Info:&quot;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$&#123;MACHINE_SSL_FILE&#125;</span>&quot;</span> | openssl x509 -noout -checkend 0; <span class="keyword">then</span></span><br><span class="line">               <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_MACHINE_SSL_CERT_INFO&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">               <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_MACHINE_SSL_CERT_INFO&#125;</span>&quot;</span> | sed -e <span class="string">&quot;s/Not Before/<span class="variable">$&#123;RED&#125;</span>&amp;/&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>---------------------------------<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>Unable to locate the Machine SSL certificate file in the support bundle.<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">      SSO_DOMAIN=$(/usr/lib/vmware-vmafd/bin/vmafd-cli get-domain-name --server-name localhost)</span><br><span class="line">      SSO_SITE=$(/usr/lib/vmware-vmafd/bin/vmafd-cli get-site-name --server-name localhost)</span><br><span class="line">      VMDIR_DC_BRANCH=<span class="string">&quot;dc=<span class="subst">$(echo $&#123;SSO_DOMAIN&#125; | sed &#x27;s/\./,dc=/g&#x27;)</span>&quot;</span></span><br><span class="line">      VMDIR_MACHINE_PASSWORD=$(/opt/likewise/bin/lwregshell list_values <span class="string">&#x27;[HKEY_THIS_MACHINE\services\vmdir]&#x27;</span> | grep dcAccountPassword | awk -F<span class="string">&quot;  &quot;</span> <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span> | awk <span class="string">&#x27;&#123;print substr($0,2,length($0)-2)&#125;&#x27;</span> | sed -e <span class="string">&#x27;s/\\&quot;/&quot;/g&#x27;</span> -e <span class="string">&#x27;s/\\\\/\\/g&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;\n&#x27;</span> &gt; /tmp/.vmdir_machine_account_password; <span class="built_in">chmod</span> go-r /tmp/.vmdir_machine_account_password)</span><br><span class="line">      VMDIR_MACHINE_ACCOUNT_DN=$(/opt/likewise/bin/lwregshell list_values <span class="string">&#x27;[HKEY_THIS_MACHINE\services\vmdir]&#x27;</span> | grep <span class="string">&#x27;&quot;dcAccountDN&quot;&#x27;</span> | awk -F<span class="string">&quot;  &quot;</span> <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span> | awk <span class="string">&#x27;&#123;print substr($0,2,length($0)-2)&#125;&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">      SITE_NODES=$(<span class="variable">$&#123;LDAPSEARCH&#125;</span> -LLL -h localhost -p 389 -b <span class="string">&quot;cn=ServiceRegistrations,cn=LookupService,cn=<span class="variable">$&#123;SSO_SITE&#125;</span>,cn=Sites,cn=Configuration,<span class="variable">$&#123;VMDIR_DC_BRANCH&#125;</span>&quot;</span> -D <span class="string">&quot;<span class="variable">$&#123;VMDIR_MACHINE_ACCOUNT_DN&#125;</span>&quot;</span> -y /tmp/.vmdir_machine_account_password <span class="string">&quot;(objectclass=vmwLKUPEndpointRegistration)&quot;</span> vmwLKUPURI | grep <span class="string">&#x27;^vmwLKUPURI&#x27;</span> | sed -e <span class="string">&#x27;s/vmwLKUPURI://g&#x27;</span> | awk -F<span class="string">&#x27;/&#x27;</span> <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | awk -F<span class="string">&#x27;:&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -i | grep -v localhost)</span><br><span class="line">  </span><br><span class="line">      <span class="built_in">rm</span> /tmp/.vmdir_machine_account_password</span><br><span class="line">      <span class="built_in">printf</span> <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">  </span><br><span class="line">      <span class="keyword">for</span> node <span class="keyword">in</span> <span class="variable">$&#123;SITE_NODES&#125;</span>; <span class="keyword">do</span></span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>-----Machine SSL Certificate-----<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span><span class="variable">$&#123;node&#125;</span><span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">         CURRENT_MACHINE_SSL_CERT_INFO=$(<span class="built_in">echo</span> | openssl s_client -connect <span class="variable">$&#123;node&#125;</span>:443 2&gt;/dev/null | openssl x509 -text -noout -fingerprint -<span class="variable">$&#123;TP_ALGORITHM&#125;</span> | grep -E <span class="string">&#x27;Issuer:|Subject:|Validity|Not Before:|Not After :|Fingerprint&#x27;</span> | sed -e <span class="string">&#x27;s/SHA[0-9]* Fingerprint/\t&amp;/g&#x27;</span> -e <span class="string">&quot;s/Subject:/<span class="variable">$&#123;GREEN&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span> -e <span class="string">&quot;s/[[:xdigit:]]\&#123;2\&#125;\(:[[:xdigit:]]\&#123;2\&#125;\)\&#123;<span class="variable">$&#123;TP_REGEX_ITER&#125;</span>\&#125;/<span class="variable">$&#123;YELLOW&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span>)</span><br><span class="line">  </span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;Certificate Info:&quot;</span></span><br><span class="line">         <span class="keyword">if</span> <span class="built_in">echo</span> | openssl s_client -connect <span class="variable">$&#123;node&#125;</span>:443 2&gt;/dev/null | openssl x509 -noout -checkend 0; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_MACHINE_SSL_CERT_INFO&#125;</span>&quot;</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_MACHINE_SSL_CERT_INFO&#125;</span>&quot;</span> | sed -e <span class="string">&quot;s/Not Before/<span class="variable">$&#123;RED&#125;</span>&amp;/&quot;</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>---------------------------------<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">      <span class="keyword">done</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;FIX&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">   <span class="keyword">if</span> [[ <span class="variable">$&#123;LIVE_CHECK&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">if</span> [ ! -f <span class="variable">$&#123;LSUPDATE_SCRIPT&#125;</span> ]; <span class="keyword">then</span></span><br><span class="line">         <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>The <span class="variable">$&#123;LSUPDATE_SCRIPT&#125;</span> script could not be found. Please ensure you are running this from a PSC.<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">      <span class="keyword">else</span>   </span><br><span class="line">         <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>SSL Trust Anchor Repair<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>---------------------------------<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;This process will attempt to update the SSL trust anchors for Lookup Service registrations using native Lookup Service libraries. These changes should propagate to all PSCs in the SSO domain.&quot;</span></span><br><span class="line">         <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>It is strongly recommended that you take offline snapshots of all PSCs in the SSO domain before proceeding.<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">         <span class="built_in">read</span> -p $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Proceed with updating trust anchors? [Y/N]: &quot;</span> PROCEED</span><br><span class="line">         <span class="keyword">if</span> [ -z <span class="variable">$&#123;PROCEED&#125;</span> ]; <span class="keyword">then</span> PROCEED_FIX=<span class="string">&quot;n&quot;</span>; <span class="keyword">else</span> PROCEED_FIX=$(<span class="built_in">echo</span> <span class="variable">$&#123;PROCEED&#125;</span> | awk <span class="string">&#x27;&#123;print tolower(substr($0,0,1))&#125;&#x27;</span>); <span class="keyword">fi</span></span><br><span class="line">         <span class="keyword">if</span> [ <span class="variable">$&#123;PROCEED_FIX&#125;</span> == <span class="string">&quot;y&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">            SSO_DOMAIN=$(/usr/lib/vmware-vmafd/bin/vmafd-cli get-domain-name --server-name localhost)</span><br><span class="line">            <span class="built_in">read</span> -p $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Enter SSO admin [administrator@<span class="variable">$&#123;SSO_DOMAIN&#125;</span>]: &quot;</span> LOGIN</span><br><span class="line">            <span class="keyword">if</span> [ -z <span class="variable">$&#123;LOGIN&#125;</span> ]; <span class="keyword">then</span> LOGIN=<span class="string">&quot;administrator@<span class="variable">$&#123;SSO_DOMAIN&#125;</span>&quot;</span>; <span class="keyword">fi</span></span><br><span class="line">            <span class="built_in">read</span> -s -p <span class="string">&quot;Enter password for <span class="variable">$&#123;LOGIN&#125;</span>: &quot;</span> PASSWORD_INPUT</span><br><span class="line">            PASSWORD=$(<span class="built_in">echo</span> <span class="variable">$&#123;PASSWORD_INPUT&#125;</span> | sed <span class="string">&quot;s/&#x27;/&#x27;\\\&#x27;&#x27;/g&quot;</span>)</span><br><span class="line">            <span class="built_in">read</span> -p $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Enter fingerprint of trust anchor(s) to update: &quot;</span> FINGERPRINT</span><br><span class="line">            <span class="built_in">read</span> -p <span class="string">&quot;Enter the FQDN of the node to update: &quot;</span> NODE_FQDN</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">echo</span> <span class="string">&#x27;y&#x27;</span> | openssl s_client -connect <span class="variable">$&#123;NODE_FQDN&#125;</span>:443 2&gt;/dev/null | openssl x509 &gt; /tmp/machine-ssl.crt; <span class="keyword">then</span></span><br><span class="line">               <span class="keyword">if</span> ! <span class="variable">$&#123;LSUPDATE_SCRIPT&#125;</span> --url http://localhost:<span class="variable">$&#123;LS_PORT&#125;</span>/lookupservice/sdk 2&gt;/tmp/ls_update_certs.stderr --fingerprint <span class="variable">$&#123;FINGERPRINT&#125;</span> --certfile /tmp/machine-ssl.crt --user <span class="variable">$&#123;LOGIN&#125;</span>  --password $(<span class="built_in">eval</span> <span class="built_in">echo</span> <span class="string">&quot;&#x27;<span class="variable">$&#123;PASSWORD&#125;</span>&#x27;&quot;</span>); <span class="keyword">then</span></span><br><span class="line">                  <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>The ls_update_certs.py script encountered an error.&quot;</span></span><br><span class="line">                  <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Please refer to /tmp/ls_update_certs.stderr for more information.<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">               <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">               <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>Unable to obtain SSL certificate from <span class="variable">$&#123;NODE_FQDN&#125;</span>. Exiting...&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Operation aborted. Exiting...&quot;</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>Fixing trust anchors can only be done on a live system.<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>


<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>证书修复 ： <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maym/p/17789156.html">https://www.cnblogs.com/maym/p/17789156.html</a><br>信任锚(Trust Anchors) : <a target="_blank" rel="noopener" href="https://www.ibm.com/docs/en/transparent-supply?topic=roles-trust-anchors">https://www.ibm.com/docs/en/transparent-supply?topic=roles-trust-anchors</a><br>信任锚 ： <a target="_blank" rel="noopener" href="http://i-wall.cn/h-nd-104.html">http://i-wall.cn/h-nd-104.html</a><br>日志查看 ：<a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/74731?lang=zh_CN">https://kb.vmware.com/s/article/74731?lang=zh_CN</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/7b993e05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/7b993e05/" class="post-title-link" itemprop="url">VMware Horizon View-常见问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-07 12:47:06" itemprop="dateCreated datePublished" datetime="2024-03-07T12:47:06+00:00">2024-03-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/Horizon-View/" itemprop="url" rel="index"><span itemprop="name">Horizon View</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Server类故障"><a href="#Server类故障" class="headerlink" title="Server类故障"></a>Server类故障</h1><h2 id="目标VDI提示被禁用，无法通过客户端重置桌面"><a href="#目标VDI提示被禁用，无法通过客户端重置桌面" class="headerlink" title="目标VDI提示被禁用，无法通过客户端重置桌面"></a>目标VDI提示被禁用，无法通过客户端重置桌面</h2><h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><ol>
<li>Connection Server 托管的vCenter服务异常；</li>
<li>目标VDI对应的虚拟机不存在；</li>
</ol>
<h1 id="Agent类故障"><a href="#Agent类故障" class="headerlink" title="Agent类故障"></a>Agent类故障</h1><h2 id="目标VDI在Connection-Server中提示“无法访问代理”"><a href="#目标VDI在Connection-Server中提示“无法访问代理”" class="headerlink" title="目标VDI在Connection Server中提示“无法访问代理”"></a>目标VDI在Connection Server中提示“无法访问代理”</h2><h3 id="原因分析-1"><a href="#原因分析-1" class="headerlink" title="原因分析"></a>原因分析</h3><ol>
<li>VDI内的网络异常，到Connection Server的必要端口没有放行；</li>
<li>VDI内的Agent进程异常，客户端内的VMware Horizon View Agent没有正常运行，其中的关联服务没有启动；</li>
<li>VDI内没有办法正常解析Connection Server的域名，导致无法与对端建立连接；【DNS解析异常】</li>
<li>Connection Server与VDI的通讯密钥需要更新；</li>
</ol>
<p>原因1，必要端口：</p>
<table>
<thead>
<tr>
<th align="center">SRC</th>
<th align="center">DST</th>
<th align="center">TCP-Port</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Agent</td>
<td align="center">CS</td>
<td align="center">4001</td>
<td align="left">Java Message Service communication , JMS</td>
</tr>
<tr>
<td align="center">Agent</td>
<td align="center">CS</td>
<td align="center">4002</td>
<td align="left">Java Message Service communication , Java Message Service (JMS) when using enhanced security (default).</td>
</tr>
<tr>
<td align="center">Agent</td>
<td align="center">CS</td>
<td align="center">389</td>
<td align="left">Only required when doing an unmanaged agent registration, for example, RDSH agent install without linked-clone or instant-clone component.</td>
</tr>
</tbody></table>
<p>参考： <a target="_blank" rel="noopener" href="https://ports.esp.vmware.com/home/Horizon">https://ports.esp.vmware.com/home/Horizon</a></p>
<p>可以在操作系统中执行相关指令确认：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Windows , run powershell as administrator</span></span><br><span class="line">netstat -ano | findstr [Target TCP port]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux , run command as sudo permission</span></span><br><span class="line">netstat -ano | gre [Target TCP port]</span><br></pre></td></tr></table></figure>

<p>原因2，关联服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Windows , run powerhsell as administrator</span></span><br><span class="line">netstat -ano | findstr vmware</span><br><span class="line"></span><br><span class="line"><span class="comment"># [TODO] Should have :</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux , run command as sudo permission</span></span><br><span class="line">ps -aux | grep vmware</span><br><span class="line"></span><br><span class="line"><span class="comment"># Should have : </span></span><br><span class="line"><span class="comment"># viewagent/jre/bin/java </span></span><br><span class="line"><span class="comment"># viewagent/bin/GetMachineId.sh </span></span><br><span class="line"><span class="comment"># viewagent/DekstopDaemon/desktopDaemon</span></span><br><span class="line"><span class="comment"># viewagent/VMwareBlastServer/BlastServer</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/ae9c0f2f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/ae9c0f2f/" class="post-title-link" itemprop="url">wireguard配置实例</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-07 01:15:45" itemprop="dateCreated datePublished" datetime="2024-03-07T01:15:45+00:00">2024-03-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/default/" itemprop="url" rel="index"><span itemprop="name">default</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://devld.me/2020/07/27/wireguard-setup/">https://devld.me/2020/07/27/wireguard-setup/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/d2146460/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/d2146460/" class="post-title-link" itemprop="url">服务器安装Windows Server异常提示无法安装到这个磁盘</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-05 00:28:51" itemprop="dateCreated datePublished" datetime="2024-02-05T00:28:51+00:00">2024-02-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">服务器与存储</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">服务器</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><p>安装操作系统提示:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Windows 无法安装到这个磁盘。这台计算机的硬件可能不支持启动到此次盘。请确保在计算机的 BIOS 菜单中启用了磁盘的控制器。</span><br><span class="line"></span><br><span class="line">Windows cannot be installed to this disk. This computer&amp;＃39;s hardware may not support booting to this disk. Ensure that the disk&amp;＃39;s controller is enabled in the computer&amp;＃39;s BIOS menu.</span><br></pre></td></tr></table></figure>

<h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p>阵列组并未作为启动卷。</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>到阵列卡中设置卷为启动卷。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://zhiliao.h3c.com/Theme/details/20319">https://zhiliao.h3c.com/Theme/details/20319</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/e52c31c7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/e52c31c7/" class="post-title-link" itemprop="url">Linux下安装Intel Ethernet Controller X710驱动</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-05 00:20:29" itemprop="dateCreated datePublished" datetime="2024-02-05T00:20:29+00:00">2024-02-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">服务器与存储</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">服务器</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><p>Linux中无法识别到X710的网卡，使用 lspci 指令可以看到目标网卡可以在系统中识别到，但是无法直接使用用 ip ad无法看到对应端口。因此是驱动问题，需要手动安装驱动。</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看原版驱动</span></span><br><span class="line">lspci | grep net</span><br><span class="line"><span class="comment"># 可以看到所有网卡信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载驱动</span></span><br><span class="line">https://www.intel.cn/content/www/cn/zh/download/18026/intel-network-adapter-driver-for-pcie-40-gigabit-ethernet-network-connections-under-linux.html?wapkw=Intel(R)%20Ethernet%20Controller%20X710</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压驱动包</span></span><br><span class="line">tar vxf i40e-2.22.18.tar.gz</span><br><span class="line"><span class="comment"># 进入src目录</span></span><br><span class="line"><span class="built_in">cd</span> i40e-2.22.18/src/</span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">make install</span><br><span class="line"><span class="comment"># 更新内核文件</span></span><br><span class="line">modinfo i40e</span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">reboot</span><br><span class="line"><span class="comment"># 检查驱动</span></span><br><span class="line">ethtool -i [对应网口]</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xujiecnblogs/p/17401832.html">https://www.cnblogs.com/xujiecnblogs/p/17401832.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/4abed311/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/4abed311/" class="post-title-link" itemprop="url">ESXI 安装ipmitools</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-05 00:12:25" itemprop="dateCreated datePublished" datetime="2024-02-05T00:12:25+00:00">2024-02-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:47" itemprop="dateModified" datetime="2024-12-22T05:27:47+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/vSphere/" itemprop="url" rel="index"><span itemprop="name">vSphere</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="下载ipmitool-esxi-vib软件"><a href="#下载ipmitool-esxi-vib软件" class="headerlink" title="下载ipmitool-esxi-vib软件"></a>下载ipmitool-esxi-vib软件</h1><p><a target="_blank" rel="noopener" href="https://vswitchzero.files.wordpress.com/2019/08/ipmitool-esxi-vib-1.8.11-2.zip">https://vswitchzero.files.wordpress.com/2019/08/ipmitool-esxi-vib-1.8.11-2.zip</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MD5值核验</span></span><br><span class="line">ipmitool-esxi-vib-1.8.11-2.zip = 444af4ce1dc68418583dba2926093980</span><br><span class="line">ipmitool-1.8.11-2-offline_bundle.zip = 44cb77cc8bd7f969b8e74eb33aec8d71</span><br><span class="line">ipmitool-1.8.11-2.x86_64.vib = 173db5b9f205d9c10d9458ff76d8954b</span><br></pre></td></tr></table></figure>

<h1 id="上传VIB文件并安装"><a href="#上传VIB文件并安装" class="headerlink" title="上传VIB文件并安装"></a>上传VIB文件并安装</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改安装许可级别</span></span><br><span class="line">esxcli software acceptance <span class="built_in">set</span> --level=CommunitySupported</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装软件</span></span><br><span class="line">esxcli software vib install -v /tmp/ipmitool-1.8.11-2.x86_64.vib</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行ipmitool指令</span></span><br><span class="line">/opt/ipmitool/ipmitool</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载ipmitool指令</span></span><br><span class="line">esxcli software vib remove -n ipmitool</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://vswitchzero.com/ipmitool-vib/">https://vswitchzero.com/ipmitool-vib/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/7df976fa/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/7df976fa/" class="post-title-link" itemprop="url">关闭VCLS虚拟机</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-11-15 00:08:09" itemprop="dateCreated datePublished" datetime="2023-11-15T00:08:09+00:00">2023-11-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/vSphere/" itemprop="url" rel="index"><span itemprop="name">vSphere</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h1><p>从 vSphere 7 开始，集群中会部署vCLS虚拟机用于集群管理；但是vCLS虚拟机需要检查ESXi主机的BIOS设置，CPU选项需要开启“MWAIT”选项。<br>如果没有开启，则vCLS虚拟机会无法启动，而vCenter会一直尝试部署开机；</p>
<p>因此短期需要关闭vCLS部署；长期来看，需要开启底层BIOS设置；</p>
<blockquote>
<p>Monitor 指令：MONITOR EAX, ECX, EDX；设置硬件要监视的线性地址范围，并激活监视器。地址范围应该是写回内存缓存型。</p>
</blockquote>
<blockquote>
<p>Mwait指令：MwAIT EAX, ECX；这是一个提示，允许处理器停止指令执行，并进入取决于具体版本的优化状态，直到发生某类事件。</p>
</blockquote>
<h1 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h1><ol>
<li>登录 vCenter Client；</li>
<li>选中集群，会在URL中看到集群域ID，类似于 domain-c<number>；</li>
<li>进入vCenter配置选项；</li>
<li>进入高级配置选项；点击编辑设置；</li>
<li>添加参数  config.vcls.clusters.domain-c<number>.enabled 且值为 False 的新条目；</li>
<li>保存退出即可；</li>
</ol>
<blockquote>
<p>设置完后，vCLS 监控服务将启动 vCLS 虚拟机的清理，用户将开始看到删除虚拟机的任务。<br>如果此集群启用了 DRS，则它将不起作用，并会在集群摘要中显示额外的警告。在此集群上重新启用 vCLS 之前，DRS 将一直处于禁用状态。<br>要从集群中移除撤回模式，请在上面的步骤 5 中将值更改为 True。 </p>
</blockquote>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/80472?lang=zh_CN">https://kb.vmware.com/s/article/80472?lang=zh_CN</a><br>Mwait设置： <a target="_blank" rel="noopener" href="https://support.huawei.com/enterprise/zh/knowledge/EKB1100006339">https://support.huawei.com/enterprise/zh/knowledge/EKB1100006339</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/e3237ebb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/e3237ebb/" class="post-title-link" itemprop="url">常用Python脚本</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-11-09 00:07:43" itemprop="dateCreated datePublished" datetime="2023-11-09T00:07:43+00:00">2023-11-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">基础知识</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%BC%96%E7%A8%8B/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (判断语句):</span><br><span class="line">    执行条件</span><br></pre></td></tr></table></figure>

<blockquote>
<p>没有{}，没有; ，注意缩进格式，注意: 。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">含义</th>
<th align="center">符号</th>
</tr>
</thead>
<tbody><tr>
<td align="center">大于</td>
<td align="center">&gt;</td>
</tr>
<tr>
<td align="center">小于</td>
<td align="center">&lt;</td>
</tr>
<tr>
<td align="center">大于等于</td>
<td align="center">&gt;&#x3D;</td>
</tr>
<tr>
<td align="center">小于等于</td>
<td align="center">&lt;&#x3D;</td>
</tr>
<tr>
<td align="center">赋值</td>
<td align="center">&#x3D;</td>
</tr>
<tr>
<td align="center">相等</td>
<td align="center">&#x3D;&#x3D;</td>
</tr>
<tr>
<td align="center">不等</td>
<td align="center">!&#x3D;</td>
</tr>
<tr>
<td align="center">相等(对象)</td>
<td align="center">is</td>
</tr>
<tr>
<td align="center">不等(对象)</td>
<td align="center">is not</td>
</tr>
<tr>
<td align="center">逻辑非</td>
<td align="center">not</td>
</tr>
<tr>
<td align="center">逻辑与</td>
<td align="center">and</td>
</tr>
<tr>
<td align="center">逻辑或</td>
<td align="center">or</td>
</tr>
<tr>
<td align="center">位运算 或</td>
<td align="center">|</td>
</tr>
<tr>
<td align="center">位运算 异或</td>
<td align="center">^</td>
</tr>
<tr>
<td align="center">位运算 与</td>
<td align="center">&amp;</td>
</tr>
</tbody></table>
<h1 id="函数体"><a href="#函数体" class="headerlink" title="函数体"></a>函数体</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">函数名</span>(<span class="params">形参</span>):</span><br><span class="line">    函数体</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用函数</span></span><br><span class="line">函数名(实参)</span><br></pre></td></tr></table></figure>

<h1 id="逐行读取文本"><a href="#逐行读取文本" class="headerlink" title="逐行读取文本"></a>逐行读取文本</h1><blockquote>
<p>节省内存,但会比较慢</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FILE = Open(<span class="string">&#x27;文件绝对路径‘)</span></span><br><span class="line"><span class="string">LINE = FILE.readline()</span></span><br><span class="line"><span class="string">while LINE:</span></span><br><span class="line"><span class="string">    print(LINE)</span></span><br><span class="line"><span class="string">    LINE = FILE.readline()</span></span><br><span class="line"><span class="string">FILE.close()</span></span><br></pre></td></tr></table></figure>

<p>参考 ： <a target="_blank" rel="noopener" href="https://www.cnblogs.com/Kingfan1993/p/9570079.html">https://www.cnblogs.com/Kingfan1993/p/9570079.html</a></p>
<h1 id="字符串分割"><a href="#字符串分割" class="headerlink" title="字符串分割"></a>字符串分割</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">string=<span class="string">&quot;world;world2;word&quot;</span></span><br><span class="line">stringSet=string.split(<span class="string">&quot;;&quot;</span>)</span><br><span class="line">stringSet[<span class="number">0</span>]</span><br><span class="line">stringSet[<span class="number">1</span>]</span><br><span class="line">stringSet[<span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<h1 id="字符型与整型转化"><a href="#字符型与整型转化" class="headerlink" title="字符型与整型转化"></a>字符型与整型转化</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">num_str=<span class="string">&quot;123&quot;</span></span><br><span class="line">num_int=<span class="built_in">int</span>(num_str)</span><br><span class="line"></span><br><span class="line">num_str=<span class="built_in">str</span>(num_int)</span><br></pre></td></tr></table></figure>

<h1 id="时延函数"><a href="#时延函数" class="headerlink" title="时延函数"></a>时延函数</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time.sleep(秒)</span><br></pre></td></tr></table></figure>

<h1 id="其他规则"><a href="#其他规则" class="headerlink" title="其他规则"></a>其他规则</h1><ol>
<li>Python严格区分大小写</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/bff72bb5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/bff72bb5/" class="post-title-link" itemprop="url">vCenter中迁移按钮是灰色状态</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-11-06 23:56:57" itemprop="dateCreated datePublished" datetime="2023-11-06T23:56:57+00:00">2023-11-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-22 14:09:56" itemprop="dateModified" datetime="2025-06-22T14:09:56+00:00">2025-06-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/vSphere/" itemprop="url" rel="index"><span itemprop="name">vSphere</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障描述"><a href="#故障描述" class="headerlink" title="故障描述"></a>故障描述</h1><p>虚拟机在vCenter中无法做vMotion，迁移按钮是灰色状态；</p>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>虚拟机因为备份而被锁定，导致无法执行迁移操作；</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>需要进入vCenter的PG数据库，将对应条目删除；</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行前，先对vCenter进行快照备份！！！！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录 VCSA 的SSH Shell；</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭vpxd服务</span></span><br><span class="line">service-control --stop vmware-vpxd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录 PG 数据库</span></span><br><span class="line">/opt/vmware/vpostgres/current/bin/psql -d VCDB -U postgres</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询目标虚拟机的VM-ID</span></span><br><span class="line"><span class="comment"># 语句：select * from VPX_VM WHERE FILE_NAME LIKE &#x27;%Virtual_Machine_Name%&#x27;;</span></span><br><span class="line"><span class="comment"># 比如</span></span><br><span class="line"><span class="keyword">select</span> * from VPX_VM WHERE FILE_NAME LIKE <span class="string">&#x27;%[rohmanvm]%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取到虚拟机的ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取虚拟机执行的条目</span></span><br><span class="line"><span class="keyword">select</span> * from VPX_DISABLED_METHODS WHERE ENTITY_MO_ID_VAL = <span class="string">&#x27;vm-[ID编码]&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除编码</span></span><br><span class="line">delete from VPX_DISABLED_METHODS WHERE ENTITY_MO_ID_VAL = <span class="string">&#x27;vm-[ID编码]&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动vCenter服务</span></span><br><span class="line">service-control --start vmware-vpxd</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/1029926?lang=zh_CN">https://kb.vmware.com/s/article/1029926?lang=zh_CN</a></p>
<p><a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/2044369">https://kb.vmware.com/s/article/2044369</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/45/">45</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Rohman.Zhu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
