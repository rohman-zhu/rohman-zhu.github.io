<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="诺曼实验室">
<meta property="og:url" content="http://github.com/rohman-zhu/page/14/index.html">
<meta property="og:site_name" content="诺曼实验室">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Rohman.Zhu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://github.com/rohman-zhu/page/14/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh_cn","comments":"","permalink":"","path":"page/14/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>诺曼实验室</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">诺曼实验室</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Rohman.Zhu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">433</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">145</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/2ea8b604/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/2ea8b604/" class="post-title-link" itemprop="url">Windows重启进入高级设置的方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-06 00:02:58" itemprop="dateCreated datePublished" datetime="2022-09-06T00:02:58+00:00">2022-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows-Server/" itemprop="url" rel="index"><span itemprop="name">Windows Server</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>服务器需要重启进入高级设置，例如禁用数字签名。</p>
<h1 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h1><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown -r -o -f -t <span class="number">0</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/bcb7d6ac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/bcb7d6ac/" class="post-title-link" itemprop="url">Linux磁盘IO性能观测</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-05 23:48:55" itemprop="dateCreated datePublished" datetime="2022-09-05T23:48:55+00:00">2022-09-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>用于检查磁盘性能IO情况、读写情况。</p>
<h1 id="iostat"><a href="#iostat" class="headerlink" title="iostat"></a>iostat</h1><p>常用指令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 间隔1s输出结果</span></span><br><span class="line">iostat -x 1</span><br></pre></td></tr></table></figure>

<h1 id="sar"><a href="#sar" class="headerlink" title="sar"></a>sar</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sar -d 1 10</span><br></pre></td></tr></table></figure>

<h1 id="atop"><a href="#atop" class="headerlink" title="atop"></a>atop</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">atop -dl</span><br></pre></td></tr></table></figure>

<h1 id="iotop"><a href="#iotop" class="headerlink" title="iotop"></a>iotop</h1><h1 id="dstat"><a href="#dstat" class="headerlink" title="dstat"></a>dstat</h1>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/ae0ca42c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/ae0ca42c/" class="post-title-link" itemprop="url">Horizon-VDI提示无法访问代理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-29 00:10:40" itemprop="dateCreated datePublished" datetime="2022-08-29T00:10:40+00:00">2022-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/Horizon-View/" itemprop="url" rel="index"><span itemprop="name">Horizon View</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">重新安装或升级代理后，View 桌面在 View Administrator 控制台中报告以下消息：</span><br><span class="line">无法访问代理 (Agent Unreachable)</span><br><span class="line">在 Horizon Agent 日志中，您会看到类似以下内容的消息：</span><br><span class="line"></span><br><span class="line">&lt;YYYY-MM-DD&gt;T&lt;time&gt; 789-07:00 DEBUG (0EB8-0F74) &lt;theTopicMessageManager&gt; [AgentJmsConfig] Published CHANGEKEY request</span><br><span class="line"></span><br><span class="line">&lt;/time&gt;约 10 秒后，您会看到以下条目：</span><br><span class="line"></span><br><span class="line">&lt;YYYY-MM-DD&gt;T&lt;time&gt;&lt;/time&gt; 789-07:00 DEBUG (0EB8-0F74) &lt;theTopicMessageManager&gt; [AgentJmsConfig] Timeout waiting for success response</span><br><span class="line">您会在同一日志文件中看到类似以下内容的条目：</span><br><span class="line">update rejected, attempt to reconfigure as paired with missing key information</span><br><span class="line">FATAL (0324-23C) &lt;572&gt; []The JVM has exited with code 6.</span><br><span class="line">INFO (0308-052C) &lt;JavaBridge&gt; wsnm_jms died, restarting in a minute</span><br><span class="line"> </span><br><span class="line">在连接服务器日志中，您会看到类似以下内容的条目：</span><br><span class="line"></span><br><span class="line">&lt;DesktopControlJMS&gt; [JMSMessageSecurity] Message could not be validated: Signature invalid for identity agent</span><br><span class="line">&lt;DesktopControlJMS&gt; [DesktopTracker] CHANGEKEY message from agent/&lt;Agent GUID&gt; is discarded as it cannot be validated</span><br></pre></td></tr></table></figure>

<h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果在连接服务器配置中更改注册表项失败，进而导致 View Agent 和连接服务器之间的通信中断，则会出现此问题。</span><br><span class="line"></span><br><span class="line">重新安装或升级 View Agent 时，它可能会更改用于识别 View Agent 与连接服务器连接的密匙对。</span><br></pre></td></tr></table></figure>

<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>登录Connect Server服务器，打开powershell，输入指令</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vdmadmin <span class="literal">-A</span> <span class="literal">-d</span> desktop<span class="literal">-pool-name</span> <span class="literal">-m</span> name<span class="literal">-of-machine-in-pool</span> <span class="literal">-resetkey</span></span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/2038679?lang=zh_cn">https://kb.vmware.com/s/article/2038679?lang=zh_cn</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/b97489b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/b97489b/" class="post-title-link" itemprop="url">记一次ESXi故障</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-12 23:26:56" itemprop="dateCreated datePublished" datetime="2022-07-12T23:26:56+00:00">2022-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/vSphere/" itemprop="url" rel="index"><span itemprop="name">vSphere</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><ol>
<li>ESXi的管理入口失效；</li>
<li>无法从带外进入ESXi 的管理界面，按F2无法进入；</li>
<li>部分虚拟机正常，部分虚拟机异常；</li>
</ol>
<h1 id="故障原因"><a href="#故障原因" class="headerlink" title="故障原因"></a>故障原因</h1><p>SAN存储的路径异常，有一条异常。如果没有及时修复，如果重启ESXi恢复后，过一会还是会复现此问题。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/7d020ab4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/7d020ab4/" class="post-title-link" itemprop="url">Windows本地防火墙相关操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-04 00:04:52" itemprop="dateCreated datePublished" datetime="2022-07-04T00:04:52+00:00">2022-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows-Server/" itemprop="url" rel="index"><span itemprop="name">Windows Server</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>Windows 本地防火墙与常规的Linux防火墙还是有区别的，策略匹配顺序、策略放行优先级有着较大的差异。</p>
<p>默认配置：</p>
<ul>
<li>未创建的策略，默认情况下是拒绝。（推荐设置为拒绝，这个也可以自行设置）</li>
</ul>
<p>匹配原则：</p>
<ol>
<li>显式定义的允许规则将优先于默认阻止设置。</li>
<li>显式阻止规则将优先于任何冲突的允许规则。（“拒绝优先”）</li>
<li>更具体的规则将优先于不太具体的规则，2 中提及的显式阻止规则除外。 （例如，如果规则 1 的参数包含 IP 地址范围，而规则 2 的参数包含一个 IP 主机地址，则规则 2 的优先级更高。）</li>
</ol>
<blockquote>
<p>实际测试下来，建议忽略规则3，无实际意义。</p>
</blockquote>
<blockquote>
<p>若要打开 Windows 防火墙，请转到“开始”菜单，选择“运行”，键入“WF.msc”，然后选择“确定”。 </p>
</blockquote>
<h1 id="相关powershell指令"><a href="#相关powershell指令" class="headerlink" title="相关powershell指令"></a>相关powershell指令</h1><h2 id="打开防火墙"><a href="#打开防火墙" class="headerlink" title="打开防火墙"></a>打开防火墙</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-NetFirewallProfile</span> <span class="literal">-Profile</span> Private,Domain,Public <span class="literal">-Enabled</span> True</span><br></pre></td></tr></table></figure>

<h2 id="创建防火墙策略"><a href="#创建防火墙策略" class="headerlink" title="创建防火墙策略"></a>创建防火墙策略</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建TCP-3389入站策略,并允许192.168.1.1，192.168.1.2匹配</span></span><br><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;Accept TCP 3389&quot;</span> <span class="literal">-Direction</span> Inbound <span class="literal">-LocalPort</span> <span class="number">3389</span> <span class="literal">-Protocol</span> TCP <span class="literal">-Action</span> Accept <span class="literal">-RemoteAddress</span> &#123;<span class="number">192.168</span>.<span class="number">1.1</span>&#125;,&#123;<span class="number">192.168</span>.<span class="number">1.2</span>&#125;;</span><br><span class="line"><span class="comment"># 创建UDP-3389出站策略</span></span><br><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;Accept UDP 3389&quot;</span> <span class="literal">-Direction</span> Outbound <span class="literal">-LocalPort</span> <span class="number">3389</span> <span class="literal">-Protocol</span> UDP <span class="literal">-Action</span> Block;</span><br></pre></td></tr></table></figure>

<h2 id="修改防火墙应用的地址范围"><a href="#修改防火墙应用的地址范围" class="headerlink" title="修改防火墙应用的地址范围"></a>修改防火墙应用的地址范围</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改上述创建的TCP-3389策略的应用范围为192.168.1.3</span></span><br><span class="line"><span class="built_in">Get-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;*TCP*3389*&quot;</span> | <span class="built_in">Get-NetFirewallAddressFilter</span> | <span class="built_in">Set-NetFirewallAddressFilter</span> <span class="literal">-RemoteAddress</span> &#123;<span class="number">192.168</span>.<span class="number">1.3</span>&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="启动某一个防火墙策略"><a href="#启动某一个防火墙策略" class="headerlink" title="启动某一个防火墙策略"></a>启动某一个防火墙策略</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;*TCP*3389*&quot;</span> | <span class="built_in">Set-NetFirewallRule</span> <span class="literal">-Enabled</span> True;</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>最佳实践：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/security/threat-protection/windows-firewall/best-practices-configuring">https://docs.microsoft.com/zh-cn/windows/security/threat-protection/windows-firewall/best-practices-configuring</a><br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/powershell/module/netsecurity/new-netfirewallrule?view=windowsserver2022-ps">https://docs.microsoft.com/en-us/powershell/module/netsecurity/new-netfirewallrule?view=windowsserver2022-ps</a><br>Powershell 与 防火墙相关指令: <a target="_blank" rel="noopener" href="https://www.pstips.net/manage-firewall-using-powershell.html">https://www.pstips.net/manage-firewall-using-powershell.html</a><br>Set-NetFirewallAddressFilter : <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/powershell/module/netsecurity/set-netfirewalladdressfilter?view=windowsserver2022-ps">https://docs.microsoft.com/en-us/powershell/module/netsecurity/set-netfirewalladdressfilter?view=windowsserver2022-ps</a><br>Set-NetFirewallPortFilter : <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/powershell/module/netsecurity/set-netfirewallportfilter?view=windowsserver2022-ps">https://docs.microsoft.com/en-us/powershell/module/netsecurity/set-netfirewallportfilter?view=windowsserver2022-ps</a><br>New-NetFirewallRule : <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/powershell/module/netsecurity/new-netfirewallrule?view=windowsserver2022-ps">https://docs.microsoft.com/en-us/powershell/module/netsecurity/new-netfirewallrule?view=windowsserver2022-ps</a><br>Set-NetFirewallRule : <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/powershell/module/netsecurity/set-netfirewallrule?view=windowsserver2022-ps">https://docs.microsoft.com/en-us/powershell/module/netsecurity/set-netfirewallrule?view=windowsserver2022-ps</a><br>Get-NetFirewallPortFilter : <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/powershell/module/netsecurity/get-netfirewallportfilter?view=windowsserver2022-ps">https://docs.microsoft.com/en-us/powershell/module/netsecurity/get-netfirewallportfilter?view=windowsserver2022-ps</a><br>显示动态端口 : <a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-CN/troubleshoot/windows-server/networking/default-dynamic-port-range-tcpip-chang">https://docs.microsoft.com/zh-CN/troubleshoot/windows-server/networking/default-dynamic-port-range-tcpip-chang</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/87c26940/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/87c26940/" class="post-title-link" itemprop="url">记一次网卡速率故障</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-25 23:18:38" itemprop="dateCreated datePublished" datetime="2022-05-25T23:18:38+00:00">2022-05-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">服务器与存储</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">服务器</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><p>服务器的网卡是千兆网络，但在实际使用却达不到千兆效果；OS内用ethtool查看网卡，协商速率仅有100Mbps ， 交换机端看到网卡速率有时在1000Mbps，有时在100Mbps 。</p>
<h1 id="可能原因"><a href="#可能原因" class="headerlink" title="可能原因"></a>可能原因</h1><ol>
<li>服务器网卡故障；</li>
<li>交换机模块故障；</li>
<li>网线故障；</li>
</ol>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>实际速率检测一下服务器之间的网络速率，逐个检测以下项目：</p>
<ol>
<li>网线连接是否稳固；</li>
<li>服务器网口是否有异常，更换网口后是否依旧存在故障现象；</li>
<li>交换机端口是否有异常，更换端口后是否依旧存在故障现象；</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/ee047264/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/ee047264/" class="post-title-link" itemprop="url">OS内使用ipmitools指令修改服务器BMC的IP</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-22 16:46:35" itemprop="dateCreated datePublished" datetime="2022-05-22T16:46:35+00:00">2022-05-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">服务器与存储</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">服务器</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>不能重启服务器的前提下，需要修改BMC的IP。</p>
<h1 id="设置方法"><a href="#设置方法" class="headerlink" title="设置方法"></a>设置方法</h1><p>带外IP，可以在操作系统内更改；带外都是基于ipmi的，所以都可以用ipmitools去修改。主要流程为：</p>
<ol>
<li>设置IP</li>
<li>设置网关</li>
<li>重启bmc生效</li>
</ol>
<h1 id="Windows-操作系统下的操作"><a href="#Windows-操作系统下的操作" class="headerlink" title="Windows 操作系统下的操作"></a>Windows 操作系统下的操作</h1><p>Windows用ipmiutil指令</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示当前BMC的网络设置</span></span><br><span class="line">ipmiutil lan</span><br><span class="line"><span class="comment"># 设置 IP</span></span><br><span class="line">ipmiutil lan <span class="literal">-e</span> <span class="literal">-I</span> x.x.x.x</span><br><span class="line"><span class="comment"># 设置 子网掩码</span></span><br><span class="line">ipmiutil lan <span class="literal">-e</span> <span class="literal">-S</span> x.x.x.x</span><br><span class="line"><span class="comment"># 设置 默认网关</span></span><br><span class="line">ipmiutil lan <span class="literal">-e</span> <span class="literal">-G</span> x.x.x.x </span><br><span class="line"><span class="comment"># 重启BMC</span></span><br><span class="line">ipmiutil reset <span class="literal">-k</span></span><br></pre></td></tr></table></figure>
<h1 id="Linux-操作系统下的操作"><a href="#Linux-操作系统下的操作" class="headerlink" title="Linux 操作系统下的操作"></a>Linux 操作系统下的操作</h1><p>Linux用ipmitools指令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示当前BMC的网络设置</span></span><br><span class="line">ipmitool lan <span class="built_in">print</span> 1</span><br><span class="line"><span class="comment"># 设置 IP</span></span><br><span class="line">ipmitool lan <span class="built_in">set</span> 1 ipaddr x.x.x.x</span><br><span class="line"><span class="comment"># 设置 子网掩码</span></span><br><span class="line">ipmitool lan <span class="built_in">set</span> 1 netmask x.x.x.x</span><br><span class="line"><span class="comment"># 设置 默认网关</span></span><br><span class="line">ipmitool lan <span class="built_in">set</span> 1 defgw ipaddr x.x.x.x</span><br><span class="line"><span class="comment"># 重启BMC</span></span><br><span class="line">ipmitool bmc reset cold</span><br></pre></td></tr></table></figure>

<p>如果出现异常“Could not open device at &#x2F;dev&#x2F;ipmi0 or &#x2F;dev&#x2F;ipmi&#x2F;0 or &#x2F;dev&#x2F;ipmidev&#x2F;0: No such file or directory”,可以执行以下指令:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载以下模块</span></span><br><span class="line">modprobe ipmi_watchdog</span><br><span class="line">modprobe ipmi_poweroff</span><br><span class="line">modprobe ipmi_devintf</span><br><span class="line">modprobe ipmi_si  加载该模块如果没有不影响ipmi的使用（与系统版本有关）</span><br><span class="line">modprobe ipmi_msghandler  加载该模块如果没有不影响ipmi的使用</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>包下载地址：<a target="_blank" rel="noopener" href="http://ipmiutil.sourceforge.net/">http://ipmiutil.sourceforge.net/</a></li>
<li>Linux与Windows指令参考：<a target="_blank" rel="noopener" href="https://portal.nutanix.com/page/documents/kbs/details?targetId=kA0600000008T3jCAE">https://portal.nutanix.com/page/documents/kbs/details?targetId=kA0600000008T3jCAE</a></li>
<li>Linux下IPMI指令异常： <a target="_blank" rel="noopener" href="https://www.cnblogs.com/samuel610/p/10868804.html">https://www.cnblogs.com/samuel610/p/10868804.html</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/9ba040fd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/9ba040fd/" class="post-title-link" itemprop="url">记录一个Windows远程桌面错误--由于安全设置错误，客户端无法连接到远程计算机</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-22 16:25:19" itemprop="dateCreated datePublished" datetime="2022-05-22T16:25:19+00:00">2022-05-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows-Server/" itemprop="url" rel="index"><span itemprop="name">Windows Server</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><p>远程桌面提示“由于安全设置错误，客户端无法连接到远程计算机” 。</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>需要将“系统加密：将FIPS兼容算法用于加密、哈希和签名”设置为禁用 。</p>
<ol>
<li>打开 secpol.msc</li>
<li>依从进入 安全设置–&gt; 本地策略 –&gt; 安全选项</li>
</ol>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Braveliu/p/6759810.html">https://www.cnblogs.com/Braveliu/p/6759810.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/78abb069/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/78abb069/" class="post-title-link" itemprop="url">esxcli 常用指令记录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-22 16:24:15" itemprop="dateCreated datePublished" datetime="2022-05-22T16:24:15+00:00">2022-05-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/vSphere/" itemprop="url" rel="index"><span itemprop="name">vSphere</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="网络测试"><a href="#网络测试" class="headerlink" title="网络测试"></a>网络测试</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示所有网卡 </span></span><br><span class="line">esxcli network nic list</span><br><span class="line"><span class="comment"># 关闭网卡 </span></span><br><span class="line">esxcli network nic down -n vmnic[X]</span><br><span class="line"><span class="comment"># 开启网卡 </span></span><br><span class="line">esxcli network nic up -n vmnic[X]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参考 https://kb.vmware.com/s/article/2006074</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用vmkernel网卡去ping </span></span><br><span class="line">vmkping -I  vmk0 [Target IP]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用巨帧</span></span><br><span class="line">vmkping -d -s 8972 x.x.x.x</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参考 ： https://kb.vmware.com/s/article/1003728?lang=zh_cn</span></span><br></pre></td></tr></table></figure>

<h1 id="负载查看"><a href="#负载查看" class="headerlink" title="负载查看"></a>负载查看</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">esxtop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用视图</span></span><br><span class="line">u=Disk Device</span><br><span class="line">d=Disk Adapter</span><br><span class="line">x=vSAN</span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他视图</span></span><br><span class="line">c=CPU</span><br><span class="line">m=Memory</span><br><span class="line">n=Network</span><br><span class="line">p=Power Management</span><br></pre></td></tr></table></figure>

<h1 id="安装补丁"><a href="#安装补丁" class="headerlink" title="安装补丁"></a>安装补丁</h1><p>esxcli software vib update -d &#x2F;vmfs&#x2F;xxxxxxxx.zip<br>esxcli software vib install -d &#x2F;vmfs&#x2F;xxxxxxxx.zip</p>
<h1 id="设置标准交换机模式"><a href="#设置标准交换机模式" class="headerlink" title="设置标准交换机模式"></a>设置标准交换机模式</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">esxcli network vswitch standard policy failover <span class="built_in">set</span> -l [Policy] -v [vSwitch] -a vmnic[X],vmnic[X]</span><br><span class="line">esxcli network vswitch standard portgroup policy failover -<span class="built_in">set</span> -p <span class="string">&quot;Management Network&quot;</span> -l [Policy] -a vmnic[X],vmnic[X]</span><br></pre></td></tr></table></figure>

<p>[Policy]有以下4种：</p>
<p>explicit – according to the list<br>portid – based on the originating virtual port<br>mac – on source MAC-hash<br>iphash – based on IP-hash</p>
<h1 id="版本查看"><a href="#版本查看" class="headerlink" title="版本查看"></a>版本查看</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmware -v</span><br></pre></td></tr></table></figure>

<h1 id="存储连接状态"><a href="#存储连接状态" class="headerlink" title="存储连接状态"></a>存储连接状态</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">esxcli storage core device list -d=device_ID 命令。</span><br><span class="line"></span><br><span class="line">on- 设备已连接。</span><br><span class="line">dead- 设备已进入 APD 状态。APD 定时器已启动。</span><br><span class="line">dead <span class="built_in">timeout</span>- APD 超时已过期。</span><br><span class="line">not connected- 设备处于 PDL 状态。</span><br></pre></td></tr></table></figure>

<h1 id="回收精简制备vmdk的空间"><a href="#回收精简制备vmdk的空间" class="headerlink" title="回收精简制备vmdk的空间"></a>回收精简制备vmdk的空间</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vmkfstools -K /vmfs/volume/xxxx/xxxx.vmdk</span><br><span class="line"><span class="comment"># -K|--punchzero  该选项会对所有清零块取消分配，只留下那些先前分配且包含有效数据的块。生成的虚拟磁盘为精简格式的虚拟磁盘。</span></span><br></pre></td></tr></table></figure>

<h1 id="虚拟机相关操作"><a href="#虚拟机相关操作" class="headerlink" title="虚拟机相关操作"></a>虚拟机相关操作</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看虚拟机信息 </span></span><br><span class="line">esxcli vm process list</span><br><span class="line">vim-cmd vmsvc/getallvms</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结束虚拟机进程</span></span><br><span class="line">esxcli vm process <span class="built_in">kill</span> --<span class="built_in">type</span>[soft,hard,force] --world-id=[WorldNumber]</span><br><span class="line"><span class="comment"># 关闭虚拟机操作系统=soft</span></span><br><span class="line">vim-cmd vmsvc/power.shudown [WorldNumber]</span><br><span class="line"><span class="comment"># 强制关闭虚拟机=hard</span></span><br><span class="line">vim-cmd vmsvc/power.off [WorldNumber]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测是否有相关任务</span></span><br><span class="line">vim-cmd vmsvc/get.tasklist [WorldNumber]</span><br></pre></td></tr></table></figure>

<h1 id="检查目标文件系统Inode情况"><a href="#检查目标文件系统Inode情况" class="headerlink" title="检查目标文件系统Inode情况"></a>检查目标文件系统Inode情况</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stat</span> -f /</span><br></pre></td></tr></table></figure>

<h1 id="进入维护模式"><a href="#进入维护模式" class="headerlink" title="进入维护模式"></a>进入维护模式</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">esxcli system maintenanceMode Set --enabled [<span class="built_in">yes</span>/no]</span><br></pre></td></tr></table></figure>
<h1 id="esxcfg命令列表"><a href="#esxcfg命令列表" class="headerlink" title="esxcfg命令列表"></a>esxcfg命令列表</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 防火墙</span></span><br><span class="line">esxcfg-firewall</span><br><span class="line"></span><br><span class="line"><span class="comment"># 路由表</span></span><br><span class="line">esxcfg-route</span><br><span class="line"></span><br><span class="line"><span class="comment"># vmkernel网卡</span></span><br><span class="line">esxcfg-vmknic</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前网卡信息</span></span><br><span class="line">esxcfg-vswif</span><br><span class="line"></span><br><span class="line"><span class="comment"># 虚拟机交换机</span></span><br><span class="line">esxcfg-vswitch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 物理网卡信息</span></span><br><span class="line">esxcfg-nics</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示HBA设备</span></span><br><span class="line">esxcfg-vmhbadevs</span><br></pre></td></tr></table></figure>

<h1 id="VSAN磁盘组操作"><a href="#VSAN磁盘组操作" class="headerlink" title="VSAN磁盘组操作"></a>VSAN磁盘组操作</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除</span></span><br><span class="line">esxcli vsan storage remove -u [磁盘组UUID]</span><br><span class="line">esxcli vsan storage remove -s [缓存层 SSD NAAID]</span><br><span class="line">esxcli vsan storage remove -d [容量层 NNID]</span><br></pre></td></tr></table></figure>

<h1 id="退出VSAN集群"><a href="#退出VSAN集群" class="headerlink" title="退出VSAN集群"></a>退出VSAN集群</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">esxcli vsan cluster get</span><br><span class="line">esxcli vsan cluster leave</span><br></pre></td></tr></table></figure>

<p>VSAN相关指令：<a target="_blank" rel="noopener" href="https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.vsan-monitoring.doc/GUID-7799D2D7-2513-4372-92EA-4A1FB510E012.html">https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.vsan-monitoring.doc/GUID-7799D2D7-2513-4372-92EA-4A1FB510E012.html</a></p>
<h1 id="输出日志"><a href="#输出日志" class="headerlink" title="输出日志"></a>输出日志</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm-support -w [指定路径]</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/1010705?lang=zh_CN">https://kb.vmware.com/s/article/1010705?lang=zh_CN</a></p>
<h1 id="重启管理程序"><a href="#重启管理程序" class="headerlink" title="重启管理程序"></a>重启管理程序</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/hostd restart</span><br><span class="line">/etc/init.d/vpxa restart</span><br></pre></td></tr></table></figure>
<p>Restarting the Management agents in ESXi (1003490):<a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/1003490">https://kb.vmware.com/s/article/1003490</a></p>
<h1 id="扩容空间"><a href="#扩容空间" class="headerlink" title="扩容空间"></a>扩容空间</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vpxd_servicecfg storage lvm autogrow</span><br></pre></td></tr></table></figure>

<h1 id="获取Dump日志"><a href="#获取Dump日志" class="headerlink" title="获取Dump日志"></a>获取Dump日志</h1><p>一般情况下，ESXi紫屏后会产生DUMP日志，一般放置在 &#x2F;var&#x2F;core 目录下，</p>
<p>获取dump日志</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一般在/root/ , /var/core/目录中都能找到zdump文件</span></span><br><span class="line"><span class="comment"># 将zdump文件转为日志文件</span></span><br><span class="line">esxcfg-dumppart -L [vmkernel-zdump-filename]</span><br></pre></td></tr></table></figure>

<p>参考： <a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/1006796?lang=zh_CN">https://kb.vmware.com/s/article/1006796?lang=zh_CN</a></p>
<h1 id="配置-zdump-文件"><a href="#配置-zdump-文件" class="headerlink" title="配置 zdump 文件"></a>配置 zdump 文件</h1><p>参考：<a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/2081902">https://kb.vmware.com/s/article/2081902</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取当前配置</span></span><br><span class="line">esxcli system coredump file get</span><br></pre></td></tr></table></figure>
<h1 id="查询文件锁定"><a href="#查询文件锁定" class="headerlink" title="查询文件锁定"></a>查询文件锁定</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmfsfilelockinfo -p [路径]</span><br></pre></td></tr></table></figure>

<h1 id="VCSA指令-查看证书"><a href="#VCSA指令-查看证书" class="headerlink" title="VCSA指令-查看证书"></a>VCSA指令-查看证书</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> store <span class="keyword">in</span> $(/usr/lib/vmware-vmafd/bin/vecs-cli store list | grep -v TRUSTED_ROOT_CRLS); <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">&quot;[*] Store :&quot;</span> <span class="variable">$store</span>; /usr/lib/vmware-vmafd/bin/vecs-cli entry list --store <span class="variable">$store</span> --text | grep -ie <span class="string">&quot;Alias&quot;</span> -ie <span class="string">&quot;Not After&quot;</span>;<span class="keyword">done</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>参考： <a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/82332">https://kb.vmware.com/s/article/82332</a></p>
<h1 id="获取USB设备"><a href="#获取USB设备" class="headerlink" title="获取USB设备"></a>获取USB设备</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsusb</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li>存储相关：<a target="_blank" rel="noopener" href="https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.storage.doc/GUID-A5D85C33-A510-4A3E-8FC7-93E6BA0A048F.html">https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.storage.doc/GUID-A5D85C33-A510-4A3E-8FC7-93E6BA0A048F.html</a></li>
<li>关闭虚拟机电源： <a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/1004340?lang=zh_CN">https://kb.vmware.com/s/article/1004340?lang=zh_CN</a></li>
<li>esxcfg命令：<a target="_blank" rel="noopener" href="https://blog.csdn.net/rrs123/article/details/77587702">https://blog.csdn.net/rrs123/article/details/77587702</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/afb69a33/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/afb69a33/" class="post-title-link" itemprop="url">记录一次Ubuntu2004下的kdump配置与测试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-05-22 16:17:42" itemprop="dateCreated datePublished" datetime="2022-05-22T16:17:42+00:00">2022-05-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/Ubuntu/" itemprop="url" rel="index"><span itemprop="name">Ubuntu</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>有一台服务器经常死机，配置了kdump后并无生成dump日志，手动触发系统Crash后依旧无法重启记录Dump日志。<br>重装操作系统后依旧无生成dump日志。</p>
<ul>
<li>OS：Ubuntu 20.04</li>
<li>Kernel ： 5.4.0-42-generic</li>
<li>CPU：6252 * 4</li>
<li>Memory：512GB</li>
</ul>
<h1 id="分析原因"><a href="#分析原因" class="headerlink" title="分析原因"></a>分析原因</h1><p>经过长期实测，主要原因还是在于需要增加dumpcrash的内存大小，否则kdump进程没有足够多的内存写入日志。</p>
<h1 id="Ubuntu-20-04配置-Kdump-过程"><a href="#Ubuntu-20-04配置-Kdump-过程" class="headerlink" title="Ubuntu 20.04配置 Kdump 过程"></a>Ubuntu 20.04配置 Kdump 过程</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装主要工具</span></span><br><span class="line"><span class="comment"># 这里会安装 crash 、 kexec-tools 、 makedumpfile</span></span><br><span class="line">apt-get install linux-crashdump -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调整crashkernel分配的内存空间</span></span><br><span class="line">vim /etc/default/grub.d/kexec-tools.cfg</span><br><span class="line"><span class="comment"># 末尾字段增加</span></span><br><span class="line"><span class="comment"># 需要根据实际内存大小来预分配</span></span><br><span class="line">crashkernel=128G-:4096M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调整kdump配置文件</span></span><br><span class="line">vim /etc/default/kdump-tools</span><br><span class="line"><span class="comment">#配置项为 </span></span><br><span class="line">USE_KDUMP=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置触发条件</span></span><br><span class="line">vim /etc/sysctl.conf</span><br><span class="line"><span class="comment"># 配置项为</span></span><br><span class="line"><span class="comment"># 相应sysrq来触发</span></span><br><span class="line">kernel.sysrq=1</span><br><span class="line"><span class="comment"># 硬件NMI按钮被按下时触发</span></span><br><span class="line">kernel.unknown_nmi_panic=1</span><br><span class="line">kernel.panic_on_unrecovered_nmi=1</span><br><span class="line"><span class="comment"># 触发内存OOM收集kdump</span></span><br><span class="line">vm.panic_on_oom=1</span><br><span class="line"><span class="comment"># 内核在OOPS错误（非法内存访问或非法指令）后触发</span></span><br><span class="line">kernel.panic_on_oops=1</span><br><span class="line"><span class="comment"># 内核在死锁或者死循环（soft-lockup）触发</span></span><br><span class="line">kernel.panic_on_io_nmi=1</span><br><span class="line"><span class="comment"># 内核在进程hung住时触发</span></span><br><span class="line">kernel.hung_task_panic=1</span><br><span class="line"><span class="comment"># 进程hung住多少时间触发</span></span><br><span class="line">kernel.hung_task_timeout_secs=120</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置完成后，需要重启服务器才能生效</span></span><br><span class="line">init 6</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是否配置成功，可以在重启后执行指令;查看是否有为kdump分配内存</span></span><br><span class="line">dmesg | grep -i crash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启完成后，通过指令查询</span></span><br><span class="line">kdump-config show</span><br><span class="line"><span class="built_in">cat</span> /proc/cmdline</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志会默认保存在 /var/crash目录</span></span><br></pre></td></tr></table></figure>

<h1 id="触发测试"><a href="#触发测试" class="headerlink" title="触发测试"></a>触发测试</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/kernel/sysrq</span><br><span class="line"><span class="built_in">echo</span> c &gt; /proc/sysrq-trigger</span><br></pre></td></tr></table></figure>

<p>正常情况下，服务器会卡死，并开始记录crash信息，屏幕会输出 makedumpfile 信息。最终将重启服务器，并在&#x2F;var&#x2F;crash目录中生存相关信息。</p>
<h1 id="分析日志"><a href="#分析日志" class="headerlink" title="分析日志"></a>分析日志</h1><h2 id="分析日志的前置工作–安装-dbgsym"><a href="#分析日志的前置工作–安装-dbgsym" class="headerlink" title="分析日志的前置工作–安装 dbgsym"></a>分析日志的前置工作–安装 dbgsym</h2><p>分析日志需要用到 dbgsym ，也就是debug info包。需要增加 ddebs 源才能安装，联网安装方式为</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb http://ddebs.ubuntu.com <span class="subst">$(lsb_release -cs)</span> main restricted universe multiverse &quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> -a /etc/apt/sources.list.d/ddebs.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/apt/sources.list.d/ddebs.list 应该有以下内容</span></span><br><span class="line">deb http://ddebs.ubuntu.com [Ubuntu 发行版本] main restricted universe multiverse</span><br><span class="line">deb http://ddebs.ubuntu.com [Ubuntu 发行版本]-updates main restricted universe multiverse</span><br><span class="line">deb http://ddebs.ubuntu.com [Ubuntu 发行版本]-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始安装</span></span><br><span class="line">apt-key adv --keyserver keyserver.ubuntu.com --recv-keys ECDCAD72428D7C01</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install systemtap</span><br><span class="line">apt-get install linux-image-$(<span class="built_in">uname</span> -r)-dbgsym</span><br><span class="line">apt-get <span class="built_in">source</span> linux-image-$(<span class="built_in">uname</span> -r)</span><br></pre></td></tr></table></figure>

<p>离线安装方式</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载地址 http://ddebs.ubuntu.com/pool/main/l/linux</span></span><br><span class="line"><span class="comment"># 因系统为 5.4.0-42-generic 的内核，因此需要使用这个版本</span></span><br><span class="line"><span class="comment"># 下载64位专用版本 linux-image-unsigned-5.4.0-42-generic-dbgsym_5.4.0-42.46_amd64.ddeb </span></span><br><span class="line"><span class="comment"># 服务器内安装 </span></span><br><span class="line">dpkg -i linux-image-unsigned-5.4.0-42-generic-dbgsym_5.4.0-42.46_amd64.ddeb</span><br></pre></td></tr></table></figure>

<h2 id="开始分析"><a href="#开始分析" class="headerlink" title="开始分析"></a>开始分析</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指令  crash [vmcore] [dumpfile]</span></span><br><span class="line"></span><br><span class="line">crash /usr/lib/debug/boot/vmlinux.......   /var/crash/20xxxxx/dump.xxxxxx </span><br><span class="line"></span><br><span class="line"><span class="comment"># 看到因为我们手动触发系统 Crash 的那一部分显示</span></span><br><span class="line">PANIC：“Kernel panic - not syncing： sysrq triggered crash”</span><br></pre></td></tr></table></figure>



<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>CentOS下的配置 <a target="_blank" rel="noopener" href="https://blog.51cto.com/kk876435928/2054256">https://blog.51cto.com/kk876435928/2054256</a><br>Ubuntu 20.04 下配置 <a target="_blank" rel="noopener" href="https://www.ebpf.top/post/ubuntu_kdump_crash/">https://www.ebpf.top/post/ubuntu_kdump_crash/</a><br>Kdump技术了解 <a target="_blank" rel="noopener" href="https://linux.cn/article-8737-1.html">https://linux.cn/article-8737-1.html</a><br>dbgsym: <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1637887">https://cloud.tencent.com/developer/article/1637887</a><br>ubuntu 中 的hwe ： <a target="_blank" rel="noopener" href="https://askubuntu.com/questions/248914/what-is-hardware-enablement-hwe">https://askubuntu.com/questions/248914/what-is-hardware-enablement-hwe</a><br>dbgsym 库 ： <a target="_blank" rel="noopener" href="http://ddebs.ubuntu.com/pool/main/l/linux-hwe-5.4/">http://ddebs.ubuntu.com/pool/main/l/linux-hwe-5.4/</a><br>x86 “ <a target="_blank" rel="noopener" href="https://blog.csdn.net/xiao_yi_xiao/article/details/120223255?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0-120223255-blog-86352725.pc_relevant_default&spm=1001.2101.3001.4242.1&utm_relevant_index=3">https://blog.csdn.net/xiao_yi_xiao/article/details/120223255?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0-120223255-blog-86352725.pc_relevant_default&amp;spm=1001.2101.3001.4242.1&amp;utm_relevant_index=3</a><br>Ubuntu 中的内存大小 小于 实际内存大小： <a target="_blank" rel="noopener" href="https://askubuntu.com/questions/923371/why-does-ubuntu-show-slightly-less-ram-than-my-computer-has-built-in">https://askubuntu.com/questions/923371/why-does-ubuntu-show-slightly-less-ram-than-my-computer-has-built-in</a><br>kdump ： <a target="_blank" rel="noopener" href="https://wiki.ubuntu.com/Kernel/CrashdumpRecipe">https://wiki.ubuntu.com/Kernel/CrashdumpRecipe</a><br>其他：<a target="_blank" rel="noopener" href="https://blog.csdn.net/quqi99/article/details/38069657">https://blog.csdn.net/quqi99/article/details/38069657</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/13/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/15/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Rohman.Zhu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
