<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="诺曼实验室">
<meta property="og:url" content="http://github.com/rohman-zhu/page/5/index.html">
<meta property="og:site_name" content="诺曼实验室">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Rohman.Zhu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://github.com/rohman-zhu/page/5/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh_cn","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>诺曼实验室</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">诺曼实验室</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Rohman.Zhu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">429</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">144</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/e0587402/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/e0587402/" class="post-title-link" itemprop="url">vRops指标-数据存储卷</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-19 23:14:41" itemprop="dateCreated datePublished" datetime="2024-03-19T23:14:41+00:00">2024-03-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/default/" itemprop="url" rel="index"><span itemprop="name">default</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="指标"><a href="#指标" class="headerlink" title="指标"></a>指标</h1><p>数据存储卷：设备：所有实例的汇总：</p>
<ol>
<li>物理设备延迟(ms)</li>
<li>总延迟(ms)</li>
<li>内核延迟(ms)</li>
</ol>
<h1 id="数据存储卷的仪表盘"><a href="#数据存储卷的仪表盘" class="headerlink" title="数据存储卷的仪表盘"></a>数据存储卷的仪表盘</h1><p>仪表板–主页–性能–数据存储性能</p>
<blockquote>
<p>可以查看各个存储卷的性能以及虚拟机性能详情。</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/ad183cc1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/ad183cc1/" class="post-title-link" itemprop="url">记录一次SAN存储控制器重启故障-VMware层影响</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-19 22:17:33" itemprop="dateCreated datePublished" datetime="2024-03-19T22:17:33+00:00">2024-03-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/default/" itemprop="url" rel="index"><span itemprop="name">default</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><p>SAN存储触发的告警为：控制 Offline 告警邮件，显示 Node 1 失败（Node unexpectedly offline ）;<br>虚拟化层触发的告警为：StorageConnectivityAlarm;</p>
<h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p>SAN存储固件异常，导致控制器自行重启。</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>升级SAN存储控制器固件至指定版本。</p>
<h2 id="关于ESXi多路径排查过程"><a href="#关于ESXi多路径排查过程" class="headerlink" title="关于ESXi多路径排查过程"></a>关于ESXi多路径排查过程</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入ESXi Shell</span></span><br><span class="line"><span class="comment"># 查看VMware kernel日志 ，路径为 /var/log/vmkernel.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找关键字 3470， CmdSN  xxx from world xxx to dev &quot;xxxx&quot; failed </span></span><br><span class="line"><span class="comment"># 参考 ：https://blog.csdn.net/Pespi_Co1a/article/details/111191902</span></span><br><span class="line"><span class="comment"># 参考 ： https://kb.vmware.com/s/article/1029039?lang=zh_cn</span></span><br><span class="line"><span class="comment"># H:0x0 , D0x2 ,P:0x0</span></span><br><span class="line"><span class="comment"># Host ID</span></span><br><span class="line"><span class="comment"># 0x0 当主机端不存在任何错误时，返回此状态。</span></span><br><span class="line"><span class="comment"># 0x01 如果与LUN的连接丢失，将返回此状态。【发生在LUN不再从阵列端对主机可见，或者如果与阵列的物理连接已被移除，则会发生这种情况】【https://kb.vmware.com/s/article/1003433?lang=zh_cn】</span></span><br><span class="line"><span class="comment"># 0x02 当HBA驱动程序无法项设备发出命令时，将返回此状态。【发生在环境中丢弃了FCP帧】</span></span><br><span class="line"><span class="comment"># 0x03 当正在对阵列执行的命令超时时，将返回此状态。</span></span><br><span class="line"><span class="comment"># 0x04 驱动程序对发生故障的目标中止命令后，将返回此状态。【通常发生在硬件错误时；如果向发生故障的目标ID发送命令也会出现】</span></span><br><span class="line"><span class="comment"># 0x05 如果驱动程序必须对目标中止的命令，将返回此状态。【命令超时或帧中出现奇偶校验错误】</span></span><br><span class="line"><span class="comment"># 0x06 将为一般错误反馈此状态。【针对其他错误（如数据超限或不足）未涵盖的事件而发生】</span></span><br><span class="line"><span class="comment"># 0x07 当由于存储器错误已重置设备时，将返回此状态。【通常过时的HBA固件，或者可能是发生故障的HBA】</span></span><br><span class="line"><span class="comment"># 0x08 遗留错误，不会返回。</span></span><br><span class="line"><span class="comment"># 0x0a 遗留错误，不会返回。</span></span><br><span class="line"><span class="comment"># 0x0b HBA驱动程序返回 DID_REQUEUE 命令，将返回此状态。【在接受到这个状态时，将重新发出I/O命令】</span></span><br><span class="line"><span class="comment"># 0x0c 由于暂时性错误，将返回此状态。【I/O命令将重新加入阵列并重新发出】</span></span><br><span class="line"><span class="comment"># 0x0d 当HBA驱动程序尝试中止命令（随后会对iocb ring中的所有命令设置IOSTAT_LOCAL_REJECT状态）时，将返回此状态。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Vital Product Data(VPD)</span></span><br><span class="line"><span class="comment"># https://kb.vmware.com/s/article/1010244?lang=zh_cn</span></span><br><span class="line"><span class="comment"># https://kb.vmware.com/s/article/289902?lang=zh_cn</span></span><br><span class="line"><span class="comment"># https://www.t10.org/lists/2asc.htm</span></span><br><span class="line"><span class="comment"># 0x80 ,设备序列号</span></span><br><span class="line"><span class="comment"># 0x83 ,设备标志号</span></span><br><span class="line"><span class="comment"># 0x85 ,管理网络地址</span></span><br><span class="line"><span class="comment"># 存储设备重新枚举期间，VMware ESX/ESXi VMkernel 向目标发送 SCSI 报告 LUN 命令 (0xa0) 以检索 LUN 列表，向每个 LUN 发送 SCSI 查询命令 (0x12) 以确定设备类型（磁盘、CD-ROM、USB 等）、设备品牌和型号以及设备支持的功能。</span></span><br><span class="line"><span class="comment"># 如果 SCSI 设备不支持某个 VPD 页面 VPD，它在响应此类请求时可能会出现错误。尤其是，它可能会返回 SCSI 状态 2（检查状况），其中，感知密匙为 5（非法请求），附加感知代码 (ASC) 和附加感知代码标识符 (ASCQ) 设置为 0x20/0x0 或 0x24/0x0。</span></span><br><span class="line"><span class="comment"># 1. 本地存储设备通常不支持 VPD 页面 0x83，从而无法用于裸设备映射 (RDM)。页面 0x83 的内容用作设备的唯一标识符。</span></span><br><span class="line"><span class="comment"># 2. CD 或 DVD-ROM 设备通常不支持 VPD 页面 0x80、0x83 或 0x85。</span></span><br><span class="line"><span class="comment"># 3. 一些设备控制器不支持报告 LUN。如果不存在 LUN 0 或报告的 SCSI 版本为 2 或更低版本，ESX/ESXi 主机会对此控制器上的 LUN 进行迭代扫描。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找关键字 lpfc_els_rcv_rscn </span></span><br><span class="line"><span class="comment"># https://kb.vmware.com/s/article/2151839?lang=zh_CN</span></span><br><span class="line"><span class="comment"># lpfc为驱动程序</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># [恢复] 查找关键之 Device .... performance has improved . I/O latency reduced from xxxx microseconds to xxx microseconds.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [恢复] lpfc : lpfc_reportStats: xxxxx Compression log for fcp target 8 , path is ok ,IO errors: busy 9 , retry xxxxx,no_connect xx,fcperr xxxx ,tmo x;</span></span><br><span class="line"><span class="comment"># https://kb.vmware.com/s/article/76350</span></span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/d444b552/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/d444b552/" class="post-title-link" itemprop="url">Excel-常用公示</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-17 17:48:49" itemprop="dateCreated datePublished" datetime="2024-03-17T17:48:49+00:00">2024-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:47" itemprop="dateModified" datetime="2024-12-22T05:27:47+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/default/" itemprop="url" rel="index"><span itemprop="name">default</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="比较两个日期间隔多少小时"><a href="#比较两个日期间隔多少小时" class="headerlink" title="比较两个日期间隔多少小时"></a>比较两个日期间隔多少小时</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cell 1 = 2024-03-17 17:50</span><br><span class="line">cell 2 = 2024-03-28 20:00</span><br><span class="line"></span><br><span class="line">间隔天 = (cell2 - cell1) </span><br><span class="line">间隔小时 = (cell2 - cell1) * 24</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="比较两个日期间隔天、月、年"><a href="#比较两个日期间隔天、月、年" class="headerlink" title="比较两个日期间隔天、月、年"></a>比较两个日期间隔天、月、年</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cell 1 = 2024-03-17 17:50</span><br><span class="line">cell 2 = 2024-03-28 20:00</span><br><span class="line">天=datedif(cell1,cell2,&quot;d&quot;)</span><br><span class="line">月=datedif(cell1,cell2,&quot;m&quot;)</span><br><span class="line">天=datedif(cell1,cell2,&quot;d&quot;)</span><br></pre></td></tr></table></figure>

<h1 id="保留小数位"><a href="#保留小数位" class="headerlink" title="保留小数位"></a>保留小数位</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">round(number,num_digits)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/53d72df5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/53d72df5/" class="post-title-link" itemprop="url">Docker-学习记录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-17 14:45:03" itemprop="dateCreated datePublished" datetime="2024-03-17T14:45:03+00:00">2024-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:47" itemprop="dateModified" datetime="2024-12-22T05:27:47+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这段时间看到一位大佬的学习记录，因此这里有大部分内容是转载的。推荐看原文!!!</p>
<p>转载自：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.zsythink.net/archives/4286">https://www.zsythink.net/archives/4286</a></li>
</ul>
<h1 id="什么是Docker-与-安装-Docker"><a href="#什么是Docker-与-安装-Docker" class="headerlink" title="什么是Docker 与 安装 Docker"></a>什么是Docker 与 安装 Docker</h1><p>咱们还是以传统意义上的“虚拟机”作为切入点，假设，有一台物理服务器，我们把这台服务器当做宿主机，在宿主机上虚出了虚机A、虚机B等虚拟机，对于这些虚拟机来说，它们各自都独占了一套完整的操作系统，准确的说，应该是一套完整的“操作系统发行版”，注意，这里强调一下“发行版”三个字，以linux系统为例，组成一个“linux系统发行版”，首先需要有“linux内核”，其次还需要有相关软件依赖的运行环境软件包，比如说一些类库包、命令行工具等等，不同的linux发行版基于相同的linux内核开发，但是由于组成运行环境的包的不同，所以产生了不同的发行版，比如ubuntu和centos就是不同的linux发行版，对于虚机A和虚机B来说，它们各自拥有一套完整的操作系统（即使A和B都安装了centos7.9，本质上也是两个相互独立的操作系统），从隔离层面上来说，A和B之间是“linux系统发行版”的完整隔离，A和B都各自使用自己的内核和运行环境依赖包，各自使用自己的虚拟硬件，这是虚拟机在操作系统层面的隔离，理解上述概念，是避免搞混docker和传统虚拟化的关键。</p>
<p>现在再来聊聊docker，我们知道docker是一种容器引擎，docker运行容器的本质目的是去运行某个程序，docker通过应用程序镜像，安装并运行对应的程序，比如，我需要运行nginx，只需要下载对应的nginx镜像，docker就可以把这个nginx镜像运行成一个容器，容器把内部的nginx服务端口暴露出来，我们就可以访问nginx服务了，其他服务软件同理，在没有使用docker之前，看到“镜像”这个词，我又情不自禁的想到了虚拟机，只不过，虚拟机是通过“操作系统镜像”安装运行系统，docker是通过“应用程序镜像”安装运行对应的软件，当我搜索docker和虚拟机有什么不同的时候，我看到了下面这张图</p>
<p><img src="https://www.zsythink.net/wp-content/uploads/2022/01/16421268329864.jpg" alt="Docker与虚拟机区别"></p>
<p>从上图来看，每个虚拟机都有自己的完整的操作系统（上图的GUEST OS就是虚拟机的操作系统，但是此处，我们应该把它拆成两部分理解，GUEST OS是由其内核和运行环境包组成的），VM1虚拟机上的所有APP使用的是同一套运行库和内核，其他虚拟机同理，Hypervisor层对硬件资源进行划分，各个虚拟机在整个操作系统发行版层面进行了隔离，而容器则不同，容器是将APP和其需要依赖的运行库打包成一个镜像，在APP进程和运行库层面进行了隔离（上图中CONTAINER中的APP就是应用程序镜像，这个镜像中包含应用本身和其需要的运行时依赖包），不同的APP各自使用自己的运行时环境，容器所运行的镜像中不需要内核，所有容器共用所在主机HostOS的内核，统一通过HostOS的内核与硬件进行交互，docker就是运行在HostOS中的容器引擎，理解了上图以后，我们就能明显感觉到它们的区别了，上图中最凸显的区别就是隔离层面的不同，虚拟机是针对整个系统发行版层面的隔离，而容器则是对程序进程和其依赖的运行环境的隔离，虚拟机的隔离性更强，隔离范围大，容器的隔离性没有虚拟机强，但是隔离范围更小，容器并不涉及Hypervisor层，它是一种进程隔离技术，从这个方面讲，它不应该算做“传统虚拟化”的范围，人们愿意把它称之为容器“虚拟化”技术，我觉得是因为容器更偏向于“java虚拟机”或者“python虚拟环境”这种软件意义上的“虚拟”，所以说，容器并不会取代虚拟机，它们之间也并不冲突，它们应该是相辅相成的。</p>
<p>把应用程序和其运行时依赖库打包隔离的好处有哪些呢？首先，由于隔离的范围更小了，所以当出现问题时，影响的范围也会更小，只会影响这个应用程序容器的进程本身，而不是其他程序的容器和HOST操作系统，其次，由于应用程序和其依赖的运行时环境是打包在一起的（打包成一个docker镜像），这就表示，如果一个程序的镜像在我的centos7上能够运行，那么在你的centos7上用也能够正常运行，不会出现某个程序在开发人员的笔记本中可以运行，但是放在服务器上就不能正常运行的情况（因为服务器上可能没有安装程序所依赖的包），这就是把程序和依赖打包在一起的好处。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># Ubuntu 安装Docker</span></span><br><span class="line"><span class="comment"># 参考 https://docs.docker.com/desktop/install/ubuntu/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新 Docker 源</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"><span class="built_in">sudo</span> apt-get install ca-certificates curl -y</span><br><span class="line"><span class="built_in">sudo</span> install -m 0755 -d /etc/apt/keyrings</span><br><span class="line"><span class="built_in">sudo</span> curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> a+r /etc/apt/keyrings/docker.asc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the repository to Apt sources:</span></span><br><span class="line"><span class="built_in">echo</span> </span><br><span class="line">  <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  <span class="subst">$(. /etc/os-release &amp;&amp; echo <span class="string">&quot;<span class="variable">$VERSION_CODENAME</span>&quot;</span>)</span> stable&quot;</span> | </span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装Docker GUI 版本</span></span><br><span class="line">apt-get install ./docker-desktop-&lt;vsersion&gt;-&lt;<span class="built_in">arch</span>&gt;.deb</span><br><span class="line">apt-get install ./docker-desktop-4.28.0-amd64.deb</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository</span></span><br><span class="line"> <span class="built_in">sudo</span> apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="初始化-仓库、镜像、容器"><a href="#初始化-仓库、镜像、容器" class="headerlink" title="初始化 仓库、镜像、容器"></a>初始化 仓库、镜像、容器</h1><p>参考 <a target="_blank" rel="noopener" href="https://www.zsythink.net/archives/4302">https://www.zsythink.net/archives/4302</a></p>
<p>从docker hub默认仓库获取镜像</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 表示从docker hub的nginx官方仓库中拉取tag为latest的镜像（即从nginx官方仓库中拉取最新版本的nginx镜像</span></span><br><span class="line">docker pull docker.io/library/nginx:latest</span><br><span class="line"><span class="comment"># 等效于 </span></span><br><span class="line">docker pull nginx</span><br></pre></td></tr></table></figure>

<p>关于 URL ： docker.io&#x2F;library&#x2F;nginx:latest<br><img src="https://www.zsythink.net/wp-content/uploads/2022/02/16443754787791.jpg" alt="Docker URL"></p>
<p>第1部分 docker.io ：代表从哪个仓库服务中心下载镜像，docker.io就是官方的仓库服务中心（其实就是docker hub，官方的仓库服务器），这个仓库服务器中有很多组织，也有很多个人，每个组织或者个人都可以在这个仓库服务器创建仓库，然后把镜像存放在仓库中，前文说过，docker hub的官网地址是registry.hub.docker.com，这个地址是方便我们从web页面查找镜像使用的，使用命令行从docker hub拉取镜像时，默认使用的是docker.io这个地址。除了docker官方的docker hub，还有一些其他仓库服务器，我们也可以自建仓库服务器，当使用其他仓库服务器或者自建仓库服务器时，要把第1部分改为对应的域名或IP，如果我们就是想要从官方的docker hub下载镜像，上图中的第1部分可以不写，当省略第1部分时，默认就是使用docker.io这个仓库服务器的，仓库服务或者仓库服务中心的英文原文是registry，简单来说，第1部分就是registry的地址。</p>
<p>第2部分 library：代表组织或者个人的“命名空间”，命名空间是什么意思呢？举个例子，我们每个人都可以docker hub上注册自己的账号，然后使用自己的账号在docker hub上创建仓库，比如，我在docker hub上的账号id是zsythink，那么我就可以在docker hub的zsythink命名空间下创建仓库，如果我创建了一个名为nginx的仓库，那么我就可以通过如下url，获取到这个nginx仓库中的镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker.io/zsythink/nginx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>library，这个命名空间比较特殊，library是专门给上游软件提供商官方使用的命名空间，比如，nginx官方（或者说nginx组织）的nginx的仓库，并不会使用docker.io&#x2F;nginx&#x2F;nginx，而是会使用docker.io&#x2F;library&#x2F;nginx，同理，redis官方的redis仓库，也不会使用docker.io&#x2F;redis&#x2F;redis，而是会使用docker.io&#x2F;library&#x2F;redis，官方仓库中的镜像被称之为官方镜像，docker有一个专门的团队，负责审核和发布官方镜像，这个团队会与软件提供商、社区以及安全专家合作，共同维护这些官方仓库中的镜像，官方镜像的更多内容，可以参考如下链接<a target="_blank" rel="noopener" href="https://docs.docker.com/docker-hub/official_images%EF%BC%8C%E5%BD%93%E6%88%91%E4%BB%AC%E6%83%B3%E8%A6%81%E4%BB%8E%E5%AE%98%E6%96%B9%E4%BB%93%E5%BA%93%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F%E6%97%B6%EF%BC%8C%E6%98%AF%E5%8F%AF%E4%BB%A5%E7%9C%81%E7%95%A5library%E7%9A%84%EF%BC%8C%E6%AF%94%E5%A6%82%EF%BC%8C%E6%88%91%E6%83%B3%E8%A6%81%E7%9B%B4%E6%8E%A5%E4%BB%8Edocker">https://docs.docker.com/docker-hub/official_images，当我们想要从官方仓库下载镜像时，是可以省略library的，比如，我想要直接从docker</a> hub的nginx官方仓库中下载镜像，可以直接使用docker pull nginx命令，此命令等效于docker pull docker.io&#x2F;library&#x2F;nginx，需要注意，只有官方仓库可以省略（即只有library可以省略），其他组织或者个人的命名空间不能省略。</p>
</blockquote>
<p>第3部分 nginx：代表仓库名，在介绍第2部分时，我们已经描述的比较清楚了，我们可以在自己的命名空间下创建很多仓库，比如nginx仓库、redis仓库等，nginx仓库专门用来存放nginx镜像，redis仓库专门用来存放redis镜像，创建仓库时，我们可以选择是否公开仓库，如果不公开，只有通过认证后，才能够获取仓库中的镜像，仓库的英文原文为repository，简单来说，第3部分就是repository的名字。</p>
<p>第4部分 latest：代表镜像对应的标签（tag），通常情况下，我们会通过标签对镜像的版本进行区分，比如，nginx仓库中有十个nginx镜像，第一个nginx镜像对应的版本为nginxV1.1，第二个nginx镜像对应的版本为nginxV1.2，那么第一个镜像的tag就是1.1，第二个镜像的tag就是1.2，以此类推，当我们在拉取镜像时，如果没有指定tag，默认会使用”latest”作为tag，也就是图例中第4部分的标签，”latest”表示最新版，当省略标签或者标签为latest时，会从仓库中下载最新版本的镜像，但是今天的最新版可能就是明天的旧版本，所以，在生产环境中，不要使用latest这个tag，或者说，不要省略tag，最好是指定一个明确的版本tag，这样做是为了防止”latest”这个特殊的tag对应的镜像发生了更新。tag和仓库名之间需要用冒号隔开，比如，nginx:1.21表示nginx库中的tag为1.21的镜像。</p>
<p>启动镜像，基于nginx:latest这个镜像，创建一个名为nginx-demo的容器，并启动这个容器，-d表示后台运行这个容器，-p 80:80表示将docker主机的80端口和容器内nginx服务的80端口进行映射，映射后，访问docker主机的80端口，即相当于访问容器内的nginx服务的80端口</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name nginx-demo -d -p 80:80 nginx:latest</span><br></pre></td></tr></table></figure>

<h1 id="与Docker交互"><a href="#与Docker交互" class="headerlink" title="与Docker交互"></a>与Docker交互</h1><p>已有一个名为 nginx-demo 的容器，需要进入容器</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it nginx-demo /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># -i参数表示interactive，即交互模式。</span></span><br><span class="line"><span class="comment"># -t参数表示分配一个伪终端。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行上述命令后，命令提示符会从host主机的提示符变成了容器的提示符（host主机就是容器所在的主机</span></span><br><span class="line">[root@kvm32docker2 ~]# docker <span class="built_in">exec</span> -it nginx-demo /bin/bash</span><br><span class="line">root@55e0b2020fc0:/# </span><br><span class="line">root@55e0b2020fc0:/# </span><br></pre></td></tr></table></figure>

<blockquote>
<p>55e0b2020fc0为容器的ID</p>
</blockquote>
<p>修改Docker内的文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方法1，将文件拷贝出来做修改操作</span></span><br><span class="line">docker <span class="built_in">cp</span> nginx-demo:/etc/nginx/nginx.conf ./</span><br><span class="line"><span class="comment"># 修改完毕后，拷贝回去</span></span><br><span class="line">docker <span class="built_in">cp</span> ./nginx.conf nginx-demo:/etc/nginx/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法2，进入docker，执行修改指令</span></span><br><span class="line">docker <span class="built_in">exec</span> -it nginx-demo /bin/bash</span><br><span class="line">vi [target.file]</span><br></pre></td></tr></table></figure>

<h2 id="关于进程隔离"><a href="#关于进程隔离" class="headerlink" title="关于进程隔离"></a>关于进程隔离</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.zsythink.net/archives/4321">https://www.zsythink.net/archives/4321</a></p>
<p>在host主机中通过docker top命令查询出的pid，和在容器中通过ps命令查询出的pid不同，前文说过，docker的本质是一种进程隔离技术，docker是通过Linux内核的namespace功能实现PID的隔离的，pid namespace将host上的PID映射为容器内的PID，这样可以让不同的PID namespace中存在相同的进程号，并控制进程间的关系。</p>
<p>这样说可能不太容易理解，咱们换个方式解释一下，假设，现在有两个容器，一个nginx容器，一个redis容器，在nginx容器中，nginx的master进程的pid为1，在redis容器中，redis-server进程的pid为1，对于nginx-master进程或者redis-server进程来说，它们都以为自己是这个世界上的王者，因为它们只能看到自己的世界，而且在自己看到的世界中，自己是主进程（PID为1）。</p>
<p>其实，它们都只不过是host主机中的一个普通进程罢了，nginx容器的master进程在host主机中的PID可能是1234，redis容器中的server进程在host主机中的PID可能是5678，即使在各自的容器中，它们的PID都是1，也许这就是pid namespace进程隔离最直观的感受吧。所以，docker top命令查看的是容器进程在host中的pid，在容器内执行ps命令查看的是容器进程在容器内的pid。</p>
<h1 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h1><p>镜像来源：</p>
<ol>
<li>官方镜像库；</li>
<li>自定义镜像；</li>
</ol>
<p>自定义镜像流程：</p>
<ol>
<li>初始化一个容器</li>
<li>进入容器做自定义修改</li>
<li>打包镜像</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1</span></span><br><span class="line">docker run -td --name alpine-test alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line">docker <span class="built_in">exec</span> -it alpine-test sh</span><br><span class="line">apk add nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line">docker commit -p -c <span class="string">&#x27;CMD [&quot;nginx&quot;,&quot;-g&quot;,&quot;daemon off;&quot;]&#x27;</span> alpine-test zsythink/nginx:test1</span><br><span class="line"><span class="comment"># docker commit 提交容器为镜像</span></span><br><span class="line"><span class="comment"># 基于 alpine-test 创建名为 zsythink/nginx:test1 的镜像</span></span><br><span class="line"><span class="comment"># 上例标签中的zsythink是作者在docker hub上注册的账号ID，zsythink/nginx表示zsythink账号下名为nginx的仓库，完整的写法应该是docker.io/zsythink/nginx:test1，表示docker hub上zsythink账户下nginx仓库中的tag为test1的镜像，但是由于是docker hub上的仓库，所以可以省略registry地址，于是就写成了zsythink/nginx:test1</span></span><br><span class="line"><span class="comment"># -c选项用于设定镜像的各种参数，上例-c选项的值为&#x27;CMD [&quot;nginx&quot;,&quot;-g&quot;,&quot;daemon off;&quot;]&#x27;，表示将镜像的默认运行的程序设置为nginx</span></span><br></pre></td></tr></table></figure>


<h2 id="Docker-构建新镜像"><a href="#Docker-构建新镜像" class="headerlink" title="Docker 构建新镜像"></a>Docker 构建新镜像</h2><p>基于现有的镜像，重新封装一个新的镜像；需要有原始镜像，并且需要有dockerfile文件</p>
<p>以下为基于node最新镜像，封装安装一个hexo博客引擎镜像；</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> node:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 维护者信息</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> your_name &lt;your_mail&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /hexo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装Hexo</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install hexo-cli -g</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> hexo init .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置git</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> git config --global user.name <span class="string">&quot;your_name&quot;</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> git config --global user.email <span class="string">&quot;your_mail&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 映射端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">4000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行命令</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/bin/bash&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>文件写完后，执行指令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t <span class="string">&quot;hexo:latest&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>编译完成后，会出现镜像 hexo:latest</p>
</blockquote>
<h2 id="Docker-Compose-应用"><a href="#Docker-Compose-应用" class="headerlink" title="Docker Compose 应用"></a>Docker Compose 应用</h2><p>将一些列动作打包至一个配置文件中，并将最终的docker以服务的方式运行。</p>
<blockquote>
<p>先决条件：涉及镜像封装，需要有dockerfile ；</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置一个hexo的compose文件</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">blog:</span></span><br><span class="line">    <span class="comment"># 如果镜像有异常就直接执行重启</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">        <span class="comment"># 涉及构建，dockerfile所在的文件夹为context属性，即为上下文</span></span><br><span class="line">        <span class="attr">context:</span> <span class="string">hexo_docker</span></span><br><span class="line">        <span class="comment"># 对应的dockerfile</span></span><br><span class="line">        <span class="attr">dockerfile:</span> <span class="string">dockerfile</span></span><br><span class="line">    <span class="comment"># 构建完的镜像名</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nextblog:24</span></span><br><span class="line">    <span class="comment"># 新起的docker服务名</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">temp_simple_test</span></span><br><span class="line">    <span class="comment"># 映射端口</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;4000:4000&quot;</span></span><br><span class="line">    <span class="comment"># 映射的目录</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">$PWD:/hexo</span></span><br></pre></td></tr></table></figure>

<p>检查compose过程中的报错日志</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose logs -f --<span class="built_in">tail</span>=50 </span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/37b1e185/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/37b1e185/" class="post-title-link" itemprop="url">Docker-常用指令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-17 14:41:00" itemprop="dateCreated datePublished" datetime="2024-03-17T14:41:00+00:00">2024-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-28 12:19:13" itemprop="dateModified" datetime="2025-02-28T12:19:13+00:00">2025-02-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>

<h1 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker pull [image name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加代理</span></span><br><span class="line">docker pull dockerproxy.cn/[image name]:[version]</span><br></pre></td></tr></table></figure>

<h1 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run --name [docker name] -d -p [host port]:[dokcer port] [image name]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run  -td --name [docker name] -d -p [host port]:[dokcer port] [image name]</span><br><span class="line"><span class="comment"># -t表示为容器分配伪终端</span></span><br><span class="line"><span class="comment"># -d表示让容器在后台运行</span></span><br><span class="line"><span class="comment"># 如果只是用-t选项，不使用-d选项，为容器分配的伪终端会直接占用host的命令行，所以，-t选项配合-d选项，让容器在后台运行，可以避免容器一直占用host的命令行窗口，并持续运行容器。</span></span><br><span class="line"><span class="comment"># 如果只使用-d选项，不使用-t选项，会无法正常运行容器，原因是pid为1的主进程结束时，容器也会自动停止，具体情况是这样的，这些操作系统类的基础镜像默认运行的程序通常都是shell，比如bash，也就是说，bash是容器中的主进程，pid是1，如果不使用-t选项为bash分配伪终端，单独执行bash命令后，bash进程就直接结束了（没有绑定任何终端，相当于执行bash命令后一闪而过，没有任何输入输出，直接结束进程）</span></span><br></pre></td></tr></table></figure>

<h1 id="查看镜像"><a href="#查看镜像" class="headerlink" title="查看镜像"></a>查看镜像</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<h1 id="下载Docker或上传文件至Docker"><a href="#下载Docker或上传文件至Docker" class="headerlink" title="下载Docker或上传文件至Docker"></a>下载Docker或上传文件至Docker</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载</span></span><br><span class="line">docker <span class="built_in">cp</span> [Docker]:/..../target.file  ./</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传</span></span><br><span class="line">docker ./target.file [Docker]:/..../target.file </span><br></pre></td></tr></table></figure>

<h1 id="与容器交互"><a href="#与容器交互" class="headerlink" title="与容器交互"></a>与容器交互</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以bash进行交互</span></span><br><span class="line">docker <span class="built_in">exec</span> -it [docker name] /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出，结束当前终端</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="comment"># 退出，不结束当前终端</span></span><br><span class="line">Ctrl + p + q</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker exec命令指定在nginx-demo中运行ls -l /etc/nginx/命令，并将容器内的运行结果返回到当前的命令行中，从而查看到了容器内部/etc/nginx/目录中的信息。</span></span><br><span class="line">docker <span class="built_in">exec</span> nginx-demo <span class="built_in">ls</span> -l /etc/nginx/</span><br></pre></td></tr></table></figure>

<h1 id="关闭容器"><a href="#关闭容器" class="headerlink" title="关闭容器"></a>关闭容器</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop [docker name]</span><br><span class="line">docker <span class="built_in">kill</span> --signal=HUP [docker name]</span><br></pre></td></tr></table></figure>

<h1 id="查看docker对象的详细信息"><a href="#查看docker对象的详细信息" class="headerlink" title="查看docker对象的详细信息"></a>查看docker对象的详细信息</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect [docker name]</span><br></pre></td></tr></table></figure>

<h1 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要先停止运行的容器才能删除目标容器</span></span><br><span class="line">docker <span class="built_in">rm</span> [docker name]</span><br><span class="line">docker ps</span><br><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<h1 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi [image name]</span><br></pre></td></tr></table></figure>

<h1 id="修改镜像的标签"><a href="#修改镜像的标签" class="headerlink" title="修改镜像的标签"></a>修改镜像的标签</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker tag [旧镜像名称]:[旧标签] [新镜像标签]:[新标签]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个动作会保留原有的标签，同时克隆一个新的标签；</span></span><br><span class="line"><span class="comment"># 可以将旧的标签删除 docker rmi [旧镜像名称]:[旧标签]</span></span><br></pre></td></tr></table></figure>

<h1 id="构建自己的镜像"><a href="#构建自己的镜像" class="headerlink" title="构建自己的镜像"></a>构建自己的镜像</h1><p>Dockerfile 是用于定义和构建 docker 镜像的文本文件。<br>包含一些指令与参数，用于描述镜像的构建过程，包含基础镜像、软件安装包、文件拷贝、环境变量设置；</p>
<p>编写规则：</p>
<ol>
<li>每一个执行指令，均为大写字母，且需要跟随参数；</li>
<li>文件按照由上至下执行；</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 参考 https://chunchengwei.github.io/ruan-jian/ji-yu-docker-de-hexo-bo-ke-da-jian/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 先要有一个基础镜像</span></span><br><span class="line">docker pull node:10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 编写docker的构建文件</span></span><br><span class="line"><span class="comment"># 命名为Dockerfile</span></span><br><span class="line"><span class="comment"># 文件内容： </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># *****************************************************************************</span></span><br><span class="line"><span class="comment"># File Name: Dockerfile</span></span><br><span class="line"><span class="comment"># Auther: Chuncheng Wei</span></span><br><span class="line"><span class="comment"># Email: weicc1989@gmail.com</span></span><br><span class="line"><span class="comment"># Created Time: Fri Nov 30 23:08:07 2018</span></span><br><span class="line"><span class="comment"># Description:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     This bases on node:10 image</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># *****************************************************************************</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 基础镜像</span></span><br><span class="line">FROM node:10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 维护者信息</span></span><br><span class="line">MAINTAINER your_name &lt;your_mail&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 工作目录</span></span><br><span class="line">WORKDIR /hexo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装Hexo</span></span><br><span class="line">RUN npm install hexo-cli -g</span><br><span class="line">RUN hexo init .</span><br><span class="line">RUN npm install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置git</span></span><br><span class="line">RUN git config --global user.name <span class="string">&quot;your_name&quot;</span></span><br><span class="line">RUN git config --global user.email <span class="string">&quot;your_mail&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 映射端口</span></span><br><span class="line">EXPOSE 4000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行命令</span></span><br><span class="line">CMD [<span class="string">&quot;/bin/bash&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 开始构建</span></span><br><span class="line">docker build -t <span class="string">&quot;新镜像名:版本号&quot;</span>  -f ./Dockerfile</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="普通用户执行-Docker-指令"><a href="#普通用户执行-Docker-指令" class="headerlink" title="普通用户执行 Docker 指令"></a>普通用户执行 Docker 指令</h1><p>非root用户执行docker指令，会提示 “permission denied while trying to connect to the Docker daemon socket at…”</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gpasswd -a [User] docker</span><br><span class="line"></span><br><span class="line">newgrp docker</span><br><span class="line"><span class="comment"># newgrp 命令更改用户的实型组标识。 运行该命令时，系统将使您处于一个新的 shell 中，并且将您的实型组名称更改为用 Group 参数指定的组。 缺省情况下，newgrp 命令将您的实型组更改为 /etc/passwd 文件中所指定的组。</span></span><br><span class="line"><span class="comment"># https://www.ibm.com/docs/zh/aix/7.3?topic=n-newgrp-command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新登录后，就可以执行docker指令</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/c153b50a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/c153b50a/" class="post-title-link" itemprop="url">Python程序实例-Selenium应用-获取页面信息</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-16 18:11:15" itemprop="dateCreated datePublished" datetime="2024-03-16T18:11:15+00:00">2024-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">基础知识</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E7%BC%96%E7%A8%8B/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h1><p>需要进入多个页面获取信息内容，并输出至文本，用于后期Excel数据展示。</p>
<h1 id="涉及知识点"><a href="#涉及知识点" class="headerlink" title="涉及知识点"></a>涉及知识点</h1><h2 id="Python-逐行读取文件"><a href="#Python-逐行读取文件" class="headerlink" title="Python 逐行读取文件"></a>Python 逐行读取文件</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方案1</span></span><br><span class="line"><span class="comment"># 全部读取</span></span><br><span class="line">FILE=<span class="built_in">open</span>(<span class="string">&quot;TEST.demo&quot;</span>)</span><br><span class="line"><span class="comment"># read()表示一次性读取文件全部内容</span></span><br><span class="line">LINE=FILE.read()</span><br><span class="line"><span class="built_in">print</span>(LINE)</span><br><span class="line">FILE.<span class="built_in">open</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方案2</span></span><br><span class="line"><span class="comment"># 逐行读取</span></span><br><span class="line">FILE=<span class="built_in">open</span>(<span class="string">&quot;TEST.demo&quot;</span>)</span><br><span class="line">LINE=FILE.readline()</span><br><span class="line"><span class="keyword">while</span> LINE:</span><br><span class="line">    <span class="built_in">print</span>(LINE)</span><br><span class="line">    LINE=FILE.readline()</span><br><span class="line">FILE.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方案3</span></span><br><span class="line"><span class="comment"># 读取所有行</span></span><br><span class="line">FILE=<span class="built_in">open</span>(<span class="string">&quot;TEST.demo&quot;</span>)</span><br><span class="line">LINES=FILE.readlines()</span><br><span class="line"><span class="keyword">for</span> LINE <span class="keyword">in</span> LINES:</span><br><span class="line">    <span class="built_in">print</span>(LINE)</span><br><span class="line">    LINE=FILE.readline()</span><br><span class="line">FILE.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="程序休眠"><a href="#程序休眠" class="headerlink" title="程序休眠"></a>程序休眠</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># 休眠</span></span><br><span class="line">time.sleep([SECONDS])</span><br></pre></td></tr></table></figure>

<h2 id="for-循环逐行读取"><a href="#for-循环逐行读取" class="headerlink" title="for 循环逐行读取"></a>for 循环逐行读取</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> iterating_var <span class="keyword">in</span> sequence:</span><br><span class="line">    statements(s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历字符串：</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> <span class="string">&#x27;Python&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Current char $s&quot;</span>% char)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历0-100的数字：</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 等效于 Powershell 语言</span></span><br><span class="line"><span class="comment"># for ($i=0;$i -lt 100;$i ++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历50-100的数字：</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<h2 id="数字整型转换成字符型"><a href="#数字整型转换成字符型" class="headerlink" title="数字整型转换成字符型"></a>数字整型转换成字符型</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TARGET_INT=<span class="number">10</span></span><br><span class="line">TARGET_STRING=<span class="built_in">str</span>(TARGET_INT)</span><br></pre></td></tr></table></figure>

<h2 id="字符型转换为整型"><a href="#字符型转换为整型" class="headerlink" title="字符型转换为整型"></a>字符型转换为整型</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认十进制</span></span><br><span class="line">TARGET_NUMBER=<span class="built_in">int</span>(<span class="string">&quot;20&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改为十六进制</span></span><br><span class="line">TARGET_NUMBER=<span class="built_in">int</span>(<span class="string">&quot;20&quot;</span>,<span class="number">16</span>)</span><br></pre></td></tr></table></figure>

<h2 id="文件输出"><a href="#文件输出" class="headerlink" title="文件输出"></a>文件输出</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 覆盖文件内容，作用相当于 echo &quot;&quot; &gt; test.demo</span></span><br><span class="line">FILE=<span class="built_in">open</span>(<span class="string">&#x27;test.demo&#x27;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line">FILE.write(<span class="string">&quot;TARGET CONTENT&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 追加文件内容，作用相当于 echo &quot;&quot; &gt;&gt; test.demo</span></span><br><span class="line"><span class="comment"># 等价于 Powershell 的 Add-Content</span></span><br><span class="line">FILE=<span class="built_in">open</span>(<span class="string">&#x27;test.demo&#x27;</span>,<span class="string">&quot;a&quot;</span>)</span><br><span class="line">FILE.write(<span class="string">&quot;TARGET CONTENT&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="字符比较判断"><a href="#字符比较判断" class="headerlink" title="字符比较判断"></a>字符比较判断</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 汉字比较</span></span><br><span class="line">TEST_CHAT=<span class="string">&quot;用于测试的字符&quot;</span></span><br><span class="line">TARGET_CHAT=<span class="string">&quot;用于匹配判断的字符&quot;</span></span><br><span class="line"><span class="keyword">if</span> TEST_CHAT <span class="keyword">in</span> TARGET_CHAT:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;匹配成功&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TARGET_STRING1=<span class="string">&#x27;字符串1&#x27;</span></span><br><span class="line">TARGET_STRING2=<span class="string">&#x27;字符串2&#x27;</span></span><br><span class="line">TARGET_STRING3=<span class="string">&#x27;字符串3&#x27;</span></span><br><span class="line">TOTAL_STRING=TARGET_STRING1 + TARGET_STRING2 + TARGET_STRING3</span><br></pre></td></tr></table></figure>

<h2 id="字符串替代"><a href="#字符串替代" class="headerlink" title="字符串替代"></a>字符串替代</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_STRING=<span class="string">&quot;DEFUALTSTRING&quot;</span></span><br><span class="line">TEMP_STRING=<span class="string">&quot;I need to replace DEFUALTSTRING&quot;</span></span><br><span class="line">NEW_STRING=TEMP_STRING(<span class="string">&quot;DEFAULTSTRING&quot;</span>,<span class="string">&quot;NEWSTRING&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="异常处理或异常"><a href="#异常处理或异常" class="headerlink" title="异常处理或异常"></a>异常处理或异常</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    Code_Block</span><br><span class="line"><span class="keyword">except</span> [Except_type]:</span><br><span class="line">    Handle_EXCEPT_CODE_Block</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    Code Block</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">    <span class="built_in">print</span>(ex)</span><br></pre></td></tr></table></figure>

<h1 id="脚本内容"><a href="#脚本内容" class="headerlink" title="脚本内容"></a>脚本内容</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> selenium.webdriver <span class="keyword">as</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver。common.keys <span class="keyword">import</span> Keys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">WriteLog</span>(<span class="params">INFO</span>):</span><br><span class="line">    FILE=<span class="built_in">open</span>(<span class="string">&quot;Output.log&quot;</span>,<span class="string">&quot;a&quot;</span>)</span><br><span class="line">    FILE.write(INFO)</span><br><span class="line">    FILE.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GetXPATHELEM</span>(<span class="params">DRIVER,TARGET_XPATH</span>):</span><br><span class="line">    ELEM=DRIVER.find_element(By.XPATH,TARGET_XPATH)</span><br><span class="line">    <span class="keyword">return</span> ELEM</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">HandleElementInfo</span>(<span class="params">DRIVER</span>):</span><br><span class="line">    TARGET_ELEM_XPATH=<span class="string">&quot;&quot;</span></span><br><span class="line">    TARGET_CONTENT=GetXPATHELEM(DRIVER,TARGET_ELEM_XPATH).text</span><br><span class="line">    <span class="keyword">return</span> TARGET_CONTENT</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">HandleURL</span>(<span class="params">DRIVER,TARGET_URL</span>):</span><br><span class="line">    <span class="comment"># 避免被服务端禁用，需要暂停10s再执行</span></span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line">    DEFAULT_URL=<span class="string">&quot;&quot;</span></span><br><span class="line">    NEW_URL=DEFAULT_URL.replace(<span class="string">&quot;&quot;</span>,TARGET_URL)</span><br><span class="line">    DRIVER.get(NEW_URL)</span><br><span class="line"></span><br><span class="line">driver=webdriver.Chrome()</span><br><span class="line">HandleURL(driver,<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Chrome-Driver-下载"><a href="#Chrome-Driver-下载" class="headerlink" title="Chrome Driver 下载"></a>Chrome Driver 下载</h1><p><a target="_blank" rel="noopener" href="https://googlechromelabs.github.io/chrome-for-testing">https://googlechromelabs.github.io/chrome-for-testing</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/81fd687e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/81fd687e/" class="post-title-link" itemprop="url">VCSA-VSAN页面显示故障</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-15 22:09:39" itemprop="dateCreated datePublished" datetime="2024-03-15T22:09:39+00:00">2024-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/vSphere/" itemprop="url" rel="index"><span itemprop="name">vSphere</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障描述"><a href="#故障描述" class="headerlink" title="故障描述"></a>故障描述</h1><p>在 VCSA 中，进入到vSAN相关的页面选项时，会出现“无法提取请求的数据。有关详细信息，请查看vSphere Client日志”</p>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>最近 VCSA 更换证书，导致底层证书不匹配。<br>关联业务只要托管 VCSA 的地址，均需要重新认证新SSL证书链接，比如vRops、Horizon等。</p>
<p>查看 VCSA的日志 （路径：&#x2F;var&#x2F;log&#x2F;vmware&#x2F;vsphere-ui&#x2F;logs&#x2F;vsphere_client_virgo.log）,显示Server certificate chain is not trusted and thumbprint doesn’t match 。</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><ol>
<li>SSH至目标 VCSA；</li>
<li>创建脚本并执行；执行指令 .&#x2F;脚本名  -cmlf</li>
<li>记录有问题的证书指纹；匹配字段 SHA1 Fingerprint&#x3D;</li>
<li>在提示 Proceed with updateing trust anchors?[Y&#x2F;N] ; 输入 Y</li>
<li>在提示 Enter SSO admin [<a href="mailto:&#x61;&#100;&#109;&#x69;&#110;&#x69;&#x73;&#x74;&#x72;&#x61;&#x74;&#x6f;&#x72;&#x40;&#118;&#115;&#x70;&#104;&#x65;&#x72;&#x65;&#46;&#x6c;&#x6f;&#99;&#97;&#108;">&#x61;&#100;&#109;&#x69;&#110;&#x69;&#x73;&#x74;&#x72;&#x61;&#x74;&#x6f;&#x72;&#x40;&#118;&#115;&#x70;&#104;&#x65;&#x72;&#x65;&#46;&#x6c;&#x6f;&#99;&#97;&#108;</a>] ; 输入 <a href="mailto:&#97;&#x64;&#109;&#105;&#x6e;&#x69;&#x73;&#x74;&#x72;&#x61;&#116;&#111;&#x72;&#64;&#x76;&#x73;&#112;&#x68;&#101;&#114;&#101;&#46;&#108;&#111;&#x63;&#97;&#x6c;">&#97;&#x64;&#109;&#105;&#x6e;&#x69;&#x73;&#x74;&#x72;&#x61;&#116;&#111;&#x72;&#64;&#x76;&#x73;&#112;&#x68;&#101;&#114;&#101;&#46;&#108;&#111;&#x63;&#97;&#x6c;</a> </li>
<li>在提示 Enter fingerprint of trust anchor(s) to update: ; 输入 No.3 记录的指纹</li>
<li>在提示 Enter the FQDN of the node to update: ; 输入 VCSA 的 FQDN 或者 IP</li>
<li>等待更新即可；</li>
</ol>
<p>关于脚本的参数</p>
<blockquote>
<p>-c ; 文本高亮，包含SHA1 Fingerprint<br>-m ; 显示当前设备的SSL 证书<br>-l ；与-m合用，显示所有节点的证书<br>-f ; 修复</p>
</blockquote>
<p>脚本文件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">setOptionColorize</span></span>() &#123;</span><br><span class="line">   RED=$(tput setaf 1)</span><br><span class="line">   GREEN=$(tput setaf 2)</span><br><span class="line">   YELLOW=$(tput setaf 3)</span><br><span class="line">   CYAN=$(tput setaf 6)</span><br><span class="line">   NORMAL=$(tput sgr0)</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">unknownOption</span></span>() &#123;</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;Unknown option &#x27;<span class="variable">$2</span>&#x27;. Please see &#x27;<span class="variable">$1</span> --help&#x27; for usage and available options&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">CURRENT_SERVICE_ID=<span class="string">&#x27;&#x27;</span></span><br><span class="line">SHOW_SERVICE_IDS=0</span><br><span class="line">SHOW_ENDPOINTS=0</span><br><span class="line">SHOW_DUPLICATE_ENDPOINTS=0</span><br><span class="line">LIVE_CHECK=0</span><br><span class="line">VIEW_MACHINE_SSL=0</span><br><span class="line">DEBUG=0</span><br><span class="line">FIX=0</span><br><span class="line">TP_ALGORITHM=<span class="string">&quot;sha1&quot;</span></span><br><span class="line">TP_REGEX_ITER=<span class="string">&quot;19&quot;</span></span><br><span class="line">CERT_TEXT=0</span><br><span class="line">CERT_COUNT=1</span><br><span class="line">RED=<span class="string">&#x27;&#x27;</span></span><br><span class="line">GREEN=<span class="string">&#x27;&#x27;</span></span><br><span class="line">YELLOW=<span class="string">&#x27;&#x27;</span></span><br><span class="line">CYAN=<span class="string">&#x27;&#x27;</span></span><br><span class="line">NORMAL=<span class="string">&#x27;&#x27;</span></span><br><span class="line">LSTOOL_FILE=<span class="string">&#x27;lstool.txt&#x27;</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;LIVE_CHECK&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">   VC_VERSION=$(grep <span class="string">&#x27;CLOUDVM_VERSION:&#x27;</span> /etc/vmware/.buildInfo | awk -F<span class="string">&#x27;:&#x27;</span> <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span> | awk -F<span class="string">&#x27;.&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   VC_VERSION=$(grep <span class="string">&#x27;CLOUDVM_VERSION:&#x27;</span> ../etc/vmware/.buildInfo | awk -F<span class="string">&#x27;:&#x27;</span> <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span> | awk -F<span class="string">&#x27;.&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;VC_VERSION&#125;</span> -eq 7 ]]; <span class="keyword">then</span></span><br><span class="line">   LS_PORT=<span class="string">&#x27;7090&#x27;</span></span><br><span class="line">   LSTOOL_SCRIPT=<span class="string">&#x27;/usr/lib/vmware-lookupsvc/tools/lstool.py&#x27;</span></span><br><span class="line">   LSUPDATE_SCRIPT=<span class="string">&#x27;/usr/lib/vmware-lookupsvc/tools/ls_update_certs.py&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   LS_PORT=<span class="string">&#x27;7080&#x27;</span></span><br><span class="line">   LSTOOL_SCRIPT=<span class="string">&#x27;/usr/lib/vmidentity/tools/scripts/lstool.py&#x27;</span></span><br><span class="line">   LSUPDATE_SCRIPT=<span class="string">&#x27;/usr/lib/vmidentity/tools/scripts/ls_update_certs.py&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [ -f /usr/bin/ldapsearch ]; <span class="keyword">then</span></span><br><span class="line">   LDAPSEARCH=<span class="string">&#x27;/usr/bin/ldapsearch&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   LDAPSEARCH=<span class="string">&#x27;/opt/likewise/bin/ldapsearch&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$#</span>&quot;</span> -ge 1 ]; <span class="keyword">then</span></span><br><span class="line">   <span class="keyword">for</span> arg <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">case</span> <span class="variable">$&#123;arg&#125;</span> <span class="keyword">in</span></span><br><span class="line">         -h|--<span class="built_in">help</span>)</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;SSL Trust Anchor Verification Script&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> [options]&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Options:&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -s | --show-service-ids   Shows the Service IDs that are using a particular SSL certificate.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -e | --show-endpoints     Shows the Endpoing URIs that are using a particular SSL certificate.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -c | --colorize           Colorizes text for quick identification of Subject field, SHA1 Fingerprint, or&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             expired certificates. Do not use if passing output to a paginator or file.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -l | --live-check         Used in conjunction with the &#x27;-m|--machine-ssl&#x27; option, will indicate the script&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             is running on a live system, and will display current Machine SSL certificates&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             for all nodes with endpoints in the current SSO Site.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -m | --machine-ssl        Will display information on the current Machine SSL ceritifcate. Cannot be run on&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             a support bundle from an external Platform Services Controller.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -t | --cert-text          Will provide full output of each certificate similar to &#x27;openssl x509 -text&#x27;&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -f | --fix                Will prompt for SSO credentials, thumbprint of a trust anchor cert to update, and the IP/FQDN&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             of a node to update.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -d | --debug              Will include the raw certificate hash to see if there are any extra characters&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             (sometimes the lstool.py script has connection issues and STDERR gets randomly&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;                             inserted in the output).&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -h | --help               Prints this help menu.&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;   -2 | --sha256             Outputs the SHA256 thumbprint of the certificates instead of the SHA1 thumbprint&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Parses the output of the following command from the Platform Services Controller:&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;LSTOOL_SCRIPT&#125;</span> list --url http://localhost:<span class="variable">$&#123;LS_PORT&#125;</span>/lookupservice/sdk 2&gt;/dev/null&quot;</span></span><br><span class="line">            <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Can be run from the &#x27;commands/&#x27; directory of a support bundle, or live on a PSC node&quot;</span></span><br><span class="line">            <span class="built_in">exit</span></span><br><span class="line">            ;;</span><br><span class="line">  </span><br><span class="line">         --show-service-ids)</span><br><span class="line">            SHOW_SERVICE_IDS=1</span><br><span class="line">            ;;</span><br><span class="line">  </span><br><span class="line">         --show-endpoints)</span><br><span class="line">            SHOW_ENDPOINTS=1</span><br><span class="line">            ;;</span><br><span class="line">         --colorize)</span><br><span class="line">            setOptionColorize</span><br><span class="line">            ;;</span><br><span class="line">         --live-check)</span><br><span class="line">            LIVE_CHECK=1</span><br><span class="line">            ;;</span><br><span class="line">         --machine-ssl)</span><br><span class="line">            VIEW_MACHINE_SSL=1</span><br><span class="line">            ;;</span><br><span class="line">         --debug)</span><br><span class="line">            DEBUG=1</span><br><span class="line">            ;;</span><br><span class="line">         --cert-text)</span><br><span class="line">            CERT_TEXT=1</span><br><span class="line">            ;;</span><br><span class="line">         --fix)</span><br><span class="line">            FIX=1</span><br><span class="line">            ;;</span><br><span class="line">         --sha256)</span><br><span class="line">            TP_ALGORITHM=<span class="string">&quot;sha256&quot;</span></span><br><span class="line">            TP_REGEX_ITER=<span class="string">&quot;31&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">         -[seclmfdt2]*)</span><br><span class="line">        OPT=$(<span class="built_in">echo</span> <span class="string">&quot;z<span class="variable">$&#123;arg&#125;</span>&quot;</span> | sed <span class="string">&#x27;s/z-//&#x27;</span>)</span><br><span class="line">            <span class="keyword">for</span> (( i=<span class="number">0</span>; i&lt;<span class="variable">$&#123;#OPT&#125;</span>; i++ )); <span class="keyword">do</span></span><br><span class="line">               <span class="keyword">case</span> <span class="variable">$&#123;OPT:$i:1&#125;</span> <span class="keyword">in</span></span><br><span class="line">                  s)</span><br><span class="line">                     SHOW_SERVICE_IDS=1</span><br><span class="line">                     ;;</span><br><span class="line">                  e)</span><br><span class="line">                     SHOW_ENDPOINTS=1</span><br><span class="line">                     ;;</span><br><span class="line">                  c)</span><br><span class="line">                     setOptionColorize</span><br><span class="line">                     ;;</span><br><span class="line">                  d)</span><br><span class="line">                     DEBUG=1</span><br><span class="line">                     ;;</span><br><span class="line">                  l)</span><br><span class="line">                     LIVE_CHECK=1</span><br><span class="line">                     ;;</span><br><span class="line">                  m)</span><br><span class="line">                     VIEW_MACHINE_SSL=1</span><br><span class="line">                     ;;</span><br><span class="line">                  t)</span><br><span class="line">                     CERT_TEXT=1</span><br><span class="line">                     ;;                 </span><br><span class="line">                  f)</span><br><span class="line">                     FIX=1</span><br><span class="line">                     ;;</span><br><span class="line">                  2)</span><br><span class="line">                     TP_ALGORITHM=<span class="string">&quot;sha256&quot;</span></span><br><span class="line">                     TP_REGEX_ITER=<span class="string">&quot;31&quot;</span></span><br><span class="line">                     ;;</span><br><span class="line">                  *)</span><br><span class="line">                     unknownOption <span class="variable">$0</span> <span class="string">&#x27;-$&#123;OPT:$i:1&#125;&#x27;</span></span><br><span class="line">                     <span class="built_in">exit</span></span><br><span class="line">                     ;;</span><br><span class="line">               <span class="keyword">esac</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">            ;;</span><br><span class="line">         *)</span><br><span class="line">            unknownOption <span class="variable">$0</span> <span class="variable">$&#123;arg&#125;</span></span><br><span class="line">            <span class="built_in">exit</span></span><br><span class="line">            ;;</span><br><span class="line">      <span class="keyword">esac</span></span><br><span class="line">   <span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;LIVE_CHECK&#125;</span> -eq 0 ]]; <span class="keyword">then</span></span><br><span class="line">   <span class="keyword">if</span> [ ! -f <span class="variable">$&#123;LSTOOL_FILE&#125;</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">if</span> [ ! -f <span class="string">&quot;python.exe_VMWARE_CIS_HOMEVMwareIdentityServiceslstoolscriptslstoolpy-list---url-httplocalhost7080lo[...].txt&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>No output from &#x27;lstool.py list&#x27; found in this bundle.&quot;</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         LSTOOL_FILE=<span class="string">&#x27;python.exe_VMWARE_CIS_HOMEVMwareIdentityServiceslstoolscriptslstoolpy-list---url-httplocalhost7080lo[...].txt&#x27;</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">if</span> [ -f ../etc/vmware/deployment.node.type ]; <span class="keyword">then</span></span><br><span class="line">      NODE_TYPE=$(<span class="built_in">cat</span> ../etc/vmware/deployment.node.type)</span><br><span class="line">   <span class="keyword">elif</span> [ -f ../ProgramData/VMware/vCenterServer/cfg/deployment.node.type ]; <span class="keyword">then</span></span><br><span class="line">      NODE_TYPE=$(<span class="built_in">cat</span> ../ProgramData/VMware/vCenterServer/cfg/deployment.node.type)</span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   NODE_TYPE=$(<span class="built_in">cat</span> /etc/vmware/deployment.node.type)</span><br><span class="line">   <span class="keyword">if</span> [ <span class="variable">$&#123;NODE_TYPE&#125;</span> == <span class="string">&#x27;management&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>Operation not supported on a Management Node. Please run this live on a PSC node. Exiting...<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">      <span class="built_in">exit</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">   <span class="keyword">if</span> [ ! -f <span class="variable">$&#123;LSTOOL_FILE&#125;</span> ]; <span class="keyword">then</span> LSTOOL_FILE=<span class="string">&#x27;/tmp/lstool.txt&#x27;</span>; <span class="keyword">fi</span></span><br><span class="line">       </span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>No &#x27;lstool.txt&#x27; file found in this directory. Dumping service registrations to <span class="variable">$&#123;LSTOOL_FILE&#125;</span>...<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">   <span class="variable">$&#123;LSTOOL_SCRIPT&#125;</span> list --url http://localhost:<span class="variable">$&#123;LS_PORT&#125;</span>/lookupservice/sdk 2&gt;/tmp/lstool_stderr &gt; <span class="variable">$&#123;LSTOOL_FILE&#125;</span>     </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">DATA=$(<span class="built_in">cat</span> <span class="variable">$&#123;LSTOOL_FILE&#125;</span> | grep -vE <span class="string">&#x27;^[0-9]&#123;4&#125;-[0-9]&#123;2&#125;-[0-9]&#123;2&#125;&#x27;</span> | grep -E <span class="string">&#x27;Service ID:|URL:|SSL trust:|^[0-9A-Za-z/\+]&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27; &#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;\n&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;\t&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;\r\n&#x27;</span> | sed -e <span class="string">&#x27;s/ServiceID:/\nServiceID:/g&#x27;</span> -e <span class="string">&#x27;s/URL:/\nURL:/g&#x27;</span> -e <span class="string">&#x27;s/SSLtrust:/\nSSLtrust:/g&#x27;</span>)</span><br><span class="line">TRUST_ANCHORS=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;DATA&#125;</span>&quot;</span> | grep <span class="string">&#x27;SSLtrust&#x27;</span> | sed -e <span class="string">&#x27;s/SSLtrust://g&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span>)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> RAW_HASH <span class="keyword">in</span> <span class="variable">$&#123;TRUST_ANCHORS&#125;</span>; <span class="keyword">do</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>-----Endpoint Certificate <span class="variable">$&#123;CERT_COUNT&#125;</span>-----<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">  </span><br><span class="line">   <span class="keyword">if</span> [[ <span class="variable">$&#123;RAW_HASH&#125;</span> =~ [0-9]&#123;4&#125;-[0-9]&#123;2&#125;-[0-9]&#123;2&#125; ]]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;RED&#125;</span>Malformed hash detected<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">      BAD=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;RAW_HASH&#125;</span>&quot;</span> | grep -oE <span class="string">&#x27;[0-9]&#123;4&#125;-[0-9]&#123;2&#125;-[0-9]&#123;2&#125;(.)+&#x27;</span>)</span><br><span class="line">      HASH=<span class="string">&quot;<span class="subst">$(echo <span class="string">&quot;<span class="variable">$&#123;RAW_HASH&#125;</span>&quot;</span> | sed -e &#x27;s/$&#123;BAD&#125;//&#x27;)</span>&quot;</span></span><br><span class="line">      CHARS=<span class="variable">$&#123;#HASH&#125;</span></span><br><span class="line">      MOD=$((<span class="variable">$&#123;CHARS&#125;</span> % <span class="number">4</span>))</span><br><span class="line">      <span class="keyword">case</span> <span class="variable">$&#123;MOD&#125;</span> <span class="keyword">in</span></span><br><span class="line">         3)</span><br><span class="line">            HASH=<span class="string">&quot;<span class="variable">$&#123;HASH&#125;</span>=&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">         2)</span><br><span class="line">            HASH=<span class="string">&quot;<span class="variable">$&#123;HASH&#125;</span>==&quot;</span></span><br><span class="line">            ;;</span><br><span class="line">      <span class="keyword">esac</span></span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">      HASH=<span class="variable">$&#123;RAW_HASH&#125;</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">   CURRENT_CERT=<span class="string">&quot;-----BEGIN CERTIFICATE-----&quot;</span>$<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">   CURRENT_CERT+=$(<span class="built_in">echo</span> <span class="variable">$&#123;HASH&#125;</span> | <span class="built_in">fold</span> -c64)</span><br><span class="line">   CURRENT_CERT+=$<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;-----END CERTIFICATE-----&quot;</span></span><br><span class="line">  </span><br><span class="line">   <span class="keyword">if</span> <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT&#125;</span>&quot;</span> | openssl x509 -text &gt; /dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">if</span> [[ <span class="variable">$&#123;CERT_TEXT&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">         CURRENT_CERT_INFO=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT&#125;</span>&quot;</span> | openssl x509 -text -noout -fingerprint -<span class="variable">$&#123;TP_ALGORITHM&#125;</span> | sed -e <span class="string">&#x27;s/SHA[0-9]* Fingerprint/\t&amp;/g&#x27;</span> -e <span class="string">&quot;s/Subject:/<span class="variable">$&#123;GREEN&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span> -e <span class="string">&quot;s/[[:xdigit:]]\&#123;2\&#125;\(:[[:xdigit:]]\&#123;2\&#125;\)\&#123;<span class="variable">$&#123;TP_REGEX_ITER&#125;</span>\&#125;/<span class="variable">$&#123;YELLOW&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span> -e <span class="string">&quot;s/X509v3 Subject Alternative Name/<span class="variable">$&#123;GREEN&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span>)</span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT_INFO&#125;</span>&quot;</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         CURRENT_CERT_INFO=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT&#125;</span>&quot;</span> | openssl x509 -text -noout -fingerprint -<span class="variable">$&#123;TP_ALGORITHM&#125;</span> | grep -E <span class="string">&#x27;Issuer:|Subject:|Validity|Not Before:|Not After :|Fingerprint&#x27;</span> | sed -e <span class="string">&#x27;s/SHA[0-9]* Fingerprint/\t&amp;/g&#x27;</span> -e <span class="string">&quot;s/Subject:/<span class="variable">$&#123;GREEN&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span> -e <span class="string">&quot;s/[[:xdigit:]]\&#123;2\&#125;\(:[[:xdigit:]]\&#123;2\&#125;\)\&#123;<span class="variable">$&#123;TP_REGEX_ITER&#125;</span>\&#125;/<span class="variable">$&#123;YELLOW&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span>)</span><br><span class="line">  </span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;Certificate Info:&quot;</span></span><br><span class="line">         <span class="keyword">if</span> <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT&#125;</span>&quot;</span> | openssl x509 -noout -checkend 0; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT_INFO&#125;</span>&quot;</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_CERT_INFO&#125;</span>&quot;</span> | sed -e <span class="string">&quot;s/Not Before/<span class="variable">$&#123;RED&#125;</span>&amp;/&quot;</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">         <span class="keyword">if</span> [[ <span class="variable">$&#123;DEBUG&#125;</span> -gt 0 ]]; <span class="keyword">then</span> <span class="built_in">echo</span> $<span class="string">&#x27;\t&#x27;</span><span class="string">&quot;Certificate Hash: <span class="variable">$&#123;HASH&#125;</span>&quot;</span>; <span class="keyword">fi</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;RED&#125;</span>Unable to parse certificate hash<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">      <span class="keyword">if</span> [[ <span class="variable">$&#123;DEBUG&#125;</span> -gt 0 ]]; <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;HASH&#125;</span>&quot;</span>; <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">   <span class="keyword">if</span> [[ <span class="variable">$&#123;SHOW_SERVICE_IDS&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">      REGEX_HASH=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;RAW_HASH&#125;</span>&quot;</span> | sed -e <span class="string">&#x27;s/\+/\\+/g&#x27;</span> -e <span class="string">&#x27;s/\$/\\$/g&#x27;</span>)</span><br><span class="line">      FOUND_SERVICE_IDS=<span class="string">&#x27;&#x27;</span></span><br><span class="line">  </span><br><span class="line">      <span class="keyword">for</span> line <span class="keyword">in</span> $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;DATA&#125;</span>&quot;</span> | grep -vE <span class="string">&#x27;^URL:&#x27;</span> | <span class="built_in">uniq</span> | grep -E <span class="string">&quot;ServiceID|<span class="variable">$&#123;REGEX_HASH&#125;</span>&quot;</span> | grep -B1 <span class="variable">$&#123;RAW_HASH&#125;</span>); <span class="keyword">do</span></span><br><span class="line">         <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$&#123;line&#125;</span>&quot;</span> =~ ^ServiceID ]]; <span class="keyword">then</span></span><br><span class="line">            CURRENT_SERVICE_ID=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;line&#125;</span>&quot;</span> | sed -e <span class="string">&#x27;s/ServiceID://g&#x27;</span>)</span><br><span class="line">         <span class="keyword">elif</span> $(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;line&#125;</span>&quot;</span> | grep <span class="variable">$&#123;RAW_HASH&#125;</span> &gt; /dev/null); <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$&#123;FOUND_SERVICE_IDS&#125;</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">               FOUND_SERVICE_IDS=$<span class="string">&#x27;\t&#x27;</span><span class="string">&quot;<span class="variable">$&#123;CURRENT_SERVICE_ID&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">               FOUND_SERVICE_IDS+=$<span class="string">&#x27;\n\t&#x27;</span><span class="string">&quot;<span class="variable">$&#123;CURRENT_SERVICE_ID&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">      <span class="keyword">done</span></span><br><span class="line">  </span><br><span class="line">      NUM_FOUND_SERVICE_IDS=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;FOUND_SERVICE_IDS&#125;</span>&quot;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">  </span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;Service IDs (<span class="variable">$&#123;NUM_FOUND_SERVICE_IDS&#125;</span>):&quot;</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;FOUND_SERVICE_IDS&#125;</span>&quot;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">   <span class="keyword">if</span> [[ <span class="variable">$&#123;SHOW_ENDPOINTS&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">      ENDPOINTS=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;DATA&#125;</span>&quot;</span> | grep -vE <span class="string">&#x27;^ServiceID&#x27;</span> | grep -B1 <span class="variable">$&#123;RAW_HASH&#125;</span> | grep -E <span class="string">&#x27;^URL:&#x27;</span> | sed -e <span class="string">&#x27;s/URL:/\t/g&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span>)</span><br><span class="line">      NUM_ENDPOINTS=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;ENDPOINTS&#125;</span>&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">  </span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;Endpoints (<span class="variable">$&#123;NUM_ENDPOINTS&#125;</span>):&quot;</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;ENDPOINTS&#125;</span>&quot;</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>--------------------------------<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">   ((++CERT_COUNT))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;VIEW_MACHINE_SSL&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">   <span class="keyword">if</span> [[ <span class="variable">$&#123;LIVE_CHECK&#125;</span> -eq 0 ]]; <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;NODE_TYPE&#125;</span>&quot;</span> = <span class="string">&#x27;infrastructure&#x27;</span> ]; <span class="keyword">then</span></span><br><span class="line">         <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>The Machine SSL certificate is not included in an external PSC support bundle.<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         <span class="keyword">if</span> [ -f ../etc/vmware-vpx/ssl/rui.crt ]; <span class="keyword">then</span></span><br><span class="line">            MACHINE_SSL_FILE=<span class="string">&#x27;../etc/vmware-vpx/ssl/rui.crt&#x27;</span></span><br><span class="line">         <span class="keyword">elif</span> [ -f ../ProgramData/VMware/vCenterServer/cfg/vmware-vpx/ssl/rui.crt ]; <span class="keyword">then</span></span><br><span class="line">            MACHINE_SSL_FILE=<span class="string">&#x27;../ProgramData/VMware/vCenterServer/cfg/vmware-vpx/ssl/rui.crt&#x27;</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">         <span class="keyword">if</span> [ ! -z <span class="variable">$&#123;MACHINE_SSL_FILE&#125;</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>-----Machine SSL Certificate-----<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">            CURRENT_MACHINE_SSL_CERT_INFO=$(<span class="built_in">cat</span> <span class="variable">$&#123;MACHINE_SSL_FILE&#125;</span> | openssl x509 -text -noout -fingerprint -<span class="variable">$&#123;TP_ALGORITHM&#125;</span> | grep -E <span class="string">&#x27;Issuer:|Subject:|Validity|Not Before:|Not After :|Fingerprint&#x27;</span> | sed -e <span class="string">&#x27;s/SHA[0-9]* Fingerprint/\t&amp;/g&#x27;</span> -e <span class="string">&quot;s/Subject:/<span class="variable">$&#123;GREEN&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span> -e <span class="string">&quot;s/[[:xdigit:]]\&#123;2\&#125;\(:[[:xdigit:]]\&#123;2\&#125;\)\&#123;<span class="variable">$&#123;TP_REGEX_ITER&#125;</span>\&#125;/<span class="variable">$&#123;YELLOW&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span>)</span><br><span class="line">  </span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Certificate Info:&quot;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$&#123;MACHINE_SSL_FILE&#125;</span>&quot;</span> | openssl x509 -noout -checkend 0; <span class="keyword">then</span></span><br><span class="line">               <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_MACHINE_SSL_CERT_INFO&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">               <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_MACHINE_SSL_CERT_INFO&#125;</span>&quot;</span> | sed -e <span class="string">&quot;s/Not Before/<span class="variable">$&#123;RED&#125;</span>&amp;/&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>---------------------------------<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>Unable to locate the Machine SSL certificate file in the support bundle.<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">      SSO_DOMAIN=$(/usr/lib/vmware-vmafd/bin/vmafd-cli get-domain-name --server-name localhost)</span><br><span class="line">      SSO_SITE=$(/usr/lib/vmware-vmafd/bin/vmafd-cli get-site-name --server-name localhost)</span><br><span class="line">      VMDIR_DC_BRANCH=<span class="string">&quot;dc=<span class="subst">$(echo $&#123;SSO_DOMAIN&#125; | sed &#x27;s/\./,dc=/g&#x27;)</span>&quot;</span></span><br><span class="line">      VMDIR_MACHINE_PASSWORD=$(/opt/likewise/bin/lwregshell list_values <span class="string">&#x27;[HKEY_THIS_MACHINE\services\vmdir]&#x27;</span> | grep dcAccountPassword | awk -F<span class="string">&quot;  &quot;</span> <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span> | awk <span class="string">&#x27;&#123;print substr($0,2,length($0)-2)&#125;&#x27;</span> | sed -e <span class="string">&#x27;s/\\&quot;/&quot;/g&#x27;</span> -e <span class="string">&#x27;s/\\\\/\\/g&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;\n&#x27;</span> &gt; /tmp/.vmdir_machine_account_password; <span class="built_in">chmod</span> go-r /tmp/.vmdir_machine_account_password)</span><br><span class="line">      VMDIR_MACHINE_ACCOUNT_DN=$(/opt/likewise/bin/lwregshell list_values <span class="string">&#x27;[HKEY_THIS_MACHINE\services\vmdir]&#x27;</span> | grep <span class="string">&#x27;&quot;dcAccountDN&quot;&#x27;</span> | awk -F<span class="string">&quot;  &quot;</span> <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span> | awk <span class="string">&#x27;&#123;print substr($0,2,length($0)-2)&#125;&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">      SITE_NODES=$(<span class="variable">$&#123;LDAPSEARCH&#125;</span> -LLL -h localhost -p 389 -b <span class="string">&quot;cn=ServiceRegistrations,cn=LookupService,cn=<span class="variable">$&#123;SSO_SITE&#125;</span>,cn=Sites,cn=Configuration,<span class="variable">$&#123;VMDIR_DC_BRANCH&#125;</span>&quot;</span> -D <span class="string">&quot;<span class="variable">$&#123;VMDIR_MACHINE_ACCOUNT_DN&#125;</span>&quot;</span> -y /tmp/.vmdir_machine_account_password <span class="string">&quot;(objectclass=vmwLKUPEndpointRegistration)&quot;</span> vmwLKUPURI | grep <span class="string">&#x27;^vmwLKUPURI&#x27;</span> | sed -e <span class="string">&#x27;s/vmwLKUPURI://g&#x27;</span> | awk -F<span class="string">&#x27;/&#x27;</span> <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | awk -F<span class="string">&#x27;:&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -i | grep -v localhost)</span><br><span class="line">  </span><br><span class="line">      <span class="built_in">rm</span> /tmp/.vmdir_machine_account_password</span><br><span class="line">      <span class="built_in">printf</span> <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">  </span><br><span class="line">      <span class="keyword">for</span> node <span class="keyword">in</span> <span class="variable">$&#123;SITE_NODES&#125;</span>; <span class="keyword">do</span></span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>-----Machine SSL Certificate-----<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span><span class="variable">$&#123;node&#125;</span><span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">         CURRENT_MACHINE_SSL_CERT_INFO=$(<span class="built_in">echo</span> | openssl s_client -connect <span class="variable">$&#123;node&#125;</span>:443 2&gt;/dev/null | openssl x509 -text -noout -fingerprint -<span class="variable">$&#123;TP_ALGORITHM&#125;</span> | grep -E <span class="string">&#x27;Issuer:|Subject:|Validity|Not Before:|Not After :|Fingerprint&#x27;</span> | sed -e <span class="string">&#x27;s/SHA[0-9]* Fingerprint/\t&amp;/g&#x27;</span> -e <span class="string">&quot;s/Subject:/<span class="variable">$&#123;GREEN&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span> -e <span class="string">&quot;s/[[:xdigit:]]\&#123;2\&#125;\(:[[:xdigit:]]\&#123;2\&#125;\)\&#123;<span class="variable">$&#123;TP_REGEX_ITER&#125;</span>\&#125;/<span class="variable">$&#123;YELLOW&#125;</span>&amp;<span class="variable">$&#123;NORMAL&#125;</span>/g&quot;</span>)</span><br><span class="line">  </span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;Certificate Info:&quot;</span></span><br><span class="line">         <span class="keyword">if</span> <span class="built_in">echo</span> | openssl s_client -connect <span class="variable">$&#123;node&#125;</span>:443 2&gt;/dev/null | openssl x509 -noout -checkend 0; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_MACHINE_SSL_CERT_INFO&#125;</span>&quot;</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CURRENT_MACHINE_SSL_CERT_INFO&#125;</span>&quot;</span> | sed -e <span class="string">&quot;s/Not Before/<span class="variable">$&#123;RED&#125;</span>&amp;/&quot;</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>---------------------------------<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">      <span class="keyword">done</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;FIX&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">   <span class="keyword">if</span> [[ <span class="variable">$&#123;LIVE_CHECK&#125;</span> -gt 0 ]]; <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">if</span> [ ! -f <span class="variable">$&#123;LSUPDATE_SCRIPT&#125;</span> ]; <span class="keyword">then</span></span><br><span class="line">         <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>The <span class="variable">$&#123;LSUPDATE_SCRIPT&#125;</span> script could not be found. Please ensure you are running this from a PSC.<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">      <span class="keyword">else</span>   </span><br><span class="line">         <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>SSL Trust Anchor Repair<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;CYAN&#125;</span>---------------------------------<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">         <span class="built_in">echo</span> <span class="string">&quot;This process will attempt to update the SSL trust anchors for Lookup Service registrations using native Lookup Service libraries. These changes should propagate to all PSCs in the SSO domain.&quot;</span></span><br><span class="line">         <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>It is strongly recommended that you take offline snapshots of all PSCs in the SSO domain before proceeding.<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">         <span class="built_in">read</span> -p $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Proceed with updating trust anchors? [Y/N]: &quot;</span> PROCEED</span><br><span class="line">         <span class="keyword">if</span> [ -z <span class="variable">$&#123;PROCEED&#125;</span> ]; <span class="keyword">then</span> PROCEED_FIX=<span class="string">&quot;n&quot;</span>; <span class="keyword">else</span> PROCEED_FIX=$(<span class="built_in">echo</span> <span class="variable">$&#123;PROCEED&#125;</span> | awk <span class="string">&#x27;&#123;print tolower(substr($0,0,1))&#125;&#x27;</span>); <span class="keyword">fi</span></span><br><span class="line">         <span class="keyword">if</span> [ <span class="variable">$&#123;PROCEED_FIX&#125;</span> == <span class="string">&quot;y&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">            SSO_DOMAIN=$(/usr/lib/vmware-vmafd/bin/vmafd-cli get-domain-name --server-name localhost)</span><br><span class="line">            <span class="built_in">read</span> -p $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Enter SSO admin [administrator@<span class="variable">$&#123;SSO_DOMAIN&#125;</span>]: &quot;</span> LOGIN</span><br><span class="line">            <span class="keyword">if</span> [ -z <span class="variable">$&#123;LOGIN&#125;</span> ]; <span class="keyword">then</span> LOGIN=<span class="string">&quot;administrator@<span class="variable">$&#123;SSO_DOMAIN&#125;</span>&quot;</span>; <span class="keyword">fi</span></span><br><span class="line">            <span class="built_in">read</span> -s -p <span class="string">&quot;Enter password for <span class="variable">$&#123;LOGIN&#125;</span>: &quot;</span> PASSWORD_INPUT</span><br><span class="line">            PASSWORD=$(<span class="built_in">echo</span> <span class="variable">$&#123;PASSWORD_INPUT&#125;</span> | sed <span class="string">&quot;s/&#x27;/&#x27;\\\&#x27;&#x27;/g&quot;</span>)</span><br><span class="line">            <span class="built_in">read</span> -p $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Enter fingerprint of trust anchor(s) to update: &quot;</span> FINGERPRINT</span><br><span class="line">            <span class="built_in">read</span> -p <span class="string">&quot;Enter the FQDN of the node to update: &quot;</span> NODE_FQDN</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">echo</span> <span class="string">&#x27;y&#x27;</span> | openssl s_client -connect <span class="variable">$&#123;NODE_FQDN&#125;</span>:443 2&gt;/dev/null | openssl x509 &gt; /tmp/machine-ssl.crt; <span class="keyword">then</span></span><br><span class="line">               <span class="keyword">if</span> ! <span class="variable">$&#123;LSUPDATE_SCRIPT&#125;</span> --url http://localhost:<span class="variable">$&#123;LS_PORT&#125;</span>/lookupservice/sdk 2&gt;/tmp/ls_update_certs.stderr --fingerprint <span class="variable">$&#123;FINGERPRINT&#125;</span> --certfile /tmp/machine-ssl.crt --user <span class="variable">$&#123;LOGIN&#125;</span>  --password $(<span class="built_in">eval</span> <span class="built_in">echo</span> <span class="string">&quot;&#x27;<span class="variable">$&#123;PASSWORD&#125;</span>&#x27;&quot;</span>); <span class="keyword">then</span></span><br><span class="line">                  <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>The ls_update_certs.py script encountered an error.&quot;</span></span><br><span class="line">                  <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Please refer to /tmp/ls_update_certs.stderr for more information.<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">               <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">               <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>Unable to obtain SSL certificate from <span class="variable">$&#123;NODE_FQDN&#125;</span>. Exiting...&quot;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;Operation aborted. Exiting...&quot;</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> $<span class="string">&#x27;\n&#x27;</span><span class="string">&quot;<span class="variable">$&#123;YELLOW&#125;</span>Fixing trust anchors can only be done on a live system.<span class="variable">$&#123;NORMAL&#125;</span>&quot;</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>


<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>证书修复 ： <a target="_blank" rel="noopener" href="https://www.cnblogs.com/maym/p/17789156.html">https://www.cnblogs.com/maym/p/17789156.html</a><br>信任锚(Trust Anchors) : <a target="_blank" rel="noopener" href="https://www.ibm.com/docs/en/transparent-supply?topic=roles-trust-anchors">https://www.ibm.com/docs/en/transparent-supply?topic=roles-trust-anchors</a><br>信任锚 ： <a target="_blank" rel="noopener" href="http://i-wall.cn/h-nd-104.html">http://i-wall.cn/h-nd-104.html</a><br>日志查看 ：<a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/74731?lang=zh_CN">https://kb.vmware.com/s/article/74731?lang=zh_CN</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/7b993e05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/7b993e05/" class="post-title-link" itemprop="url">VMware Horizon View-常见问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-07 12:47:06" itemprop="dateCreated datePublished" datetime="2024-03-07T12:47:06+00:00">2024-03-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/Horizon-View/" itemprop="url" rel="index"><span itemprop="name">Horizon View</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Server类故障"><a href="#Server类故障" class="headerlink" title="Server类故障"></a>Server类故障</h1><h2 id="目标VDI提示被禁用，无法通过客户端重置桌面"><a href="#目标VDI提示被禁用，无法通过客户端重置桌面" class="headerlink" title="目标VDI提示被禁用，无法通过客户端重置桌面"></a>目标VDI提示被禁用，无法通过客户端重置桌面</h2><h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><ol>
<li>Connection Server 托管的vCenter服务异常；</li>
<li>目标VDI对应的虚拟机不存在；</li>
</ol>
<h1 id="Agent类故障"><a href="#Agent类故障" class="headerlink" title="Agent类故障"></a>Agent类故障</h1><h2 id="目标VDI在Connection-Server中提示“无法访问代理”"><a href="#目标VDI在Connection-Server中提示“无法访问代理”" class="headerlink" title="目标VDI在Connection Server中提示“无法访问代理”"></a>目标VDI在Connection Server中提示“无法访问代理”</h2><h3 id="原因分析-1"><a href="#原因分析-1" class="headerlink" title="原因分析"></a>原因分析</h3><ol>
<li>VDI内的网络异常，到Connection Server的必要端口没有放行；</li>
<li>VDI内的Agent进程异常，客户端内的VMware Horizon View Agent没有正常运行，其中的关联服务没有启动；</li>
<li>VDI内没有办法正常解析Connection Server的域名，导致无法与对端建立连接；【DNS解析异常】</li>
<li>Connection Server与VDI的通讯密钥需要更新；</li>
</ol>
<p>原因1，必要端口：</p>
<table>
<thead>
<tr>
<th align="center">SRC</th>
<th align="center">DST</th>
<th align="center">TCP-Port</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Agent</td>
<td align="center">CS</td>
<td align="center">4001</td>
<td align="left">Java Message Service communication , JMS</td>
</tr>
<tr>
<td align="center">Agent</td>
<td align="center">CS</td>
<td align="center">4002</td>
<td align="left">Java Message Service communication , Java Message Service (JMS) when using enhanced security (default).</td>
</tr>
<tr>
<td align="center">Agent</td>
<td align="center">CS</td>
<td align="center">389</td>
<td align="left">Only required when doing an unmanaged agent registration, for example, RDSH agent install without linked-clone or instant-clone component.</td>
</tr>
</tbody></table>
<p>参考： <a target="_blank" rel="noopener" href="https://ports.esp.vmware.com/home/Horizon">https://ports.esp.vmware.com/home/Horizon</a></p>
<p>可以在操作系统中执行相关指令确认：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Windows , run powershell as administrator</span></span><br><span class="line">netstat -ano | findstr [Target TCP port]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux , run command as sudo permission</span></span><br><span class="line">netstat -ano | gre [Target TCP port]</span><br></pre></td></tr></table></figure>

<p>原因2，关联服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Windows , run powerhsell as administrator</span></span><br><span class="line">netstat -ano | findstr vmware</span><br><span class="line"></span><br><span class="line"><span class="comment"># [TODO] Should have :</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux , run command as sudo permission</span></span><br><span class="line">ps -aux | grep vmware</span><br><span class="line"></span><br><span class="line"><span class="comment"># Should have : </span></span><br><span class="line"><span class="comment"># viewagent/jre/bin/java </span></span><br><span class="line"><span class="comment"># viewagent/bin/GetMachineId.sh </span></span><br><span class="line"><span class="comment"># viewagent/DekstopDaemon/desktopDaemon</span></span><br><span class="line"><span class="comment"># viewagent/VMwareBlastServer/BlastServer</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/ae9c0f2f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/ae9c0f2f/" class="post-title-link" itemprop="url">wireguard配置实例</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-07 01:15:45" itemprop="dateCreated datePublished" datetime="2024-03-07T01:15:45+00:00">2024-03-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/default/" itemprop="url" rel="index"><span itemprop="name">default</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://devld.me/2020/07/27/wireguard-setup/">https://devld.me/2020/07/27/wireguard-setup/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/d2146460/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/d2146460/" class="post-title-link" itemprop="url">服务器安装Windows Server异常提示无法安装到这个磁盘</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-05 00:28:51" itemprop="dateCreated datePublished" datetime="2024-02-05T00:28:51+00:00">2024-02-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">服务器与存储</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">服务器</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><p>安装操作系统提示:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Windows 无法安装到这个磁盘。这台计算机的硬件可能不支持启动到此次盘。请确保在计算机的 BIOS 菜单中启用了磁盘的控制器。</span><br><span class="line"></span><br><span class="line">Windows cannot be installed to this disk. This computer&amp;＃39;s hardware may not support booting to this disk. Ensure that the disk&amp;＃39;s controller is enabled in the computer&amp;＃39;s BIOS menu.</span><br></pre></td></tr></table></figure>

<h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p>阵列组并未作为启动卷。</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>到阵列卡中设置卷为启动卷。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://zhiliao.h3c.com/Theme/details/20319">https://zhiliao.h3c.com/Theme/details/20319</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/">43</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Rohman.Zhu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
