<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="诺曼实验室">
<meta property="og:url" content="http://github.com/rohman-zhu/page/8/index.html">
<meta property="og:site_name" content="诺曼实验室">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Rohman.Zhu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://github.com/rohman-zhu/page/8/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh_cn","comments":"","permalink":"","path":"page/8/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>诺曼实验室</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">诺曼实验室</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Rohman.Zhu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">443</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">146</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/991119f8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/991119f8/" class="post-title-link" itemprop="url">Horizon CORS 配置-kb85801</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-11-05 17:03:11" itemprop="dateCreated datePublished" datetime="2023-11-05T17:03:11+00:00">2023-11-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:47" itemprop="dateModified" datetime="2024-12-22T05:27:47+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/KB/" itemprop="url" rel="index"><span itemprop="name">KB</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h1><ul>
<li>Horizon 从 6.2.1 开始，checkOrigin 属性默认为enabled；</li>
<li>从 8.3 ， 2106 开始，enableCORS默认为enabled；</li>
<li>从 2111.1 开始，allowUnexpectedHost 默认为enabled；</li>
<li>从 2111.2 开始，allowUnexpectedHost 默认为disabled；</li>
</ul>
<h1 id="原文"><a href="#原文" class="headerlink" title="原文"></a>原文</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Horizon  2111.2, 2209.1, 2212.1 and 2306:</span><br><span class="line">Cross-Origin Resource Sharing (CORS) is enabled by default. See Cross-Origin Resource Sharing.</span><br><span class="line">Security configuration setting balancedHost can now accept a list for those with more than one load balancer. The syntax is exactly the same as portalHost. (Release Notes ) </span><br><span class="line">​​​​​​Security configuration setting allowUnexpectedHost has changed from true to false. </span><br><span class="line">This means that connections using the name or IP address of a proxy, gateway or load balancer that is not defined in locked.properties will fail, even if checkOrigin and enableCORS are both set to false.</span><br><span class="line">Please see Error 421 while connecting to Horizon via HTML Web Console after an upgrade to 2306,2111.1 or Later (93915) for additional details.</span><br><span class="line">For a step-by-step walkthrough of configuring Locked.properties, please see Horizon Server: Troubleshooting Configuration Issues with Locked.properties(94578)</span><br><span class="line">This Article&#x27;s purpose is to outline some common questions seen as a result of these changes.</span><br><span class="line"></span><br><span class="line">Potential Symptoms seen as a result of the change:</span><br><span class="line"> HTML access is stuck in the &quot;Waiting&quot; screen due to the lack of configuration in &quot;locked.properties&quot; </span><br><span class="line">An alert appears on an HTML5 access attempt &quot;Failed to connect to the Horizon Connection Server&quot;</span><br><span class="line">Solution</span><br><span class="line">Common Questions: </span><br><span class="line"></span><br><span class="line">1.What is the purpose of this change?</span><br><span class="line"></span><br><span class="line">Any URL the user clicks on needs to be known to the connection server the request reaches.</span><br><span class="line">If they click on badguy.com, and that redirects them to Horizon, we need to reject the request. That’s the purpose of this. This is a W3 standard we comply with, see the documentation on this. CORS allows additional granularity through policy.</span><br><span class="line"></span><br><span class="line">2. Is this not just Origin Checking?</span><br><span class="line">Origin Checking has been a default in Horizon since Horizon 7.6 and this impacted admin page access in the past, please see KB2144768. </span><br><span class="line">Default origins include the connection servers&#x27; localhost and external URL (the external URL defaults to the server FQDN but is typically changed to an FDQN of a VIP used for external access). These are not impacted by the change.</span><br><span class="line">Origin checking is enabled by default. When it is enabled, a request is accepted only without an Origin, or with an Origin equal to the address that the External URL specifies, to the balancedHost address, to any portalHost address, to any chromeExtension hash, to null, or to localhost. If Origin is not one of these possibilities, an &quot;Unexpected Origin&quot; error is logged and a status of 404 is returned. Reference Link </span><br><span class="line"></span><br><span class="line">3. I&#x27;m aware of origin checking, what do I need to consider?</span><br><span class="line"></span><br><span class="line">This enhancement can impact an environment in terms of HTML5 access when load balancers are in the equation.</span><br><span class="line"></span><br><span class="line">Origin Header:  The origin header is the value that will pass through for validation by the connection server and can be defined as the URL that the user clicks on.</span><br><span class="line"></span><br><span class="line">Example: </span><br><span class="line">User opens htttps:/loadbalancer/ and logs into Horizon, hitting enter to authenticate.</span><br><span class="line">This request will be rejected if this load balancer URL does not match the aforementioned defaults.</span><br><span class="line"></span><br><span class="line">4. I&#x27;m experiencing issues with html5 page access after an update to 2106 and worked fine with previous release , what are my options?</span><br><span class="line"></span><br><span class="line">Essentially a configuration or design change is potentially needed based on your individual circumstances.</span><br><span class="line">UAG has a feature to rewrite the origin header coming from the client to match the URL it is using to forward requests to the connection server. (documentation  - Re-Write Origin Header).  This feature is off by default but can help to reduce the list of entries or even obviate the need for locked.properties entirely.</span><br><span class="line">If the URL that your users connect with will need to be added to the known origins list for each connection server behind the load balancer which is contained within locked.properties</span><br><span class="line"> </span><br><span class="line">4. How do I edit locked.properties?</span><br><span class="line"></span><br><span class="line">   1. Create or edit the locked.properties file. This is located on each connection server in     c:\program files\vmware\VMware View\Server\sslgateway\conf.</span><br><span class="line">   2. This file can be edited with a standard text editor, like Notepad.</span><br><span class="line">   3. Please validate the extension of the file to ensure it is saved as .properties. If saved as a .txt extension, the edited values will not be read.</span><br><span class="line">   4. Restart each server to ensure the values take effect.</span><br><span class="line"></span><br><span class="line">5. What values  do I need to change in locked.properties?</span><br><span class="line">  </span><br><span class="line"> There are two keywords for extending the known origins list, balancedHost and portalHost.</span><br><span class="line">Note 1: You don’t set a URL on these, just the hostname.</span><br><span class="line">Note 2: Both are designed to extend the list of known origins.</span><br><span class="line"></span><br><span class="line">For a hypothetical load balancer, we need to add this entry to all connection servers behind it:</span><br><span class="line">balancedHost = loadbalandedviewurl.company.com</span><br><span class="line">There can only be one entry for balancedHost and only https is allowed.</span><br><span class="line">The purpose of balanced host is primarily for the load balancer between connection servers and internal clients.</span><br><span class="line">There is no limit on the amount of portal host entries</span><br><span class="line"></span><br><span class="line">The purpose of portalHost is primarily for alternative routes and names.</span><br><span class="line"></span><br><span class="line">For example, let’s say that there are more routes into the environment, through originalname.com  and newname.net and internally through originalname.int or hostname.</span><br><span class="line"></span><br><span class="line">You’ll need to add portalHost entries for these:</span><br><span class="line"></span><br><span class="line">portalHost.1 = originalname.com</span><br><span class="line">portalHost.2 = newname.net</span><br><span class="line">portalHost.3 = originalname.int</span><br><span class="line">portalHost.4 = originalname</span><br><span class="line">portalHost.5 = hostname</span><br><span class="line"></span><br><span class="line">If all of these are load balancers too, You can reduce complexity and stop using balancedHost and list all routes with portalHost entries.</span><br><span class="line"></span><br><span class="line">5.  Are these failures tracked in logs?</span><br><span class="line">Yes, If a request comes in with an origin header that is not in the list of known origins, you will get the error in the debug log of the connection server with a line: &quot;Unexpected origin”.</span><br><span class="line"></span><br><span class="line">Log file Location: C:\ProgramData\VMware\VDM\logs</span><br><span class="line">Log file name: debug-datetime.txt</span><br><span class="line"></span><br><span class="line">It you note the time of the failed attempt or check the debug log that most closely matches the time of the reported test.</span><br><span class="line"></span><br><span class="line">Sample Log Line :</span><br><span class="line">2021-09-24T22:05:34.737-07:00 ERROR (1B08-1A58) &lt;SimpleDeamonThread&gt; [h] (ajp:admin:Request190) Unexpected Origin: https://newname.net</span><br><span class="line">2021-09-24T22:05:34.738-07:00 DEBUG (1B08-1A58) &lt;SimpleDeamonThread&gt; [v] (ajp:admin:Request190) Response 404 Not Found [close]</span><br><span class="line"></span><br><span class="line">It then tells you what the origin header looks like, and if this should be accepted you can add yet another portalHost entry, for instance, with the above example - newname.net needs to be added as a portalhost entry.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><p><a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/85801">https://kb.vmware.com/s/article/85801</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/345f1997/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/345f1997/" class="post-title-link" itemprop="url">VMware Horizon 提示没有可用的显示协议</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-11-05 16:38:08" itemprop="dateCreated datePublished" datetime="2023-11-05T16:38:08+00:00">2023-11-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%85%E9%9A%9C/" itemprop="url" rel="index"><span itemprop="name">故障</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障描述"><a href="#故障描述" class="headerlink" title="故障描述"></a>故障描述</h1><p>关键节点：UAG、连接服务器、RDSH服务器；</p>
<p>显示协议：Blast；</p>
<p>客户端节点提示，无可用显示协议或者 Internal Server Error；<br>UAG与RDSH服务器网络链路正常，TCP-22443端口是联通的；</p>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>RDSH服务器上面的22443端口不是VMware View Agent进程监听的，而是其他应用程序在监听，导致客户端无法使用 Blast 协议安装；</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>检测端口监听的进程：</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -a:--all，显示所有链接和监听端口</span></span><br><span class="line"><span class="comment"># -b:显示包含于创建每个连接或监听端口的可执行组件。在某些情况下已知可执行组件拥有多个独立组件，并且在这些情况下包含于创建连接或监听端口的组件序列被显示。这种情况下，可执行组件名在底部的 [] 中，顶部是其调用的组件，等等，直到 TCP/IP 部分。注意此选项可能需要很长时间，如果没有足够权限可能失败。</span></span><br><span class="line">netstat <span class="literal">-ab</span> | findstr <span class="number">22443</span>;</span><br></pre></td></tr></table></figure>

<p>检测 WINRM 监听端口并修改：</p>
<p>观察到 WINRM 的端口被改为 22443 ，导致BLAST协议的进程无法使用此端口；</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查端口</span></span><br><span class="line">winrm enumerate winrm/config/listener</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改端口</span></span><br><span class="line"><span class="built_in">set-item</span> wsman:\localhost\listener\listener*\port <span class="literal">-value</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/ed83ffb5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/ed83ffb5/" class="post-title-link" itemprop="url">故障记录-ESXi-Umap紫屏</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-10-15 20:14:57" itemprop="dateCreated datePublished" datetime="2023-10-15T20:14:57+00:00">2023-10-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/vSphere/" itemprop="url" rel="index"><span itemprop="name">vSphere</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障描述"><a href="#故障描述" class="headerlink" title="故障描述"></a>故障描述</h1><p>多个ESXi 在未知的情况下，发生资屏，上面的虚拟机发生HA重启；<br>紫屏记录为 “PF Exception 14 in world xxxx ： Unmap Helper IP 0xXXXXXX addr 0x0”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PCPU 0:xxxx</span><br><span class="line">PCPU 64:xxxxx</span><br><span class="line">PCPU 128 :xxxx</span><br><span class="line">Code start : xxx应该是ESXi运行时间</span><br><span class="line">0xXXXXXXX:Res5MemUnlockTxnRCL ist@esx#nover</span><br><span class="line">0xXXXXXXX:J3_DeleteTransacton@esx#nover</span><br><span class="line">0xXXXXXXX:J3_AbortTransaction@esx#nover</span><br><span class="line">0xXXXXXXX:UnmapLockCommon@esx#nover</span><br><span class="line">0xXXXXXXX:UnmapAsyncClusterProcessing@esx#nover</span><br><span class="line">0xXXXXXXX:HelperQueueFunc@vmkernel#nover</span><br><span class="line">0xXXXXXXX:CpuSched_StartWorld@vmernel</span><br></pre></td></tr></table></figure>

<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>底层有一个存储卷有异常，原本工目标Datastore开启了精简置备、去重压缩功能，Datastore上面的虚拟机任何数据变化，则会触发底层Datastore空间回收；<br>现在因为这个卷异常，上面的虚拟机的数据变化，则会触发空间回收，因为空间回收异常，导致ESXi直接紫屏；</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><ol>
<li>关闭ESXi 的空间回收功能；【并不能解决问题,底层空间回收依旧会触发紫屏】</li>
<li>将目标卷上面的虚拟机迁移走。【注意，这个卷上面的操作，都有可能导致ESXi紫屏】</li>
<li>将目标卷卸载并删除；</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/682a790d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/682a790d/" class="post-title-link" itemprop="url">CHROME-TLS-SHA1更新发布导致无法访问UAG</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-10-08 00:16:04" itemprop="dateCreated datePublished" datetime="2023-10-08T00:16:04+00:00">2023-10-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-03-18 08:48:44" itemprop="dateModified" datetime="2025-03-18T08:48:44+00:00">2025-03-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/Horizon-View/" itemprop="url" rel="index"><span itemprop="name">Horizon View</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障描述"><a href="#故障描述" class="headerlink" title="故障描述"></a>故障描述</h1><p>Chrome浏览器在117版本中，访问UAG地址（<a target="_blank" rel="noopener" href="https://xxxxxx.com)/">https://xxxxxx.com）</a> 浏览器提示”ERR_SSL_PROTOCOL_ERROR”;但使用其他浏览器，如Safari、Edge、Firefox就可以正常访问；</p>
<p>Chrome版本信息：117.0.5938.150</p>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>服务器端的TLS使用了SHA1加密，导致浏览器判定为异常；</p>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><h2 id="短期方案"><a href="#短期方案" class="headerlink" title="短期方案"></a>短期方案</h2><p>调整Chrome的配置</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在浏览器地址栏中输入</span></span><br><span class="line">chrome://flags/#use-sha1-server-handshakes</span><br><span class="line"><span class="comment"># 将 Allow SHA-1 server signatures in TLS 调整为 Allow</span></span><br></pre></td></tr></table></figure>

<h2 id="长期方案【待补充】"><a href="#长期方案【待补充】" class="headerlink" title="长期方案【待补充】"></a>长期方案【待补充】</h2><p>需要升级openssl</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 版本查看</span></span><br><span class="line">openssl version</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 2023-10-07</span><br><span class="line">测试过 2306 ，2306-FIPS版本，结果只有普通版的2306版本是正常的，而FIPS版本则无法使用；</span><br><span class="line">可能是FIPS版本，过程有需要SHA-1加密的TLS，导致被Chrome给拦截了，目前还在等待官方信息；</span><br><span class="line"></span><br><span class="line"># 2025-03-18</span><br><span class="line"># euc-unified-access-gateway-23.06.1.0-22332533_OVF10.ova 版本可用，不会出现SSL拦截，使用一年下来，也不会出现根目录用满情况。</span><br></pre></td></tr></table></figure>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>诡异的ERR_SSL_PROTOCOL_ERROR：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/659738295">https://zhuanlan.zhihu.com/p/659738295</a><br>Chromium描述：<a target="_blank" rel="noopener" href="https://bugs.chromium.org/p/chromium/issues/detail?id=1488571">https://bugs.chromium.org/p/chromium/issues/detail?id=1488571</a><br>发布信息：<a target="_blank" rel="noopener" href="https://chromium-review.googlesource.com/c/chromium/src/+/4898836">https://chromium-review.googlesource.com/c/chromium/src/+/4898836</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/9e510a03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/9e510a03/" class="post-title-link" itemprop="url">VSAN-健康检查出现分区故障</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-10-06 22:20:15" itemprop="dateCreated datePublished" datetime="2023-10-06T22:20:15+00:00">2023-10-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/vSphere/" itemprop="url" rel="index"><span itemprop="name">vSphere</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/vSphere/vSAN/" itemprop="url" rel="index"><span itemprop="name">vSAN</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障描述"><a href="#故障描述" class="headerlink" title="故障描述"></a>故障描述</h1><p>vSAN集群的健康检查中，出现分区错误，有一台主机的vSAN分区为2号，其他主机的vSAN分区为1号。</p>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><ol>
<li>网络异常：vSAN节点之间网络不通；</li>
<li>版本问题：vSAN节点之间版本不一致；</li>
<li>目标主机未开启集群发现；</li>
</ol>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>先确认 vSAN Kernel 网络流量是否正常；</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取 vSAN 网卡信息</span></span><br><span class="line">esxcli vsan network list</span><br><span class="line"><span class="comment"># 获取 IP 配置信息</span></span><br><span class="line">esxcli network ip interface ipv4 get</span><br><span class="line"><span class="comment"># 结合上述信息，确定vSAN用的 vmk 、IP信息；</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发起ping测试</span></span><br><span class="line">ping [目标IP]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定对应网卡发起ping测试</span></span><br><span class="line">vmkping -I [vSAN用的网卡] [目标IP]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>确定网络是否正常，另外MTU也是需要关注的；</p>
</blockquote>
<p>确定磁盘版本是否一致；</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">esxcli system settings advanced list -o /Virsto/DiskFormatVersion</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果磁盘版本不一致，则需要检查ESXi版本是否一致，是否有升级；</p>
</blockquote>
<p>检查分区更新值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确认成员更新值</span></span><br><span class="line">esxcfg-advcfg -g  /VSAN/IgnoreClusterMemberListupdates</span><br><span class="line"><span class="comment"># 如果值为1，则表示目标主机当前状态为“禁止从 vCenter Server 中更新集群成员”</span></span><br><span class="line"><span class="comment"># 需要重新执行指令：</span></span><br><span class="line">esxcfg-advcfg -s 0 /VSAN/IgnoreClusterMemberListupdates</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>解决VMware vSAN分区故障：<a target="_blank" rel="noopener" href="https://m.fx361.com/news/2018/1106/18285695.html">https://m.fx361.com/news/2018/1106/18285695.html</a><br>如何使用旧格式版本格式化 VSAN 磁盘组 ：<a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/2146221?lang=zh_CN">https://kb.vmware.com/s/article/2146221?lang=zh_CN</a><br>vSAN 运行状况服务 - 网络运行状况 - vSAN 群集分区：<a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/2108011?lang=zh_CN">https://kb.vmware.com/s/article/2108011?lang=zh_CN</a><br>如何处理 VSAN 群集中的隔离&#x2F;分区情形？：<a target="_blank" rel="noopener" href="https://blog.51cto.com/vsdsrevolution/1375800">https://blog.51cto.com/vsdsrevolution/1375800</a><br>Configuring vSAN Unicast networking from the command line (2150303)： <a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/2150303">https://kb.vmware.com/s/article/2150303</a><br>手动关闭并重新启动 vSAN 集群：<a target="_blank" rel="noopener" href="https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.vsan-monitoring.doc/GUID-31B4F958-30A9-4BEC-819E-32A18A685688.html">https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.vsan-monitoring.doc/GUID-31B4F958-30A9-4BEC-819E-32A18A685688.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/5c673c3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/5c673c3/" class="post-title-link" itemprop="url">CentOS7无法启动故障</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-08-27 23:08:01" itemprop="dateCreated datePublished" datetime="2023-08-27T23:08:01+00:00">2023-08-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:47" itemprop="dateModified" datetime="2024-12-22T05:27:47+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%85%E9%9A%9C/" itemprop="url" rel="index"><span itemprop="name">故障</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障描述"><a href="#故障描述" class="headerlink" title="故障描述"></a>故障描述</h1><p>服务器在开机时会出现Log</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[FAILED] Failed to start Security Auditing Service.</span><br><span class="line">[FAILED] Failed to start Journal Service.</span><br></pre></td></tr></table></figure>

<p>使用正确的密码却无法登录服务器，一直提示Login incorrect.</p>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>服务器开启了 selinux</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/selinux/config</span><br><span class="line"></span><br><span class="line">将selinux改为disabled</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/aae56061/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/aae56061/" class="post-title-link" itemprop="url">VCSA-503故障-证书到期</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-07-30 17:39:17" itemprop="dateCreated datePublished" datetime="2023-07-30T17:39:17+00:00">2023-07-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/vSphere/" itemprop="url" rel="index"><span itemprop="name">vSphere</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><ol>
<li>登录vCenter的WEB界面，提示503报错；</li>
<li>登录vCenter的管理界面(<a href="https://VC-IP:5480)，提示服务异常；">https://VC-IP:5480)，提示服务异常；</a></li>
</ol>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><ol>
<li>证书过期后未及时更新，导致服务异常；</li>
</ol>
<h2 id="检查方式1"><a href="#检查方式1" class="headerlink" title="检查方式1"></a>检查方式1</h2><p>登录vCenter的web界面，点击证书详情，可以看到证书到期时间；</p>
<h2 id="检查方式2"><a href="#检查方式2" class="headerlink" title="检查方式2"></a>检查方式2</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查指令</span></span><br><span class="line"><span class="keyword">for</span> store <span class="keyword">in</span> $(/usr/lib/vmware-vmafd/bin/vecs-cli store list | grep -v TRUSTED_ROOT_CRLS); <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">&quot;[*] Store :&quot;</span> <span class="variable">$store</span>; /usr/lib/vmware-vmafd/bin/vecs-cli entry list --store <span class="variable">$store</span> --text | grep -ie <span class="string">&quot;Alias&quot;</span> -ie <span class="string">&quot;Not After&quot;</span>;<span class="keyword">done</span>;</span><br></pre></td></tr></table></figure>

<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>注意，以下操作执行前，请给VCSA虚拟机执行快照！！</p>
<p>另外需关闭HA功能</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vcha-destroy -f</span><br></pre></td></tr></table></figure>

<p>启动必要服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#检查服务启动情况：</span></span><br><span class="line">service-control --status</span><br><span class="line"><span class="comment">#手动启动服务：</span></span><br><span class="line">service-control --start applmgmtd</span><br><span class="line">service-control --start vmafdd</span><br></pre></td></tr></table></figure>

<h2 id="STS证书过期"><a href="#STS证书过期" class="headerlink" title="STS证书过期"></a>STS证书过期</h2><p>Center Single Sign-On Security Token Service (STS) 签名证书是内部 VMware 证书；</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建目录</span></span><br><span class="line"><span class="built_in">mkdir</span> newsts</span><br><span class="line"><span class="built_in">cd</span> newsts</span><br><span class="line"><span class="built_in">pwd</span> </span><br><span class="line"><span class="comment">#resulting output: /root/newst</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 certool.cfg 文件复制到新目录中</span></span><br><span class="line"><span class="built_in">cp</span> /usr/lib/vmware-vmca/share/config/certool.cfg /root/newsts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开 certool.cfg 文件的副本并进行编辑，以便使用本地 Platform Services Controller 的 IP 地址和主机名。</span></span><br><span class="line">vim certool.cfg</span><br><span class="line"><span class="comment"># Template file for a CSR request</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Country is needed and has to be 2 characters</span></span><br><span class="line">Country = US</span><br><span class="line">Name = STS</span><br><span class="line">Organization = ExampleInc</span><br><span class="line">OrgUnit = ExampleInc Dev</span><br><span class="line">State = Indiana</span><br><span class="line">Locality = Indianapolis</span><br><span class="line">IPAddress = 10.0.1.32</span><br><span class="line">Email = chen@exampleinc.com</span><br><span class="line">Hostname = homecenter.exampleinc.local</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成密钥</span></span><br><span class="line">/usr/lib/vmware-vmca/bin/certool --server localhost --genkey --privkey=/root/newsts/sts.key --pubkey=/root/newsts/sts.pub</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成证书</span></span><br><span class="line">/usr/lib/vmware-vmca/bin/certool --gencert --cert=/root/newsts/newsts.cer --privkey=/root/newsts/sts.key --config=/root/newsts/certool.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将证书转成pk12格式</span></span><br><span class="line">openssl pkcs12 -<span class="built_in">export</span> -<span class="keyword">in</span> /root/newsts/newsts.cer -inkey /root/newsts/sts.key -certfile /var/lib/vmware/vmca/root.cer -name <span class="string">&quot;newstssigning&quot;</span> -passout pass:testpassword -out newsts.p12</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将证书添加到JAVA密钥库</span></span><br><span class="line">/usr/java/jre-vmware/bin/keytool -v -importkeystore -srckeystore newsts.p12 -srcstoretype pkcs12 -srcstorepass testpassword -srcalias newstssigning -destkeystore root-trust.jks -deststoretype JKS -deststorepass testpassword -destkeypass testpassword</span><br><span class="line"></span><br><span class="line">/usr/java/jre-vmware/bin/keytool -v -importcert -keystore root-trust.jks -deststoretype JKS -storepass testpassword -keypass testpassword -file /var/lib/vmware/vmca/root.cer -<span class="built_in">alias</span> root-ca</span><br><span class="line"><span class="comment"># 出现提示时，键入 Yes 接受证书以将其添加到密钥库。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="根证书替换"><a href="#根证书替换" class="headerlink" title="根证书替换"></a>根证书替换</h2><p>需要先获取：</p>
<ol>
<li><a href="mailto:&#97;&#x64;&#109;&#x69;&#x6e;&#x69;&#x73;&#116;&#114;&#97;&#x74;&#111;&#x72;&#64;&#118;&#x73;&#112;&#104;&#x65;&#x72;&#x65;&#x2e;&#108;&#111;&#99;&#97;&#x6c;">&#97;&#x64;&#109;&#x69;&#x6e;&#x69;&#x73;&#116;&#114;&#97;&#x74;&#111;&#x72;&#64;&#118;&#x73;&#112;&#104;&#x65;&#x72;&#x65;&#x2e;&#108;&#111;&#99;&#97;&#x6c;</a>密码</li>
<li>VCSA的FQDN；</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成脚本路径：</span></span><br><span class="line"><span class="comment"># LINUX版本的VCSA：/usr/lib/vmware-vmca/bin/certificate-manager</span></span><br><span class="line"><span class="comment"># WINDOWS版本的VCSA：C:\Program Files\VMware\vCenter Server\vmcad\certificate-manager.bat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择4,Regenerate a new VMCA Root Certificate and replace all certificates。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据提示，输入指定信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">service-control --stop --all</span><br><span class="line">service-control --start vmafdd</span><br><span class="line">service-control --start vmdird</span><br><span class="line">service-control --start vmcad</span><br><span class="line">service-control --start --all</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="更换方式2，全部证书重置"><a href="#更换方式2，全部证书重置" class="headerlink" title="更换方式2，全部证书重置"></a>更换方式2，全部证书重置</h2><blockquote>
<p>2024-08-16</p>
</blockquote>
<p>需要先获取：</p>
<ol>
<li><a href="mailto:&#97;&#x64;&#x6d;&#105;&#x6e;&#105;&#115;&#116;&#114;&#x61;&#x74;&#x6f;&#x72;&#x40;&#x76;&#x73;&#112;&#104;&#101;&#114;&#x65;&#46;&#x6c;&#111;&#99;&#97;&#108;">&#97;&#x64;&#x6d;&#105;&#x6e;&#105;&#115;&#116;&#114;&#x61;&#x74;&#x6f;&#x72;&#x40;&#x76;&#x73;&#112;&#104;&#101;&#114;&#x65;&#46;&#x6c;&#111;&#99;&#97;&#108;</a>密码</li>
<li>VCSA的FQDN；</li>
<li>获取VCSA的FQDN、VCSA的hostname；</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/vmware-vmafd/bin/vmafd-cli get-pnid --server-name localhost</span><br><span class="line">/usr/lib/vmware-vmafd/bin/vecs-cli entry list --store MACHINE_SSL_CERT --text | grep -A1 Alternative</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成脚本路径：</span></span><br><span class="line"><span class="comment"># LINUX版本的VCSA：/usr/lib/vmware-vmca/bin/certificate-manager</span></span><br><span class="line"><span class="comment"># WINDOWS版本的VCSA：C:\Program Files\VMware\vCenter Server\vmcad\certificate-manager.bat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择8,Reset all Certificates</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关键字段！！以下两个字段需要先确认自身的FQDN后填写，不可乱填写</span></span><br><span class="line"><span class="comment"># IPAddress</span></span><br><span class="line"><span class="comment"># FQDN</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据提示，输入指定信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">service-control --stop --all</span><br><span class="line">service-control --start vmafdd</span><br><span class="line">service-control --start vmdird</span><br><span class="line">service-control --start vmcad</span><br><span class="line">service-control --start --all</span><br></pre></td></tr></table></figure>

<h1 id="后续待办"><a href="#后续待办" class="headerlink" title="后续待办"></a>后续待办</h1><ol>
<li>【高优先级】证书监控；</li>
<li>证书自动续签；</li>
</ol>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>检查证书：<a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/82332">https://kb.vmware.com/s/article/82332</a><br>503报错相关处理步骤：<a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/67818?lang=zh_cn">https://kb.vmware.com/s/article/67818?lang=zh_cn</a><br>更换STS证书：<a target="_blank" rel="noopener" href="https://docs.vmware.com/cn/VMware-vSphere/6.7/com.vmware.psc.doc/GUID-497233EA-AEF9-464B-A9C3-CCAEEA90C801.html#:~:text=%E7%94%B1%E4%BA%8E%20vCenter%20Single%20Sign-On%20Security%20Token%20Service%20%28STS%29,%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6%E6%98%AF%E5%86%85%E9%83%A8%20VMware%20%E8%AF%81%E4%B9%A6%EF%BC%8C%E5%9B%A0%E6%AD%A4%E8%AF%B7%E5%8B%BF%E6%9B%BF%E6%8D%A2%E5%AE%83%EF%BC%8C%E9%99%A4%E9%9D%9E%E8%B4%B5%E5%85%AC%E5%8F%B8%E8%A6%81%E6%B1%82%E6%9B%BF%E6%8D%A2%E5%86%85%E9%83%A8%E8%AF%81%E4%B9%A6%E3%80%82%20%E5%A6%82%E6%9E%9C%E8%A6%81%E6%9B%BF%E6%8D%A2%E9%BB%98%E8%AE%A4%E7%9A%84%20STS%20%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6%EF%BC%8C%E5%BF%85%E9%A1%BB%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E6%96%B0%E8%AF%81%E4%B9%A6%E5%B9%B6%E5%B0%86%E5%85%B6%E6%B7%BB%E5%8A%A0%E5%88%B0%20Java%20%E5%AF%86%E9%92%A5%E5%BA%93%E3%80%82">https://docs.vmware.com/cn/VMware-vSphere/6.7/com.vmware.psc.doc/GUID-497233EA-AEF9-464B-A9C3-CCAEEA90C801.html#:~:text=%E7%94%B1%E4%BA%8E%20vCenter%20Single%20Sign-On%20Security%20Token%20Service%20%28STS%29,%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6%E6%98%AF%E5%86%85%E9%83%A8%20VMware%20%E8%AF%81%E4%B9%A6%EF%BC%8C%E5%9B%A0%E6%AD%A4%E8%AF%B7%E5%8B%BF%E6%9B%BF%E6%8D%A2%E5%AE%83%EF%BC%8C%E9%99%A4%E9%9D%9E%E8%B4%B5%E5%85%AC%E5%8F%B8%E8%A6%81%E6%B1%82%E6%9B%BF%E6%8D%A2%E5%86%85%E9%83%A8%E8%AF%81%E4%B9%A6%E3%80%82%20%E5%A6%82%E6%9E%9C%E8%A6%81%E6%9B%BF%E6%8D%A2%E9%BB%98%E8%AE%A4%E7%9A%84%20STS%20%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6%EF%BC%8C%E5%BF%85%E9%A1%BB%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E6%96%B0%E8%AF%81%E4%B9%A6%E5%B9%B6%E5%B0%86%E5%85%B6%E6%B7%BB%E5%8A%A0%E5%88%B0%20Java%20%E5%AF%86%E9%92%A5%E5%BA%93%E3%80%82</a><br>重新生成新的VMCA根证书并替换所有证书：<a target="_blank" rel="noopener" href="https://docs.vmware.com/cn/VMware-vSphere/6.7/com.vmware.psc.doc/GUID-D944C044-B682-4427-90F8-55B8770F21AF.html">https://docs.vmware.com/cn/VMware-vSphere/6.7/com.vmware.psc.doc/GUID-D944C044-B682-4427-90F8-55B8770F21AF.html</a><br>自动替换VCSA证书：<a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/2112281?lang=zh_cn">https://kb.vmware.com/s/article/2112281?lang=zh_cn</a><br>STS证书处理KB：<a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/79248?lang=zh_cn">https://kb.vmware.com/s/article/79248?lang=zh_cn</a><br>vCenter使用VMCA续订证书：续订证书时发生意外错误：<a target="_blank" rel="noopener" href="https://www.dinghui.org/vcenter-vmca-machine-cert.html">https://www.dinghui.org/vcenter-vmca-machine-cert.html</a><br>VCSA 7.0 证书过期后的修复工作：<a target="_blank" rel="noopener" href="https://ngx.hk/2023/01/10/vcsa-7-0%e8%af%81%e4%b9%a6%e8%bf%87%e6%9c%9f%e5%90%8e%e7%9a%84%e4%bf%ae%e5%a4%8d%e5%b7%a5%e4%bd%9c.html">https://ngx.hk/2023/01/10/vcsa-7-0%e8%af%81%e4%b9%a6%e8%bf%87%e6%9c%9f%e5%90%8e%e7%9a%84%e4%bf%ae%e5%a4%8d%e5%b7%a5%e4%bd%9c.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/4f7b31ae/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/4f7b31ae/" class="post-title-link" itemprop="url">vCenter磁盘空间扩容</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-07-30 17:31:46" itemprop="dateCreated datePublished" datetime="2023-07-30T17:31:46+00:00">2023-07-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/vSphere/" itemprop="url" rel="index"><span itemprop="name">vSphere</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障描述"><a href="#故障描述" class="headerlink" title="故障描述"></a>故障描述</h1><ol>
<li>vCenter告警：Log Disk Exhaustion on vCenter；</li>
<li>进入vCenter的5480端口界面，看到磁盘空间耗尽；</li>
</ol>
<h1 id="故障分析"><a href="#故障分析" class="headerlink" title="故障分析"></a>故障分析</h1><ol>
<li>log增长，导致空间占满。</li>
</ol>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><h2 id="短期："><a href="#短期：" class="headerlink" title="短期："></a>短期：</h2><p>找到目标硬盘，执行扩容：</p>
<ol>
<li>虚拟化层，扩容目标硬盘；</li>
<li>OS层，扩容目标空间；</li>
</ol>
<p>执行指令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vpxd_servicecfg storage lvm autogrow</span><br></pre></td></tr></table></figure>

<h2 id="长期："><a href="#长期：" class="headerlink" title="长期："></a>长期：</h2><ol>
<li>设置日志保存周期；</li>
<li>设置VCSA空间告警；</li>
</ol>
<h1 id="其他补充"><a href="#其他补充" class="headerlink" title="其他补充"></a>其他补充</h1><table>
<thead>
<tr>
<th align="left">磁盘(VMDK)</th>
<th align="left">默认大小（微型，具有默认存储大小）</th>
<th align="left">挂载点</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">VMDK1</td>
<td align="left">12 GB</td>
<td align="left">&#x2F;(10 GB), &#x2F;boot (132 MB), SWAP (1 GB)</td>
<td align="left">存储内核映像和引导加载程序配置的目录。</td>
</tr>
<tr>
<td align="left">VMDK2</td>
<td align="left">1.8 GB</td>
<td align="left">&#x2F;tmp</td>
<td align="left">用于存储 vCenter Server 中的服务生成或使用的临时文件的目录</td>
</tr>
<tr>
<td align="left">VMDK3</td>
<td align="left">25 GB</td>
<td align="left">SWAP</td>
<td align="left">系统内存不足时用于交换到磁盘的目录</td>
</tr>
<tr>
<td align="left">VMDK4</td>
<td align="left">25 GB</td>
<td align="left">&#x2F;storage&#x2F;core</td>
<td align="left">用于存储 vCenter Server 中 VPXD  进程的核心转储文件的目录</td>
</tr>
<tr>
<td align="left">VMDK5</td>
<td align="left">10 GB</td>
<td align="left">&#x2F;storage&#x2F;log</td>
<td align="left">vCenter Server 和 Platform Services Controller 存储环境的所有日志的目录</td>
</tr>
<tr>
<td align="left">VMDK6</td>
<td align="left">10 GB</td>
<td align="left">&#x2F;storage&#x2F;db</td>
<td align="left">VMware Postgres 数据库存储位置</td>
</tr>
<tr>
<td align="left">VMDK7</td>
<td align="left">5 GB</td>
<td align="left">&#x2F;storage&#x2F;dblog</td>
<td align="left">VMware Postgres 数据库日志记录位置</td>
</tr>
<tr>
<td align="left">VMDK8</td>
<td align="left">10 GB</td>
<td align="left">&#x2F;storage&#x2F;seat</td>
<td align="left">VMware Postgres 的统计信息、事件、警报和任务 (SEAT) 目录</td>
</tr>
<tr>
<td align="left">VMDK9</td>
<td align="left">1 GB</td>
<td align="left">&#x2F;storage&#x2F;netdump</td>
<td align="left">VMware Netdump Collector 存储库，用于存储 ESXi 转储</td>
</tr>
<tr>
<td align="left">VMDK10</td>
<td align="left">10 GB</td>
<td align="left">&#x2F;storage&#x2F;autodeploy</td>
<td align="left">VMware Auto Deploy 存储库，存储用于 ESXi 主机无状态引导的</td>
</tr>
<tr>
<td align="left">VMDK11</td>
<td align="left">10 GB</td>
<td align="left">&#x2F;storage&#x2F;imagebuilder</td>
<td align="left">VMware Image Builder 存储库，用于存储 vSphere 映像配置文件、软件库和 VIB 软件包，例如驱动程序 VIB 和更新 VIB。</td>
</tr>
<tr>
<td align="left">VMDK12</td>
<td align="left">100 GB</td>
<td align="left">&#x2F;storage&#x2F;updatemgr</td>
<td align="left">VMware Update Manager 存储库，用于存储虚拟机和 ESXi 主机的修补程序和更新</td>
</tr>
<tr>
<td align="left">VMDK13</td>
<td align="left">50 GB</td>
<td align="left">&#x2F;storage&#x2F;archive</td>
<td align="left">VMware Postgres 数据库的预写日志记录 (WAL) 位置</td>
</tr>
</tbody></table>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://www.dinghui.org/increasing-the-disk-space-for-the-vcenter-server-appliance.html">https://www.dinghui.org/increasing-the-disk-space-for-the-vcenter-server-appliance.html</a><br>Troubleshooting vCenter Appliance &#x2F;storage&#x2F;log directory is 80% or more full (83070): <a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/83070?lang=zh_cn">https://kb.vmware.com/s/article/83070?lang=zh_cn</a><br>vCenter Server Appliance disk space is full (76563)<br>:<a target="_blank" rel="noopener" href="https://kb.vmware.com/s/article/76563">https://kb.vmware.com/s/article/76563</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/8ec359a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/8ec359a/" class="post-title-link" itemprop="url">Citrix 合作伙伴信息</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-07-30 17:23:44" itemprop="dateCreated datePublished" datetime="2023-07-30T17:23:44+00:00">2023-07-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:47" itemprop="dateModified" datetime="2024-12-22T05:27:47+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Citrix/" itemprop="url" rel="index"><span itemprop="name">Citrix</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Citrix-代理商资质信息"><a href="#Citrix-代理商资质信息" class="headerlink" title="Citrix 代理商资质信息"></a>Citrix 代理商资质信息</h1><p>目前有4中资质,资质从低到高分别是：</p>
<ol>
<li>Silver Solution Advisor</li>
<li>Gold Solution Advisor</li>
<li>Platinum Solution Advisor</li>
<li>Platinum Plus Solution Advisor</li>
</ol>
<blockquote>
<p>信息截止至：2023年</p>
</blockquote>
<h1 id="可以在Citrix官网查询"><a href="#可以在Citrix官网查询" class="headerlink" title="可以在Citrix官网查询"></a>可以在Citrix官网查询</h1><p><a target="_blank" rel="noopener" href="https://www.citrix.com/buy/partnerlocator/results.html?partnertypes=CSN&levels=PLATINUM">https://www.citrix.com/buy/partnerlocator/results.html?partnertypes=CSN&amp;levels=PLATINUM</a></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://www.citrix.com/buy/partnerlocator/results.html?partnertypes=CSN&levels=PLATINUM">https://www.citrix.com/buy/partnerlocator/results.html?partnertypes=CSN&amp;levels=PLATINUM</a><br><a target="_blank" rel="noopener" href="https://www.citrix.com/buy/partnerlocator/results.html?partnertypes=CSN&levels=PLATINUM">https://www.citrix.com/buy/partnerlocator/results.html?partnertypes=CSN&amp;levels=PLATINUM</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/9b8590f7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/9b8590f7/" class="post-title-link" itemprop="url">Citrix Virtual Apps and Desktops 常用指令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-07-30 17:19:20" itemprop="dateCreated datePublished" datetime="2023-07-30T17:19:20+00:00">2023-07-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:47" itemprop="dateModified" datetime="2024-12-22T05:27:47+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Citrix/" itemprop="url" rel="index"><span itemprop="name">Citrix</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h1><ol>
<li>安装SDK，或者直接在DDC中打开powershell</li>
<li>加载SDK，使用指令 asnp citrix*</li>
</ol>
<h2 id="获取用户信息"><a href="#获取用户信息" class="headerlink" title="获取用户信息"></a>获取用户信息</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-BrokerUser</span></span><br></pre></td></tr></table></figure>


<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a target="_blank" rel="noopener" href="https://developer-docs.citrix.com/projects/citrix-virtual-apps-desktops-sdk/en/latest/Broker/Get-BrokerUser/">https://developer-docs.citrix.com/projects/citrix-virtual-apps-desktops-sdk/en/latest/Broker/Get-BrokerUser/</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.citrix.com/en-us/xenapp-and-xendesktop">https://docs.citrix.com/en-us/xenapp-and-xendesktop</a></li>
<li><a target="_blank" rel="noopener" href="https://support.citrix.com/article/CTX222326/how-to-configure-powershell-sdk-and-execute-commands-remotely-in-xenappxendesktop-7x#:~:text=Install%20these%20PowerShell%20Snap-ins%20on%20the%20machine%20where,Citrix%20PowerShell%20commands%20by%20using%20the%20%22AdminAddress%22%20parameter">https://support.citrix.com/article/CTX222326/how-to-configure-powershell-sdk-and-execute-commands-remotely-in-xenappxendesktop-7x#:~:text=Install%20these%20PowerShell%20Snap-ins%20on%20the%20machine%20where,Citrix%20PowerShell%20commands%20by%20using%20the%20%22AdminAddress%22%20parameter</a>.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/45/">45</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Rohman.Zhu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
