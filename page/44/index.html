<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="诺曼实验室">
<meta property="og:url" content="http://github.com/rohman-zhu/page/44/index.html">
<meta property="og:site_name" content="诺曼实验室">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Rohman.Zhu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://github.com/rohman-zhu/page/44/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh_cn","comments":"","permalink":"","path":"page/44/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>诺曼实验室</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">诺曼实验室</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Rohman.Zhu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">443</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">146</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/55f10baf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/55f10baf/" class="post-title-link" itemprop="url">Android ConstraintLayout解析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-07-06 11:43:48" itemprop="dateCreated datePublished" datetime="2017-07-06T11:43:48+00:00">2017-07-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:47" itemprop="dateModified" datetime="2024-12-22T05:27:47+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>因为ConstraintLayout这个布局是安卓的新特性,所以在此就学习一下.这里转自网上的一篇文章,把基本的东西都讲到了,感觉还是不错的.</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p>　　本篇文章的主题是ConstraintLayout。其实ConstraintLayout是Android Studio 2.2中主要的新增功能之一，也是Google在去年的I&#x2F;O大会上重点宣传的一个功能。我们都知道，在传统的Android开发当中，界面基本都是靠编写XML代码完成的，虽然Android Studio也支持可视化的方式来编写界面，但是操作起来并不方便，我也一直都不推荐使用可视化的方式来编写Android应用程序的界面。</p>
<p>　　而ConstraintLayout就是为了解决这一现状而出现的。它和传统编写界面的方式恰恰相反，ConstraintLayout非常适合使用可视化的方式来编写界面，但并不太适合使用XML的方式来进行编写。当然，可视化操作的背后仍然还是使用的XML代码来实现的，只不过这些代码是由Android Studio根据我们的操作自动生成的。</p>
<p>　　另外，ConstraintLayout还有一个优点，它可以有效地解决布局嵌套过多的问题。我们平时编写界面，复杂的布局总会伴随着多层的嵌套，而嵌套越多，程序的性能也就越差。ConstraintLayout则是使用约束的方式来指定各个控件的位置和关系的，它有点类似于RelativeLayout，但远比RelativeLayout要更强大。</p>
<p>　　其实ConstraintLayout属于Android Studio 2.2的新特性，我在去年写《第二行代码》的时候就非常想要将这部分内容加入到新书里面，但是在尝试之后还是放弃了。因为ConstraintLayout的用法很多都是对控件进行拖拽，只用文字或者是一些静态图片实在太难将它的用法表达清楚了，因此不太适合写到书上。我当时的想法就是在博客上面写一篇ConstraintLayout的用法讲解，来弥补一下《第二行代码》中缺失的这部分新特性，那么今天这篇文章来了。</p>
<h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>　　下面我们开始用边学边练的方式来进行学习，首先打开你的Android Studio，并新建一个ConstraintLayoutTest项目。另外，确保你的Android Studio是2.2或以上版本。<br>　　为了要使用ConstraintLayout，我们需要在app&#x2F;build.gradle文件中添加ConstraintLayout的依赖，如下所示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">　　dependencies &#123;</span><br><span class="line">　  compile &#x27;com.android.support.constraint:constraint-layout:1.0.2&#x27;</span><br><span class="line">　　&#125;</span><br></pre></td></tr></table></figure>

<p>　　目前ConstraintLayout库最新的版本是1.0.2.</p>
<p>　　在目前的Android Studio 2.3中默认布局就是ConstraintLayout的</p>
<p>　　我们可以看到，现在主操作区域内有两个类似于手机屏幕的界面，左边的是预览界面，右边的是蓝图界面。这两部分都可以用于进行布局编辑工作，区别是左边部分主要用于预览最终的界面效果，右边部分主要用于观察界面内各个控件的约束情况。</p>
<p><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175356264.gif" alt="ConstraintLayout转化"></p>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p>　　下面我们来学习一些具体的操作吧，ConstraintLayout的基本用法很简单，比如我们想要向布局中添加一个按钮，那么只需要从左侧的Palette区域拖一个Button进去就可以了，如下图所示。<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175357269.gif" alt="添加按钮"></p>
<p>　　虽说现在Button已经添加到界面上了，但是由于我们还没有给Button添加任何的约束，因此Button并不知道自己应该出现在什么位置。现在我们在预览界面上看到的Button位置并不是它最终运行后的实际位置，如果一个控件没有添加任何约束的话，它在运行之后会自动位于界面的左上角。</p>
<p>　　那么下面我们就来给Button添加约束，每个控件的约束都分为垂直和水平两类，一共可以在四个方向上给控件添加约束，如下图所示。<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175357273.png" alt="按钮约束">　　</p>
<p>　　上图中Button的上下左右各有一个圆圈，这圆圈就是用来添加约束的，我们可以将约束添加到ConstraintLayout，也可以将约束添加到另一个控件。比如说，想让Button位于布局的右下角，就可以这样添加约束，如下图所示。<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175357217.gif" alt="添加约束"></p>
<p>　　我们给Button的右边和下边添加了约束，因此Button就会将自己定位到布局的右下角了。类似地，如果我们想要让Button居中显示，那么就需要给它的上下左右都添加约束，如下图所示。<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175357404.gif" alt="添加约束">
　　</p>
<p>　　这就是添加约束最基本的用法了。</p>
<p>　　除此之外，我们还可以使用约束让一个控件相对于另一个控件进行定位。比如说，我们希望再添加一个Button，让它位于第一个Button的正下方，并且间距64dp，那么操作如下所示。<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175358652.gif" alt="给控件进行定位"></p>
<p>　　现在添加约束的方式我们已经学完了，那么该怎样删除约束呢?其实也很简单，删除约束的方式一共有三种，第一种用于删除一个单独的约束，将鼠标悬浮在某个约束的圆圈上，然后该圆圈会变成红色，这个时候单击一下就能删除了，如下图所示。<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175358976.gif" alt="删除约束一"></p>
<p>　　第二种用于删除某一个控件的所有约束，选中一个控件，然后它的左下角会出现一个删除约束的图标，点击该图标就能删除当前控件的所有约束了，如下所示。</p>
<p><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175358962.gif" alt="删除约束二">　　</p>
<p>　　第三种用于删除当前界面中的所有约束，点击工具栏中的删除约束图标即可，如下图所示。<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175358912.png" alt="删除约束三"></p>
<h2 id="Inspector"><a href="#Inspector" class="headerlink" title="Inspector"></a>Inspector</h2><p>　　这样我们就把ConstraintLayout的基本用法学完了，接下来我们开始学习一些进阶的内容。</p>
<p>　　当你选中任意一个控件的时候，在右侧的Properties区域就会出现很多的属性选项，如下图所示。<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175359745.png" alt="检查员"></p>
<p>　　在这里我们就可以设置当前控件的所有属性，如文本内容、颜色、点击事件等等。这些功能都非常简单，我就不再进行详细介绍，大家自己点一点就会操作了。</p>
<p>　　需要我们重点掌握的是Properties区域的上半部分，这部分也被称为Inspector。<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175359431.png" alt="属性">
　　</p>
<p>　　首先可以看到，在Inspector中有一个纵向的轴和一个横向的轴，这两个轴也是用于确定控件的位置的。我们刚才给Button的上下左右各添加了一个约束，然后Button就能居中显示了，其实就是因为这里纵横轴的值都是50。如果调整了纵横轴的比例，那么Button的位置也会随之改变，如下图所示。<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175359810.gif" alt="Button位置"></p>
<p>　　不过，虽然我们将横轴的值拖动到了100，但是Button并没有紧贴到布局的最右侧，这是为什么呢?实际上，Android Studio给控件的每个方向上的约束都默认添加了一个16dp的间距，从Inspector上面也可以明显地看出来这些间距的值。如果这些默认值并不是你想要的，可以直接在Inspector上进行修改，如下图所示：<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175359805.gif" alt="贴紧边缘">　　</p>
<p>　　可以看到，修改成0之后Button右侧的间距就没了。<br>　　接下来我们再来学习一下位于Inspector最中间的那个正方形区域，它是用来控制控件大小的。一共有三种模式可选，每种模式都使用了一种不同的符号表示，点击符号即可进行切换。<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175400110.png" alt="wrap_content"></p>
<p>　　表示wrap content，这个我们很熟悉了，不需要进行什么解释。<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175400860.png" alt="固定值">　　</p>
<p>　　表示固定值，也就是给控件指定了一个固定的长度或者宽度值。<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175400253.png" alt="any_size"></p>
<p>　　表示any size，它有点类似于match parent，但和match parent并不一样，是属于ConstraintLayout中特有的一种大小控制方式，下面我们来重点讲解一下。</p>
<p>　　首先需要说明，在ConstraintLayout中是有match parent的，只不过用的比较少，因为ConstraintLayout的一大特点就是为了解决布局嵌套，既然没有了布局嵌套，那么match parent也就没有多大意义了。</p>
<p>　　而any size就是用于在ConstraintLayout中顶替match parent的，先看一下我们怎样使用any size实现和match parent同样的效果吧。比如说我想让Button的宽度充满整个布局，操作如下图所示。<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175400124.gif" alt="any_size">　　</p>
<p>　　可以看到，我们将Button的宽度指定成any size，它就会自动充满整个布局了。当然还要记得将Button左侧的间距设置成0才行。</p>
<p>　　那有的朋友可能会问了，这和match parent有什么区别呢?其实最大的区别在于，match parent是用于填充满当前控件的父布局，而any size是用于填充满当前控件的约束规则。举个例子更好理解，如果我们有一个新的Button，它的其中一个约束是添加到当前这个Button上的，那么any size的效果也会发生改变，如下图所示。<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175401772.gif" alt="any_size">　　</p>
<p>　　通过上图的演示，相信你已经很好地理解any size的作用了。<br>##　　Guidelines ##</p>
<p>　　现在你已经对ConstraintLayout比较熟悉，并且能使用ConstraintLayout来编写一些简单的界面了。不过目前有一个问题可能还比较头疼，刚才我们已经实现了让一个按钮居中对齐的功能，如果我们想让两个按钮共同居中对齐该怎么实现呢?</p>
<p>　　其实这个需求很常见，比如说在应用的登录界面，都会有一个登录按钮和一个注册按钮，不管它们是水平居中也好还是垂直居中也好，但肯定都是两个按钮共同居中的。</p>
<p>　　想要实现这个功能，仅仅用我们刚刚学的那些知识是不够的，这需要用到ConstraintLayout中的一个新的功能，Guidelines。</p>
<p>　　下面我们还是通过实际操作来学习一下Guidelines的用法吧。比如现在已经向界面中添加了登录和注册这两个按钮，如下图所示。<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175401539.png" alt="两个按钮"></p>
<p>　　然后我们希望让这两个按钮在水平方向上居中显示，在垂直方向上都距离底部64dp，那么就需要先添加一个垂直方向上的Guideline，如下图所示。<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175401448.gif" alt="垂直方向"></p>
<p>　　我来对上图中的操作进行一下解释。首先点击通知栏中的Guidelines图标可以添加一个垂直或水平方向上的Guideline，这里我们需要的是垂直方向上的。而Guideline默认是使用的dp尺，我们需要选中Guideline，并点击一下最上面的箭头图标将它改成百比分尺，然后将垂直方向上的Guideline调整到50%的位置，这样就将准备工作做好了。</p>
<p>　　接下来我们开始实现让两个按钮在水平方向上居中显示，并距离底部64dp的功能，如下图所示。<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175402417.gif" alt="增加64dp"></p>
<p>　　可以看到，我们给登录按钮的右边向Guideline添加约束，登录按钮的下面向底部添加约束，并拖动按钮让它距离底部64dp。然后给注册按钮的左边向Guideline添加约束，注册按钮的下面向登录按钮的下面添加约束。这样就实现了让两个按钮在水平方向上居中显示，在垂直方向上都距离底部64dp的功能了。<br>##　　自动添加约束 ##<br>　　不过如果界面中的内容变得复杂起来，给每个控件一个个地添加约束也是一件很繁琐的事情。为此，ConstraintLayout中支持自动添加约束的功能，可以极大程度上简化那些繁琐的操作。</p>
<p>　　自动添加约束的方式主要有两种，一种叫Autoconnect，一种叫Inference，我们先来看第一种。</p>
<p>　　想要使用Autoconnect，首先需要在工具栏中将这个功能启用，默认情况下Autoconnect是不启用的，如下图所示。<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175402878.png" alt="Autoconnect"></p>
<p>　　Autoconnect可以根据我们拖放控件的状态自动判断应该如何添加约束，比如我们将Button放到界面的正中央，那么它的上下左右都会自动地添加上约束，如下图所示。<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175402399.gif" alt="自动约束">
　　</p>
<p>　　然后我们在这个Button的下方再放置一个Button，效果如下。<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175402126.gif" alt="Autoconnect"></p>
<p>　　可以看到，只需要将Button拖放到界面上，Autoconnect会判断我们的意图，并自动给控件添加约束。不过Autoconnect是无法保证百分百准确判断出我们的意图的，如果自动添加的约束并不是你想要的话，还可以在任何时候进行手动修改。总之，可以把它当成一个辅助工具，但不能完全靠它去添加控件的约束。<br>　　以上是Autoconnect的用法，接下来我们看一下Inference的用法。Inference也是用于自动添加约束的，但它比Autoconnect的功能要更为强大，因为AutoConnect只能给当前操作的控件自动添加约束，而Inference会给当前界面中的所有元素自动添加约束。因而Inference比较适合用来实现复杂度比较高的界面，它可以一键自动生成所有的约束。<br>　　下面我们就通过一个例子来演示一下Inference的用法，比如界面上现在有两个TextView，两个EditText，和两个Button，如下图所示。<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175403533.png" alt="Autoconnect"></p>
<p>　　接下来我们先将各个控件按照界面设计的位置进行摆放，摆放完成之后点击一下工具栏上的Infer Constraints按钮，就能为所有控件自动添加约束了，如下图所示。<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175403858.gif" alt="Autoconnect"><br>　　现在运行一下程序，最终效果如下图所示：<br>　　<br><img src="http://www.jeawaa.com/knowledge/UploadFiles_8892/201702/20170204175403263.png" alt="运行效果"></p>
<p>　　</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/b348c678/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/b348c678/" class="post-title-link" itemprop="url">NE555-呼吸灯</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-07-06 11:08:14" itemprop="dateCreated datePublished" datetime="2017-07-06T11:08:14+00:00">2017-07-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%94%B5%E5%AD%90/" itemprop="url" rel="index"><span itemprop="name">电子</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>其实要做出呼吸灯的效果,直接用单片机的PMW(脉宽调制,即在一个周期内控制高电平的时间与低电平的时间).但是也可以在没有单片机的情况下,组建电路.</p>
<p>而要实现呼吸灯的效果,其实最核心的地方在于能不能控制流进LED的电流,要让这个电流逐渐变大(或者逐渐变小),</p>
<p>实现不断循环的关键在于产生一个一段方波,这里用NE555芯片来做,这个芯片是用于产生振荡电路的.</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="NE555"><a href="#NE555" class="headerlink" title="NE555"></a>NE555</h2><p>介绍一下NE555:</p>
<ul>
<li>1脚：外接电源负端VSS或接地，一般情况下接地。</li>
<li>2脚：低触发端TR。</li>
<li>3脚：输出端Vo</li>
<li>4脚：是直接清零端。当此端接低电平，则时基电路不工作，此时不论TR、TH处于何电平，时基电路输出为“0”，该端不用时应接高电平。</li>
<li>5脚：VC为控制电压端。若此端外接电压，则可改变内部两个比较器的基准电压，当该端不用时，应将该端串入一只0.01μF电容接地，以防引入干扰。</li>
<li>6脚：高触发端TH。</li>
<li>7脚：放电端。该端与放电管集电极相连，用做定时器时电容的放电。</li>
<li>8脚：外接电源VCC，双极型时基电路VCC的范围是4.5 ~ 16V，CMOS型时基电路VCC的范围为3 ~ 18V。一般用5V。在1脚接地，5脚未外接电压，两个比较器A1、A2基准电压分别为低电平的情况下，555时基电路的功能表如表1示。</li>
</ul>
<p><img src="http://www.elecfans.com/uploads/160803/1449523-160P31P10SI.png" alt="功能表"><br><img src="http://www.elecfans.com/uploads/160803/1449523-160P31P136229.png" alt="内部结构"><br><img src="http://www.elecfans.com/article/UploadPic/2007-11/20071121182046892.gif" alt="内部结构二"><br><img src="http://www.elecfans.com/uploads/160803/1449523-160P31P136229.png" alt="封装型式"></p>
<p><a target="_blank" rel="noopener" href="https://bbs.kechuang.org/tool/elc/tool/ne555.html">频率计算器</a></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/73c7af9e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/73c7af9e/" class="post-title-link" itemprop="url">多谐震荡器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-07-05 23:48:26" itemprop="dateCreated datePublished" datetime="2017-07-05T23:48:26+00:00">2017-07-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%94%B5%E5%AD%90/" itemprop="url" rel="index"><span itemprop="name">电子</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>之前对手电筒的电路有点感兴趣,为什么一个按钮会有三种状态的灯光状态,于是今天先学习一种状态 – 频闪模式.这个电路主要是用两个NPN型三极管加上两个电解电容组成的.</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="一-为什么会两个三极管间断开关呢"><a href="#一-为什么会两个三极管间断开关呢" class="headerlink" title="一.为什么会两个三极管间断开关呢?"></a>一.为什么会两个三极管间断开关呢?</h2><p><img src="http://img0.imgtn.bdimg.com/it/u=1623282880,3585205188&fm=26&gp=0.jpg" alt="电路图"><br>由于电子元件的差异性,我们假设三极管A先导通,那么与三极管A串连的电解电容也会处于充电状态,而三极管B的基极真是与这个电解电容相连,此时基极的电压基本为0,因此三极管B会处于断开状态.</p>
<p>当电容A充满后,此时电容A就为断路状态,三极管B的基极则会分到高电平,那么三极管B就会导通,同时,电容B也会处于充电状态,这就会导致三极管A的基极为低电平,那么就会导致三极管A处于断路,因此与三极管A串联的LED灯则会灭.</p>
<p>如此反复,这个震荡电路就构成了…</p>
<h2 id="二-为什么电解电容处于充电状态就会导致三极管B的基极电压为0"><a href="#二-为什么电解电容处于充电状态就会导致三极管B的基极电压为0" class="headerlink" title="二.为什么电解电容处于充电状态就会导致三极管B的基极电压为0?"></a>二.为什么电解电容处于充电状态就会导致三极管B的基极电压为0?</h2><p>在这里要说明一下,无论是哪种电容,其内部构造本身就是通路状态,电容从无电状态到有电状态的这个充电过程,就是一个通路,因此这个电容才会有通路的特性,这样也就导致了另外一端的三极管B的基极为0电压状态.</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这个电路的关键在于了解三极管的特性,两个三极管的通与断关键在于基极的电压,基极为高电平,则导通;那么第二个关键点在于对电容充放电的理解,当电容在充电时,相当电容被短接了,则与电容并联的三极管的基极相当于没有电流通过,这也就导致了这个三极管为断路的状态了.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/7eb9e4ae/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/7eb9e4ae/" class="post-title-link" itemprop="url">超声波测距模块</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-07-05 19:45:07" itemprop="dateCreated datePublished" datetime="2017-07-05T19:45:07+00:00">2017-07-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MCU/" itemprop="url" rel="index"><span itemprop="name">MCU</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>今天接触到一个新的模块 – 超声波测距模块,这个模块在淘宝上看就卖2.3一块,非常的便宜,而且卖家给出的参数又挺不错的,所以我就买一块来玩玩.但直到今天才来用,实在惭愧…捣鼓了一天,还是不知道怎么回事,于是先记录下来相关的参数.</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="一-引脚说明"><a href="#一-引脚说明" class="headerlink" title="一.引脚说明"></a>一.引脚说明</h2><p>一共有四个引脚:</p>
<ol>
<li>VCC</li>
<li>TRIG(触控器)</li>
<li>ECHO(接收端)</li>
<li>GND<br>注意 <em>TRIG</em> 引脚是一个内部上拉10K的电阻,用单片机的 <em>IO</em> 口拉TRIG 引脚,然后给一个 10us 以上的脉冲信号.</li>
</ol>
<h2 id="二-工作原理"><a href="#二-工作原理" class="headerlink" title="二.工作原理"></a>二.工作原理</h2><ol>
<li>采用 <em>IO</em> 触发测距,给至少10us的高电平信号.</li>
<li>模块自动发送8个40khz的方波,自动检测是否有信号返回.</li>
<li>如果有信号返回,通过 <em>IO</em> 输出一高电平,高电平持续的时间就是超声波从发送到返回的时间(t).</li>
</ol>
<blockquote>
<p>测距离公式 &#x3D; (高电平持续时间 * 声速(340m&#x2F;s)) &#x2F; 2 ;</p>
</blockquote>
<p>而在单片机中,计时器每记一个数是 1 us(一个指令周期) ,因此计算公式是 : 单片机记下的数 * 0.017</p>
<h2 id="三-程序设计"><a href="#三-程序设计" class="headerlink" title="三.程序设计"></a>三.程序设计</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;reg51.h&gt;</span><br><span class="line"></span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint  unsigned int</span><br><span class="line"></span><br><span class="line">sbit TRIGGER = P2^0;  //用于触发超声波模块工作的引脚</span><br><span class="line">sbit ECHO = P2^1;      //用于接收超声波模块的数据引脚</span><br><span class="line"></span><br><span class="line">uint timeH; //从计时器,记下高位的数值</span><br><span class="line">uint timeL; //从计时器,记下低位的数值</span><br><span class="line">uint time; //计算得出的总时间</span><br><span class="line"></span><br><span class="line">uint distance; //测出的距离 ,单位cm</span><br><span class="line"></span><br><span class="line">//初始化函数</span><br><span class="line">void init()</span><br><span class="line">&#123;</span><br><span class="line">    TRIGGER = 0; //将触发引脚的电平拉低.</span><br><span class="line">    ECHO = 0;   //初始化接收引脚的电平</span><br><span class="line">    initTimer(); // 初始化定时器的函数</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void initTimer()</span><br><span class="line">&#123;</span><br><span class="line">    TMOD = 0x01;    //设置定时器0的工作模式</span><br><span class="line">    TH0 = 0;        //赋予初值</span><br><span class="line">    TL0 = 0;        //赋予初值,因为我们用的是自己计数,所以这里最好初值都赋为0;</span><br><span class="line">    EA = 1;         //打开总中断</span><br><span class="line">    ET0 = 1;        //打开中断源</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//延时函数,这里没有20us,因为C语言不准确等其他因素,导致这个延时函数所延长的时间大于20us.</span><br><span class="line">void delay_20us()</span><br><span class="line">&#123;</span><br><span class="line">    uchar a;</span><br><span class="line">    for(a = 0 ; a &lt; 100;a++);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//计算超声波检测到的距离</span><br><span class="line">void calculate()</span><br><span class="line">&#123;</span><br><span class="line">    uint distance;</span><br><span class="line">    //--- 从计时器取值 ----//</span><br><span class="line">    timeH = TH0;</span><br><span class="line">    timeL = TL0;</span><br><span class="line">    time = timeH * 256  + timeL;</span><br><span class="line">    </span><br><span class="line">    distance = time * 0.017;</span><br><span class="line"></span><br><span class="line">    TH0 = 0;</span><br><span class="line">    TL0 = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">    init();</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">        //----  触发信号 ----//                                                                        </span><br><span class="line">        TRIGGER = 1;</span><br><span class="line">        delay_20us();</span><br><span class="line">        TRIGGER = 0;</span><br><span class="line">	</span><br><span class="line">        while(ECHO != 1);   //接收端收到信号,开启计时器开始计数</span><br><span class="line">        TR0 = 1;            //有信号输入,打开计时器0计时.</span><br><span class="line">        while(ECHO == 1);   //信号持续时间.</span><br><span class="line">		TR0 = 0;            //打开关闭计时器0.</span><br><span class="line">        calculate();        //计算距离,并清除计时器的值.</span><br><span class="line"></span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>使用起来其实蛮方便的,就是在将Trigger 与 Echo 引脚接到对应的 IO 口就好了 , 这边有一个未解决的疑难点,就是C语言中的延时函数,在for循环里计数时,所消耗的时间是多少? </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/4e9f8737/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/4e9f8737/" class="post-title-link" itemprop="url">单片机最小系统</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-07-04 00:54:38" itemprop="dateCreated datePublished" datetime="2017-07-04T00:54:38+00:00">2017-07-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MCU/" itemprop="url" rel="index"><span itemprop="name">MCU</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>老是用开发板写程序,于是就想可不可以自己脱离开发板,自己组建一个单片机电路,然后自己烧写程序.于是在晚上查找资料,发现USB口采用的通讯协议跟单片机的串口通讯协议不同USB的四个引脚分别代表着:VCC , DATA - , DATA + , GND. 而在单片机中 , 用的是TXD与RXD这两个引脚来下载程序,或者传输成数据.因此,想要给单片机下载程序,不能直接通过usb连接,还需要一个转化器或者下载线.</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="一-组成单片机的最小系统"><a href="#一-组成单片机的最小系统" class="headerlink" title="一. 组成单片机的最小系统"></a>一. 组成单片机的最小系统</h2><p>所谓最小系统无非是需要三个部分:</p>
<ol>
<li>复位电路.(可以不添加)</li>
<li>时序电路.</li>
<li>电源.</li>
</ol>
<ul>
<li>复位电路是要给单片机进行重置才用到,一般复位引脚是第9引脚(RST&#x2F;VPD)接高电平即复位.</li>
<li>时序电路,第18号引脚与第19号引脚(XTAL2 与 XTAL1)之间并一个晶振,再并上两个串联的电容,两个电容之间接地.</li>
<li>电源引脚第20号引脚是GND,第40号引脚是VCC(呈现对角线分布),通上一个5V的电压.</li>
</ul>
<p>(PS: 在第31号引脚上面,也要接上高电平,代表的是使用内部存储器;若接上低电平或者悬空,则表示使用外部存储器)</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>没有钱买学习板也可以自己组建电路,这样下来所需要的成本也仅需30左右,对自己理解电路也会有帮助,但是这相对会耗费点时间,对于新手来说还是难了一些.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/eddaec84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/eddaec84/" class="post-title-link" itemprop="url">安卓蓝牙通讯</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-07-02 20:12:54" itemprop="dateCreated datePublished" datetime="2017-07-02T20:12:54+00:00">2017-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近做到一个案例,想实现的功能是 用手机蓝牙控制 <em>单片机</em> 上面的继电器, 那么在单片机上面需要一个蓝牙模块来与安卓手机上面的蓝牙通讯(这个代码,我会在另外一篇文章里面写).经过查询,发现单片机加装的蓝牙通讯模块,是用字节流的形式来进行数据传输,因此,我先来编写安卓手机上面的蓝牙通讯模块.</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="一-获取蓝牙操作对象"><a href="#一-获取蓝牙操作对象" class="headerlink" title="一.获取蓝牙操作对象"></a>一.获取蓝牙操作对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BluetoothAdapter</span> <span class="variable">blueAdapter</span> <span class="operator">=</span> BluetoothAdapter.getDefaultAdapter();</span><br><span class="line"></span><br><span class="line"><span class="comment">//查看本地蓝牙是不是开启状态的</span></span><br><span class="line">blueAdapter.isEnable();</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询蓝牙是不是被发现的状态...这些都是BluetoothAdapter的方法,根据英文提示就好了.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//打开蓝牙设备</span></span><br><span class="line"><span class="comment">//方法一:</span></span><br><span class="line">&#123;</span><br><span class="line">    blueAdapter.Enable();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//方法二:</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Intent</span> <span class="variable">intent</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(BluetoothAdapter.ACTION_REQUEST_ENABLE);</span><br><span class="line">    startActivity(intent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//开启蓝牙被发现的状态</span></span><br><span class="line">&#123;</span><br><span class="line">    BluetoothAdapter.startDiscovery();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二-获取搜索到的蓝牙设备"><a href="#二-获取搜索到的蓝牙设备" class="headerlink" title="二.获取搜索到的蓝牙设备"></a>二.获取搜索到的蓝牙设备</h2><p>这里的蓝牙设备对象都是BluetoothDevice对象,在BluetoothAdapter中可以获取到这些对象.<br>我要用到的是这个设备的 <em>名字</em> 和 <em>MAC地址</em> .</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    Set&lt;bluetoothDevice&gt; bluetoothDevices = BluetoothAdapter.getBondedDevices();<span class="comment">//这里返回的是一个Set集合</span></span><br><span class="line">    <span class="comment">//这里可以用一个增强for来遍历所有的设备</span></span><br><span class="line">    <span class="keyword">for</span>(BluetoothDevice device : bluetoothDevices)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">DeviceName</span> <span class="operator">=</span> device.getName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">DeviceAddress</span> <span class="operator">=</span> device.getAddress();</span><br><span class="line">        <span class="comment">//添加到List集合中</span></span><br><span class="line">        <span class="comment">//自定义修改...   </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三-蓝牙通讯"><a href="#三-蓝牙通讯" class="headerlink" title="三.蓝牙通讯"></a>三.蓝牙通讯</h2><p>蓝牙通讯都是通过Socket型式来传送,需要 客户端(C端)与服务器端(S端) 这两端通过流传输.</p>
<h2 id="四-固定的UUID"><a href="#四-固定的UUID" class="headerlink" title="四.固定的UUID"></a>四.固定的UUID</h2><h3 id="蓝牙串口服务"><a href="#蓝牙串口服务" class="headerlink" title="蓝牙串口服务"></a>蓝牙串口服务</h3><p>SerialPortServiceClass_UUID &#x3D; ‘{00001101-0000-1000-8000-00805F9B34FB}’<br>LANAccessUsingPPPServiceClass_UUID &#x3D; ‘{00001102-0000-1000-8000-00805F9B34FB}’</p>
<h3 id="拨号网络服务"><a href="#拨号网络服务" class="headerlink" title="拨号网络服务"></a>拨号网络服务</h3><p>DialupNetworkingServiceClass_UUID &#x3D; ‘{00001103-0000-1000-8000-00805F9B34FB}’</p>
<h3 id="信息同步服务"><a href="#信息同步服务" class="headerlink" title="信息同步服务"></a>信息同步服务</h3><p>IrMCSyncServiceClass_UUID &#x3D; ‘{00001104-0000-1000-8000-00805F9B34FB}’<br>SDP_OBEXObjectPushServiceClass_UUID &#x3D; ‘{00001105-0000-1000-8000-00805F9B34FB}’</p>
<h3 id="文件传输服务"><a href="#文件传输服务" class="headerlink" title="文件传输服务"></a>文件传输服务</h3><p>OBEXFileTransferServiceClass_UUID &#x3D; ‘{00001106-0000-1000-8000-00805F9B34FB}’<br>IrMCSyncCommandServiceClass_UUID &#x3D; ‘{00001107-0000-1000-8000-00805F9B34FB}’</p>
<h4 id="关键字"><a href="#关键字" class="headerlink" title="关键字:"></a>关键字:</h4><ul>
<li>BluetoothServerSocket</li>
<li>BluetoothSocket</li>
<li>InputStream</li>
<li>OutputStream</li>
<li>耗时&#x2F;阻塞</li>
<li>线程</li>
<li>Handler</li>
</ul>
<p>无论是服务器端,还是客户端,都需相同UUID来创建SOCKET;</p>
<h3 id="客户端-C端"><a href="#客户端-C端" class="headerlink" title="客户端( C端 )"></a>客户端( C端 )</h3><ul>
<li><p>通过Socket.connect(),会让Socket连接到服务器端,但这个操作是耗时操作,会阻塞线程,所以这个方法必须放在另外一个线程里面操作.</p>
</li>
<li><p>创建客户端Socket需要一个 <em>“目标”</em> BluetoothDevice对象;</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导包略...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientSocket</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BluetoothDevice bluetoothDevice;</span><br><span class="line">    <span class="keyword">private</span> UUID uuid;</span><br><span class="line">    <span class="keyword">private</span> BluetoothSocket bluetoothSocket;</span><br><span class="line">    <span class="keyword">private</span> Handler handler;</span><br><span class="line">    <span class="keyword">private</span> SocketIOOperate socketIOOperate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClientSocket</span><span class="params">(BluetoothDevice bluetoothDevice, UUID uuid,Handler handler)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bluetoothDevice = bluetoothDevice;</span><br><span class="line">        <span class="built_in">this</span>.uuid = uuid;</span><br><span class="line">        <span class="built_in">this</span>.handler = handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ConnectToServer</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            bluetoothSocket = bluetoothDevice.createRfcommSocketToServiceRecord(uuid);</span><br><span class="line">            bluetoothSocket.connect();</span><br><span class="line">            <span class="comment">//TODO : 这里有两方法 ,先用第IO流操作个类,直接传入一个socket</span></span><br><span class="line">            <span class="comment">// 剩下的事情交给另外一个类来做</span></span><br><span class="line">            <span class="comment">//SocketIOOperate(BluetoothSocket bluetoothSocket,Handler handler)是一个操作流的类,用于处理Socket收发信息;</span></span><br><span class="line">            socketIOOperate = <span class="keyword">new</span> <span class="title class_">SocketIOOperate</span>(bluetoothSocket,handler);</span><br><span class="line">            socketIOOperate.start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String Content)</span></span><br><span class="line">    &#123;</span><br><span class="line">        socketIOOperate.sendMessage(Content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关闭Socket</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            socketIOOperate.close();</span><br><span class="line">            bluetoothSocket.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        ConnectToServer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="服务器端-S端"><a href="#服务器端-S端" class="headerlink" title="服务器端( S端 )"></a>服务器端( S端 )</h3><p>在服务器端里面会用到两个对象 ,分别是BluetoothServerSocket , BluetoothSocket; </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerSocket</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BluetoothDevice bluetoothDevice;</span><br><span class="line">    <span class="keyword">private</span> UUID uuid;</span><br><span class="line">    <span class="keyword">private</span> BluetoothSocket bluetoothSocket;</span><br><span class="line">    <span class="keyword">private</span> Handler handler;</span><br><span class="line">    <span class="keyword">private</span> BluetoothServerSocket bluetoothServerSocket;</span><br><span class="line">    <span class="keyword">private</span> BluetoothAdapter bluetoothAdapter;</span><br><span class="line">    <span class="keyword">private</span> SocketIOOperate socketIOOperate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//private UUID uuid = UUID.fromString(&quot;8b66eab7-6f0e-42a2-870e-72a8141e308c&quot;); //固定</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServerSocket</span><span class="params">(BluetoothAdapter bluetoothAdapter,UUID uuid,Handler handler)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.bluetoothAdapter = bluetoothAdapter;</span><br><span class="line">        <span class="built_in">this</span>.uuid = uuid;</span><br><span class="line">        <span class="built_in">this</span>.handler = handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">AcceptClient</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            bluetoothServerSocket = bluetoothAdapter.listenUsingRfcommWithServiceRecord(<span class="string">&quot;MyBTServer&quot;</span>,uuid);</span><br><span class="line">            bluetoothSocket = bluetoothServerSocket.accept();</span><br><span class="line">            <span class="comment">//TODO : 这里有两方法 ,先用第IO流操作个类,直接传入一个socket</span></span><br><span class="line">            <span class="comment">// 剩下的事情交给另外一个类来做</span></span><br><span class="line">            socketIOOperate = <span class="keyword">new</span> <span class="title class_">SocketIOOperate</span>(bluetoothSocket,handler);</span><br><span class="line">            socketIOOperate.start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String Content)</span></span><br><span class="line">    &#123;</span><br><span class="line">        socketIOOperate.sendMessage(Content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关闭Socket</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            bluetoothServerSocket.close();</span><br><span class="line"></span><br><span class="line">            bluetoothSocket.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        AcceptClient();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="操作线程"><a href="#操作线程" class="headerlink" title="操作线程"></a>操作线程</h3><p>建立了两个Socket,并使其连接,这还不够,因为要让客户端或服务器端接收数据,或者发送数据,因为无论在客户端还是在服务器端,这两个操作都是一样的,因此单独写成一个线程来处理.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SocketIOOperate</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BluetoothSocket bluetoothSocket;</span><br><span class="line">    <span class="keyword">private</span> InputStream inputStream;</span><br><span class="line">    <span class="keyword">private</span> OutputStream outputStream;</span><br><span class="line">    <span class="keyword">private</span> Handler handler;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//---输入流需要的变量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> readIndex;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] buff;</span><br><span class="line">    <span class="keyword">private</span> String receiveContent;</span><br><span class="line">    <span class="keyword">private</span> Message msg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SocketIOOperate</span><span class="params">(BluetoothSocket bluetoothSocket , Handler handler)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bluetoothSocket = bluetoothSocket;</span><br><span class="line">        <span class="built_in">this</span>.handler = handler;</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        buff = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        readIndex = <span class="number">0</span>;</span><br><span class="line">        receiveContent = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            inputStream  = bluetoothSocket.getInputStream();</span><br><span class="line">            outputStream = bluetoothSocket.getOutputStream();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">listenerContent</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//默认采用UTF-8的编码</span></span><br><span class="line">                readIndex = inputStream.read(buff);</span><br><span class="line">                receiveContent = <span class="keyword">new</span> <span class="title class_">String</span>(buff,<span class="number">0</span>,readIndex);</span><br><span class="line">                msg = <span class="keyword">new</span> <span class="title class_">Message</span>();</span><br><span class="line">                msg.obj = receiveContent;</span><br><span class="line">                handler.sendMessage(msg);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getReceiveContent</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> receiveContent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String content)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">byte</span>[] sendContent = content.getBytes();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            outputStream.write(sendContent);</span><br><span class="line">            outputStream.flush();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        listenerContent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            inputStream.close();</span><br><span class="line">            outputStream.close();</span><br><span class="line">            bluetoothSocket.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>实现蓝牙通讯,额外总共开启了三个线程…这句话不太严谨,是一个作为客户端,要额外再开启两个线程;同理服务器端也需要额外开启两个线程.</p>
<p>而开启线程的原因无非两个:</p>
<ol>
<li>是让耗时(阻塞)放在子线程里面;</li>
<li>是需要重复执行读取流的操作.</li>
</ol>
<p>获取的数据通过Handler类来传输,这就可以实现蓝牙聊天室了.</p>
<p><a href="https://github.com/R0manJ/BlueToothTestDemo">项目地址</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/bd1bdbe4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/bd1bdbe4/" class="post-title-link" itemprop="url">浅谈51单片机串口通讯</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-07-01 00:04:31" itemprop="dateCreated datePublished" datetime="2017-07-01T00:04:31+00:00">2017-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MCU/" itemprop="url" rel="index"><span itemprop="name">MCU</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在做一个单片机通过蓝牙与安卓通讯的案例,这里的案例就需要单片机部分就需要用到串口通讯部分,因此在这里进行记录.</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p>关键字:</p>
<ul>
<li>RXD(ReceiveData)–P3^0</li>
<li>TXD(TransmitData)–P3^1</li>
<li>波特率</li>
<li>串口中断</li>
<li>SBUF</li>
</ul>
<h2 id="一-了解几个概念"><a href="#一-了解几个概念" class="headerlink" title="一.了解几个概念"></a>一.了解几个概念</h2><h3 id="波特率"><a href="#波特率" class="headerlink" title="波特率:"></a>波特率:</h3><p>简单的讲,就是单片机发送的数据的速度,单位是 <em>位&#x2F;秒</em> ,一般我们都用9600(8的倍数).在单片机中的通讯,波特率一定要设置好,这样才能跟其他设备进行通讯,可以说波特率就是实现双方通讯的保证.</p>
<h3 id="SBUF"><a href="#SBUF" class="headerlink" title="SBUF :###"></a>SBUF :###</h3><p>这个是一个缓存寄存器,无论是发送还是接收都在同一个寄存器里面.</p>
<h3 id="串口中断"><a href="#串口中断" class="headerlink" title="串口中断:"></a>串口中断:</h3><p>当单片机接收到信息的时候,就会执行接收中断,并把接收中断允许RI设置为1,代表接收完成,而所有接收过来的数据都会被保存SBUF里面.因此在接收完成后,需要通过软件的方式将RI设置为1;</p>
<h3 id="TXD-RXD"><a href="#TXD-RXD" class="headerlink" title="TXD&#x2F;RXD:"></a>TXD&#x2F;RXD:</h3><p>这里就没有什么好讲的,RXD代表单片机的接收端,TXD代表单片机的发送端.</p>
<p>一般的与外界设备的连接都是相反的;</p>
<table>
<thead>
<tr>
<th align="center">单片机</th>
<th align="left">外界设备</th>
</tr>
</thead>
<tbody><tr>
<td align="center">TXD</td>
<td align="left">RXD</td>
</tr>
<tr>
<td align="center">RXD</td>
<td align="left">TXD</td>
</tr>
<tr>
<td align="center">当然,也有例外的时候,这里就不举例了.</td>
<td align="left"></td>
</tr>
</tbody></table>
<h2 id="二-程序部分"><a href="#二-程序部分" class="headerlink" title="二.程序部分"></a>二.程序部分</h2><p>这里可以用一个叫 “单片机精灵” 的软件来协助生成代码.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg51.h&gt;</span><br><span class="line"></span><br><span class="line">void InitUART(void)</span><br><span class="line">&#123;</span><br><span class="line">    TMOD = 0x20;</span><br><span class="line">    SCON = 0x50;</span><br><span class="line">    //设置定时器的工作方式</span><br><span class="line"></span><br><span class="line">    TH1 = 0xFD;</span><br><span class="line">    TL1 = TH1;</span><br><span class="line">    //设置定时器的值</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    PCON = 0x00; // 波特率不加倍</span><br><span class="line"></span><br><span class="line">    EA = 1; // 打开总中断</span><br><span class="line">    ES = 1; // 打开中断标志位</span><br><span class="line">    TR1 = 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void SendOneByte(unsigned char c)</span><br><span class="line">&#123;</span><br><span class="line">    SBUF = c;</span><br><span class="line">    while(!TI);</span><br><span class="line">    TI = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line">    InitUART();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void UARTInterrupt(void) interrupt 4</span><br><span class="line">&#123;</span><br><span class="line">    if(RI)</span><br><span class="line">    &#123;</span><br><span class="line">        RI = 0;</span><br><span class="line">        //add your code here!</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">        TI = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>总之要实现串口通讯,就必须设置好波特率,然后开启相应的中断就好了.<br>数据的读与写都是通过字节流的型式传送的.这个没有什么好说的.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/b562b54a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/b562b54a/" class="post-title-link" itemprop="url">浅谈三极管</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-07-01 00:04:04" itemprop="dateCreated datePublished" datetime="2017-07-01T00:04:04+00:00">2017-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%94%B5%E5%AD%90/" itemprop="url" rel="index"><span itemprop="name">电子</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在电路中都能经常用三极管,三级管的作用有很多,可以当成一个开关或者放大器.但三级管也比较难以理解,因为这个小元器件上面有太多的概念,如PNP,NPN,包和电压,截至电压……我一看到这些就头大,可能是因为自己不愿意去多学吧,或者自己不愿意话太多的时间去动脑,因此我一直都没有学会怎么去应用三极管.可是,天无绝人之路,今天我就看到一个视屏讲解三极管,讲的内容非常少,但却很有用,在这里做一下总结,方便以后查看.</p>
<h1 id="一-三极管的三个脚"><a href="#一-三极管的三个脚" class="headerlink" title="一 . 三极管的三个脚"></a>一 . 三极管的三个脚</h1><ul>
<li>E 极: 表示发射极(Emitter),如果 <em>向外</em> 就是PNP型三极管,反之则是NPN型三极管. 这个方向也代表了电势降落的方向.</li>
<li>B 极 : 表示基极(Basc),我们在这里不用想太多,就把这里当成开关或者阀门就好,</li>
<li>C 极: 表示集电极(Collector).</li>
</ul>
<h1 id="二-用三极管来当开关"><a href="#二-用三极管来当开关" class="headerlink" title="二. 用三极管来当开关"></a>二. 用三极管来当开关</h1><blockquote>
<p>三极管是常开状态 的开关</p>
</blockquote>
<p>我们就把三极管当成开关就好了,而这个开关的触发条件是这样的:</p>
<ul>
<li>NPN型三极管中 : 当B极是低电平的电压时,三极管处于开路(E与C之间);当B极是高电平时,三极管处于通路(E与C之间).</li>
<li>PNP型三极管中 : 当B极是低电平的电压时,三极管处于通路(E与C之间);当B极是高电平时,三极管处于开路(E与C之间).</li>
</ul>
<p><img src="https://gss2.bdstatic.com/-fo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike92%2C5%2C5%2C92%2C30/sign=3420af8568d0f703f2bf9d8e69933a58/f2deb48f8c5494ee4e2cf68b27f5e0fe99257e12.jpg" alt="两种型号"></p>
<h1 id="三-三极管的三种封装型式"><a href="#三-三极管的三种封装型式" class="headerlink" title="三. 三极管的三种封装型式"></a>三. 三极管的三种封装型式</h1><ul>
<li>SOT-23 , 这是一种贴片式的三极管,单独一脚的是发射机(E),左下角的一脚为基极(B),右下角是集电极(C)<br><img src="/" alt="SOT-23"></li>
<li>TO-92 ,这种是一种直插式的三极管,平面的一边对着自己,从做左到右依次是,E,B,C.<br><img src="/" alt="TO-92"></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/ce024141/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/ce024141/" class="post-title-link" itemprop="url">在MAC的VirtualBox中编写单片机程序</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-06-30 16:53:37" itemprop="dateCreated datePublished" datetime="2017-06-30T16:53:37+00:00">2017-06-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MCU/" itemprop="url" rel="index"><span itemprop="name">MCU</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在Mac OS sierra中想要编写单片机程序，并且实现烧录程序到单片机，这是可以实现的。如果不想倒腾，那么只需安装虚拟机，装个windows7，并且用相关的软件，如Keil、STC_ISP等来编写就好了。</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h3 id="一、需要准备的软件"><a href="#一、需要准备的软件" class="headerlink" title="一、需要准备的软件"></a>一、需要准备的软件</h3><ul>
<li>Virtual Box</li>
<li>Virtual Box Guest Additions</li>
<li>Windows7的镜像</li>
<li>Keil </li>
<li>STC_ISP</li>
<li>USB转串口驱动</li>
</ul>
<p><a href="在百度网盘">我已经打包到百度网盘了，点击下载</a></p>
<h3 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h3><ul>
<li>正常安装Virtual Box</li>
<li>安装windows7</li>
<li>在windows7中安装VirtualBox GuestAdditions</li>
<li>安装跟编写单片机程序相关的软件（如Keil、STC_ISP等）</li>
</ul>
<h3 id="三、在虚拟机中连接单片机"><a href="#三、在虚拟机中连接单片机" class="headerlink" title="三、在虚拟机中连接单片机"></a>三、在虚拟机中连接单片机</h3><ul>
<li>连接好相关线路</li>
<li>到虚拟机右下角一个USB模样的图标中，点击与单片机相关的硬件，表示装载到虚拟机中</li>
<li>这时候windows系统内，会提示没有安装驱动。我这边直接打开驱动程序，会提示不能安装。因此通过设备管理器，找到该设备，指定驱动文件夹位置手动安装，就可以了。</li>
</ul>
<h3 id="四、下载程序"><a href="#四、下载程序" class="headerlink" title="四、下载程序"></a>四、下载程序</h3><ul>
<li>打开STC_ISP，选择好HEX文件，点击下载。</li>
<li>如果卡在单片机握手什么的，直接重启一下单片机。</li>
</ul>
<p>（其实就是跟普通的下载流程一样的，这里没什么可以说的）</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/3f08da7f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/3f08da7f/" class="post-title-link" itemprop="url">有关Fragment的相关问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-06-28 12:26:18" itemprop="dateCreated datePublished" datetime="2017-06-28T12:26:18+00:00">2017-06-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>写笔记前先扯一下蛋,明天(2017-06-29 14:00 信息楼103)要参加A+认证考试.而到现在为止,本人还没有看多少题.本人最近都是在根据题库做一个背题的APP,就当作练练手.从上星期六(2017-06-26)立项到现在,历时4天,终于弄出了以下玩意:</p>
<p><img src="/sourc/images/20170628_mainpager.png" alt="img"><br><img src="/sourc/images/20170628_testPager.png" alt="img"><br><img src="/images/20170628_rememberPager.jpeg" alt="img"><br><img src="/images/20170628_recordPager.jpeg" alt="img"></p>
<h3 id="用到了一下几个控件"><a href="#用到了一下几个控件" class="headerlink" title="用到了一下几个控件:"></a>用到了一下几个控件:</h3><ul>
<li>ViewPager(主要)<h4 id="viewpager用的适配器-FragmentAdapter"><a href="#viewpager用的适配器-FragmentAdapter" class="headerlink" title="viewpager用的适配器: FragmentAdapter"></a>viewpager用的适配器: FragmentAdapter</h4></li>
<li>DrawerLayout</li>
<li>CheckBox</li>
<li>Button</li>
<li>ListView</li>
</ul>
<h3 id="APP构思"><a href="#APP构思" class="headerlink" title="APP构思"></a>APP构思</h3><ol>
<li>编码题库TXT文件 txt -&gt; xml</li>
<li>解析题库XML文件 xml -&gt; 题目类</li>
<li>编辑题目类,有 题号&#x2F;题目内容&#x2F;选项A内容&#x2F;选项B内容&#x2F;选项C内容&#x2F;选项D内容&#x2F;正确答案,一个类共7个项内容,并且设置相应的操作函数.</li>
<li>加载题库数据到Viewpager…</li>
</ol>
<p>最终实现流程:<br>编码XML -&gt; 解析XML -&gt; 封装类到集合 -&gt; 根据集合封装Fragment -&gt; 给Viewpager设置适配器</p>
<h3 id="出现大的问题"><a href="#出现大的问题" class="headerlink" title="出现大的问题"></a>出现大的问题</h3><ol>
<li>因为本APP有三种模式,其中错题模式的页面内容是跟另外两个模式不一样的,适配器的数据(Fragment集需要更变)更变后,页面没变化.</li>
<li>在 <em>测试模式</em> 和 <em>背题模式</em> 中,不同的是Fragment中的题目答案是否有显示,而在页面中要让一个TextView显示,Fragment必须是要加载到Activity中,未加载的Fragment是不能设置TextView显示.</li>
</ol>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><ol>
<li>留到下文再写.</li>
<li>在每一个题目的Fragment中设置一个用于表示 <em>是否显示参数</em> (boolean isVisible),如果要显示则,通过fragment集合获取指定的fragment的这个参数(isVisible),设置为 <em>true</em> ;然后在onCreateView()中加入这段逻辑:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TestViewAnswer.setVisibility(isVisible);</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p>话说回来,因为我用到的Viewpager控件采用的是FragmentAdapter这个适配器,因此用的是有关Fragment的相关内容.</p>
<h2 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h2><h3 id="一-什么是Fragment"><a href="#一-什么是Fragment" class="headerlink" title="一.什么是Fragment"></a>一.什么是Fragment</h3><p>Fragment是一个类似Activity组件,跟Activity一样的也有生命周期.<br><img src="http://img.my.csdn.net/uploads/201211/29/1354170699_6619.png" alt="Fragment生命周期"></p>
<p>由图中可以看到,Fragment被加载的时候,会多一个onCreateView方法.而且每一次再加载的时候都是调用onCreateView方法.</p>
<h3 id="二-使用Fragment-加载Fragment"><a href="#二-使用Fragment-加载Fragment" class="headerlink" title="二.使用Fragment(加载Fragment)"></a>二.使用Fragment(加载Fragment)</h3><h4 id="方法一-静态添加"><a href="#方法一-静态添加" class="headerlink" title="方法一: 静态添加"></a>方法一: 静态添加</h4><p>这个方法其实跟自定义控件一样,需要java文件与xml布局文件.</p>
<ol>
<li><p>正常设置布局</p>
</li>
<li><p>编写java文件 ,类继承自Fragment,并重写以对应的方法.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Override  </span><br><span class="line">   public View onCreateView(LayoutInflater inflater, ViewGroup container,  </span><br><span class="line">           Bundle savedInstanceState)  </span><br><span class="line">   &#123;  </span><br><span class="line">       return inflater.inflate(R.layout.fragment_content, container, false);  </span><br><span class="line">       //这里相当于加载了fragment的布局文件</span><br><span class="line">   &#125;  </span><br></pre></td></tr></table></figure></li>
<li><p>在MainActivity中也需要编写两个文件,只需编写布局文件就好了</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//这里是MainActivity的布局文件</span><br><span class="line">&lt;fragment</span><br><span class="line">    android:id=&quot;@+id/id_fragment_content&quot;  </span><br><span class="line">    android:name=&quot;fragment放置的包名&quot;  </span><br><span class="line">    android:layout_width=&quot;fill_parent&quot;  </span><br><span class="line">    android:layout_height=&quot;fill_parent&quot; /&gt;  </span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="方法二-动态添加"><a href="#方法二-动态添加" class="headerlink" title="方法二 : 动态添加"></a>方法二 : 动态添加</h4><p>这个方法是通过 FragmentManager的一个事务对象来实现的 ( <em>FragmentTransaction</em> ),常用方法有add,remove,replace, 最后都要用commit方法提交.</p>
<ol>
<li><p>replace()</p>
<ul>
<li>这里需要设置两个参数(被替换的布局文件id,将要替换的fragment);</li>
<li>设置完后提交,FragmentTransaction.commit();</li>
</ul>
</li>
</ol>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>Fragment常用的三个类：</p>
<ul>
<li>android.app.Fragment 主要用于定义Fragment</li>
<li>android.app.FragmentManager 主要用于在Activity中操作Fragment</li>
<li>android.app.FragmentTransaction 保证一些列Fragment操作的原子性，熟悉事务这个词，一定能明白~</li>
</ul>
<hr>
<ul>
<li><p>获取FragmentManager的方法是getFragmentManager(),而在v4中是用getSupportFragmentManager();</p>
</li>
<li><p>操作事务的对象是 FragmentManager.beginTransaction();</p>
</li>
<li><p>transaction.add() ;往Activity中添加一个Fragment</p>
</li>
<li><p>transaction.remove() ; 从Activity中移除一个Fragment，如果被移除的Fragment没有添加到回退栈（回退栈后面会详细说），这个Fragment实例将会被销毁。</p>
</li>
<li><p>transaction.replace()<br>使用另一个Fragment替换当前的，实际上就是remove()然后add()的合体</p>
</li>
<li><p>transaction.hide()<br>隐藏当前的Fragment，仅仅是设为不可见，并不会销毁</p>
</li>
<li><p>transaction.show()<br>显示之前隐藏的Fragment</p>
</li>
<li><p>detach()<br>会将view从UI中移除,和remove()不同,此时fragment的状态依然由FragmentManager维护。</p>
</li>
<li><p>attach()<br>重建view视图，附加到UI上并显示。</p>
</li>
<li><p>transatcion.commit()&#x2F;&#x2F;提交一个事务</p>
</li>
<li><p>注意：常用Fragment的哥们，可能会经常遇到这样Activity状态不一致：State loss这样的错误。主要是因为：commit方法一定要在Activity.onSaveInstance()之前调用。</p>
</li>
<li><p>a、比如：我在FragmentA中的EditText填了一些数据，当切换到FragmentB时，如果希望会到A还能看到数据，则适合你的就是hide和show；也就是说，希望保留用户操作的面板，你可以使用hide和show，当然了不要使劲在那new实例，进行下非null判断。</p>
</li>
<li><p>b、再比如：我不希望保留用户操作，你可以使用remove()，然后add()；或者使用replace()这个和remove,add是相同的效果。</p>
</li>
<li><p>c、remove和detach有一点细微的区别，在不考虑回退栈的情况下，remove会销毁整个Fragment实例，而detach则只是销毁其视图结构，实例并不会被销毁。那么二者怎么取舍使用呢？如果你的当前Activity一直存在，那么在不希望保留用户操作的时候，你可以优先使用detach。</p>
</li>
</ul>
<h3 id="关于回退栈"><a href="#关于回退栈" class="headerlink" title="关于回退栈"></a>关于回退栈</h3><ul>
<li>如果不添加事务到回退栈，前一个Fragment实例会被销毁。这里很明显，我们调用tx.addToBackStack(null);将当前的事务添加到了回退栈，所以FragmentOne实例不会被销毁，但是视图层次依然会被销毁，即会调用onDestoryView和onCreateView.</li>
</ul>
<h2 id="ViewPager"><a href="#ViewPager" class="headerlink" title="ViewPager"></a>ViewPager</h2><p>我用的是FragmentAdapter,也就是说,这个Viewpager里面放的是Fragment,这个控件会在当前页中,预先加载position - 1 页 和 position + 1页.</p>
<h3 id="FragmentAdapter"><a href="#FragmentAdapter" class="headerlink" title="FragmentAdapter"></a>FragmentAdapter</h3><ul>
<li>构造函数中必须需要传入一个FragmentManager参数.</li>
<li>将显示的页面,需要传入一个Fragment集合</li>
</ul>
<hr>
<p>方法说明:</p>
<ul>
<li>public Fragment getItem()</li>
</ul>
<ol>
<li>该类中新增的一个虚函数。函数的目的为生成新的 Fragment 对象。重载该函数时需要注意这一点。在需要时，该函数将被 instantiateItem() 所调用。</li>
<li>如果需要向 Fragment 对象传递相对静态的数据时，我们一般通过 Fragment.setArguments() 来进行，这部分代码应当放到 getItem()。它们只会在新生成 Fragment 对象时执行一遍。</li>
<li>如果需要在生成 Fragment 对象后，将数据集里面一些动态的数据传递给该 Fragment，那么，这部分代码不适合放到 getItem() 中。因为当数据集发生变化时，往往对应的 Fragment 已经生成，如果传递数据部分代码放到了 getItem() 中，这部分代码将不会被调用。这也是为什么很多人发现调用 PagerAdapter.notifyDataSetChanged() 后，getItem() 没有被调用的一个原因。</li>
</ol>
<ul>
<li><p>public Object instantiateItem()</p>
<p>  在每次 ViewPager 需要一个用以显示的 Object 的时候，该函数都会被 ViewPager.addNewItem() 调用。</p>
</li>
</ul>
<ol>
<li>函数中判断一下要生成的 Fragment 是否已经生成过了，如果生成过了，就使用旧的，旧的将被 Fragment.attach()；如果没有，就调用 getItem() 生成一个新的，新的对象将被 FragmentTransation.add()。</li>
<li>FragmentPagerAdapter 会将所有生成的 Fragment 对象通过 FragmentManager 保存起来备用，以后需要该 Fragment 时，都会从 FragmentManager 读取，而不会再次调用 getItem() 方法。</li>
<li>如果需要在生成 Fragment 对象后，将数据集中的一些数据传递给该 Fragment，这部分代码应该放到这个函数的重载里。在我们继承的子类中，重载该函数，并调用 FragmentPagerAdapter.instantiateItem() 取得该函数返回 Fragment 对象，然后，我们该 Fragment 对象中对应的方法，将数据传递过去，然后返回该对象。</li>
<li>否则，如果将这部分传递数据的代码放到 getItem()中，在 PagerAdapter.notifyDataSetChanged() 后，这部分数据设置代码将不会被调用。</li>
</ol>
<ul>
<li><p>public void notifyDataSetChanged()</p>
<p>  在数据集发生变化的时候，一般 Activity 会调用 PagerAdapter.notifyDataSetChanged()，以通知 PagerAdapter，而 PagerAdapter 则会通知在自己这里注册过的所有 DataSetObserver。其中之一就是在 ViewPager.setAdapter() 中注册过的 PageObserver。PageObserver 则进而调用 ViewPager.dataSetChanged()，从而导致 ViewPager 开始触发更新其内含 View 的操作。</p>
</li>
</ul>
<p>参考资料:<a href=http://m.blog.csdn.net/shaoyezhangliwei/article/details/52488179>CSDN</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/43/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/">43</a><span class="page-number current">44</span><a class="page-number" href="/page/45/">45</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/45/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Rohman.Zhu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
