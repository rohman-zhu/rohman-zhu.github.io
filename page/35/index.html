<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="诺曼实验室">
<meta property="og:url" content="http://github.com/rohman-zhu/page/35/index.html">
<meta property="og:site_name" content="诺曼实验室">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Rohman.Zhu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://github.com/rohman-zhu/page/35/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh_cn","comments":"","permalink":"","path":"page/35/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>诺曼实验室</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">诺曼实验室</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Rohman.Zhu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">450</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">148</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/5c44fcdc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/5c44fcdc/" class="post-title-link" itemprop="url">为Grub菜单添加密码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-18 19:03:10" itemprop="dateCreated datePublished" datetime="2018-11-18T19:03:10+00:00">2018-11-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/d244349e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/d244349e/" class="post-title-link" itemprop="url">BIOS 无法读取大硬盘的问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-18 19:02:21" itemprop="dateCreated datePublished" datetime="2018-11-18T19:02:21+00:00">2018-11-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:47" itemprop="dateModified" datetime="2024-12-22T05:27:47+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/97711d3f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/97711d3f/" class="post-title-link" itemprop="url">ToDo-修复因缺少initrd而无法启动的grub程序</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-18 18:20:44" itemprop="dateCreated datePublished" datetime="2018-11-18T18:20:44+00:00">2018-11-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/a57385a9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/a57385a9/" class="post-title-link" itemprop="url">待补充-Boot Loader:Grub</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-17 23:03:01" itemprop="dateCreated datePublished" datetime="2018-11-17T23:03:01+00:00">2018-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><ul>
<li>在BIOS 读完信息后，第一启动设备的MBR会去读取boot loader 。</li>
<li>boot loader 具有菜单功能、直接加载内核文件 以及 控制权移交的功能等，系统必须要有 loader 才有办法加载该操作系统的内核。</li>
<li>MBR 是整个硬盘的第一个 sector 内的一个块，充其量整个大小也才446bytes。</li>
</ul>
<p><img src="https://images0.cnblogs.com/blog/432441/201305/19135459-4ac4e5873a42476c95a02460464449d5.jpg" alt="启动顺序"></p>
<p>测试环境：</p>
<ul>
<li>CentOS 6.9</li>
</ul>
<h1 id="TODO-LIST"><a href="#TODO-LIST" class="headerlink" title="TODO-LIST"></a>TODO-LIST</h1><ul>
<li>两块硬盘，每一块硬盘都装有不同的系统，编写双系统启动grub引导文件。</li>
<li>当从一块没有系统的硬盘（只装有grub的硬盘）启动，如何快速修复进入系统）[完成时间：2018-11-18]</li>
<li>第二块盘上面的grub配置文件有误，如何快速进入系统[完成时间：2018-11-18]</li>
<li>修复Ubuntu下的无法启动问题。</li>
<li>修复采用LVM分区方式的Ubuntu无法启动问题。</li>
</ul>
<h1 id="Linux中的解决方案"><a href="#Linux中的解决方案" class="headerlink" title="Linux中的解决方案"></a>Linux中的解决方案</h1><p>Linux将boot loader的程序代码执行与设置值加载分成两个阶段（stage）</p>
<h2 id="Stage-1-：-执行boot-loader-主程序"><a href="#Stage-1-：-执行boot-loader-主程序" class="headerlink" title="Stage 1 ： 执行boot loader 主程序"></a>Stage 1 ： 执行boot loader 主程序</h2><p>这个主程序必须安装在启动区 ， 即 MBR或者 boot sector 。 不过由于 MBR 实在太小了， 因此 MBR 或者 boot sector 通常仅安装 boot loader 的最小主程序 ， 并没有安装 loader 的相关配置文件。</p>
<h2 id="Stage-2-：-主程序加载配置文件"><a href="#Stage-2-：-主程序加载配置文件" class="headerlink" title="Stage 2 ： 主程序加载配置文件"></a>Stage 2 ： 主程序加载配置文件</h2><p>通过boot loader加载所有配置文件与相关的环境参数文件（包括文件系统定义与主要配置文件menu.lst) , 一般在 &#x2F;boot 下面。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">与Grub有关的文件都放在 /boot/grub 中</span></span><br><span class="line">[root@OrigialCentOS ~]# ll /boot/grub/</span><br><span class="line">总用量 274</span><br><span class="line">-rw-r--r--. 1 root root     63 11月  9 2017 device.map  # grub 的设备对应文件</span><br><span class="line">-rw-r--r--. 1 root root  13428 11月  9 2017 e2fs_stage1_5 # ext2/ext3 文件系统的定义文件</span><br><span class="line">-rw-r--r--. 1 root root  12636 11月  9 2017 fat_stage1_5 # fat 文件系统的定义文件</span><br><span class="line">-rw-r--r--. 1 root root  11780 11月  9 2017 ffs_stage1_5 # ffs 文件系统的定义文件</span><br><span class="line">-rw-------. 1 root root    771 11月  9 2017 grub.conf # grub 在 Centos中的配置文件</span><br><span class="line">-rw-r--r--. 1 root root  11772 11月  9 2017 iso9660_stage1_5 # 光驱文件系统的定义文件</span><br><span class="line">-rw-r--r--. 1 root root  13284 11月  9 2017 jfs_stage1_5 # jfs 文件系统的定义文件</span><br><span class="line">lrwxrwxrwx. 1 root root     11 11月  9 2017 menu.lst -&gt; ./grub.conf # menu.lst 配置文件</span><br><span class="line">-rw-r--r--. 1 root root  11972 11月  9 2017 minix_stage1_5 # minix 文件系统定义文件</span><br><span class="line">-rw-r--r--. 1 root root  14428 11月  9 2017 reiserfs_stage1_5 # reiserfs 文件系统的定义文件</span><br><span class="line">-rw-r--r--. 1 root root   1341 11月 15 2010 splash.xpm.gz # 启动时 在 grub 下面的后台图示</span><br><span class="line">-rw-r--r--. 1 root root    512 11月  9 2017 stage1 # stage 1 的相关说明</span><br><span class="line">-rw-r--r--. 1 root root 126148 11月  9 2017 stage2 # stage 2 的相关说明</span><br><span class="line">-rw-r--r--. 1 root root  12040 11月  9 2017 ufs2_stage1_5 # ufs 的文件系统定义文件</span><br><span class="line">-rw-r--r--. 1 root root  11380 11月  9 2017 vstafs_stage1_5 # vstafs 的文件系统定义文件</span><br><span class="line">-rw-r--r--. 1 root root  13980 11月  9 2017 xfs_stage1_5 # xfs 文件系统的定义文件</span><br></pre></td></tr></table></figure>

<p>上面中 ， 最重要的配置文件为 menu.lst 。（Red hat 定义为 &#x2F;boot&#x2F;grub.conf) </p>
<h1 id="Grub"><a href="#Grub" class="headerlink" title="Grub"></a>Grub</h1><p>Grub 是目前使用最广泛的 Linux 引导装载程序 ， 有以下几个优点 ： </p>
<ul>
<li>认识与支持较多的文件系统 ， 并且可以使用该grub的主程序直接在文件系统中查询内核文件名。</li>
<li>启动的时候，可以自行编辑与修改启动设置选项，类似bash的命令模式。</li>
<li>可以动态查找配置文件，而不需要修改配置文件后重新安装 grub 。 只需要修改 &#x2F;boot&#x2F;grub&#x2F;menu.lst 后重启生效。</li>
<li>安装在 MBR 的 grub 主要任务是加载内核文件，以让内核能够驱动整个系统的硬件。</li>
<li>grub 与 硬盘分区代号<ul>
<li>(hd0,0)</li>
<li>硬盘代号以 () 括起</li>
<li>硬盘以hd表示 ， 后面会接一组数字</li>
<li>以“查找顺序”作为硬盘的编号，而不是依照硬盘扁平电缆的排序（重点！）</li>
<li>第一个查找的硬盘编号为0号</li>
<li>每块硬盘的第一个分区号为0</li>
</ul>
</li>
<li>第一块硬盘的第一个逻辑分区的boot sector 代号为 (hd0,4)</li>
</ul>
<blockquote>
<p>使用SATA 磁盘，加上使用逻辑分区，Linux当中的文件名为&#x2F;dev&#x2F;sda5 (1-4保留给 primary 和 extended 使用)。 对应grub 的磁盘代号为 （hd0，4） ， 注意因为代号是从0开始，所以是4，而不是5.</p>
</blockquote>
<h2 id="menu-lst-配置文件"><a href="#menu-lst-配置文件" class="headerlink" title="menu.lst 配置文件"></a>menu.lst 配置文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@OrigialCentOS ~]# cat /boot/grub/menu.lst </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">grub.conf generated by anaconda</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Note that you do not have to rerun grub after making changes to this file</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">NOTICE:  You have a /boot partition.  This means that</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">         all kernel and initrd paths are relative to /boot/, eg.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">         root (hd0,0)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">         kernel /vmlinuz-version ro root=/dev/sda3</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">         initrd /initrd-[generic-]version.img</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">boot=/dev/sda</span></span><br><span class="line">default=0 # 默认启动选项，使用第一个启动菜单（title）</span><br><span class="line">timeout=5 # 超时5s</span><br><span class="line">splashimage=(hd0,0)/grub/splash.xpm.gz # 后台图示所在的文件</span><br><span class="line">hiddenmenu # 读秒期间是否显示出完整菜单（默认隐藏）</span><br><span class="line">title CentOS 6 (2.6.32-696.el6.x86_64) # 第一个菜单的内容</span><br><span class="line">	root (hd0,0)</span><br><span class="line">	kernel /vmlinuz-2.6.32-696.el6.x86_64 ro root=UUID=4c170fc7-b150-4dde-8bb4-6987741f6fd1 rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet</span><br><span class="line">	initrd /initramfs-2.6.32-696.el6.x86_64.img</span><br></pre></td></tr></table></figure>

<ul>
<li>default ， 默认从第几个菜单启动， 从0开始。</li>
<li>timeout ，单位为s ， 设置为0表示直接使用 default值进行启动而不读秒；设置为 -1 表示进入菜单不读秒。</li>
<li>title 后面是指定启动的内核文件或者是 boot loader 控制权。</li>
<li>splashimage &#x3D; (hd0,0)&#x2F;grub&#x2F;splash.xpm.gz , 提供后台图示。</li>
<li>hiddenmenu ， 如果要显示完整菜单，则注释掉此行。</li>
<li>指定内核启动<ul>
<li>先指定内核文件放置的分区 ，再读取文件（目录树），最后才加入文件的实际文件名和路径 （ kernel 与 initrd）</li>
<li>root (hd0,0) 代表内核文件放在哪一个分区中<ul>
<li>root 代表 的是内核文件放置的那个分区 ，而不是根目录 。</li>
</ul>
</li>
<li>kernel kernel &#x2F;vmlinuz-2.6.32-696.el6.x86_64 ro root&#x3D;UUID&#x3D;4c170fc7-b150-4dde-8bb4-6987741f6fd1 rd_NO_LUKS rd_NO_LVM LANG&#x3D;en_US.UTF-8 rd_NO_MD SYSFONT&#x3D;latarcyrheb-sun16 crashkernel&#x3D;auto  KEYBOARDTYPE&#x3D;pc KEYTABLE&#x3D;us rd_NO_DM rhgb quiet<ul>
<li>kernel 接的是内核的文件名 ， 文件名后面接的是内核的参数 。</li>
<li>root&#x3D;UUID ， 指的是Linux的根目录在哪一个分区的意思。这里采用的UUID来挂载根目录。</li>
<li>rhgb （redhat graphics boot） 为色彩显示 </li>
<li>rd_NO_LVM 禁用LVM</li>
<li>rd_NO_LUKS</li>
<li>SYSFONT</li>
<li>crashkernel</li>
<li>rd_NO_DM</li>
<li>quiet 是 安静模式 （屏幕不会输入内核检测信息）</li>
</ul>
</li>
<li>initrd &#x2F;initramfs-2.6.32-696.el6.x86_64.img</li>
</ul>
</li>
</ul>
<h2 id="利用-chain-loader的方式转交控制权-，即-双系统的启动方式-。"><a href="#利用-chain-loader的方式转交控制权-，即-双系统的启动方式-。" class="headerlink" title="利用 chain loader的方式转交控制权 ，即 双系统的启动方式 。"></a>利用 chain loader的方式转交控制权 ，即 双系统的启动方式 。</h2><p>chain loader（引导装载程序的连接） 仅是 将控制权交给下一个boot loader而已 。</p>
<ul>
<li>预计要前往的boot sector 所在的分区代号。</li>
<li>chain loader 在的那个分区的boot sector （一般为第一个扇区）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">应用场景 ， 假设 Windows分区在dev/hda1 ，仅有一块硬盘</span> </span><br><span class="line">title Windows partition</span><br><span class="line">    root (hd0,0)</span><br><span class="line">    # 如果我的/dev/hda5 是安装Linux的分区，不想让Windows识别到这个分区。</span><br><span class="line">    hide (hd0,4)</span><br><span class="line">    # +1 可以认为是第一个扇区 ，即 boot sector</span><br><span class="line">    chainloader +1 </span><br><span class="line">    # 由于Windows的系统盘需要设置为活动（active）状态 ，并且 grub 默认会去检查该分区的文件系统</span><br><span class="line">    makeactive </span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h1 id="initrd"><a href="#initrd" class="headerlink" title="initrd"></a>initrd</h1><p>initrd 启动过程中提供所需要的最重要内核模块，以便系统启动过程顺利完成。</p>
<p>而需要 initrd 的原因：</p>
<ul>
<li>内核模块放置于 &#x2F;lib&#x2F;modules&#x2F;$(uname -r)&#x2F;kernel&#x2F;当中 ， 这些模块必须要根目录(&#x2F;)被挂在时才能够被读取。<ul>
<li>如果内核本身不具备磁盘的驱动程序时，时无法挂载根目录的，也没有办法取得驱动程序。</li>
<li>部分服务器的RAID驱动并没有集成到内核中，因此开机过程中会提示没有找到启动目录。</li>
</ul>
</li>
<li>initrd 可以将&#x2F;lib&#x2F;modules&#x2F;…内的启动过程中一定需要的模块打包成一个文件（文件名为initrd）。<ul>
<li>然后再启动时通过主机的int13 硬件功能 将该文件读取出来解压缩，并且initrd在内存内会仿真成根目录 。</li>
<li>由于虚拟文件系统（Initial RAM Disk） 主要包含磁盘与文件系统的模块，所以内核最后才能对实际硬盘进行根目录挂载 操作。  </li>
<li>initrd 内所包含的模块大多都与启动过程有关，而主要以文件系及硬盘模块（usb、SCSI等）为主的。</li>
<li>一般需要initrd的时刻为<ul>
<li>根目录所在的磁盘为 SATA 、 USB | SCSI 等连接接口</li>
<li>根目录所在文件系统为LVM 、 RAID 等特殊格式</li>
<li>根目录所在文件系统为非创痛LINUX “认识” 的文件系统</li>
<li>其他必须在内核加载时系统的模块</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="mkinitrd"><a href="#mkinitrd" class="headerlink" title="mkinitrd"></a>mkinitrd</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mkinitrd [-v] [--with=模块名称] initrd文件名 内核版本</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v 显示mkinitrd 运行过程</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--with 模块名称 ： 指模块的名字 ，不需要写完整路径</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">内核版本 ，当前的内核版本就写上 $(<span class="built_in">uname</span> -r)</span></span><br></pre></td></tr></table></figure>

<h1 id="测试安装-grub"><a href="#测试安装-grub" class="headerlink" title="测试安装 grub"></a>测试安装 grub</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">grub-install [--root-directory=DIR] INSTALL_DEVICE</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--root-directory 为设置实际目录。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用grub-install默认会将grub所有的文件都复制到/boot/grub/*。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果想要更改目录，则需要使用这个参数。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">INSTALL_DEVICE 为安装的设备代号</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">案例1 ： 将 grub 安装在目前系统的MBR下面</span> </span><br><span class="line">grub-install /dev/hda</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">案例2 ： /home.test 为独立的 /dev/sdb1 , 将grub安装到 /dev/sdb1</span></span><br><span class="line">grub-install --root-directory=/home.test /dev/sdb1</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">Probing devices to guess BIOS drives. This may take a long time.</span><br><span class="line">Installation finished. No error reported.</span><br><span class="line">This is the contents of the device map /home.test/boot/grub/device.map.</span><br><span class="line">Check if this is correct or not. If any of the lines is incorrect,</span><br><span class="line">fix it and re-run the script `grub-install&#x27;.</span><br><span class="line"></span><br><span class="line">(fd0)	/dev/fd0</span><br><span class="line">(hd0)	/dev/sda</span><br><span class="line">(hd1)	/dev/sdb</span><br><span class="line">-</span><br></pre></td></tr></table></figure>

<p>这个在两个硬盘上的第一个分区都装有grub ， 需要从第二块硬盘上面启动的时候，才能生效。</p>
<h2 id="第二块盘上面只有grub，如何快速进入系统"><a href="#第二块盘上面只有grub，如何快速进入系统" class="headerlink" title="第二块盘上面只有grub，如何快速进入系统"></a>第二块盘上面只有grub，如何快速进入系统</h2><p>因为第二快盘只有 grub ，开机启动只有grub shell ，是因为grub没有配置好所导致的问题，现在无法进入系统。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 正常情况下为：</span><br><span class="line"># 从有操作系统的磁盘启动 </span><br><span class="line"># Linux 显示 ： /dev/sda</span><br><span class="line"># grub 检测显示： hd0</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"># 故障情况</span><br><span class="line"># 修改启动顺序，从一块没有操作系统的磁盘启动</span><br><span class="line"># Linux 显示 ： /dev/sdb</span><br><span class="line"># grub 显示 ： hd0</span><br><span class="line"># 【正确的系统盘】在grub 显示为 ： hd1</span><br><span class="line"></span><br><span class="line">root (hd1,0)</span><br><span class="line"># kernel 参数中必须挂上root目录，否则系统无法启动 </span><br><span class="line">kernel/vmlinuz-2.6.32-696.el6.x86_64 ro root=UUID=4c170fc7-b150-4dde-8bb4-6987741f6fd1</span><br><span class="line"># 挂载内核模块</span><br><span class="line">initrd /initramfs-2.6.32-696.el6.x86_64.img</span><br><span class="line">boot</span><br></pre></td></tr></table></figure>

<h2 id="第二块盘上面的grub配置文件有误，如何快速进入系统"><a href="#第二块盘上面的grub配置文件有误，如何快速进入系统" class="headerlink" title="第二块盘上面的grub配置文件有误，如何快速进入系统"></a>第二块盘上面的grub配置文件有误，如何快速进入系统</h2><p>主要查看两点：</p>
<ul>
<li>路径（root ， kernel ， initrd）是否正确，是否选择有操作系统的boot sector</li>
<li>kernel 中是否有选中root目录。（这个有报错提示的）<ul>
<li>指定root目录三种方法：<ul>
<li>LABEL方法：前提是要设置了label ， root&#x3D;LABEL&#x3D;myRoot</li>
<li>UUID方法：前提是要知道UUID，root&#x3D;UUID&#x3D;…..</li>
<li>指定分区 ： 前提是要知道根目录在哪一个分区 ,root&#x3D;&#x2F;dev&#x2F;sda3</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>《鸟哥的Linux私房菜（第三版）》</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/1be89a35/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/1be89a35/" class="post-title-link" itemprop="url">内核学习笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-15 22:43:10" itemprop="dateCreated datePublished" datetime="2018-11-15T22:43:10+00:00">2018-11-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>内核即Kernel ， 控制主机的所有硬件并提供系统所有的功能。一般Linux启动过程是利用开机管理程序加载这个内核文件来检测硬件 ， 在内核加载合适的驱动程序后，系统才能够正常启动。</p>
<ul>
<li>内核（Kernel）是一个文件 ，通常放置在 &#x2F;boot&#x2F;vmlinuz 中 ，一台Linux中可以有多个内核文件，只是开机的时候仅加载其中一个而已。</li>
<li>内核模块（Kernel Module）通常是一些不常用的类似驱动程序的内容独立出内核，编译成模块，系统在运行过程中加载这个模块得到内核的支持。通常放在 &#x2F;lib&#x2F;modules&#x2F;$(uname -r)&#x2F;kernel&#x2F;当中。</li>
<li>内核是通过源代码(Source Code)编译而成的，内核是直接被读入内存当中的。</li>
</ul>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>《鸟哥的Linux私房菜（第三版）》</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/6fdfd9f8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/6fdfd9f8/" class="post-title-link" itemprop="url">设置NTP服务器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-10 22:05:53" itemprop="dateCreated datePublished" datetime="2018-11-10T22:05:53+00:00">2018-11-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>前些日子遇到google-authenticator验证失败，排查过程中发现 静态token能生效，然而动态的token却无法生效，经过一番的排查，锁定为时间问题，服务器上面的时间跟当前的时间偏差竟然达到10分钟的偏移，所以这个是导致动态token验证的主要原因。 因此，今天就记录ntp时间同步的相关操作，因为集群中没有设置ntp服务器（非常有必要建立NTP服务器），所以连接的NTP服务器，我这里选用 阿里云 的时间服务器。</p>
<ul>
<li>NTP &#x3D; 网络时间协议(Network Time Protocol)，它是用来同步网络中各个计算机的时间的协议</li>
</ul>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><ul>
<li>OS：CentOS 6.9</li>
</ul>
<h1 id="操作实例"><a href="#操作实例" class="headerlink" title="操作实例"></a>操作实例</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装ntp服务</span></span><br><span class="line">yum install ntp -y</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置 ntp 的主节点</span></span><br><span class="line">vim /etc/ntp.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---ntp.conf---#</span></span><br><span class="line">server ntp1.aliyun.com</span><br><span class="line">server ntp2.aliyun.com</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ntp 用到的端口是UDP 123 ， 因此防火墙拦截会导致ntp无法使用</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开启服务后，可以用netstat看该端口是否有运行</span></span><br><span class="line">netstat -lntup | grep 123</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看ntp运行状态</span></span><br><span class="line">watch ntpq -p</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一般需要等待20分钟左右，我这里6分钟就生效了。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">当服务器地址前面有 “*” 时 ， 表示正在使用该服务器做时间同步</span></span><br><span class="line">ntpstat</span><br></pre></td></tr></table></figure>

<h1 id="知识梳理"><a href="#知识梳理" class="headerlink" title="知识梳理"></a>知识梳理</h1><h2 id="标准时间"><a href="#标准时间" class="headerlink" title="标准时间"></a>标准时间</h2><p>1、美国中部时间：Central Standard Time (USA) UT-6:00<br>2、澳大利亚中部时间：Central Standard Time (Australia) UT+9:30<br>3、中国标准时间：China Standard Time UT+8:00<br>4、古巴标准时间：Cuba Standard Time UT-4:00</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>设置实例 ：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/quchunhui/p/7658853.html">https://www.cnblogs.com/quchunhui/p/7658853.html</a></li>
<li>设置实例 ：<a target="_blank" rel="noopener" href="https://blog.csdn.net/caodongfang126/article/details/79670636">https://blog.csdn.net/caodongfang126/article/details/79670636</a></li>
<li>NTP服务器官网 ：<a target="_blank" rel="noopener" href="http://www.pool.ntp.org/">http://www.pool.ntp.org/</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/930f6d91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/930f6d91/" class="post-title-link" itemprop="url">[待补充]expect脚本学习--实现自动化登录脚本</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-08 23:02:59" itemprop="dateCreated datePublished" datetime="2018-11-08T23:02:59+00:00">2018-11-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>今天看到很多自动ssh连接的脚本，免去输入密码，任何需要输入的shell都可以使用expect脚本解决，因此也必要学习一下。</p>
<h1 id="To-Do-list"><a href="#To-Do-list" class="headerlink" title="To-Do list"></a>To-Do list</h1><ul>
<li>自动生成otp脚本，demo.exp username , 免去输入 y</li>
</ul>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>expect实例讲解：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/lixigang/articles/4849527.html">http://www.cnblogs.com/lixigang/articles/4849527.html</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/fdcee059/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/fdcee059/" class="post-title-link" itemprop="url">[待补充]perl脚本学习</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-08 22:56:17" itemprop="dateCreated datePublished" datetime="2018-11-08T22:56:17+00:00">2018-11-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>今天看到一些大佬写的脚本竟然使用perl写的，故此需要简单记录一下学习笔记。</p>
<h1 id="To-Do-list"><a href="#To-Do-list" class="headerlink" title="To-Do list"></a>To-Do list</h1><ul>
<li>连接数据库，可以做到增删改查操作。</li>
<li>从其他服务器中抓取需要的信息。</li>
</ul>
<table>
<thead>
<tr>
<th align="center">服务器A</th>
<th align="center">服务器B</th>
</tr>
</thead>
<tbody><tr>
<td align="center">192.168.1.1</td>
<td align="center">192.168.1.2</td>
</tr>
<tr>
<td align="center">Token服务器</td>
<td align="center">Web后端服务器</td>
</tr>
<tr>
<td align="center">生成OTP代码</td>
<td align="center">呈现OTP代码</td>
</tr>
<tr>
<td align="center">接收B发送的请求，并呈现结果</td>
<td align="center">发送请求，并将获取的结果写入数据库</td>
</tr>
</tbody></table>
<h1 id="脚本的知识点"><a href="#脚本的知识点" class="headerlink" title="脚本的知识点"></a>脚本的知识点</h1><h2 id="数据库-DBI"><a href="#数据库-DBI" class="headerlink" title="数据库 DBI"></a>数据库 DBI</h2><h2 id="调用expect库"><a href="#调用expect库" class="headerlink" title="调用expect库"></a>调用expect库</h2><h2 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h2><h1 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h1><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/4026c435/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/4026c435/" class="post-title-link" itemprop="url">[待补充]Linux系统备份还原实例</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-07 23:17:12" itemprop="dateCreated datePublished" datetime="2018-11-07T23:17:12+00:00">2018-11-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>今天从书上看到Linux的系统备份相关知识，做一次记录。备份的重要性，在此就不讲了，只记录实战中所需要的命令知识与系统知识点。</p>
<h1 id="To-Do-list"><a href="#To-Do-list" class="headerlink" title="To-Do list"></a>To-Do list</h1><ul>
<li>指定备份策略 ： 周备份策略 ， 日备份策略 ，并写出相应的脚本</li>
<li>执行一遍Centos的备份操作</li>
<li>执行一遍Ubuntu的备份操作</li>
<li>执行一遍Centos的还原操作</li>
<li>执行一遍Ubuntu的还原操作</li>
</ul>
<h1 id="知识梳理"><a href="#知识梳理" class="headerlink" title="知识梳理"></a>知识梳理</h1><ul>
<li>操作系统中需要备份的目录</li>
<li>这里有用到 dd ， tar ， dump ，cpio 四种指令</li>
<li>两种备份方式： 完整备份（包含差异备份） 、 关键数据备份</li>
<li>针对备份频率的备份策略脚本</li>
</ul>
<h2 id="cpio"><a href="#cpio" class="headerlink" title="cpio"></a>cpio</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-o 将数据Copy 输出到文件或设备上</span><br><span class="line">-B 让默认的 Blocks 可以增加至 5120 bytes ， 默认的是 512 bytes</span><br><span class="line">-i 将数据自文件或设备复制到系统中</span><br><span class="line">-d 自动新建目录。使用cpio所备份的数据内容不见得会在同一层目录中，因此我们必须要让cpio再还原时可以新建新目录，此时就要 -d 参数的帮助</span><br><span class="line">-u 自动将较新的文件覆盖较旧的文件</span><br><span class="line">-t 需要配合 -i 参数，~~可用在查看以~~ cpio 新建的文件或设备的内容</span><br><span class="line">-v 让存储过程中，文件名可以在屏幕上显示</span><br><span class="line">-c 一种较新的 portable format 方式存储</span><br></pre></td></tr></table></figure>

<h2 id="需要备份的目录"><a href="#需要备份的目录" class="headerlink" title="需要备份的目录"></a>需要备份的目录</h2><table>
<thead>
<tr>
<th align="center">目录</th>
<th align="center">讲解</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&#x2F;etc&#x2F;passwd 、 &#x2F;etc&#x2F;shadow 、 &#x2F;etc&#x2F;group 、 &#x2F;etc&#x2F;gshadow 、 &#x2F;etc</td>
<td align="center">这些目录跟账户有关，而Linux中所有重要参数、配置参数都在&#x2F;etc&#x2F;下面保存。</td>
</tr>
<tr>
<td align="center">&#x2F;home</td>
<td align="center">用户的主要文件夹</td>
</tr>
<tr>
<td align="center">&#x2F;var&#x2F;spool&#x2F;mail</td>
<td align="center">邮件</td>
</tr>
<tr>
<td align="center">&#x2F;boot</td>
<td align="center">启动引导</td>
</tr>
<tr>
<td align="center">&#x2F;root</td>
<td align="center">不解释</td>
</tr>
<tr>
<td align="center">&#x2F;usr&#x2F;local</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">&#x2F;opt</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">&#x2F;src</td>
<td align="center"></td>
</tr>
</tbody></table>
<p>对于软件应用来说 ， 如果是默认安装 一般配置文件都在 &#x2F;etc下面 ，但是若为用户自行安装，则有可能在 &#x2F;usr&#x2F;local 下面。</p>
<p>而可以不需要备份的目录有：</p>
<table>
<thead>
<tr>
<th align="center">目录</th>
<th align="center">讲解</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&#x2F;dev</td>
<td align="center">设备信息</td>
</tr>
<tr>
<td align="center">&#x2F;proc</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">&#x2F;mnt,&#x2F;media</td>
<td align="center">如果没有挂载系统的东西，可以不用备份</td>
</tr>
<tr>
<td align="center">&#x2F;tmp</td>
<td align="center">就一个临时文件存放地</td>
</tr>
</tbody></table>
<h2 id="备份命令"><a href="#备份命令" class="headerlink" title="备份命令"></a>备份命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用 <span class="built_in">dd</span> 备份</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">假设 sda 是系统盘 ， sdb是移动硬盘，用于存放备份资料的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">因为 <span class="built_in">dd</span> 是读取扇区 ， 所以 sdb 这块磁盘可以不必格式化。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">缺点是非常慢</span></span><br><span class="line">dd if=/dev/sda of=/dev/sdb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">用<span class="built_in">dd</span>恢复</span></span><br><span class="line">dd if=/dev/sdb of=/dev/sda</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用 cpio 备份</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">假设存储设备为sata磁带机</span></span><br><span class="line">find / -print | cpio /backupdata/home.dump /home</span><br><span class="line">cpio -iduv &lt; /dev/st0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用dump备份</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">完整备份</span></span><br><span class="line">dump -0u -f /backupdata/home.dump /home</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">增量备份</span></span><br><span class="line">dump -1u -f /backupdata/home.dump.1 /home</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">用tar备份</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">tar --exclude /proc --exclude /mnt --exclude /tmp --exclude /backupdata -jcvp -f /backupdata/system.tar.bz2</span></span><br><span class="line"></span><br><span class="line">tar cvpzf system_backup.tar.gz / --exclude=/proc --exclude=/lost+found --exclude=/system_backup.tar.gz --exclude=/mnt --exclude=/sys</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">用tar恢复系统</span></span><br><span class="line">tar xvpfz system_backup.tar.gz -C /</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建备份时排除的目录</span></span><br><span class="line">mkdir proc</span><br><span class="line">mkdir lost+found</span><br><span class="line">mkdir mnt</span><br><span class="line">mkdir sys</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">/proc 权限：文件所有者：root群组：root 所有者：读取 执行 群组：读取 执行 其它：读取 执行</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">/lost+found 权限：文件所有者：root群组：root 所有者：读取 写入 执行 群组：读取 执行 其它：读取 执行</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">/mnt 权限：文件所有者：root群组：root 所有者：读取 写入 执行 群组：读取 执行 其它：读取 执行</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">/sys 权限：文件所有者：root群组：root 所有者：读取 写入 执行 群组：读取 执行 其它：读取 执行</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用rsync备份</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意目标分区的格式最好是NTFS、FAT、EXT之类的格式，避免遇到大于4G的文件无法备份的问题。</span></span><br><span class="line">rsync -Pa / /media/usb/backup_20170410 --exclude=/media/* --exclude=/sys/* --exclude=/proc/* --exclude=/mnt/* --exclude=/tmp/*</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用rsync恢复</span></span><br><span class="line">rsync -Pa /media/usb/backup_20170410 /</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h1><p>这里参照《鸟哥的Linux私房菜》写到的策略：</p>
<ol>
<li>主机硬件：使用一个独立的文件系统来存储备份数据，此文件系统挂载到&#x2F;backup</li>
<li>每日进行： 仅仅备份 MySql 的数据库</li>
<li>每周进行： 包括 &#x2F;home、&#x2F;var 、&#x2F;etc 、 &#x2F;boot 、 &#x2F;usr&#x2F;local 等目录与特殊服务的目录</li>
</ol>
<h2 id="每周备份脚本"><a href="#每周备份脚本" class="headerlink" title="每周备份脚本"></a>每周备份脚本</h2><h2 id="每日备份脚本"><a href="#每日备份脚本" class="headerlink" title="每日备份脚本"></a>每日备份脚本</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/e455ff7e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/e455ff7e/" class="post-title-link" itemprop="url">Vmware给Linux虚拟机热添加硬盘并创建LVM分区实例</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-11-07 22:46:14" itemprop="dateCreated datePublished" datetime="2018-11-07T22:46:14+00:00">2018-11-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>一般情况下，虚拟机肯定会有硬盘扩容的需求，而且大多数生产环境下，机器还不允许关机添加。目前遇到可以热添加的是Vmware的虚拟机，用的scsi硬盘，因此做一下操作记录，以便复习。</p>
<h1 id="操作记录"><a href="#操作记录" class="headerlink" title="操作记录"></a>操作记录</h1><p>在Vmware的控制面板上，添加scsi硬盘即可。</p>
<p>进入Linux系统则需要扫描scsi硬件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输入以下指令</span></span><br><span class="line">echo &quot;- - -&quot; &gt; /sys/class/scsi_host/host*/scan</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这里 - - - 之间有两个空格</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">host* 不会生效，目前不知道原因</span></span><br></pre></td></tr></table></figure>

<p>改进版扫描脚本v1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">hostNumber=0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">因为 scsi_host 文件夹下又33个host文件夹</span></span><br><span class="line">while [ $hostNumber -l 33]</span><br><span class="line">do</span><br><span class="line">    echo &quot;$hostNumber. host has been scaned.&quot;</span><br><span class="line">    echo &quot;- - -&quot; &gt; /sys/class/scsi_host/host$hostNumber/scan</span><br><span class="line">    hostNumber=$(( hostNumber + 1 ))</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>给脚本添加执行权限即可。</p>
<p>运行脚本后，扫描到新添加的硬盘 sdb ，接下来开始创建LVM分区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/sdb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---fdisk---</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建分区</span></span><br><span class="line">n</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">选择主分区</span></span><br><span class="line">p</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">分区编号，默认为1</span></span><br><span class="line">1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">起始扇区 ，默认即可</span></span><br><span class="line">回车</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">结束扇区，默认即可</span></span><br><span class="line">回车</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更改分区类型</span></span><br><span class="line">t</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">选择需要更改的分区</span></span><br><span class="line">1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">改为 LVM 类型</span></span><br><span class="line">8e</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写入分区表</span></span><br><span class="line">w</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---fdisk---</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建 pv</span></span><br><span class="line">pvcreate /dev/sdb1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建 vg</span></span><br><span class="line">vgcreate vg-data /dev/sdb1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建 lv</span></span><br><span class="line">lvcreate -n lv-data -l 100%VG vg-data</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">格式化lv</span></span><br><span class="line">mkfs.ext4 /dev/vg-data/lv-data</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">挂载lv</span></span><br><span class="line">mount /dev/vg-data/lv-data /data</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改 fstab 列表</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---fstab---</span></span><br><span class="line">/dev/mapper/vg-data-lv-data /data ext4 default 0 0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">---fstab---</span></span><br></pre></td></tr></table></figure>

<h1 id="补充知识点"><a href="#补充知识点" class="headerlink" title="补充知识点"></a>补充知识点</h1><h2 id="Linux系统SCSI磁盘扫描机制解析及命令详细介绍"><a href="#Linux系统SCSI磁盘扫描机制解析及命令详细介绍" class="headerlink" title="Linux系统SCSI磁盘扫描机制解析及命令详细介绍"></a>Linux系统SCSI磁盘扫描机制解析及命令详细介绍</h2><p>Linux系统提供多重机制以重新扫描SCSI总线并重认系统中加入的SCSI设备。<br>在2.4内核方案中，由于动态LUN扫描机制不具备一致性，往往需要中断I&#x2F;O。<br>在2.6内核里，LUN扫描有了显著改进并添加了动态LUN扫描机制。<br>Linux目前缺乏像drvconfig或ioscan那样允许动态SCSI通道重配的命令。</p>
<p>Linux主机对磁盘设备进行重新配置的方式包括：</p>
<ul>
<li>重启系统</li>
<li>卸载并重新加载HBA驱动模块</li>
<li>echo &#x2F;proc下的SCSI设备列表</li>
<li>通过&#x2F;sys下的属性设置运行SCSI扫描</li>
<li>通过HBA厂商脚本运行SCSI扫描</li>
</ul>
<h3 id="系统重启"><a href="#系统重启" class="headerlink" title="系统重启"></a>系统重启</h3><p>重启主机是检测新添加磁盘设备的可靠方式。在所有I&#x2F;O停止之后方可重启主机，同时静态或以模块方式连接磁盘驱动。系统初始化时会扫描PCI总线，因此挂载其上的SCSI host adapter会被扫描到，并生成一个PCI device。之后扫描软件会为该PCI device加载相应的驱动程序。加载SCSI host驱动时，其探测函数会初始化SCSI host，注册中断处理函数，最后调用scsi_scan_host函数扫描scsi host adapter所管理的所有scsi总线。</p>
<h3 id="重新加载HBA驱动"><a href="#重新加载HBA驱动" class="headerlink" title="重新加载HBA驱动"></a>重新加载HBA驱动</h3><p>通常情况下，HBA驱动在系统中以模块形式加载。从而允许模块被卸载并重新加载，在该过程中SCSI扫描函数得以调用。通常，在卸载HBA驱动之前，SCSI设备的所有I&#x2F;O都应该停止，卸载文件系统，多路径服务应用也需停止。如果有代理或HBA应用帮助模块，也应当中止。</p>
<p>命令示例：<br>例如，rac节点上某台服务器执行fdisk –l命令看不到共享磁盘，可尝试执行如下命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 卸载驱动</span></span><br><span class="line">modprobe -r lpfc</span><br><span class="line"><span class="comment"># 加载驱动</span></span><br><span class="line">modprobe lpfc</span><br></pre></td></tr></table></figure>

<h3 id="proc下SCSI扫描"><a href="#proc下SCSI扫描" class="headerlink" title="&#x2F;proc下SCSI扫描"></a>&#x2F;proc下SCSI扫描</h3><p>2.4内核中，&#x2F;proc文件系统提供了可用SCSI设备的列表。如果系统中SCSI设备重新配置，那么所有这些改变通过echo &#x2F;proc接口反映到SCSI设备中。添加一个设备，主机，channel，target ID，以及磁盘设备的LUN编号会被添加到&#x2F;proc&#x2F;scsi&#x2F;，需指定scsi编号。</p>
<p>命令示例：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0：主机ID</span></span><br><span class="line"><span class="comment"># 1：channel ID</span></span><br><span class="line"><span class="comment"># 2：target ID</span></span><br><span class="line"><span class="comment"># 3：LUN编号</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;scsi add-single-device 0 1 2 3&quot;</span> &gt; /proc/scsi/scsi</span><br></pre></td></tr></table></figure>

<p>该命令会将新磁盘设备添加到&#x2F;proc&#x2F;scsi&#x2F;scsi文件中。如果没有找到相应文件，需为&#x2F;dev路径下新增磁盘设备创建设备文件名。<br>如果要删除一个磁盘设备，使用适当的主机，channel，target ID及LUN编号运行如下格式命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 0：主机ID</span></span><br><span class="line"><span class="comment"># 1：channel ID</span></span><br><span class="line"><span class="comment"># 2：target ID</span></span><br><span class="line"><span class="comment"># 3：LUN编号</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;scsi remove-single-device 0 1 2 3&quot;</span> &gt; /proc/scsi/scsi</span><br></pre></td></tr></table></figure>

<h3 id="sys下SCSI扫描"><a href="#sys下SCSI扫描" class="headerlink" title="&#x2F;sys下SCSI扫描"></a>&#x2F;sys下SCSI扫描</h3><p>2.6内核中，HBA驱动将SCAN功能导出至&#x2F;sys目录下，可用来重新扫描该接口下的SCSI磁盘设备。命令如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /sys/class/scsi_host/host4/</span><br><span class="line"><span class="built_in">ls</span> -al scan</span><br><span class="line"><span class="built_in">echo</span> ‘- - -’ &gt; scan</span><br><span class="line"><span class="comment"># ‘- - -’代表channel，target和LUN编号。以上命令会导致hba4下所有channel，target以及可见LUN被扫描。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RHEL5 或SUSE10：</span></span><br><span class="line"><span class="built_in">echo</span> ‘- - -’ &gt; /sys/class/scsi_host/host0/scan</span><br><span class="line"><span class="comment">#/sys/class/scsi_host/ 下面有几个host 就扫描几次</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RHEL4 或SUSE9：</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt;&gt; /sys/class/scsi_host/host0/issue_lip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同样是/sys/class/scsi_host/ 下面有几个host 就执行几次</span></span><br><span class="line"><span class="built_in">echo</span> ‘- - -’ &gt;&gt; /sys/class/scsi_host/host0/scan</span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://www.jb51.net/LINUXjishu/67115.html">https://www.jb51.net/LINUXjishu/67115.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/34/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/34/">34</a><span class="page-number current">35</span><a class="page-number" href="/page/36/">36</a><span class="space">&hellip;</span><a class="page-number" href="/page/45/">45</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/36/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Rohman.Zhu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":"light","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
