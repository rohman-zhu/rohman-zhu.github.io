<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="诺曼实验室">
<meta property="og:url" content="http://github.com/rohman-zhu/page/6/index.html">
<meta property="og:site_name" content="诺曼实验室">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Rohman.Zhu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://github.com/rohman-zhu/page/6/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh_cn","comments":"","permalink":"","path":"page/6/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>诺曼实验室</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">诺曼实验室</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Rohman.Zhu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">450</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">40</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">148</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/cf950940/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/cf950940/" class="post-title-link" itemprop="url">油猴JavaScript脚本-B站牧场物语弹幕需求</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-05-05 00:21:04" itemprop="dateCreated datePublished" datetime="2024-05-05T00:21:04+00:00">2024-05-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:49" itemprop="dateModified" datetime="2024-12-22T05:27:49+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/default/" itemprop="url" rel="index"><span itemprop="name">default</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="需求说明"><a href="#需求说明" class="headerlink" title="需求说明"></a>需求说明</h1><p>B站有一个弹幕游戏，叫牧场物语，可以通过弹幕来进行喂鸡、收货、寻宝等动作；于是就想做一个自动点击操作的脚本；现有的技术能力有两种：</p>
<ol>
<li>python+selenium；</li>
<li>JavaScript+油猴插件；</li>
</ol>
<p>方案1已经挑战过了，现在来试试方案2；</p>
<h1 id="代码记录"><a href="#代码记录" class="headerlink" title="代码记录"></a>代码记录</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         牧场物语-喂食-收取-寻宝一条龙</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      2024-05-04</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        https://live.bilibili.com/21510733?live_from=84001&amp;spm_id_from=333.337.search-card.all.click</span></span><br><span class="line"><span class="comment">// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;【TESTING！！】Start to handle script.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> index=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> timer;</span><br><span class="line">    <span class="comment">//timer =setInterval(function()&#123; var lock = getlock(); if(lock == 0)&#123;setval();clearInterval(timer)&#125; &#125;,500)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Global VAR</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">delay</span>(<span class="params">x</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">111</span>);</span><br><span class="line">                <span class="title function_">resolve</span>(x);</span><br><span class="line">            &#125;,<span class="number">2000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">WS</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Script Work]Ready to WS&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="variable constant_">DM</span>=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;textarea&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="variable constant_">SENDBUTTON</span>=<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;button[class=&#x27;bl-button live-skin-highlight-button-bg live-skin-button-text bl-button--primary bl-button--small&#x27;]&quot;</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable constant_">DM</span>.<span class="property">value</span>=<span class="string">&quot;喂食&quot;</span>;</span><br><span class="line">        <span class="variable constant_">DM</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;input&#x27;</span>));</span><br><span class="line">        <span class="variable constant_">SENDBUTTON</span>.<span class="property">style</span>.<span class="property">backgroundColor</span>=<span class="string">&quot;Aqua&quot;</span>;</span><br><span class="line">        <span class="variable constant_">SENDBUTTON</span>.<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Script Work]WS completed.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">SQ</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Script Work]Ready to SQ&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="variable constant_">DM</span>=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;textarea&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="variable constant_">SENDBUTTON</span>=<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;button[class=&#x27;bl-button live-skin-highlight-button-bg live-skin-button-text bl-button--primary bl-button--small&#x27;]&quot;</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable constant_">DM</span>.<span class="property">value</span>=<span class="string">&quot;收取&quot;</span>;</span><br><span class="line">        <span class="variable constant_">DM</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;input&#x27;</span>));</span><br><span class="line">        <span class="variable constant_">SENDBUTTON</span>.<span class="property">style</span>.<span class="property">backgroundColor</span>=<span class="string">&quot;Lime&quot;</span>;</span><br><span class="line">        <span class="variable constant_">SENDBUTTON</span>.<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Script Work]SQ completed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">XB</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Script Work]Ready to XB&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="variable constant_">DM</span>=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;textarea&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="variable constant_">SENDBUTTON</span>=<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;button[class=&#x27;bl-button live-skin-highlight-button-bg live-skin-button-text bl-button--primary bl-button--small&#x27;]&quot;</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//var DM=document.querySelector(&quot;textarea&quot;);</span></span><br><span class="line">        <span class="comment">//DM.click();</span></span><br><span class="line">        <span class="variable constant_">DM</span>.<span class="property">value</span>=<span class="string">&quot;寻宝&quot;</span>;</span><br><span class="line">        <span class="variable constant_">DM</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;input&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//var SENDB=document.querySelectorAll(&quot;button[class=&#x27;bl-button live-skin-highlight-button-bg live-skin-button-text bl-button--primary bl-button--small&#x27;]&quot;)[0];</span></span><br><span class="line">        <span class="variable constant_">SENDBUTTON</span>.<span class="property">style</span>.<span class="property">backgroundColor</span>=<span class="string">&quot;yellow&quot;</span>;</span><br><span class="line">            <span class="comment">//DM.value=&quot;寻宝&quot;;</span></span><br><span class="line"></span><br><span class="line">        <span class="variable constant_">SENDBUTTON</span>.<span class="title function_">click</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Script Work]XB completed.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">DY</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Script Work]Ready to XB&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="variable constant_">DM</span>=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;textarea&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="variable constant_">SENDBUTTON</span>=<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;button[class=&#x27;bl-button live-skin-highlight-button-bg live-skin-button-text bl-button--primary bl-button--small&#x27;]&quot;</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//var DM=document.querySelector(&quot;textarea&quot;);</span></span><br><span class="line">        <span class="comment">//DM.click();</span></span><br><span class="line">        <span class="variable constant_">DM</span>.<span class="property">value</span>=<span class="string">&quot;d1&quot;</span>;</span><br><span class="line">        <span class="variable constant_">DM</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;input&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//var SENDB=document.querySelectorAll(&quot;button[class=&#x27;bl-button live-skin-highlight-button-bg live-skin-button-text bl-button--primary bl-button--small&#x27;]&quot;)[0];</span></span><br><span class="line">        <span class="variable constant_">SENDBUTTON</span>.<span class="property">style</span>.<span class="property">backgroundColor</span>=<span class="string">&quot;yellow&quot;</span>;</span><br><span class="line">            <span class="comment">//DM.value=&quot;寻宝&quot;;</span></span><br><span class="line"></span><br><span class="line">        <span class="variable constant_">SENDBUTTON</span>.<span class="title function_">click</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Script Work]XB completed.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="variable constant_">WS</span>,<span class="number">2000</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="variable constant_">SQ</span>,<span class="number">8000</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="variable constant_">XB</span>,<span class="number">18000</span>);</span><br><span class="line">    <span class="comment">//setTimeout(DY,18000);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//200s</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123; location.<span class="title function_">reload</span>();&#125;,<span class="number">202000</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h2 id="注意点，注意坑！"><a href="#注意点，注意坑！" class="headerlink" title="注意点，注意坑！"></a>注意点，注意坑！</h2><ol>
<li>查找元素的方法为 dom 对象以及其对应的方法，比如 document.querySelector(“标签或者元素”)；</li>
<li>注意大小写！JavaScript是区分大小写的，这个与powershell脚本不同；</li>
<li>DOM的querySelectorAll方法，返回的是数组，所以需要引用该数组对象的第一个；</li>
<li>setTimeout延时函数有毒，是异步执行的，所以写延时函数需要注意网页加载时间；</li>
<li>匿名函数表示方法 ()&#x3D;&gt;{} ;</li>
<li>页面刷新 location.reload();</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/de3b0569/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/de3b0569/" class="post-title-link" itemprop="url">HPE-SAN存储热备盘比例</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-05-04 23:39:36" itemprop="dateCreated datePublished" datetime="2024-05-04T23:39:36+00:00">2024-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:47" itemprop="dateModified" datetime="2024-12-22T05:27:47+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">服务器与存储</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">存储</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/SAN%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">SAN存储</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="背景说明"><a href="#背景说明" class="headerlink" title="背景说明"></a>背景说明</h1><p>做SAN存储扩容时，需要供应商做扩容方案。对应的硬件所堆积出来的硬件可用容量到底怎么计算的？这里面有几个问题：</p>
<ol>
<li>裸容量是多少？</li>
<li>可用容量是多少？</li>
<li>热备盘比例是多少？</li>
</ol>
<h1 id="可查资料"><a href="#可查资料" class="headerlink" title="可查资料"></a>可查资料</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Spare rate</span><br><span class="line">A key parameter in the spare policy is the spare rate. The spare rate is a target amount of space to set aside for sparing expressed relative to the number of disks of a given type in the system. A spare rate of 24, for example, sets target spare space equal to the size of one drive for every 24 drives in the array.</span><br><span class="line">The spare rate is defined based on the hardware configuration in the array as follows:</span><br><span class="line">• Spare rate = 40 if there are any magazines present in the array (e.g., 10,000)</span><br><span class="line">• Spare rate = 24 for all others such as 7400/7400c, 7450/7450c, etc.</span><br><span class="line"></span><br><span class="line">Sparing algorithms defined</span><br><span class="line">The spare option is set for the entire array and applied to each disk type (SSD, FC, NL) in the following way.</span><br><span class="line">• Default: Roughly 2.5 percent with minimums</span><br><span class="line">Small configurations (e.g., 7000’s with less than 48 disks, 10000’s with less than 80 disks) have a spare space target equal to the size of two of the largest drives of the type being spared.</span><br><span class="line">• Minimal: Roughly 2.5 percent without minimums</span><br><span class="line">Minimal is the same as default except for small configurations. When the configuration is small, minimal will only set aside spare space equal to one of the largest drives (compared to two for default) of the type being sized.</span><br><span class="line">• Maximal: One disk’s worth in every cage</span><br><span class="line">Spare space is calculated as the space of the largest drive of the drive type being sized for each disk cage.</span><br><span class="line">• Custom: Implemented manually by the administrator using the createspare, showspare, and removespare commands.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>默认比例为 2.5%；最大比例为 12%；</p>
</blockquote>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://community.hpe.com/t5/hpe-3par-storserv-storage/check-spare-capacity-on-disk-driver/td-p/7085333">https://community.hpe.com/t5/hpe-3par-storserv-storage/check-spare-capacity-on-disk-driver/td-p/7085333</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/1f81934e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/1f81934e/" class="post-title-link" itemprop="url">HPE SAN存储常用指令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-05-03 17:54:31" itemprop="dateCreated datePublished" datetime="2024-05-03T17:54:31+00:00">2024-05-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:47" itemprop="dateModified" datetime="2024-12-22T05:27:47+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">服务器与存储</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">存储</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AD%98%E5%82%A8/%E5%AD%98%E5%82%A8/SAN%E5%AD%98%E5%82%A8/" itemprop="url" rel="index"><span itemprop="name">SAN存储</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="常用指令集"><a href="#常用指令集" class="headerlink" title="常用指令集"></a>常用指令集</h1><h2 id="查询类"><a href="#查询类" class="headerlink" title="查询类"></a>查询类</h2><h3 id="查询后端存储端口流量"><a href="#查询后端存储端口流量" class="headerlink" title="查询后端存储端口流量"></a>查询后端存储端口流量</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">statport -disk -ni</span><br></pre></td></tr></table></figure>

<h3 id="查询盘笼状态"><a href="#查询盘笼状态" class="headerlink" title="查询盘笼状态"></a>查询盘笼状态</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showcage</span><br></pre></td></tr></table></figure>

<h3 id="查询-PD-状态，即硬盘状态"><a href="#查询-PD-状态，即硬盘状态" class="headerlink" title="查询 PD 状态，即硬盘状态"></a>查询 PD 状态，即硬盘状态</h3><p>会显示该硬盘的总容量、使用量、可用容量、热备空间；</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showpd -c</span><br></pre></td></tr></table></figure>

<h3 id="查询系统信息"><a href="#查询系统信息" class="headerlink" title="查询系统信息"></a>查询系统信息</h3><p>序列号、总容量、已分配容量、空闲容量；</p>
<blockquote>
<p>注意精简置备带来的影响！</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showsys -d</span><br></pre></td></tr></table></figure>

<h3 id="查询CPG策略"><a href="#查询CPG策略" class="headerlink" title="查询CPG策略"></a>查询CPG策略</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showcpg</span><br></pre></td></tr></table></figure>

<h3 id="查询CPG对应的容量分配"><a href="#查询CPG对应的容量分配" class="headerlink" title="查询CPG对应的容量分配"></a>查询CPG对应的容量分配</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showspace -cpg [CPG_NAME]</span><br></pre></td></tr></table></figure>

<h3 id="查询任务"><a href="#查询任务" class="headerlink" title="查询任务"></a>查询任务</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">showtask</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询具体任务信息</span></span><br><span class="line">showtask -d [PID]</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/7b93299d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/7b93299d/" class="post-title-link" itemprop="url">Windows Server 创建计划任务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-05-03 16:08:26" itemprop="dateCreated datePublished" datetime="2024-05-03T16:08:26+00:00">2024-05-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-22 14:05:09" itemprop="dateModified" datetime="2025-06-22T14:05:09+00:00">2025-06-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows-Server/" itemprop="url" rel="index"><span itemprop="name">Windows Server</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows-Server/Powershell/" itemprop="url" rel="index"><span itemprop="name">Powershell</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h1><p>任务1：创建自动化任务，到指定时间自动运行脚本；<br>任务2：通过远程下发指令，时间自动化创建自动任务；</p>
<h1 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h1><h2 id="任务1操作实例-CLI操作界面"><a href="#任务1操作实例-CLI操作界面" class="headerlink" title="任务1操作实例-CLI操作界面"></a>任务1操作实例-CLI操作界面</h2><p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/powershell/module/psscheduledjob/register-scheduledjob?view=powershell-5.1">https://learn.microsoft.com/zh-cn/powershell/module/psscheduledjob/register-scheduledjob?view=powershell-5.1</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/powershell/module/scheduledtasks/new-scheduledtask?view=winserver2012r2-ps">https://learn.microsoft.com/en-us/powershell/module/scheduledtasks/new-scheduledtask?view=winserver2012r2-ps</a></li>
</ol>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 叫什么：一个名为 TEST 的自动任务</span></span><br><span class="line"><span class="variable">$TASKNAME</span>=<span class="string">&quot;TEST&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 干什么：并执行 test.ps1 脚本</span></span><br><span class="line"><span class="variable">$TESTSCRIPT</span>=<span class="string">&quot;C:\test.ps1&quot;</span>;</span><br><span class="line"><span class="variable">$ACTION</span>=<span class="built_in">New-ScheduledTaskAction</span> <span class="literal">-Execute</span> <span class="string">&quot;Powershell&quot;</span> <span class="literal">-Argument</span> <span class="variable">$TESTCRIPT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 什么时候做：在每周三，晚上7:30执行；</span></span><br><span class="line"><span class="variable">$JOBTRIGGER</span>=<span class="built_in">New-JobTrigger</span> <span class="literal">-Weekly</span> <span class="literal">-At</span> <span class="string">&quot;9:00 PM&quot;</span> <span class="literal">-DaysOfWeek</span> Wednesday <span class="literal">-WeeksInterval</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 谁：拥有最高权限</span></span><br><span class="line"><span class="comment"># 有啥注意事项：无论有没有用户登录，都执行</span></span><br><span class="line"><span class="variable">$PRINCIPAL</span>=<span class="built_in">New-ScheduledTaskPrincipal</span> <span class="literal">-UserId</span> [<span class="type">USER</span>] <span class="literal">-LogonType</span> S4U</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建任务信息</span></span><br><span class="line"><span class="variable">$SCHEDULEDTASKOBJECT</span>=<span class="built_in">New-ScheduledTask</span> <span class="literal">-Action</span> <span class="variable">$ACTION</span> <span class="literal">-Trigger</span> <span class="variable">$JOBTRIGGER</span> <span class="literal">-Principal</span> <span class="variable">$PRINCIPAL</span></span><br><span class="line"><span class="comment"># 注册任务</span></span><br><span class="line"><span class="built_in">Register-ScheduledTask</span> <span class="literal">-TaskName</span> <span class="variable">$TASKNAME</span> <span class="literal">-InputObject</span> [<span class="type">SchedledTaskObjectName</span>];</span><br></pre></td></tr></table></figure>


<h2 id="任务1操作实例-GUI操作界面"><a href="#任务1操作实例-GUI操作界面" class="headerlink" title="任务1操作实例-GUI操作界面"></a>任务1操作实例-GUI操作界面</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lishidefengchen/p/4381565.html">https://www.cnblogs.com/lishidefengchen/p/4381565.html</a></p>
<p>环境说明:</p>
<ol>
<li>Powershell 目录：C:\Windows\SysWOW64\WindowsPowerShell\v1.0\PowerShell.exe;</li>
<li>脚本位置：C:\test.ps1;</li>
</ol>
<h3 id="运行“任务计划程序”"><a href="#运行“任务计划程序”" class="headerlink" title="运行“任务计划程序”"></a>运行“任务计划程序”</h3><ol>
<li>windows + R;</li>
<li>输入 taskschd.msc;</li>
</ol>
<h3 id="创建任务"><a href="#创建任务" class="headerlink" title="创建任务"></a>创建任务</h3><p>常规页面：</p>
<ol>
<li>填写任务名称；</li>
<li>勾选“不敢用户是否登录都要运行”</li>
<li>勾选“使用最高权限运行”；【如果有涉及提权操作，则需要勾选】</li>
<li>配置选择为对应的OS版本；</li>
</ol>
<p>触发器页面：</p>
<ol>
<li>新建；</li>
<li>设置自动执行的频率与时间；</li>
</ol>
<p>操作页面：</p>
<ol>
<li>操作，选择“启动程序”；</li>
<li>程序或脚本，输入“powershell”或者Powershell的绝对路径“C:\Windows\SysWOW64\WindowsPowerShell\v1.0\PowerShell.exe”；</li>
<li>添加参数（可选）,输入脚本的绝对路径，用英文状态的双引号包裹；</li>
</ol>
<p>点击确定；</p>
<h3 id="如何DEBUG"><a href="#如何DEBUG" class="headerlink" title="如何DEBUG"></a>如何DEBUG</h3><p>有可能任务运行会失败或者未按预期执行，可以选中任务，点击运行后，可以在“历史History”标签页中看到执行情况。<br>不过此时获取的信息还是比较有限，所以可以在脚本中增加 Start-Transcript 与 Stop-Transcript 指令，检查执行情况。</p>
<h1 id="TASK-LOGON-TYPE-类型"><a href="#TASK-LOGON-TYPE-类型" class="headerlink" title="TASK_LOGON_TYPE 类型"></a>TASK_LOGON_TYPE 类型</h1><p>参考: <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/api/taskschd/ne-taskschd-task_logon_type">https://learn.microsoft.com/en-us/windows/win32/api/taskschd/ne-taskschd-task_logon_type</a></p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">typedef <span class="class"><span class="keyword">enum</span> _<span class="title">TASK_LOGON_TYPE</span></span> &#123;</span><br><span class="line">  TASK_LOGON_NONE = <span class="number">0</span>,</span><br><span class="line">  TASK_LOGON_PASSWORD = <span class="number">1</span>,</span><br><span class="line">  TASK_LOGON_S4U = <span class="number">2</span>,</span><br><span class="line">  TASK_LOGON_INTERACTIVE_TOKEN = <span class="number">3</span>,</span><br><span class="line">  TASK_LOGON_GROUP = <span class="number">4</span>,</span><br><span class="line">  TASK_LOGON_SERVICE_ACCOUNT = <span class="number">5</span>,</span><br><span class="line">  TASK_LOGON_INTERACTIVE_TOKEN_OR_PASSWORD = <span class="number">6</span></span><br><span class="line">&#125; TASK_LOGON_TYPE;</span><br></pre></td></tr></table></figure>

<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">TASK_LOGON_NONE</span><br><span class="line">Value: <span class="number">0</span></span><br><span class="line">The logon method is not specified. Used <span class="keyword">for</span> non<span class="literal">-NT</span> credentials.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TASK_LOGON_PASSWORD</span><br><span class="line">Value: <span class="number">1</span></span><br><span class="line">Use a password <span class="keyword">for</span> logging on the user. The password must be supplied at registration time.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TASK_LOGON_S4U</span><br><span class="line">Value: <span class="number">2</span></span><br><span class="line">The service will log the user on <span class="keyword">using</span> Service For User (S4U), and the task will run in a non-interactive desktop. When an S4U logon is used, no password is stored by the system and there is no access to either the network or to encrypted files.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TASK_LOGON_INTERACTIVE_TOKEN</span><br><span class="line">Value: <span class="number">3</span></span><br><span class="line">User must already be logged on. The task will be run only <span class="keyword">in</span> an existing interactive session.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TASK_LOGON_GROUP</span><br><span class="line">Value: <span class="number">4</span></span><br><span class="line"><span class="built_in">Group</span> activation. The groupId field specifies the <span class="built_in">group</span>.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TASK_LOGON_SERVICE_ACCOUNT</span><br><span class="line">Value: <span class="number">5</span></span><br><span class="line">Indicates that a Local System, Local Service, or Network Service account is being used as a security context to run the task.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TASK_LOGON_INTERACTIVE_TOKEN_OR_PASSWORD</span><br><span class="line">Value: <span class="number">6</span></span><br><span class="line">Not <span class="keyword">in</span> use; currently identical to TASK_LOGON_PASSWORD.</span><br><span class="line"></span><br><span class="line">Windows <span class="number">10</span>, version <span class="number">1511</span>, Windows <span class="number">10</span>, version <span class="number">1507</span>, Windows <span class="number">8.1</span>, Windows Server <span class="number">2012</span> R2, Windows <span class="number">8</span>, Windows Server <span class="number">2012</span>, Windows Vista and Windows Server <span class="number">2008</span>:  First use the interactive token. <span class="keyword">If</span> the user is not logged on (no interactive token is available), then the password is used. The password must be specified when a task is registered. This flag is not recommended <span class="keyword">for</span> new tasks because it is less reliable than TASK_LOGON_PASSWORD.</span><br><span class="line"></span><br></pre></td></tr></table></figure>








      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/d5bff2f1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/d5bff2f1/" class="post-title-link" itemprop="url">待补充-Windows Server 通过NTDLL设置注册表权限</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-04-23 00:49:16" itemprop="dateCreated datePublished" datetime="2024-04-23T00:49:16+00:00">2024-04-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows-Server/" itemprop="url" rel="index"><span itemprop="name">Windows Server</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="场景说明"><a href="#场景说明" class="headerlink" title="场景说明"></a>场景说明</h1><p>一般在重置 RDS 120天许可会用到，需要删除GracePeriod 注册表才可以恢复120天试用期；但是直接使用Powershell的Remove-Item属性是无法完成这个操作的，必须提权。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/31ea1e9e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/31ea1e9e/" class="post-title-link" itemprop="url">Windows Server  安装其他语言包</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-04-22 16:44:54" itemprop="dateCreated datePublished" datetime="2024-04-22T16:44:54+00:00">2024-04-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows-Server/" itemprop="url" rel="index"><span itemprop="name">Windows Server</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><ol>
<li>下载语言包；</li>
<li>将所需的语言cab包传入目标服务器；</li>
<li>运行lpksetup.exe,安装对应的补丁包；</li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.dell.com/support/kbdoc/zh-cn/000220901/windows-server-2022%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E8%AF%AD%E8%A8%80%E5%8C%85">https://www.dell.com/support/kbdoc/zh-cn/000220901/windows-server-2022%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E8%AF%AD%E8%A8%80%E5%8C%85</a><br><a target="_blank" rel="noopener" href="https://netshopisp.medium.com/how-to-install-language-pack-on-windows-server-2019-8d477d8c3c2e">https://netshopisp.medium.com/how-to-install-language-pack-on-windows-server-2019-8d477d8c3c2e</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/e83d3b1f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/e83d3b1f/" class="post-title-link" itemprop="url">Windows-Server-RDSH初始化清单</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-04-18 19:54:05" itemprop="dateCreated datePublished" datetime="2024-04-18T19:54:05+00:00">2024-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/Horizon-View/" itemprop="url" rel="index"><span itemprop="name">Horizon View</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>RDSH(Remote Desktop Session Host)，用于发布APP给到用户，需要做一些初始化的操作，以及安装一些必要的软件。</p>
<h1 id="确认需求"><a href="#确认需求" class="headerlink" title="确认需求"></a>确认需求</h1><p>比如通过RDSH发布的浏览器或者SSH客户端，用于网页访问、SSH访问；</p>
<h2 id="应用清单"><a href="#应用清单" class="headerlink" title="应用清单"></a>应用清单</h2><table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">版本</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Chrome</td>
<td align="center">最新版本</td>
<td align="center">可以用msi包，通过WINRM下发指令安装</td>
</tr>
<tr>
<td align="center">Firefox</td>
<td align="center">最新版本</td>
<td align="center">作为Chrome的备用软件，也可以远程安装</td>
</tr>
<tr>
<td align="center">杀毒软件</td>
<td align="center"></td>
<td align="center">避免用户自行上传恶意包，导致RDSH故障</td>
</tr>
<tr>
<td align="center">XSHELL</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">Putty</td>
<td align="center"></td>
<td align="center">作为xshell的备用软件</td>
</tr>
<tr>
<td align="center">Xterm</td>
<td align="center"></td>
<td align="center">作为xshell的备用软件，可以打开X Desktop应用</td>
</tr>
<tr>
<td align="center">VMware Horizon View Agent</td>
<td align="center">有版本关联要求，一般安装稳定版本</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">Remote desktop session hosts</td>
<td align="center"></td>
<td align="center">120天限制</td>
</tr>
</tbody></table>
<h2 id="权限与组策略调整"><a href="#权限与组策略调整" class="headerlink" title="权限与组策略调整"></a>权限与组策略调整</h2><h3 id="Chrome没有声音"><a href="#Chrome没有声音" class="headerlink" title="Chrome没有声音"></a>Chrome没有声音</h3><p>可以参照：<a target="_blank" rel="noopener" href="https://rohman-zhu.github.io/2022/10/16/RDSH%E4%B8%AD%E7%9A%84Chrome%E6%B2%A1%E6%9C%89%E5%A3%B0%E9%9F%B3/">https://rohman-zhu.github.io/2022/10/16/RDSH%E4%B8%AD%E7%9A%84Chrome%E6%B2%A1%E6%9C%89%E5%A3%B0%E9%9F%B3/</a></p>
<h3 id="Chrome下载目录"><a href="#Chrome下载目录" class="headerlink" title="Chrome下载目录"></a>Chrome下载目录</h3><ol>
<li>导入Chrome 组策略包；</li>
<li>设置下载路径： \[SAMBA 服务器地址]\路径${user_name}</li>
</ol>
<blockquote>
<p>${user_name}是一个变量，固定写法；</p>
</blockquote>
<h3 id="设置安全策略"><a href="#设置安全策略" class="headerlink" title="设置安全策略"></a>设置安全策略</h3><ol>
<li>隐藏驱动器；</li>
</ol>
<h3 id="设置C盘根目录权限"><a href="#设置C盘根目录权限" class="headerlink" title="设置C盘根目录权限"></a>设置C盘根目录权限</h3><p>一般可以访问RDSH的用户均是 Remote Desktop Users 组，因此对C盘根目录的NTFS权限可以设置 该组 为 <em>写入拒绝</em> 、 <em>读取内容拒绝</em> 权限；</p>
<blockquote>
<p>只有Windows 、 Program Files 、Program Files(x86) 目录无法设置；</p>
</blockquote>
<h2 id="运维相关"><a href="#运维相关" class="headerlink" title="运维相关"></a>运维相关</h2><h3 id="安装-PS-Windows-Update-模块"><a href="#安装-PS-Windows-Update-模块" class="headerlink" title="安装 PS Windows Update 模块"></a>安装 PS Windows Update 模块</h3><p>为了方便以后Windows 补丁安装；</p>
<h3 id="修改-WinRM-监听端口"><a href="#修改-WinRM-监听端口" class="headerlink" title="修改 WinRM 监听端口"></a>修改 WinRM 监听端口</h3><p>默认端口为5985，需要修改为一个不常用的端口；<br>其次要设置防火墙策略，避免被拦截。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/3fa89bd7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/3fa89bd7/" class="post-title-link" itemprop="url">Horizon-599故障</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-04-01 01:14:06" itemprop="dateCreated datePublished" datetime="2024-04-01T01:14:06+00:00">2024-04-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:47" itemprop="dateModified" datetime="2024-12-22T05:27:47+00:00">2024-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/" itemprop="url" rel="index"><span itemprop="name">VMware</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/VMware/Horizon-View/" itemprop="url" rel="index"><span itemprop="name">Horizon View</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="故障描述"><a href="#故障描述" class="headerlink" title="故障描述"></a>故障描述</h1><ol>
<li>连接服务器、安全服务器无法连接TCP-443；</li>
<li>连接 https:&#x2F;&#x2F;安全服务器 ，显示599；</li>
<li>连接服务器的日志（C:\ProgramData\VMware\VDM\log\xxx.log），显示 MEMORY-ALARM:physical memory use &#x3D; 97% ,[ws_perfmon]High memory use….</li>
</ol>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>直接原因：服务器内存已经用满，出现内存泄漏的情况；<br>根本原因：出现补丁更新，未重启；</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>重启服务器。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/3f099f5a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/3f099f5a/" class="post-title-link" itemprop="url">Powershell实例-远程安装补丁</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-04-01 00:49:57" itemprop="dateCreated datePublished" datetime="2024-04-01T00:49:57+00:00">2024-04-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-22 14:00:34" itemprop="dateModified" datetime="2025-06-22T14:00:34+00:00">2025-06-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows-Server/" itemprop="url" rel="index"><span itemprop="name">Windows Server</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows-Server/Powershell/" itemprop="url" rel="index"><span itemprop="name">Powershell</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="需求说明"><a href="#需求说明" class="headerlink" title="需求说明"></a>需求说明</h1><ol>
<li>给远端的服务器安装补丁；</li>
<li>检查是否需要重启；</li>
</ol>
<h1 id="实例脚本"><a href="#实例脚本" class="headerlink" title="实例脚本"></a>实例脚本</h1><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Date:2024-03-31</span></span><br><span class="line"><span class="comment"># Version : v2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Global Veriable</span></span><br><span class="line"><span class="variable">$WINRM_PORT</span>=<span class="number">5985</span>;</span><br><span class="line"><span class="comment"># Target Windows Update  inneed;</span></span><br><span class="line"><span class="variable">$TARGET_WUKB_ARRARY</span>=<span class="string">&quot;KB5035849&quot;</span>,<span class="string">&quot;KB5035849&quot;</span>;</span><br><span class="line"><span class="variable">$TARGETSERVER_List</span>=<span class="variable">$args</span>[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$null</span> <span class="operator">-eq</span> <span class="variable">$PSCREDENTIAL</span>)&#123;<span class="variable">$PSCREDENTIAL</span>=<span class="built_in">Get-Credential</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Get-Log</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$TYPE</span>,<span class="variable">$CONTENT</span>);</span><br><span class="line">    <span class="variable">$TIMESPAN1</span>=<span class="built_in">Get-Date</span> <span class="literal">-Format</span> <span class="string">&quot;yyyy-MM-dd&quot;</span>;</span><br><span class="line">    <span class="variable">$TIMESPAN2</span>=<span class="built_in">Get-Date</span> <span class="literal">-Format</span> <span class="string">&quot;HH:mm:ss&quot;</span>;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;[<span class="variable">$TIMESPAN1</span>][<span class="variable">$TIMESPAN2</span>][<span class="variable">$TYPE</span>]<span class="variable">$CONTENT</span>;&quot;</span>;</span><br><span class="line">    <span class="built_in">Add-Content</span> <span class="string">&quot;<span class="variable">$TYPE</span>.log&quot;</span> <span class="string">&quot;[<span class="variable">$TIMESPAN1</span>][<span class="variable">$TIMESPAN2</span>][<span class="variable">$TYPE</span>]<span class="variable">$CONTENT</span>;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check windows updates is installed</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Check-WindowsUpdate</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$TARGET_WUKB_ARRARY</span>,<span class="variable">$PSSESSION</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># </span></span><br><span class="line">    <span class="variable">$WU_CHECK_BLOCK</span>=&#123;</span><br><span class="line">        <span class="keyword">param</span>(<span class="variable">$TARGET_WUKB</span>);</span><br><span class="line">        <span class="variable">$INSTALL_FLAG</span>=<span class="variable">$TRUE</span>;</span><br><span class="line">        <span class="variable">$INSTALL_KB_CHECK</span>=<span class="built_in">Get-HotFix</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.HotFixID <span class="operator">-match</span> <span class="variable">$TARGET_WUKB</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$null</span> <span class="operator">-eq</span> <span class="variable">$INSTALL_KB_CHECK</span>)&#123;</span><br><span class="line">            <span class="variable">$INSTALL_FLAG</span>=<span class="variable">$FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$INSTALL_FLAG</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span> ;<span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$TARGET_WUKB_ARRARY</span>.Length;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="variable">$WU_PRE_CHECK_FLAG</span>=<span class="built_in">Invoke-Command</span> <span class="literal">-Session</span> <span class="variable">$PSSESSION</span> <span class="literal">-ArgumentList</span> <span class="variable">$TARGET_WUKB_ARRARY</span>[<span class="variable">$i</span>] <span class="literal">-ScriptBlock</span> <span class="variable">$WU_CHECK_BLOCK</span>;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$WU_PRE_CHECK_FLAG</span>)&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;#注意 ArgumentList 无法传递数组；2024-03-31，废案；</span></span><br><span class="line"><span class="comment">    $WU_CHECK=&#123;</span></span><br><span class="line"><span class="comment">        param($TARGET_WUKB_ARRARY);</span></span><br><span class="line"><span class="comment">        $INSTALL_FLAG=$FALSE;</span></span><br><span class="line"><span class="comment">        for($i = 0; $i -lt $TARGET_WUKB_ARRARY.Length;$i++)&#123;</span></span><br><span class="line"><span class="comment">            $ISINSTALLED=Get-HotFix | Where-Object &#123;$_.HotFixID -match $TARGET_WUKB_ARRARY[$i]&#125;;</span></span><br><span class="line"><span class="comment">            if($null -eq $ISINSTALLED)&#123;</span></span><br><span class="line"><span class="comment">                $INSTALL_FLAG=$TRUE;</span></span><br><span class="line"><span class="comment">                Write-Host &quot;$(hostname) need install $($TARGET_WUKB_ARRARY[$i]);&quot;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        return $INSTALL_FLAG;</span></span><br><span class="line"><span class="comment">    &#125;    </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    $READY_FLAG=Invoke-Command -Session $PSSESSION -ScriptBlock $WU_CHECK -ArgumentList $TARGET_WUKB_ARRARY;</span></span><br><span class="line"><span class="comment">    #&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$WU_PRE_CHECK_FLAG</span>)&#123;</span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$PSSESSION</span>.ComputerName) need to install windows update &quot;</span></span><br><span class="line">        <span class="built_in">Invoke-WuJob</span> <span class="literal">-ComputerName</span> <span class="variable">$PSSESSION</span>.ComputerName <span class="literal">-Script</span> &#123;<span class="built_in">Install-WindowsUpdate</span> <span class="literal">-AcceptAll</span> <span class="literal">-IgnoreReboot</span> | <span class="built_in">Out-File</span> C:\InstallWindows.log&#125; <span class="literal">-RunNow</span> <span class="literal">-Confirm</span>:<span class="variable">$FALSE</span> <span class="literal">-ErrorAction</span> Ignore;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INSTALL-WU&quot;</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$PSSESSION</span>.ComputerName) don&#x27;t need to intall <span class="variable">$TARGET_WUKB_ARRARY</span>&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check target windows server;</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Check-RebootStatus</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$PSSESSION</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$CHECK_REBOOT_BLOCK</span>=&#123;</span><br><span class="line">        <span class="comment">#$ISNEED_REBOOT=$FALSE;</span></span><br><span class="line">        <span class="variable">$ISNEED_REBOOT</span>=<span class="built_in">Get-Item</span> <span class="literal">-Path</span> <span class="string">&quot;HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update\RebootRequired&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$null</span> <span class="operator">-eq</span> <span class="variable">$ISNEED_REBOOT</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$FALSE</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$TRUE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$REBOOT_FLAG</span>=<span class="built_in">Invoke-Command</span> <span class="literal">-Session</span> <span class="variable">$PSSESSION</span> <span class="literal">-ScriptBlock</span> <span class="variable">$CHECK_REBOOT_BLOCK</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$REBOOT_FLAG</span>)&#123;</span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$PSSESSION</span>.ComputerName) need to reboot&quot;</span>;</span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;REBOOT&quot;</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$PSSESSION</span>.ComputerName)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Start check target server;</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Start-CheckTargetServer</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$TARGETSERVER_LIST_FILE</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Get-Content</span> <span class="variable">$TARGETSERVER_LIST_FILE</span> | <span class="built_in">ForEach-Object</span>&#123;</span><br><span class="line">        <span class="variable">$SERVERNAME</span>=<span class="variable">$_</span>.Trim();</span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Start connect to <span class="variable">$SERVERNAME</span> &quot;</span>;</span><br><span class="line">        <span class="variable">$SESSION</span>=<span class="built_in">New-PSSession</span> <span class="literal">-ComputerName</span> <span class="variable">$SERVERNAME</span> <span class="literal">-Port</span> <span class="variable">$WINRM_PORT</span> <span class="literal">-Credential</span> <span class="variable">$PSCREDENTIAL</span>;</span><br><span class="line"></span><br><span class="line">        Check<span class="literal">-WindowsUpdate</span> <span class="variable">$TARGET_WUKB_ARRARY</span> <span class="variable">$SESSION</span>;</span><br><span class="line">        Check<span class="literal">-RebootStatus</span> <span class="variable">$SESSION</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Start-CheckTargetServer</span> <span class="variable">$TARGETSERVER_List</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>Invoke-Command 传参：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/talentzemin/p/16976197.html">https://www.cnblogs.com/talentzemin/p/16976197.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/add0804a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/add0804a/" class="post-title-link" itemprop="url">Powershell脚本实例-检查域账户状态并删除禁用账户</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-31 01:00:28" itemprop="dateCreated datePublished" datetime="2024-03-31T01:00:28+00:00">2024-03-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-22 14:05:40" itemprop="dateModified" datetime="2025-06-22T14:05:40+00:00">2025-06-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows-Server/" itemprop="url" rel="index"><span itemprop="name">Windows Server</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows-Server/Powershell/" itemprop="url" rel="index"><span itemprop="name">Powershell</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><p>目标： 通过WMRM将指令下发至远端服务器，删除该服务器内无效的用户配置（AD账户已被禁用），以释放空间；</p>
<ol>
<li>获取远端服务器的用户配置信息列表，路径为 C:\Users\；检查目标账户是否为停用状态；</li>
<li>若为停用状态的账户，则下发指令删除配置文件；</li>
</ol>
<h1 id="脚本思路"><a href="#脚本思路" class="headerlink" title="脚本思路"></a>脚本思路</h1><ol>
<li>向远端获取该服务器的用户列表 : Get-ChildItem -Path “C:\Users”;</li>
<li>判断账户是否停用: $USER_INFOS&#x3D;net user $TARGET_USERNAME &#x2F;domain;$USER_INFOS[7] - match “No”;</li>
<li>删除用户配置；</li>
</ol>
<h1 id="脚本实例"><a href="#脚本实例" class="headerlink" title="脚本实例"></a>脚本实例</h1><h2 id="第一版本-v1"><a href="#第一版本-v1" class="headerlink" title="第一版本 :v1"></a>第一版本 :v1</h2><figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Date : 2024-3-30</span></span><br><span class="line"><span class="comment"># Version : v1</span></span><br><span class="line"><span class="comment">#requires -RunAsAdministrator</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Global veriable</span></span><br><span class="line"><span class="variable">$DOMAIN</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$TARGETSERVER_LIST</span>=<span class="variable">$args</span>[<span class="number">0</span>];</span><br><span class="line"><span class="variable">$WINRM_PORT</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$null</span> <span class="operator">-eq</span> <span class="variable">$PSCREDENTIAL</span>)&#123;<span class="variable">$PSCREDENTIAL</span>=<span class="built_in">Get-Credential</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Function Delete user profile</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Start-DelUserProfile</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$TARGET_USERNAME</span>,<span class="variable">$TARGET_SERVER_PSSESSION</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$DELUSERPROFILE_BLOCK</span>=&#123;</span><br><span class="line">        <span class="keyword">param</span>(<span class="variable">$TARGET_USERNAME</span>,<span class="variable">$DOMAIN</span>);</span><br><span class="line">        <span class="comment"># get user SID</span></span><br><span class="line">        <span class="variable">$USER_SID</span> = (<span class="built_in">New-Object</span> Security.Principal.NTAccount(<span class="variable">$DOMAIN</span>, <span class="variable">$TARGET_USERNAME</span>)).Translate([<span class="type">Security.Principal.SecurityIdentifier</span>]).Value;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Get-WmiObject</span> <span class="literal">-ClassName</span> Win32_UserProfile <span class="literal">-Filter</span> <span class="string">&quot;SID=&#x27;<span class="variable">$USER_SID</span>&#x27;&quot;</span> |</span><br><span class="line">        <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">            <span class="variable">$_</span>.Delete();</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;<span class="variable">$TARGET_USERNAME</span> &#x27;s profile dir has been deleted.&quot;</span></span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Invoke-Command</span> <span class="literal">-Session</span> <span class="variable">$TARGET_SERVER_PSSESSION</span> <span class="literal">-ScriptBlock</span> <span class="variable">$DELUSERPROFILE_BLOCK</span> <span class="literal">-ArgumentList</span> <span class="variable">$TARGET_USERNAME</span>,<span class="variable">$DOMAIN</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check target user status;</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Start-CheckUserStatus</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$TARGET_USERNAME</span>,<span class="variable">$TARGET_SERVER_PSSESSION</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Check on localfile</span></span><br><span class="line">    <span class="variable">$LOCAL_STATUS</span>=<span class="string">&quot;NULL&quot;</span>;</span><br><span class="line">    <span class="comment">## Disabled user file check.</span></span><br><span class="line">    <span class="variable">$ISVALID</span>=<span class="built_in">Get-Content</span> disabled<span class="literal">-user</span>.list | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span> <span class="operator">-like</span> <span class="string">&quot;<span class="variable">$TARGET_USERNAME</span>&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$null</span> <span class="operator">-eq</span> <span class="variable">$ISVALID</span>)&#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Target user : <span class="variable">$TARGET_USERNAME</span> , cannot be found on disbaled-user.list.&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Target user : <span class="variable">$TARGET_USERNAME</span> , was been found on disbaled-user.list.&quot;</span>;</span><br><span class="line">        <span class="variable">$LOCAL_STATUS</span>=<span class="string">&quot;DISABLED&quot;</span>;</span><br><span class="line">        <span class="built_in">Start-DelUserProfile</span> <span class="variable">$TARGET_USERNAME</span> <span class="variable">$TARGET_SERVER_PSSESSION</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ISVALID</span>=<span class="built_in">Get-Content</span> enabled<span class="literal">-user</span>.list | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span> <span class="operator">-like</span> <span class="string">&quot;<span class="variable">$TARGET_USERNAME</span>&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$null</span> <span class="operator">-eq</span> <span class="variable">$ISVALID</span>)&#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Target user : <span class="variable">$TARGET_USERNAME</span> , cannot be found on enabled-user.list.&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Target user : <span class="variable">$TARGET_USERNAME</span> , was been found on enabled-user.list.&quot;</span>;</span><br><span class="line">        <span class="variable">$LOCAL_STATUS</span>=<span class="string">&quot;ENABLED&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;NULL&quot;</span> <span class="operator">-match</span> <span class="variable">$LOCAL_STATUS</span>)&#123;</span><br><span class="line">        <span class="variable">$TARGET_USER_STATUS</span>=<span class="variable">$</span>(net user <span class="variable">$TARGET_USERNAME</span> /domain);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$TARGET_USER_STATUS</span>[<span class="number">7</span>] <span class="operator">-match</span> <span class="string">&quot;Yes&quot;</span>)&#123;</span><br><span class="line">            <span class="built_in">Add-Content</span> enabled<span class="literal">-user</span>.list <span class="variable">$TARGET_USERNAME</span>;</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;Target user : <span class="variable">$TARGET_USERNAME</span> was enabled , add to enabled-user.list.&quot;</span></span><br><span class="line">        &#125;<span class="keyword">elseif</span>(<span class="variable">$TARGET_USER_STATUS</span>[<span class="number">7</span>] <span class="operator">-match</span> <span class="string">&quot;No&quot;</span>)&#123;</span><br><span class="line">            <span class="built_in">Add-Content</span> disbaled<span class="literal">-user</span>.list <span class="variable">$TARGET_USERNAME</span>;</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">&quot;Target user : <span class="variable">$TARGET_USERNAME</span> was disabled , add to disabled-user.list.&quot;</span></span><br><span class="line">            <span class="built_in">Start-DelUserProfile</span> <span class="variable">$TARGET_USERNAME</span> <span class="variable">$TARGET_SERVER_PSSESSION</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Start current mission</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Start-InvokeDelUserProfil</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$TARGETSERVER_LIST_FILE</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Init local file</span></span><br><span class="line">    <span class="built_in">Add-Content</span> enabled<span class="literal">-user</span>.list <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="built_in">Add-Content</span> disabled<span class="literal">-user</span>.list <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Clear-Content</span> enabled<span class="literal">-user</span>.list;</span><br><span class="line">    <span class="built_in">Clear-Content</span> disbaled<span class="literal">-user</span>.list;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Start handle</span></span><br><span class="line">    <span class="built_in">Get-Content</span> <span class="variable">$TARGETSERVER_LIST_FILE</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">        <span class="variable">$TARGET_SERVERNAME</span>=<span class="variable">$_</span>.Trim();</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Start handle target server : <span class="variable">$TARGET_SERVERNAME</span> . &quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$TARGET_SERVER_PSSESSION</span>=<span class="built_in">New-PSSession</span> <span class="literal">-ComputerName</span> <span class="variable">$TARGET_SERVERNAME</span> <span class="literal">-Port</span> <span class="variable">$WINRM_PORT</span> <span class="literal">-Credential</span> <span class="variable">$PSCREDENTIAL</span>;</span><br><span class="line">        <span class="variable">$TARGET_USER_SET</span>=<span class="built_in">Invoke-Command</span> <span class="literal">-Session</span> <span class="variable">$TARGET_SERVER_PSSESSION</span> <span class="literal">-ScriptBlock</span> &#123;<span class="built_in">Get-ChildItem</span> <span class="string">&quot;C:\Users&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span> ;<span class="variable">$i</span> <span class="operator">-lt</span> <span class="variable">$TARGET_USER_SET</span>.Length ; <span class="variable">$i</span>++)&#123;</span><br><span class="line">            <span class="variable">$TARGET_USERNAME</span>=<span class="variable">$TARGET_USER_SET</span>[<span class="variable">$i</span>].Name;</span><br><span class="line">            <span class="built_in">Start-CheckUserStatus</span> <span class="variable">$TARGET_USERNAME</span> <span class="variable">$TARGET_SERVER_PSSESSION</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Archive user list;</span></span><br><span class="line">    <span class="variable">$TIMESPAN</span>=<span class="built_in">Get-Date</span> <span class="literal">-Format</span> <span class="string">&quot;yyyyMMdd-HHmm&quot;</span>;</span><br><span class="line">    <span class="built_in">Rename-Item</span> enabled<span class="literal">-user</span>.list enabeld<span class="literal">-user-</span><span class="variable">$TIMESPAN</span>.list;</span><br><span class="line">    <span class="built_in">Rename-Item</span> disbaled<span class="literal">-user</span>.list disabled<span class="literal">-user-</span><span class="variable">$TIMESPAN</span>.list;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="built_in">Start-InvokeDelUserProfil</span> <span class="variable">$TARGETSERVER_LIST</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="迭代升级版本-v2"><a href="#迭代升级版本-v2" class="headerlink" title="迭代升级版本 v2"></a>迭代升级版本 v2</h2><p>增加特性：账户状态为启用的，但是已经超过1年没有访问记录，则删除文件。</p>
<figure class="highlight ps1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;#</span></span><br><span class="line"><span class="comment">Date:2025-06-22</span></span><br><span class="line"><span class="comment">Version:v2</span></span><br><span class="line"><span class="comment">Description:</span></span><br><span class="line"><span class="comment">1. Remove user profile folder;</span></span><br><span class="line"><span class="comment">2. Remove Out of date folder which over 365day not access record;</span></span><br><span class="line"><span class="comment">#&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;# Global Variables#&gt;</span></span><br><span class="line"><span class="variable">$Global_Domain_Name</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$Gloabl_Winrm_Port</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$Global_Computer_Name_Index</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$Global_Out_of_Day</span>=<span class="number">365</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$null</span> <span class="operator">-eq</span> <span class="variable">$Global_Winrm_Credential</span>)&#123;<span class="variable">$Global_Winrm_Credential</span>=<span class="built_in">Get-Credential</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;# Log Function #&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Get-Log</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$LOGTYPE</span>,<span class="variable">$LOG_CONTENT_TEMP</span>);</span><br><span class="line">    <span class="variable">$CURRENT_PATH</span>=(<span class="built_in">Get-Location</span>).Path;</span><br><span class="line">    <span class="variable">$LOGFILE</span>=<span class="string">&quot;<span class="variable">$</span>(<span class="variable">$CURRENT_PATH</span>)\\runtime.log&quot;</span>;</span><br><span class="line">    <span class="variable">$LOG_CONTENT_FIN</span>=<span class="string">&quot;<span class="variable">$</span>(Get-Date -Format &quot;</span>[<span class="type">yyyy</span>-<span class="type">MM</span>-<span class="type">dd</span>][<span class="type">HH</span>:<span class="type">mm</span>:<span class="type">ss</span>]<span class="string">&quot;)[<span class="variable">$LOGTYPE</span>],<span class="variable">$LOG_CONTENT_TEMP</span>;&quot;</span>;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$LOGTYPE</span>):<span class="variable">$</span>(<span class="variable">$LOG_CONTENT_FIN</span>)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$null</span> <span class="operator">-eq</span> <span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$LOGFILE</span>))&#123;</span><br><span class="line">        <span class="built_in">Add-Content</span> <span class="variable">$LOGFILE</span> <span class="string">&quot;<span class="variable">$</span>(Get-Date -Format &quot;</span>[<span class="type">yyyy</span>-<span class="type">MM</span>-<span class="type">dd</span>][<span class="type">HH</span>:<span class="type">mm</span>:<span class="type">ss</span>]<span class="string">&quot;)[INFO],Start create log file;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Add-Content</span> <span class="variable">$LOGFILE</span> <span class="variable">$LOG_CONTENT_FIN</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查C盘剩余空间占比</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Get-DriverFreeSpcaeUsage</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$PS_SESSION</span>,<span class="variable">$DRIVER_NAME</span>)</span><br><span class="line"></span><br><span class="line">    <span class="variable">$CodeBlock</span>=&#123;</span><br><span class="line">        <span class="keyword">param</span>(<span class="variable">$DRIVER_NAME</span>)</span><br><span class="line">        <span class="variable">$Driver</span>=<span class="built_in">Get-PSDrive</span> <span class="literal">-Name</span> <span class="variable">$DRIVER_NAME</span>;</span><br><span class="line">        <span class="comment">#$Available_Space=$Driver.Free/$Driver.Used;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$Driver</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Driver</span>=<span class="variable">$</span>(<span class="built_in">Invoke-Command</span> <span class="literal">-Session</span> <span class="variable">$PS_SESSION</span> <span class="literal">-ScriptBlock</span> <span class="variable">$CodeBlock</span> <span class="literal">-ArgumentList</span> <span class="variable">$DRIVER_NAME</span>; );</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$PS_SESSION</span>.ComputerName) driver <span class="variable">$</span>(<span class="variable">$DRIVER_NAME</span>):\ Total Space: <span class="variable">$</span>((<span class="variable">$Driver</span>.Free + <span class="variable">$Driver</span>.Used))&quot;</span>;</span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$PS_SESSION</span>.ComputerName) driver <span class="variable">$</span>(<span class="variable">$DRIVER_NAME</span>):\ Used Space: <span class="variable">$</span>(<span class="variable">$Driver</span>.Used)&quot;</span>;</span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$PS_SESSION</span>.ComputerName) driver <span class="variable">$</span>(<span class="variable">$DRIVER_NAME</span>):\ Free Space: <span class="variable">$</span>(<span class="variable">$Driver</span>.Free)&quot;</span>;</span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$PS_SESSION</span>.ComputerName) driver <span class="variable">$</span>(<span class="variable">$DRIVER_NAME</span>):\ Free Space percentage: <span class="variable">$</span>(<span class="variable">$Driver</span>.Free/(<span class="variable">$Driver</span>.Free + <span class="variable">$Driver</span>.Used))&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$Free_Space_Usage</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;# Check account Function #&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Check-UserActive</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$USERNAME</span>);</span><br><span class="line">    <span class="variable">$IS_ACTIVE</span>=<span class="variable">$FALSE</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;[<span class="variable">$USERNAME</span>]Checking account status&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$CHECK_CONTENT</span>=<span class="variable">$</span>(net user <span class="variable">$USERNAME</span> /domain);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;[<span class="variable">$USERNAME</span>]CHECK_CONTENT:<span class="variable">$</span>(<span class="variable">$CHECK_CONTENT</span>)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$CHECK_CONTENT</span>[<span class="number">7</span>] <span class="operator">-match</span> <span class="string">&quot;YES&quot;</span>)&#123;</span><br><span class="line">        <span class="comment"># account status is enabled</span></span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$USERNAME</span> is active&quot;</span>;</span><br><span class="line">        <span class="variable">$IS_ACTIVE</span>=<span class="variable">$TRUE</span>;</span><br><span class="line">    &#125;<span class="keyword">elseif</span>(<span class="variable">$CHECK_CONTENT</span>[<span class="number">7</span>] <span class="operator">-match</span> <span class="string">&quot;NO&quot;</span>)&#123;</span><br><span class="line">        <span class="comment"># account status is disabled</span></span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$USERNAME</span> is inactive&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment"># locked status , etc.</span></span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$USERNAME</span> status unknow&quot;</span>;</span><br><span class="line">        <span class="variable">$IS_ACTIVE</span>=<span class="variable">$TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$IS_ACTIVE</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Check-UserUnderList</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$Target_USER</span>,<span class="variable">$ENABLED_FILE</span>,<span class="variable">$DISABLED_FILE</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$FLAG_ENABLED_LIST</span>=<span class="variable">$</span>(<span class="built_in">Get-Content</span> <span class="variable">$ENABLED_FILE</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span> <span class="operator">-like</span> <span class="variable">$Target_USER</span>&#125;);</span><br><span class="line">    <span class="variable">$FLAG_DISABLED_LIST</span>=<span class="variable">$</span>(<span class="built_in">Get-Content</span> <span class="variable">$DISABLED_FILE</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span> <span class="operator">-like</span> <span class="variable">$Target_USER</span>&#125;);</span><br><span class="line">    <span class="variable">$FLAG_IS_Target_USER_ENABLED</span>=<span class="variable">$TRUE</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$null</span> <span class="operator">-eq</span> <span class="variable">$FLAG_ENABLED_LIST</span>)&#123;</span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$DISABLED_FILE</span>) does not contain  <span class="variable">$Target_USER</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$null</span> <span class="operator">-eq</span> <span class="variable">$FLAG_DISABLED_LIST</span>)&#123;</span><br><span class="line">            <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$ENABLED_FILE</span>) does not contain  <span class="variable">$Target_USER</span>&quot;</span>;</span><br><span class="line">            <span class="variable">$FLAG_IS_Target_USER_ENABLED</span>=<span class="variable">$</span>(Check<span class="literal">-UserActive</span> <span class="variable">$Target_USER</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$FLAG_IS_Target_USER_ENABLED</span>)&#123;</span><br><span class="line">                <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$Target_USER</span> is active&quot;</span>;</span><br><span class="line">                <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Write <span class="variable">$Target_USER</span> to <span class="variable">$</span>(<span class="variable">$ENABLED_FILE</span>)&quot;</span>;</span><br><span class="line">                <span class="built_in">Add-Content</span> <span class="variable">$ENABLED_FILE</span> <span class="variable">$Target_USER</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;<span class="variable">$Target_USER</span> is inactive&quot;</span>;</span><br><span class="line">                <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Write <span class="variable">$Target_USER</span> to <span class="variable">$</span>(<span class="variable">$DISABLED_FILE</span>)&quot;</span>;</span><br><span class="line">                <span class="built_in">Add-Content</span> <span class="variable">$DISABLED_FILE</span> <span class="variable">$Target_USER</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">Get-Log</span> <span class="string">&quot;[INFO]&quot;</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$DISABLED_FILE</span>) is contain <span class="variable">$Target_USER</span>&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;[INFO]&quot;</span> <span class="string">&quot;<span class="variable">$</span>(<span class="variable">$ENABLED_FILE</span>) is contain <span class="variable">$Target_USER</span>&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除禁用状态用户的AD配置</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Invoke-RemoveInactieUserPorfile</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$PS_SESSION</span>,<span class="variable">$Target_USER</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Code_Block</span>=&#123;</span><br><span class="line">        <span class="keyword">param</span>(<span class="variable">$DOMAIN_NAME</span>,<span class="variable">$Target_USER</span>)</span><br><span class="line">        <span class="comment"># get user SID</span></span><br><span class="line">        <span class="variable">$sid</span> = (<span class="built_in">New-Object</span> Security.Principal.NTAccount(<span class="variable">$DOMAIN_NAME</span>, <span class="variable">$Target_USER</span>)).Translate([<span class="type">Security.Principal.SecurityIdentifier</span>]).Value</span><br><span class="line">        <span class="built_in">Get-WmiObject</span> <span class="literal">-ClassName</span> Win32_UserProfile <span class="literal">-Filter</span> <span class="string">&quot;SID=&#x27;<span class="variable">$sid</span>&#x27;&quot;</span> |</span><br><span class="line">        <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">            <span class="variable">$_</span>.Delete()</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Invoke-Command</span> <span class="literal">-Session</span> <span class="variable">$PS_SESSION</span> <span class="literal">-ScriptBlock</span> <span class="variable">$Code_Block</span> <span class="literal">-ArgumentList</span> <span class="variable">$Global_Domain_Name</span>,<span class="variable">$Target_USER</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除过期文件</span></span><br><span class="line"><span class="comment"># 过期：超过365天</span></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Get-TargetObjectIfOutOfDat</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$TIME_SPAN</span>);</span><br><span class="line">    <span class="variable">$FLAG_IS_OVER_DAY</span>=<span class="variable">$FALSE</span>;</span><br><span class="line">    <span class="variable">$Temp_Timespan</span>=<span class="built_in">New-TimeSpan</span> <span class="variable">$TIME_SPAN</span> <span class="variable">$</span>(<span class="built_in">Get-Date</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$Temp_Timespan</span>.Days <span class="operator">-gt</span> <span class="variable">$Global_Out_of_Day</span>)&#123;</span><br><span class="line">        <span class="variable">$FLAG_IS_OVER_DAY</span>=<span class="variable">$TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$FLAG_IS_OVER_DAY</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Invoke-RemoveUserProfileByAccessTime</span></span>&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$PS_SESSION</span>,<span class="variable">$TARGET_USER</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Temp_Parent_Folder_Path</span>=<span class="string">&quot;C:\\users\\<span class="variable">$TARGET_USER</span>&quot;</span>;</span><br><span class="line">    <span class="variable">$Temp_Folder_Path_1</span>=<span class="string">&quot;<span class="variable">$Temp_Parent_Folder_Path</span>\\AppData&quot;</span>;</span><br><span class="line">    <span class="variable">$Temp_Folder_Path_2</span>=<span class="string">&quot;<span class="variable">$Temp_Folder_Path_1</span>\\Roaming&quot;</span>;</span><br><span class="line">    <span class="variable">$Temp_Folder_Path_3</span>=<span class="string">&quot;<span class="variable">$Temp_Folder_Path_1</span>\\Local&quot;</span>;</span><br><span class="line">    <span class="variable">$Temp_Folder_Path_4</span>=<span class="string">&quot;<span class="variable">$Temp_Folder_Path_1</span>\\LocalLow&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Checking folder : <span class="variable">$</span>(<span class="variable">$Temp_Folder_Path_1</span>)&quot;</span>;</span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Checking folder : <span class="variable">$</span>(<span class="variable">$Temp_Folder_Path_2</span>)&quot;</span>;</span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Checking folder : <span class="variable">$</span>(<span class="variable">$Temp_Folder_Path_3</span>)&quot;</span>;</span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Checking folder : <span class="variable">$</span>(<span class="variable">$Temp_Folder_Path_4</span>)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Code_Block</span>=&#123;</span><br><span class="line">        <span class="keyword">param</span>(<span class="variable">$Target_Path</span>);</span><br><span class="line">        <span class="variable">$Target_Object</span>=<span class="built_in">Get-Item</span> <span class="variable">$Target_Path</span> <span class="literal">-Force</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$Target_Object</span>.LastAccessTime;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Temp_Folder_Object_1_LastAccessTime</span>=<span class="variable">$</span>(<span class="built_in">Invoke-Command</span> <span class="literal">-Session</span> <span class="variable">$PS_SESSION</span> <span class="literal">-ScriptBlock</span> <span class="variable">$Code_Block</span> <span class="literal">-ArgumentList</span> <span class="variable">$Temp_Folder_Path_1</span>;)</span><br><span class="line">    <span class="variable">$Temp_Folder_Object_2_LastAccessTime</span>=<span class="variable">$</span>(<span class="built_in">Invoke-Command</span> <span class="literal">-Session</span> <span class="variable">$PS_SESSION</span> <span class="literal">-ScriptBlock</span> <span class="variable">$Code_Block</span> <span class="literal">-ArgumentList</span> <span class="variable">$Temp_Folder_Path_2</span>;)</span><br><span class="line">    <span class="variable">$Temp_Folder_Object_3_LastAccessTime</span>=<span class="variable">$</span>(<span class="built_in">Invoke-Command</span> <span class="literal">-Session</span> <span class="variable">$PS_SESSION</span> <span class="literal">-ScriptBlock</span> <span class="variable">$Code_Block</span> <span class="literal">-ArgumentList</span> <span class="variable">$Temp_Folder_Path_3</span>;)</span><br><span class="line">    <span class="variable">$Temp_Folder_Object_4_LastAccessTime</span>=<span class="variable">$</span>(<span class="built_in">Invoke-Command</span> <span class="literal">-Session</span> <span class="variable">$PS_SESSION</span> <span class="literal">-ScriptBlock</span> <span class="variable">$Code_Block</span> <span class="literal">-ArgumentList</span> <span class="variable">$Temp_Folder_Path_4</span>;)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Checking folder : <span class="variable">$</span>(<span class="variable">$Temp_Folder_Path_1</span>) . LastAccessTime: <span class="variable">$</span>(<span class="variable">$Temp_Folder_Object_1_LastAccessTime</span>)&quot;</span>;</span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Checking folder : <span class="variable">$</span>(<span class="variable">$Temp_Folder_Path_2</span>) . LastAccessTime: <span class="variable">$</span>(<span class="variable">$Temp_Folder_Object_2_LastAccessTime</span>)&quot;</span>;</span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Checking folder : <span class="variable">$</span>(<span class="variable">$Temp_Folder_Path_3</span>) . LastAccessTime: <span class="variable">$</span>(<span class="variable">$Temp_Folder_Object_3_LastAccessTime</span>)&quot;</span>;</span><br><span class="line">    <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Checking folder : <span class="variable">$</span>(<span class="variable">$Temp_Folder_Path_4</span>) . LastAccessTime: <span class="variable">$</span>(<span class="variable">$Temp_Folder_Object_4_LastAccessTime</span>)&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$</span>(<span class="built_in">Get-TargetObjectIfOutOfDat</span> <span class="variable">$Temp_Folder_Object_1_LastAccessTime</span>) <span class="operator">-and</span> <span class="variable">$</span>(<span class="built_in">Get-TargetObjectIfOutOfDat</span> <span class="variable">$Temp_Folder_Object_2_LastAccessTime</span>) <span class="operator">-and</span> <span class="variable">$</span>(<span class="built_in">Get-TargetObjectIfOutOfDat</span> <span class="variable">$Temp_Folder_Object_3_LastAccessTime</span>) <span class="operator">-and</span> <span class="variable">$</span>(<span class="built_in">Get-TargetObjectIfOutOfDat</span> <span class="variable">$Temp_Folder_Object_4_LastAccessTime</span>))&#123;</span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;All object has over <span class="variable">$</span>(<span class="variable">$Global_Out_of_Day</span>)&quot;</span>;</span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Ready to remove target folder&quot;</span>;</span><br><span class="line">        <span class="comment"># Delete user profile</span></span><br><span class="line">        <span class="comment"># Invoke-RemoveInactieUserPorfile $PS_SESSION $TARGET_USER;</span></span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;All object not over <span class="variable">$</span>(<span class="variable">$Global_Out_of_Day</span>)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Start-Main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Init file</span></span><br><span class="line">    <span class="built_in">Add-Content</span> enabled<span class="literal">-user</span>.list <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="built_in">Add-Content</span> disabled<span class="literal">-user</span>.list <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="built_in">Clear-Content</span> enabled<span class="literal">-user</span>.list;</span><br><span class="line">    <span class="built_in">Clear-Content</span> disabled<span class="literal">-user</span>.list;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Init PSession</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">1</span>;<span class="variable">$i</span> <span class="operator">-lt</span> <span class="number">1</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="variable">$Computer_Name</span>=<span class="string">&quot;<span class="variable">$</span>(<span class="variable">$Global_Computer_Name_Index</span>)<span class="variable">$i</span>&quot;</span>;</span><br><span class="line">        <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;Start connect to <span class="variable">$Computer_Name</span>&quot;</span>;</span><br><span class="line">        <span class="variable">$Ps_session</span>=<span class="built_in">New-PSSession</span> <span class="literal">-ComputerName</span> <span class="variable">$Computer_Name</span> <span class="literal">-Port</span> <span class="variable">$Gloabl_Winrm_Port</span> <span class="literal">-Credential</span> <span class="variable">$Global_Winrm_Credential</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$null</span> <span class="operator">-ne</span> <span class="variable">$Ps_session</span>)&#123;</span><br><span class="line">            <span class="built_in">Get-DriverFreeSpcaeUsage</span> <span class="variable">$Ps_session</span> <span class="string">&quot;C&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$UserList</span>=<span class="built_in">Invoke-Command</span> <span class="literal">-Session</span> <span class="variable">$Ps_session</span> <span class="literal">-ScriptBlock</span> &#123;<span class="built_in">Get-ChildItem</span> <span class="string">&#x27;C:\Users&#x27;</span>&#125;;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$UserList</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">                <span class="variable">$Username</span>=<span class="variable">$_</span>;</span><br><span class="line">                <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;[<span class="variable">$Computer_Name</span>]Start check user: <span class="variable">$Username</span>&quot;</span>;</span><br><span class="line">                Check<span class="literal">-UserUnderList</span> <span class="variable">$Username</span> enabled<span class="literal">-user</span>.list disabled<span class="literal">-user</span>.list;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">Get-Content</span> disabled<span class="literal">-user</span>.list | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">                <span class="variable">$Username</span>=<span class="variable">$_</span>.Trim();</span><br><span class="line">                <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;[<span class="variable">$Computer_Name</span>]Start remove user profile: <span class="variable">$Username</span>&quot;</span>;</span><br><span class="line">                <span class="built_in">Invoke-RemoveInactieUserPorfile</span> <span class="variable">$Ps_session</span> <span class="variable">$Username</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">Get-Content</span> enabled<span class="literal">-user</span>.list | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">                <span class="variable">$Username</span>=<span class="variable">$_</span>;</span><br><span class="line">                <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;[<span class="variable">$Computer_Name</span>]Start remove user profile which out of <span class="variable">$</span>(<span class="variable">$Global_Out_of_Day</span>)&quot;</span>.</span><br><span class="line">                <span class="built_in">Get-Log</span> <span class="string">&quot;INFO&quot;</span> <span class="string">&quot;[<span class="variable">$Computer_Name</span>][<span class="variable">$Username</span>] Checking...&quot;</span></span><br><span class="line">                <span class="built_in">Invoke-RemoveUserProfileByAccessTime</span> <span class="variable">$Ps_session</span> <span class="variable">$Username</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">Get-DriverFreeSpcaeUsage</span> <span class="variable">$Ps_session</span> <span class="string">&quot;C&quot;</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$Timespan</span>=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="literal">-Format</span> <span class="string">&quot;yyyyMMdd-HHmm&quot;</span>);</span><br><span class="line">    <span class="built_in">Rename-Item</span> enabled<span class="literal">-user</span>.list enabled<span class="literal">-user-</span><span class="variable">$Timespan</span>.list;</span><br><span class="line">    <span class="built_in">Rename-Item</span> disabled<span class="literal">-user</span>.list disabled<span class="literal">-user-</span><span class="variable">$Timespan</span>.list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Start-Main</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>删除配置文件：<a target="_blank" rel="noopener" href="https://blog.vichamp.com/2017/12/27/deleting-user-profiles/#:~:text=%E4%BB%A5%E4%B8%8B%E6%98%AF%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%EF%BC%9A%20%E9%A6%96%E5%85%88%EF%BC%8C%E8%B0%83%E6%95%B4%20%24domain%20%E5%92%8C%20%24username,%E5%8F%98%E9%87%8F%E6%8C%87%E5%90%91%E6%82%A8%E6%83%B3%E5%88%A0%E9%99%A4%E7%9A%84%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E3%80%82%20%E7%84%B6%E5%90%8E%EF%BC%8C%E5%9C%A8%20PowerShell%20%E4%B8%AD%E4%BB%A5%E7%AE%A1%E7%90%86%E5%91%98%E7%89%B9%E6%9D%83%E8%BF%90%E8%A1%8C%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%EF%BC%9A%20123456789101112">https://blog.vichamp.com/2017/12/27/deleting-user-profiles/#:~:text=%E4%BB%A5%E4%B8%8B%E6%98%AF%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%EF%BC%9A%20%E9%A6%96%E5%85%88%EF%BC%8C%E8%B0%83%E6%95%B4%20%24domain%20%E5%92%8C%20%24username,%E5%8F%98%E9%87%8F%E6%8C%87%E5%90%91%E6%82%A8%E6%83%B3%E5%88%A0%E9%99%A4%E7%9A%84%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E3%80%82%20%E7%84%B6%E5%90%8E%EF%BC%8C%E5%9C%A8%20PowerShell%20%E4%B8%AD%E4%BB%A5%E7%AE%A1%E7%90%86%E5%91%98%E7%89%B9%E6%9D%83%E8%BF%90%E8%A1%8C%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%EF%BC%9A%20123456789101112</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/45/">45</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Rohman.Zhu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":"light","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
