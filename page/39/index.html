<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="诺曼实验室">
<meta property="og:url" content="http://github.com/rohman-zhu/page/39/index.html">
<meta property="og:site_name" content="诺曼实验室">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Rohman.Zhu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://github.com/rohman-zhu/page/39/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh_cn","comments":"","permalink":"","path":"page/39/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>诺曼实验室</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">诺曼实验室</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Rohman.Zhu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">434</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">145</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/94fa7fb3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/94fa7fb3/" class="post-title-link" itemprop="url">Keepalived高可用集群</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-16 18:17:11" itemprop="dateCreated datePublished" datetime="2017-11-16T18:17:11+00:00">2017-11-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Keepalive"><a href="#Keepalive" class="headerlink" title="Keepalive"></a>Keepalive</h1><p>起初是为LVS设计的,专门用来监控LVS集群系统中各个服务节点的状态,后来又加入了VRRP的功能(Virtual Router Redundancy Protocol 虚拟路由器冗余协议),因此配合除了LVS服务外,也可以作为其他服务(nginx,haproxy)的高可用软件.</p>
<blockquote>
<p>VRRP出现是为了解决静态路由出现的单点故障问题.</p>
</blockquote>
<p>主要两大用户:healthcheck , failover</p>
<h2 id="VRRP"><a href="#VRRP" class="headerlink" title="VRRP"></a>VRRP</h2><p>Virtual Router Redundacy Protocol,解决静态路由器的单点故障,VRRP时通过一种竞选协议机制来将故障路由器的任务给某台VRRP.</p>
<ul>
<li>VRRP是通过IP多播的方式实现通信</li>
<li>主发包,备接包,当备接不到主发的包的时候,就启动接管程序接管主的资源.</li>
</ul>
<h2 id="failover"><a href="#failover" class="headerlink" title="failover"></a>failover</h2><p>实现LB Master主机和 Backup 主机之间故障转移何自动切换.(这里针对有两个负载均衡)</p>
<h2 id="healthcheck"><a href="#healthcheck" class="headerlink" title="healthcheck"></a>healthcheck</h2><ol>
<li>keepalived.conf里面配置就可以实现LVS.</li>
<li>keepalive可以对LVS下面的集群节点做监控检查.</li>
</ol>
<p>负载均衡定期检查RSYNC的可用性决定是否给其分发请求.</p>
<h2 id="keepalived-故障切换转移原理"><a href="#keepalived-故障切换转移原理" class="headerlink" title="keepalived 故障切换转移原理"></a>keepalived 故障切换转移原理</h2><ol>
<li>在keepalived directors正常工作时,主Director节点会不断向被节点广播心跳消息,告诉备节点设备–主节点设备正常.</li>
<li>当主节点发生故障时,备节点就无法检测到主节点的心跳,今儿调用自身的接管程序,接管主节点的IP资源与服务.</li>
<li>当主节点恢复时,备节点会释放主节点故障时自身接管的IP资源与服务,恢复到原来的自身备用角色.</li>
</ol>
<h2 id="配置keepalive"><a href="#配置keepalive" class="headerlink" title="配置keepalive"></a>配置keepalive</h2><p>官网 <code>http:\\www.keepalived.org</code></p>
<p>这里用的是 1.2.16 的版本.</p>
<p>相关的配置可以用man keepalived.conf查看,这里只列出80%</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ln -s /user/src/kernel/2.6 /usr/src/linux</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 到keepalive的文件包里面</span></span><br><span class="line"><span class="comment"># ./configure</span></span><br><span class="line"><span class="comment"># 出现以下相关内容即可</span></span><br><span class="line">Use IPVS Framework  : Yes</span><br><span class="line">IPVS <span class="built_in">sync</span> daemon support: Yes</span><br><span class="line">Use VRRP Framework : Yes</span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 规范启动</span></span><br><span class="line"><span class="comment"># cp /usr/local/etc/rc.d/init.d/keepalived /etc/init.d/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置启动脚本参数</span></span><br><span class="line"><span class="comment"># cp /usr/local/etc/sysconfig/keepalived /etc/sysconfig/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建默认的keepalived配置文件路径</span></span><br><span class="line"><span class="comment"># mkdir /etc/keepalived</span></span><br><span class="line"><span class="comment"># cp /usr/local/etc/keepalived/keepalived.conf /etc/keepalived</span></span><br></pre></td></tr></table></figure>

<p>keepalived的配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">!Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">!全局变量</span><br><span class="line">!Comments start with ’#’ or ’!’ to the end of the line and can start anywhere in a line.</span><br><span class="line">!contains subblocks of Global definitions, Static routes, and Static rules</span><br><span class="line">global_defs&#123;</span><br><span class="line">    notification_email&#123;</span><br><span class="line">        !管理员邮箱</span><br><span class="line">        admin@example.com</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from admin@example.com</span><br><span class="line">    !邮箱服务器的地址设置</span><br><span class="line">    smtp_server xx.xx.xx.xx</span><br><span class="line">    smtp_connect_timeout 30</span><br><span class="line"></span><br><span class="line">    !string,identifying the machine,(do not have to be hostname,default:localhostname)</span><br><span class="line">    router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">!Static routes/address/rules</span><br><span class="line">!Keepalived can configure static addresses, routes, and rules. These addresses are NOT moved by vrrpd, they stay on the machine.  If you already  have  IPs and routes on your machines and your machines can ping each other, you don’t need this section.</span><br><span class="line"></span><br><span class="line">static_ipaddress&#123;</span><br><span class="line">    192.168.1.2/24 dev eth0 scope global</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static_routes&#123;</span><br><span class="line">    192.168.1.1/24 via 192.168.1.100</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static_rules&#123;</span><br><span class="line">    from 192.168.1.1/24 table 1</span><br><span class="line">    to 192.168.1.1/24 table 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">!Adds a scritpt to be executed periodically.Its exit code will be recorded for all VRRP instances which are monitoring it with non-zero weight.</span><br><span class="line">vrrp_script &lt;SCRIPT_NAME&gt;&#123;</span><br><span class="line">    !path of the script to execute</span><br><span class="line">    script &lt;STRING&gt;|&lt;QUOTED-STRING&gt;</span><br><span class="line">    !seconds between script invocations,default 1 second</span><br><span class="line">    interval &lt;INTEGER&gt;</span><br><span class="line">    !seconds after which script is considered to have failed</span><br><span class="line">    timeout &lt;INTEGER&gt;</span><br><span class="line">    !adjust priority by this weight,default 2</span><br><span class="line">    weight &lt;INTEGER : -254..254&gt;</span><br><span class="line">    !required number of successes for OK transition</span><br><span class="line">    rise &lt;INTERGER&gt;</span><br><span class="line">    !required number of successes for KO transition</span><br><span class="line">    fall &lt;INTEGER&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">!describes the movable IP for each instance of a group in vrrp_sync_group.</span><br><span class="line">!Here are describes two IPs(on inside_network an on_outside_network)on machine &quot;my_hostname&quot;,!which belog to the group VG_1 and which will trasition together on any state change.</span><br><span class="line"></span><br><span class="line">vrrp_instance inside_network&#123;</span><br><span class="line">    !Initial state,MASTER | BACKUP</span><br><span class="line">    !As soon as the other machine(s) come up,</span><br><span class="line">    !an election will be held and the machine</span><br><span class="line">    !With the highest priority will become MASTER</span><br><span class="line">    !So the entry here do not matter a whole lot</span><br><span class="line">    state MASTER</span><br><span class="line"></span><br><span class="line">    !Interface for inside_network,bound by vrrp</span><br><span class="line">    interface eth0</span><br><span class="line"></span><br><span class="line">    !Use VRRP Virtual MAC.</span><br><span class="line">    use_vmac [&lt;VMAC_INTERFACE&gt;]</span><br><span class="line"></span><br><span class="line">    !Send/Recv VRRP messages from base interface instea dof</span><br><span class="line">    vmac_xmit_base</span><br><span class="line"></span><br><span class="line">    !force instance to use IPv6(when mixed IPv4 and IPv6 config)</span><br><span class="line">    native_ipv6</span><br><span class="line"></span><br><span class="line">    !Ignore VRRP interface faults(default unset)</span><br><span class="line">    dont_track_primary</span><br><span class="line"></span><br><span class="line">    ! optional,monitor these as well</span><br><span class="line">    ! go to FAULT state if any of these go down</span><br><span class="line">    track_interface&#123;</span><br><span class="line">        eth0</span><br><span class="line">        eth1</span><br><span class="line">        eth2 weight &lt;-254..254&gt;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ! add a tracking script to the interface (&lt;SCRIPT_NAME&gt;is the name of the vrrp_script entry)</span><br><span class="line">    track_script&#123;</span><br><span class="line">        &lt;SCRIPT_NAME&gt;</span><br><span class="line">        &lt;SCRIPT_NAME&gt; weight &lt;-254..254&gt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    !Default IP for binding vrrpd is the primary IP on interface.If you want to hid the location of vrrpd, use this IP as src_addr for multicast or unicast vrrp packets.(Since it is multicast,vrrpd will get the reply packet no matter what src_addr is used).</span><br><span class="line">    !Optional</span><br><span class="line">    mcast_src_ip &lt;IPADDR&gt;</span><br><span class="line">    unicast_src_ip &lt;IPADDR&gt;</span><br><span class="line">    ! VRRP version to run on interface</span><br><span class="line">    version&lt;2 or 3&gt;</span><br><span class="line"></span><br><span class="line">    !addresses add|del on change to MASTER , to BACKUP.With the same entries on other machines, the opposite transition will be occurring.</span><br><span class="line">    virtual_ipaddress&#123;</span><br><span class="line">        &lt;IPADDR&gt;/&lt;MASK&gt; brd &lt;IPADDR&gt; dev &lt;STRING&gt; scope &lt;SCOPE&gt; label &lt;LABEL&gt;</span><br><span class="line">        192.168.200.17/24 dev eth1</span><br><span class="line">        192.168.200.18/24 dev eth2 label eth2:1</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # Note: authentication was removed from the VRRPv2 specification by RFC3768 in 2004.</span><br><span class="line">    #    Use of this option is non-compliant and can cause problems; avoid using if possible,</span><br><span class="line">    #   except when using unicast, where it can be helpful.</span><br><span class="line">    authentication &#123;</span><br><span class="line">        # Authentication block</span><br><span class="line">        # PASS||AH</span><br><span class="line">        # PASS - Simple password (suggested)</span><br><span class="line">        # AH - IPSEC (not recommended))</span><br><span class="line">        auth_type PASS</span><br><span class="line">        # Password for accessing vrrpd.</span><br><span class="line">        # should be the same on all machines.</span><br><span class="line">        # Only the first eight (8) characters are used.</span><br><span class="line">        auth_pass 1234</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>主要配置:</p>
<ul>
<li>从文档中可以看到,我们需要配置主要有全局参数(global_defs),email &amp; router_id</li>
<li>如果有需要定时执行的脚本,则配置vrrp_script 块, script位置,interval,weight</li>
<li>配置主机标签vrrp_instance ,里面设置state,网卡接口,主机ip,virtual_id,优先级priorioty,adver_int,authentication,为主机虚拟ip,检测脚本</li>
<li>用上一个步骤里面的虚拟IP配置虚拟服务器</li>
</ul>
<p>主:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">!Configuration file for keepalived</span><br><span class="line">global_defs&#123;</span><br><span class="line">    notification_email&#123;</span><br><span class="line">        zhur0ngjian@126.com</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from zhur0ngjian@126.com</span><br><span class="line">    smtp_server 127.0.0.1</span><br><span class="line">    smtp_connect_timeout 30</span><br><span class="line">    router_id MASTER_ROUTER</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance V1_1&#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth1</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    mcast_src_ip 172.16.177.150</span><br><span class="line">    priority 50</span><br><span class="line">    adver_int 1</span><br><span class="line">    authentication&#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass chtopnet</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress&#123;</span><br><span class="line">        10.0.1.1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 10.0.1.1 80&#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    persistence_timeout 50</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 172.16.177.150 80 &#123;</span><br><span class="line">        weight 3</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">            connect_timeout 10</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    real_server 172.16.177.151 80&#123;</span><br><span class="line">        weight 3</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">            connect_timeout 10</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>被:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">!Configuration file for keepalived</span><br><span class="line">global_defs&#123;</span><br><span class="line">    notification_email&#123;</span><br><span class="line">        zhur0ngjian@126.com</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from zhur0ngjian@126.com</span><br><span class="line">    smtp_server 127.0.0.1</span><br><span class="line">    smtp_connect_timeout 30</span><br><span class="line">    router_id BACKUP_ROUTER</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance V1_1&#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth1</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    mcast_src_ip 172.16.177.151</span><br><span class="line">    priority 50</span><br><span class="line">    adver_int 1</span><br><span class="line">    authentication&#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass chtopnet</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress&#123;</span><br><span class="line">        10.0.1.1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 10.0.1.1 80&#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    persistence_timeout 50</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 172.16.177.150 80 &#123;</span><br><span class="line">        weight 3</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">            connect_timeout 10</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    real_server 172.16.177.151 80&#123;</span><br><span class="line">        weight 3</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">            connect_timeout 10</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主备的配置文件需要注意:</p>
<ol>
<li>在vrrp_instance节点中,主备的实例名字可以不一样,但virtual_router_id必须一样.</li>
<li>virtual_router_id的作用是区分不同的vrrp组,因此在同一网段内,不同的vrrp组不能重复id.</li>
<li>一个 virtual_server节点中配置多个 real_server,需要注意 TCP_CHECK与’{‘ 之间的空格,如果没有空格,则从上往下数第二个real_server会识别不到.</li>
<li>VIP可以和主机真实IP地址不在同一个网段,但必须在环境中搭建VPN.</li>
</ol>
<p>启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># keeplived需要通过ip地址添加来启动服务</span><br><span class="line"># ip addr add 10.0.0.18/24 dev eth0</span><br><span class="line"># /etc/init.d/keepalived start</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对外提供服务的是VIP(virtual ip)</p>
</blockquote>
<h2 id="场景应用"><a href="#场景应用" class="headerlink" title="场景应用"></a>场景应用</h2><p>假设我们的集群架构中,有两台机器是作为LB存在,分别是LB1(主),LB2(备) ; 两台 LB 通过 <em>keepalive</em> 建立关系 , 当一台 _LB_挂了,立即启用 <em>备用LB</em> .</p>
<p>我用的 <em>load Balance</em> 软件是 Nginx , 所谓宕机就是 <em>Nginx</em> 和 <em>keepalive</em> 这两个服务停止了,然而当 <em>Nginx</em> 停止服务的时候 ,keepalive 是不能识别到的(Keepalive不会关闭,不会让 <em>备用LB</em> 接管 <em>主LB</em> 接受到的请求)</p>
<p>因此,我们要写一个监控Nginx状态的脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Monitoring Nginx status</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="subst">$(ps -ef|grep <span class="string">&quot;nginx : master process&quot;</span>|grep -v grep)</span>&quot;</span>==<span class="string">&quot;&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    /application/nginx/sbin/nginx</span><br><span class="line">    <span class="built_in">sleep</span> 5</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="subst">$(ps -ef|grep <span class="string">&quot;nginx : master process&quot;</span>|grep -v grep)</span>&quot;</span>==<span class="string">&quot;&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">    killall keepalived</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>升级版:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/keepaalived/check_nginx.sh</span></span><br><span class="line">Count1=<span class="string">&quot;netstat -antp |grep -v grep|grep nginx|wc -l&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$Count1</span> -eq 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    /application/nginx/sbin/nginx</span><br><span class="line">    <span class="built_in">sleep</span> 2</span><br><span class="line">    Count2=<span class="string">&quot;netstat -antp|grep -v grep|grep nginx|wc -l&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$Count2</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        /etc/init.d/keepalived stop</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>这个脚本可以放到 <em>keepalived.conf</em> 里面 <em>vrrp_script</em> 节点中,这里可以每隔相应的时间执行一次脚本.</p>
<p>在工作时,keepalived根据用户设定的策略判断服务器上的程序是否正常运行,如果故障则将这台服务器从热备组移出.</p>
<p>在实例中重要参数: nopreempt , 当主LB挂了,备LB接管,主恢复,不自动接管</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/61d1add5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/61d1add5/" class="post-title-link" itemprop="url">Linux之kickstart无人值守系统装系统</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-14 15:48:16" itemprop="dateCreated datePublished" datetime="2017-11-14T15:48:16+00:00">2017-11-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="无人值守装系统-PXE-APACHE-DHCP-TFTP-KICKSTART"><a href="#无人值守装系统-PXE-APACHE-DHCP-TFTP-KICKSTART" class="headerlink" title="无人值守装系统(PXE+APACHE+DHCP+TFTP+KICKSTART)"></a>无人值守装系统(PXE+APACHE+DHCP+TFTP+KICKSTART)</h1><ul>
<li>DHCP_Server 用于给客户端提供IP地址以及PXE文件的位置.</li>
<li>Web_Server 存放系统镜像以及kickstart的配置文件.</li>
<li>TFTP_Server 存放PXE文件以及相关的启动文件</li>
</ul>
<hr>
<p>相关IP地址:</p>
<ul>
<li>DHCP_Server:192.168.1.2</li>
<li>Web_Server:192.168.1.3</li>
<li>TFTP_Server:192.168.1.4</li>
</ul>
<h2 id="1-1-什么是PXE"><a href="#1-1-什么是PXE" class="headerlink" title="1.1 什么是PXE"></a>1.1 什么是PXE</h2><p>PXE(preboot execute environment，预启动执行环境)是由Intel公司开发的最新技术，工作于Client&#x2F;Server的网络模式，支持工作站通过网络从远端服务器下载映像，并由此支持通过网络启动操作系统，</p>
<p>在启动过程中，终端要求服务器分配IP地址，再用TFTP（trivial file transfer protocol）或MTFTP(multicast trivial file transfer protocol)协议下载一个启动软件包到本机内存中执行，由这个启动软件包完成终端（客户端）基本软件设置，从而引导预先安装在服务器中的终端操作系统。</p>
<h2 id="1-2-PXE工作过程"><a href="#1-2-PXE工作过程" class="headerlink" title="1.2 PXE工作过程"></a>1.2 PXE工作过程</h2><p><img src="http://images.cnitblog.com/blog/370046/201406/152331547498487.jpg" alt="PXE工作原理示意图"></p>
<p>PXE客户端 (发送UDP广播请求)-&gt; DHCP服务 (DHCP服务器提供信息) -&gt; PXE客户端 (请求下载启动文件)-&gt; TFTP服务 (响应并提供文件)-&gt; PXE 客户端 (请求下载自动应答文件) -&gt; Http服务 (客户端安装操作系统) -&gt; PXE客户端</p>
<h3 id="1-2-1-获取相关的pxe程序"><a href="#1-2-1-获取相关的pxe程序" class="headerlink" title="1.2.1 获取相关的pxe程序"></a>1.2.1 获取相关的pxe程序</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 安装syslinux</span><br><span class="line"># syslinux是一个引导加载程序,而且兼容各种介质.syslinux是一个小型的Linux操作系统,目的是简化首次安装Linux的时间,并建立维护或者其他特殊用途的启动盘</span><br><span class="line"># yum install syslinux</span><br><span class="line"></span><br><span class="line"># 将Linux的pxe文件复制到TFTP文件夹中(TFTP下面会讲到安装,默认启动的路径在/var/lib/tftpboot/)</span><br><span class="line"># cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line"># 将iso镜像中的/image/pxeboot/initrd.img和vmlinux复制到/var/lib/tftpboot/下</span><br><span class="line"># scp -P22 root@192.168.1.3:/var/www/html/cdrom/images/pxeboot/&#123;initrd.im,gvmlinuz&#125; /var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line"># 复制iso镜像中的/isolinux/*.msg 到 /var/lib/tftpboot/文件夹中</span><br><span class="line"># cp /var/www/html/cdrom/isolinux/*.msg /var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line"># 在/var/lib/tftpboot/中创建一个pxelinux.cfg目录</span><br><span class="line"># mkdir /var/lib/tftpboot/pxelinux.cfg</span><br><span class="line"></span><br><span class="line"># 将iso镜像中的/isolinux目录中的isolinux.cfg复制到pxelinux.cfg目录下,同时改名为default</span><br><span class="line"># cp /var/www/html/cdrom/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改default文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 设置启动的是&#x27;label ks&#x27;中的内容</span><br><span class="line">default ks</span><br><span class="line"># 显示 &#x27;boot:&#x27;提示符.为&#x27;0&#x27;时则不显示,将会直接启动&#x27;default&#x27;参数中指定的内容.</span><br><span class="line">prompt 1</span><br><span class="line">#在用户输入之前的超时时间,单位为0.1秒</span><br><span class="line">timeout 6</span><br><span class="line"># 显示某个文件的内容,注意文件的路径.</span><br><span class="line"># 默认是在/var/lib/tftpboot/目录下</span><br><span class="line"># 也可以指定其他的全路径下的msg文件</span><br><span class="line">display boot.msg</span><br><span class="line"></span><br><span class="line"># &#x27;label&#x27;指定在&#x27;boot&#x27;提示符下输入的关键字,比如boot:linux[ENTER],这个会启动&#x27;label linux&#x27;下标记的kernel和initrd.img文件</span><br><span class="line">label linux</span><br><span class="line">    # kernel 参数指定要启动的内核</span><br><span class="line">    kernel vmlinuz</span><br><span class="line">    # append指定追加给内核的参数,能够在grub里使用的追加给内核的参数.</span><br><span class="line">    append initrd=initrd.img</span><br><span class="line">label ks</span><br><span class="line">    kernel vmlinuz</span><br><span class="line">    #指定ks.cfg文件</span><br><span class="line">    append ks=http://192.168.1.3/ks.cfg initrd=initrd.img</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Linux初始RAM磁盘（initrd）是在系统引导过程中挂载的一个临时根文件系统，用来支持两阶段的引导过程。initrd文件中包含了各种可执行程序和驱动程序，它们可以用来挂载实际的根文件系统，然后再将这个 initrd RAM磁盘卸载，并释放内存。在很多嵌入式Linux系统中，initrd 就是最终的根文件系统。</p>
</blockquote>
<h2 id="2-DHCP服务器安装"><a href="#2-DHCP服务器安装" class="headerlink" title="2. DHCP服务器安装"></a>2. DHCP服务器安装</h2><p>DHCP（Dynamic Host Configuration Protocol，动态主机配置协议）是一个局域网的网络协议，使用UDP协议工作， 主要有两个用途：给内部网络或网络服务供应商自动分配IP地址，给用户或者内部网络管理员作为对所有计算机作中央管理的手段.</p>
<p>在本次案例中,DHCP服务器用于给客户机分配IP地址以及TFTP服务器的IP地址.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 安装DHCP服务</span><br><span class="line"># yum -y install dhcp</span><br><span class="line"></span><br><span class="line"># 复制配置模板文件到DHCP的配置目录中</span><br><span class="line"># cp -f /usr/share/doc/dhcp-4.1.1/dhcpd.conf/sample /etc/dhcp/dhcpd.conf</span><br><span class="line"></span><br><span class="line"># 修改/etc/dhcp/dhcp.conf配置文件,内容如下:</span><br><span class="line"># vi /etc/dhcp/dhcp.conf</span><br><span class="line"># ---</span><br><span class="line">ddns-update-style interim;</span><br><span class="line">ignore client-updates;</span><br><span class="line"># pxelinux启动文件位置;</span><br><span class="line">filename &quot;pxelinux.0&quot;;</span><br><span class="line"># TFTP Server的IP地址;</span><br><span class="line">next-server 192.168.1.4;</span><br><span class="line"></span><br><span class="line">subnet 192.168.1.0 netmask 255.255.255.0&#123;</span><br><span class="line">    option routers 192.168.1.4;</span><br><span class="line">    option subnet-mask 255.255.255.0;</span><br><span class="line"></span><br><span class="line">    range dynamic-bootp 192.168.1.100 192.168.1.200;</span><br><span class="line">    default-lease-time 21600;</span><br><span class="line">    max-lease-time 43000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 启动DHCP服务</span><br><span class="line"># /etc/init.d/dhcpd start</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里有可能会出现客户机无法找到ip地址,需要关闭防火墙和selinux.</p>
</blockquote>
<h2 id="3-TFTP-Server-安装与配置"><a href="#3-TFTP-Server-安装与配置" class="headerlink" title="3.TFTP_Server 安装与配置"></a>3.TFTP_Server 安装与配置</h2><p>TFTP（Trivial File Transfer Protocol,简单文件传输协议）是TCP&#x2F;IP协议族中的一个用来在客户机与服务器之间进行简单文件传输的协议，提供不复杂、开销不大的文件传输服务。端口号为69。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 安装tftp-server</span><br><span class="line"># yum install tftp-server -y</span><br><span class="line"></span><br><span class="line"># 编辑tftp服务的配置</span><br><span class="line"># vi /etc/xinetd.d/tftp</span><br><span class="line"># ---</span><br><span class="line">service tftp</span><br><span class="line">&#123;</span><br><span class="line">    socket_type = dgram</span><br><span class="line">    protocol = udp</span><br><span class="line">    wait = yes</span><br><span class="line">    user = root</span><br><span class="line">    server = /usr/sbin/in.tftpd</span><br><span class="line">    server_args = -s /var/lib/tftpboot</span><br><span class="line">    disable = no</span><br><span class="line">    per_source = 11</span><br><span class="line">    cps = 100 2</span><br><span class="line">    flags = IPv4</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 启动服务</span><br><span class="line"># /etc/init.d/xinetd restart</span><br></pre></td></tr></table></figure>

<h2 id="4-安装HTTP服务"><a href="#4-安装HTTP服务" class="headerlink" title="4. 安装HTTP服务"></a>4. 安装HTTP服务</h2><p>可以用 <em>Apache</em> 或者 <em>Nginx</em> , 具体安装教程在以往的文章中由详细记录.</p>
<blockquote>
<p>创建一个站点目录挂载光盘镜像.</p>
</blockquote>
<h2 id="6-创建ks-cfg"><a href="#6-创建ks-cfg" class="headerlink" title="6.创建ks.cfg"></a>6.创建ks.cfg</h2><h3 id="6-1-语法"><a href="#6-1-语法" class="headerlink" title="6.1 语法"></a>6.1 语法</h3><ul>
<li>命令段</li>
<li>脚本段</li>
</ul>
<h3 id="6-2-定制配置文件"><a href="#6-2-定制配置文件" class="headerlink" title="6.2 定制配置文件"></a>6.2 定制配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#platform=x86, AMD64, or Intel EM64T</span><br><span class="line">#version=DEVEL</span><br><span class="line"># Firewall configuration</span><br><span class="line">firewall --disabled</span><br><span class="line"># Install OS instead of upgrade</span><br><span class="line">install</span><br><span class="line"># Use network installation</span><br><span class="line">url --url=http://192.168.1.3/cdrom/</span><br><span class="line">#这个选项告诉安装程序：到服务器192.168.1.3 的HTTP根目录下的cdrom 文件夹下寻找安装介质</span><br><span class="line"># Root password</span><br><span class="line">rootpw --iscrypted $1$vsvtP./e$6PVMNfJd.shq2LgFJjYfA1</span><br><span class="line"># System authorization information</span><br><span class="line">auth  --useshadow  --enablemd5</span><br><span class="line"># Use graphical install</span><br><span class="line">graphical</span><br><span class="line">firstboot --disable</span><br><span class="line"># System keyboard</span><br><span class="line">keyboard us</span><br><span class="line"># System language</span><br><span class="line">lang en_US</span><br><span class="line"># SELinux configuration</span><br><span class="line">selinux --disabled</span><br><span class="line"># Installation logging level</span><br><span class="line">logging --level=info</span><br><span class="line"># Reboot after installation</span><br><span class="line">reboot</span><br><span class="line"># System timezone</span><br><span class="line">timezone  --isUtc Asia/Shanghai</span><br><span class="line"># Network information</span><br><span class="line">network  --bootproto=dhcp --device=eth0 --onboot=on</span><br><span class="line"># System bootloader configuration</span><br><span class="line"># Redhat system</span><br><span class="line"># key --skip</span><br><span class="line"></span><br><span class="line">bootloader --append=&quot;rhgb quiet&quot; --location=mbr --driveorder=sda</span><br><span class="line"></span><br><span class="line"># Clear the Master Boot Record</span><br><span class="line">zerombr</span><br><span class="line"># Partition clearing information</span><br><span class="line">clearpart --all --initlabel</span><br><span class="line"># Disk partitioning information</span><br><span class="line">part /boot --fstype=&quot;ext4&quot; --size=200</span><br><span class="line">part swap --fstype=&quot;swap&quot; --size=1024</span><br><span class="line">part / --fstype=&quot;ext4&quot; --size=8192</span><br><span class="line">part /home --fstype=&quot;ext4&quot; --size=2048</span><br><span class="line"></span><br><span class="line">%packages</span><br><span class="line">@base</span><br><span class="line"></span><br><span class="line">%end</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/14a7ca93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/14a7ca93/" class="post-title-link" itemprop="url">MySQL的引擎</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-10 20:37:23" itemprop="dateCreated datePublished" datetime="2017-11-10T20:37:23+00:00">2017-11-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="MySQL引擎"><a href="#MySQL引擎" class="headerlink" title="MySQL引擎"></a>MySQL引擎</h1><p>常用的为MyISAM 与 InnoDB.</p>
<h2 id="MyISAM引擎"><a href="#MyISAM引擎" class="headerlink" title="MyISAM引擎"></a>MyISAM引擎</h2><p>MySQL关系数据库管理系统的默认储存引擎(MySQL5.5.5以前).</p>
<p>特点:</p>
<ol>
<li>不支持事务</li>
<li>表级锁定,数据库更新的时候,锁定整张表</li>
<li>读写相互阻塞</li>
<li>只会缓存索引</li>
<li>读取速度较快,占用资源小</li>
<li>不支持外键约束</li>
</ol>
<p>适用的生产场景:</p>
<ol>
<li>不需要事务支持的业务</li>
<li>一般为读数据比较多的应用,读写都频繁的场景不适用.</li>
<li>读取并发访问相对较低的业务.</li>
<li>数据修改相对较小的业务.</li>
</ol>
<p>调优:</p>
<ol>
<li>设置合适的索引</li>
<li>调整读写优先级,根据实际需求确保重要操作更优先执行.</li>
<li>启用延迟插入改善大批量写入性能.(降低写入频率,尽可能多条数据一次性写入)</li>
<li>尽量顺序操作让insert数据都写入尾部,减少阻塞</li>
<li>分解时间长的SQL操作,降低单个操作的阻塞时间.</li>
<li>降低并发数(减少对MySQL访问).</li>
</ol>
<p>重要参数:</p>
<blockquote>
<p>查看 heavy-4G.my</p>
</blockquote>
<h2 id="InnoDB引擎"><a href="#InnoDB引擎" class="headerlink" title="InnoDB引擎"></a>InnoDB引擎</h2><p>特点:</p>
<ol>
<li>支持事务</li>
<li>行级锁定</li>
<li>读写阻塞与事务隔离级别相关</li>
<li>具有非常高效的缓存特性:能缓存索引,也能缓存数据.</li>
<li>整个表和主键以Cluster方式存储.</li>
<li>支持分区,表控件</li>
<li>支持外键约束</li>
<li>相比于MyISAM引擎,InnoDB对硬件资源要求比较高</li>
<li>所有Secondary Index 都会保存主键信息.</li>
</ol>
<p>调优:</p>
<ol>
<li>建立有效索引避免全表扫描,因为会使用表锁</li>
<li>尽可能缓存所有的索引和数据,提高响应速度,减少磁盘IO消耗</li>
<li>合理设置innodb_flush_log_at_trx_commit参数值,不要过度追求安全性.(如果innodb_flush_at_trx_commit的值为0,log,buffer每秒会被刷写日志文件到磁盘,提交事务的时候不做任何操作.)</li>
<li>在大批量小插入的时候,尽量自己控制事务而不要使用autocommit自动提交.</li>
<li>主键尽可能小,避免给Secondary index带来过大的控件负担</li>
<li>避免主键更新,因为会带来大量的数据更新</li>
</ol>
<h2 id="查看引擎"><a href="#查看引擎" class="headerlink" title="查看引擎"></a>查看引擎</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; show engines;</span><br></pre></td></tr></table></figure>

<h2 id="更改引擎"><a href="#更改引擎" class="headerlink" title="更改引擎"></a>更改引擎</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; 永久生效</span><br><span class="line">mysql &gt; ALTER TABLE [tableName] ENGINE = EngineName;</span><br></pre></td></tr></table></figure>

<p>多表批量更改,先查找所有表,然后再更改.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/239f14e0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/239f14e0/" class="post-title-link" itemprop="url">SQL语句详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-09 17:20:39" itemprop="dateCreated datePublished" datetime="2017-11-09T17:20:39+00:00">2017-11-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Structure-Query-Language"><a href="#Structure-Query-Language" class="headerlink" title="Structure Query Language"></a>Structure Query Language</h1><p>一般分为三类:</p>
<ol>
<li>DDL(Data Definition Language) – 数据定义语言(CREAT,EALTER,DROP),管理基础数据,例如:库,表;</li>
<li>DCL(Data Control Language) – 数据控制语言(GRANT,REVOKE,COMMIT,ROLLBACK),用户授权,权限回收,数据提交回滚</li>
<li>DML(Data Manipulation Language) – 数据操作语言 (SELECT,INSERT,DELETE,UPDATE),针对数据库里的表与记录</li>
</ol>
<h2 id="常见应用"><a href="#常见应用" class="headerlink" title="常见应用"></a>常见应用</h2><h3 id="1-创建数据库"><a href="#1-创建数据库" class="headerlink" title="1. 创建数据库"></a>1. 创建数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create database &lt;DatabaseName&gt;;</span><br><span class="line"></span><br><span class="line">* 创建指定字符集的数据库:</span><br><span class="line"></span><br><span class="line">create database &lt;DatabaseName&gt; CHARACTER SET [Charset] [Description] [Default collattion];</span><br><span class="line"></span><br><span class="line">* 查看字符集</span><br><span class="line"></span><br><span class="line">show character set;</span><br></pre></td></tr></table></figure>

<p>默认使用utf-8</p>
<h3 id="2-删除数据库"><a href="#2-删除数据库" class="headerlink" title="2.删除数据库"></a>2.删除数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">drop database &lt;databaseName&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-连接数据库"><a href="#3-连接数据库" class="headerlink" title="3.连接数据库"></a>3.连接数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use &lt;databaseName&gt;</span><br><span class="line"></span><br><span class="line">不切换数据库,用 database.table</span><br><span class="line"></span><br><span class="line">例如:</span><br><span class="line"></span><br><span class="line">select user,host from mysql.user</span><br></pre></td></tr></table></figure>

<h3 id="4-授权"><a href="#4-授权" class="headerlink" title="4.授权"></a>4.授权</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">命令 : 授权命令 对应权限 目标 用户名和客户机 密码</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all on *.* to &#x27;&#x27;@&#x27;localhost&#x27; identified by &#x27;12345&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="5-为表创建索引"><a href="#5-为表创建索引" class="headerlink" title="5.为表创建索引"></a>5.为表创建索引</h3><p>加快语句查询速度.</p>
<h4 id="5-1-主键索引"><a href="#5-1-主键索引" class="headerlink" title="5.1 主键索引"></a>5.1 主键索引</h4><p>一个表只能有一个主键索引列,可以有多个普通列索引.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">在建表的时候添加</span><br><span class="line"></span><br><span class="line"># 主键索引</span><br><span class="line">primary key(列名)</span><br><span class="line"></span><br><span class="line"># 普通索引</span><br><span class="line">Key index_name(列名)</span><br><span class="line"></span><br><span class="line">mysql &gt; alter table [table_name] [add|drop] index_name(ColumName);</span><br><span class="line"></span><br><span class="line"># 指定某一个列中的前几个字符,例如 student 表的name varchar(20)</span><br><span class="line">mysql &gt; create index index_name to student(name(8))</span><br></pre></td></tr></table></figure>

<ul>
<li>PRI为主键索引的标识</li>
<li>MUL为普通索引的标识</li>
</ul>
<h4 id="5-2-联合索引"><a href="#5-2-联合索引" class="headerlink" title="5.2 联合索引"></a>5.2 联合索引</h4><p>具有前缀特性,举个例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 有三个字段 A B C</span><br><span class="line"></span><br><span class="line"># 创建联合索引 index(A,B,C)</span><br><span class="line"></span><br><span class="line">那么在查询的时候,索引的位置只能是以下三种情况:</span><br><span class="line"></span><br><span class="line">A</span><br><span class="line"></span><br><span class="line">A B</span><br><span class="line"></span><br><span class="line">A B C</span><br><span class="line"></span><br><span class="line">===============以下情况则不允许出现================</span><br><span class="line"></span><br><span class="line">A C</span><br><span class="line"></span><br><span class="line">B C</span><br><span class="line"></span><br><span class="line">C</span><br></pre></td></tr></table></figure>

<p>因此,我们创建的时候,要考虑到以下因素:</p>
<blockquote>
<p>经常用于条件查询的字段,放在前面,例如经常查 学号(A),再查年龄(B),那么创建联合索引就可以是index(A,B)</p>
</blockquote>
<h4 id="5-3唯一索引"><a href="#5-3唯一索引" class="headerlink" title="5.3唯一索引"></a>5.3唯一索引</h4><h4 id="5-4-关于索引的相关问题"><a href="#5-4-关于索引的相关问题" class="headerlink" title="5.4 关于索引的相关问题"></a>5.4 关于索引的相关问题</h4><h5 id="1-既然索引可以加快查询速度-那么就给所有列都添加索引-可以吗"><a href="#1-既然索引可以加快查询速度-那么就给所有列都添加索引-可以吗" class="headerlink" title="1.既然索引可以加快查询速度,那么就给所有列都添加索引,可以吗"></a>1.既然索引可以加快查询速度,那么就给所有列都添加索引,可以吗</h5><p>因为索引占系统空间,而且更新数据库也需要更新索引数据,因此索引并不是越多越好.例如,几百行的小表上无需建立索引,更新频繁,读取比较少的表要少建立索引.</p>
<h5 id="2-需要在哪些列上创建索引"><a href="#2-需要在哪些列上创建索引" class="headerlink" title="2.需要在哪些列上创建索引"></a>2.需要在哪些列上创建索引</h5><ul>
<li>索引一定要创建在where后的条件列上,而不是select后的选择数据列上.</li>
<li>索引建立在_唯一值_多的大表上的列建立索引.(只有男&#x2F;女的列上不适合建立索引)</li>
</ul>
<h3 id="6-用explain优化SQL语句查询"><a href="#6-用explain优化SQL语句查询" class="headerlink" title="6.用explain优化SQL语句查询"></a>6.用explain优化SQL语句查询</h3><ol>
<li>抓慢查询: a. show full prcesslist;(现场抓) b.分析慢查询日志.(配置文件中添加long_query_time &#x3D;1 log-slow-queries &#x3D; &#x2F;..&#x2F;..&#x2F;xx.log log_queries_not_using_indexes)</li>
<li>explain语句检查索引执行情况</li>
<li>对需要建索引的列建立索引.</li>
</ol>
<h3 id="7-profile功能对SQL语句进行优化"><a href="#7-profile功能对SQL语句进行优化" class="headerlink" title="7.profile功能对SQL语句进行优化"></a>7.profile功能对SQL语句进行优化</h3><h3 id="8-增删表的字段"><a href="#8-增删表的字段" class="headerlink" title="8.增删表的字段"></a>8.增删表的字段</h3><p>alter table table_name add 字段 类型 其他;</p>
<h3 id="9-中文数据乱码问题"><a href="#9-中文数据乱码问题" class="headerlink" title="9.中文数据乱码问题"></a>9.中文数据乱码问题</h3><p>设置好以下字符集(UTF-8):</p>
<ul>
<li>Linux 客户端字符集</li>
<li>Linux 服务端字符集</li>
<li>数据库 客户端字符集</li>
<li>数据库 服务端字符集</li>
<li>具体数据库的字符集</li>
<li>表的字符集</li>
<li>PHP&#x2F;Java程序字符集</li>
</ul>
<h4 id="9-1-解决方法"><a href="#9-1-解决方法" class="headerlink" title="9.1 解决方法"></a>9.1 解决方法</h4><h5 id="临时生效-set-names-字符集"><a href="#临时生效-set-names-字符集" class="headerlink" title="临时生效:set names 字符集"></a>临时生效:set names 字符集</h5><p>相当于</p>
<p>SET character_set_client &#x3D; 字符集<br>SET character_set_results &#x3D; 字符集<br>SET character_setconnection &#x3D; 字符集</p>
<p>查看字符集更改</p>
<p>show variable like “character%”</p>
<h5 id="永久生效-mysql-–default-character-set-utf8"><a href="#永久生效-mysql-–default-character-set-utf8" class="headerlink" title="永久生效 :mysql –default-character-set &#x3D; utf8"></a>永久生效 :mysql –default-character-set &#x3D; utf8</h5><p>登录数据库的时候指定字符集</p>
<h5 id="配置文件-my-cnf更改mysqld标签下面"><a href="#配置文件-my-cnf更改mysqld标签下面" class="headerlink" title="配置文件:my.cnf更改mysqld标签下面"></a>配置文件:my.cnf更改mysqld标签下面</h5><p>在 [mysqld] 下边添加: init_connect &#x3D; ‘SET NAMES 字符集’</p>
<blockquote>
<p>客户端字符集更改,默认配置文件在&#x2F;etc&#x2F;my.cnf</p>
</blockquote>
<h5 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h5><p>在配置文件中修改[mysqld]标签下的参数,相当于在登录mysql后,修改了以下两个参数:</p>
<ul>
<li>character_set_database | gbk</li>
<li>character_set_server | gbk</li>
</ul>
<p>客户端[mysql]修改后,相当于登录mysql后,修改了以下两个参数:</p>
<ul>
<li>character_set_database</li>
<li>character_set_results</li>
<li>character_set_client</li>
</ul>
<p>另外,数据有中文与英文,建议用”utf-8”字符集.</p>
<h3 id="10-MySQL日志"><a href="#10-MySQL日志" class="headerlink" title="10.MySQL日志"></a>10.MySQL日志</h3><h4 id="10-1错误日志"><a href="#10-1错误日志" class="headerlink" title="10.1错误日志"></a>10.1错误日志</h4><ol>
<li>在配置文件中的 [mysqld_safe] 的 log-error 设置</li>
<li>启动命令添加 –log-error</li>
</ol>
<h4 id="10-2查询日志"><a href="#10-2查询日志" class="headerlink" title="10.2查询日志"></a>10.2查询日志</h4><p>在数据库中,用命令查看相关命令show variables like ‘general_log%’</p>
<p>更改(临时生效),set global general_log_file&#x3D;”全路径”</p>
<p>在配置文件中添加 general-log-file&#x3D;”全路径”</p>
<h4 id="10-3慢查询日志"><a href="#10-3慢查询日志" class="headerlink" title="10.3慢查询日志"></a>10.3慢查询日志</h4><p>这里面记录查询时间超过指定时间的语句</p>
<p>log-slow-queries&#x3D;”全路径”</p>
<p>使用mysqlsla分析慢查询,定时发给相关人员邮箱.</p>
<h4 id="10-4二进制日志"><a href="#10-4二进制日志" class="headerlink" title="10.4二进制日志"></a>10.4二进制日志</h4><p>在配置文件中,把 log_bin 打开开关, log-bin &#x3D; “全路径”</p>
<p>作用:</p>
<ol>
<li>记录更改的SQL语句</li>
<li>主从复制</li>
<li>做增量备份</li>
</ol>
<p>三种模式:</p>
<h5 id="1-Row-Level"><a href="#1-Row-Level" class="headerlink" title="1. Row Level"></a>1. Row Level</h5><p>优点 : 记录了每一个SQL执行语句的细节.<br>缺点 : 性能不足.</p>
<h5 id="2-Statement-Level-默认"><a href="#2-Statement-Level-默认" class="headerlink" title="2. Statement Level(默认)"></a>2. Statement Level(默认)</h5><p>优点 : 提高效率<br>缺点 : 简略记录SQL语句,会导致从库无法执行执行.(例如使用了一些特殊功能的语句)</p>
<h5 id="3-Mixed"><a href="#3-Mixed" class="headerlink" title="3. Mixed"></a>3. Mixed</h5><p>会分析SQL语句,根据情况选择Statement或者Row模式.</p>
<blockquote>
<p>如果对数据库要求较多,则选择Mixed</p>
</blockquote>
<h3 id="11-恢复数据库source命令"><a href="#11-恢复数据库source命令" class="headerlink" title="11.恢复数据库source命令"></a>11.恢复数据库source命令</h3><p>source 备份文件的全路径</p>
<h3 id="12-mysqlbinlog命令"><a href="#12-mysqlbinlog命令" class="headerlink" title="12.mysqlbinlog命令"></a>12.mysqlbinlog命令</h3><p>主要用于增量恢复,原本是二进制的内容解析成SQL语句.</p>
<ul>
<li>参数 :-d 指定对应的库</li>
</ul>
<ol>
<li>条件: 全备份与全备后的binlog</li>
<li>关键点 : G点 ,确定全备份之后时刻binlog文件及位置</li>
<li>恢复时尽量对外停止服务</li>
</ol>
<blockquote>
<p>如果不能停止对外服务,要怎么做?</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/378944fd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/378944fd/" class="post-title-link" itemprop="url">CentOS_6.9_下安装VirtualBox</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-05 13:52:02" itemprop="dateCreated datePublished" datetime="2017-11-05T13:52:02+00:00">2017-11-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:47" itemprop="dateModified" datetime="2024-12-22T05:27:47+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Linux-CentOS-6-9安装VirtualBox"><a href="#Linux-CentOS-6-9安装VirtualBox" class="headerlink" title="Linux_CentOS_6.9安装VirtualBox"></a>Linux_CentOS_6.9安装VirtualBox</h1><h2 id="1-安装VirtualBox"><a href="#1-安装VirtualBox" class="headerlink" title="1.安装VirtualBox"></a>1.安装VirtualBox</h2><h3 id="1-0-安装相关的环境与内核"><a href="#1-0-安装相关的环境与内核" class="headerlink" title="1.0 安装相关的环境与内核"></a>1.0 安装相关的环境与内核</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum groupinstall &quot;Development Tools&quot;</span><br><span class="line"># yum install kernel-devel</span><br><span class="line">#yum install qt qt-x11</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Qt是一个1991年由Qt Company开发的跨平台C++图形用户界面应用程序开发框架.</p>
</blockquote>
<h3 id="1-1下载VirtualBox的rpm包"><a href="#1-1下载VirtualBox的rpm包" class="headerlink" title="1.1下载VirtualBox的rpm包"></a>1.1下载VirtualBox的rpm包</h3><p>官网 <code>https://www.virtualbox.org/wiki/Downloads</code></p>
<h3 id="1-2开始安装VirtualBox"><a href="#1-2开始安装VirtualBox" class="headerlink" title="1.2开始安装VirtualBox\"></a>1.2开始安装VirtualBox\</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install VirtualBox-4.3-4.3.26_98988_el7-1.x86_64.rpm</span><br></pre></td></tr></table></figure>

<h2 id="2-在VirtualBox安装Centos-Minimal"><a href="#2-在VirtualBox安装Centos-Minimal" class="headerlink" title="2.在VirtualBox安装Centos_Minimal"></a>2.在VirtualBox安装Centos_Minimal</h2><p>现在6.9的版本,主要分分为LiveDVD,BinDvD,MinimalDvD三种版本</p>
<ul>
<li>LiveDVD是带有可以体验的系统,一般已经集成了相关的软件,如搜狐浏览器,rsync等.</li>
<li>BinDvD是普通安装版，需安装到计算机硬盘才能用，bin一般都比较大，而且包含大量的常用软件，安装时无需再在线下载（大部分情况）。</li>
<li>MinimalDvD这就是一个精简的系统.通常也就几百M.</li>
</ul>
<p>国内的镜像地址:</p>
<p>China CMCC Taian Branch（泰安移动）<br><code>http://mirrors.ta139.com/centos/</code><br>China NetEase（163网易）<br><code>http://mirrors.163.com/centos/</code><br>China Northeastern University, Shenyang Liaoni（东北大学）<br><code>http://mirror.neu.edu.cn/centos/</code><br>China Sohu Inc, Beijing P.R. China（搜狐CentOS镜像）<br><code>http://mirrors.sohu.com/centos/</code><br>China Star Studio of UESTC（电子科技大)<br><code>http://mirrors.stuhome.net/centos/</code><br>China University of Science and Tech of China（中科大）<br><code>http://centos.ustc.edu.cn/centos/</code></p>
<h3 id="2-1-安装过程中需要注意的问题"><a href="#2-1-安装过程中需要注意的问题" class="headerlink" title="2.1 安装过程中需要注意的问题"></a>2.1 安装过程中需要注意的问题</h3><ul>
<li>Disc Found 检查镜像的时候跳过.</li>
<li>注意给&#x2F;boot,swap分区分配适当的空间.</li>
</ul>
<h3 id="2-2-网卡配置"><a href="#2-2-网卡配置" class="headerlink" title="2.2 网卡配置"></a>2.2 网卡配置</h3><p>这里出现了一点点小问题:</p>
<ol>
<li>网络采用NAT的方式,物理机不能跟虚拟机互相ping通.</li>
<li>网络采用桥接模式,没有选择好对应桥接的网卡,导致不能ping通局域网内的机器.</li>
<li>虚拟机采用带链接的复制方式,网卡没有初始化,导致不能配置网络.</li>
</ol>
<h4 id="问题一"><a href="#问题一" class="headerlink" title="问题一"></a>问题一</h4><p>未解决 -.-</p>
<h4 id="问题二"><a href="#问题二" class="headerlink" title="问题二"></a>问题二</h4><p>物理机上面有多块网卡(eth0,enp7s0…),只有enp7s0连接着局域网,所以就需要通过桥接该网卡,这里要通过虚拟机的配置来实现.</p>
<h4 id="问题三"><a href="#问题三" class="headerlink" title="问题三"></a>问题三</h4><p>由于在复制虚拟机的时候,没有初始网卡,所以复制完的虚拟机,MAC地址都跟前面的机器一样,所以一定要勾选上初始网卡.</p>
<p>查看本机的网卡,可以查看 &#x2F;etc&#x2F;udev&#x2F;rules.d&#x2F;70-persistent-net.rules 文件里面的信息.</p>
<h3 id="2-3系统优化"><a href="#2-3系统优化" class="headerlink" title="2.3系统优化"></a>2.3系统优化</h3><ol>
<li>修改ssh的端口号(22),位置&#x2F;etc&#x2F;sshd&#x2F;config</li>
<li>禁止其他机器ping通 , 位置&#x2F;etc&#x2F;sysctl.conf(net.ipv4.icmp_echo_ignore_all&#x3D;1)</li>
<li>修改默认启动界面提示信息,位置 &#x2F;etc&#x2F;issue</li>
<li>修改shell登陆信息,位置&#x2F;etc&#x2F;motd</li>
<li>移动并锁住相关的命令文件,如rm指令由原来的&#x2F;bin&#x2F;rm移到其他地方.(chattr)</li>
</ol>
<h3 id="2-4-查看相关资源利用"><a href="#2-4-查看相关资源利用" class="headerlink" title="2.4 查看相关资源利用"></a>2.4 查看相关资源利用</h3><h4 id="2-4-1-CPU"><a href="#2-4-1-CPU" class="headerlink" title="2.4.1 CPU"></a>2.4.1 CPU</h4><p>lscpu</p>
<p>cat &#x2F;proc&#x2F;cpuinfo</p>
<h4 id="2-4-2-内存"><a href="#2-4-2-内存" class="headerlink" title="2.4.2 内存"></a>2.4.2 内存</h4><p>free -m</p>
<p>cat &#x2F;proc&#x2F;meminfo</p>
<h4 id="2-4-3硬盘分布情况"><a href="#2-4-3硬盘分布情况" class="headerlink" title="2.4.3硬盘分布情况"></a>2.4.3硬盘分布情况</h4><p>lsblk</p>
<p>fdisk</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/bdbb562/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/bdbb562/" class="post-title-link" itemprop="url">Linux之Saltstack自动化运维</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-10-31 21:54:19" itemprop="dateCreated datePublished" datetime="2017-10-31T21:54:19+00:00">2017-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Saltstacks"><a href="#Saltstacks" class="headerlink" title="Saltstacks"></a>Saltstacks</h1><p>是一个新的基础平台管理工具.</p>
<h2 id="0-运维重复性工作有哪些"><a href="#0-运维重复性工作有哪些" class="headerlink" title="0.运维重复性工作有哪些"></a>0.运维重复性工作有哪些</h2><ol>
<li>系统安装</li>
<li>环境部署</li>
<li>添加监控</li>
<li>代码发布</li>
<li>项目迁移</li>
<li>计划任务</li>
</ol>
<p>Saltstack主要用于解决环境部署的工作.</p>
<h2 id="1-Salt可以做什么"><a href="#1-Salt可以做什么" class="headerlink" title="1.Salt可以做什么"></a>1.Salt可以做什么</h2><ol>
<li>配置管理</li>
<li>远程命令</li>
<li>包管理</li>
</ol>
<h2 id="2-安装部署"><a href="#2-安装部署" class="headerlink" title="2.安装部署"></a>2.安装部署</h2><h3 id="2-1-客户端"><a href="#2-1-客户端" class="headerlink" title="2.1 客户端"></a>2.1 客户端</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 安装</span><br><span class="line"># yum install -y salt-monitor</span><br><span class="line"></span><br><span class="line"># 修改配置文件</span><br><span class="line"># vim /etc/salt/minion</span><br><span class="line"># ------</span><br><span class="line">master : 服务端的ip</span><br><span class="line">cachedir : /etc/salt/modules</span><br><span class="line">log_file:</span><br><span class="line">log_level:</span><br><span class="line"># --------</span><br><span class="line"></span><br><span class="line"># salt的hostname</span><br><span class="line"># vim /etc/salt/minion_id</span><br></pre></td></tr></table></figure>

<h3 id="2-2-服务端"><a href="#2-2-服务端" class="headerlink" title="2.2 服务端"></a>2.2 服务端</h3><p>yum install -y salt-master</p>
<h2 id="3-KEY管理-master"><a href="#3-KEY管理-master" class="headerlink" title="3.KEY管理(master)"></a>3.KEY管理(master)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 查看key</span><br><span class="line"># salt-key -L</span><br><span class="line"></span><br><span class="line"># 接收所有key</span><br><span class="line"># salt-key -A</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-测试-master"><a href="#4-测试-master" class="headerlink" title="4.测试(master)"></a>4.测试(master)</h2><h3 id="4-1分组管理"><a href="#4-1分组管理" class="headerlink" title="4.1分组管理"></a>4.1分组管理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">nodegroups:</span><br><span class="line">  php:&#x27;主机名字&#x27;</span><br><span class="line"></span><br><span class="line"># salt -N &#x27;组名&#x27; 模块.执行命令 &#x27;命令&#x27;</span><br><span class="line"># salt -N &#x27;php&#x27; cmd.run &#x27;uptime&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-2即时管理"><a href="#4-2即时管理" class="headerlink" title="4.2即时管理"></a>4.2即时管理</h3><ul>
<li>salt -N ‘组名’ test.ping 匹配分组主机,即时ping</li>
<li>salt -N ‘组名’ cmd.run ‘uptime’ 即时执行命令</li>
<li>salt -E ‘ops-dev{01|03}’ test.ping</li>
<li>salt ‘*’ cmd.run “ab-n 10 -c 2 “<code>http://www.google.com/</code>“ 匹配所有机器做压力测试.</li>
<li>salt -N ‘dev’ sys.doc.cmd 查看模块文档</li>
</ul>
<h3 id="4-3环境配置"><a href="#4-3环境配置" class="headerlink" title="4.3环境配置"></a>4.3环境配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/master</span><br><span class="line">#--------</span><br><span class="line">file_roots:</span><br><span class="line">    base:</span><br><span class="line">      - /srv/salt</span><br></pre></td></tr></table></figure>

<p>两个空格为一个单位.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/8dc4a755/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/8dc4a755/" class="post-title-link" itemprop="url">Web_Apache</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-10-27 14:48:28" itemprop="dateCreated datePublished" datetime="2017-10-27T14:48:28+00:00">2017-10-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h1><h2 id="0-下载地址"><a href="#0-下载地址" class="headerlink" title="0.下载地址"></a>0.下载地址</h2><p>httpd-2.4.28.tar.gz:</p>
<p><code>http://mirror.bit.edu.cn/apache/httpd/httpd-2.4.28.tar.gz</code></p>
<p>apr-util-1.6.1:</p>
<p><code>http://mirror.bit.edu.cn/apache/apr/apr-util-1.6.1.tar.gz</code></p>
<p>apr-1.6.3:</p>
<p><code>http://mirror.bit.edu.cn/apache/apr/apr-1.6.3.tar.gz</code></p>
<p>开始安装前,把必要的编译库安装上:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall Development tools Compatibility libraries Chinese Support [zh] -y</span><br></pre></td></tr></table></figure>

<p>需要的依赖文件:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install pcre-devel openssl openssl-devel -y</span><br></pre></td></tr></table></figure>

<p>编译安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">./configure \</span><br><span class="line">--prefix=/usr/local/httpd-2.x.x \</span><br><span class="line">--sysconfdir=/etc/httpd \</span><br><span class="line">--with-apr=/usr/local/apr \</span><br><span class="line">--with-apr-util=/usr/local/apr-util \</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">允许压缩,提升效率</span></span><br><span class="line">--enable-deflate \</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">浏览器打开页面后有缓存</span></span><br><span class="line">--enable-expires \</span><br><span class="line">--enbale-headers \</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">激活大部分模块</span></span><br><span class="line">--enable-modules=most \</span><br><span class="line">--enable-so \</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">worker模式</span></span><br><span class="line">--with-mpm=worker \</span><br><span class="line">--enable-rewrite</span><br></pre></td></tr></table></figure>

<p>编辑&#x2F;conf下的httpd.conf</p>
<ul>
<li>网页首页与目录权限设定（DocumentRoot 与 Directory）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#添加虚拟主机</span><br><span class="line">Include conf/extra/httpd-vhosts.conf</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Directory</span> &quot;<span class="attr">路径</span>&quot;&gt;</span></span><br><span class="line">    Options -Indexes +FollowSymLinks</span><br><span class="line">    Order allow,deny</span><br><span class="line">    Allow from all</span><br><span class="line"><span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br><span class="line"></span><br><span class="line">#添加两行</span><br><span class="line">AddType application/x-httpd-php .php .phtmls</span><br><span class="line">AddType application/x-httpd-php-source .php5</span><br></pre></td></tr></table></figure>
<h2 id="httpd-conf-配置文件"><a href="#httpd-conf-配置文件" class="headerlink" title="httpd.conf 配置文件"></a>httpd.conf 配置文件</h2><p>一般在 &#x2F;etc&#x2F;httpd&#x2F;httpd.conf</p>
<h3 id="Diretory-节点"><a href="#Diretory-节点" class="headerlink" title="Diretory 节点"></a>Diretory 节点</h3><p>Options 可选参数:</p>
<ul>
<li>Indexes：如果在此目录下找不到 index.html 时， 就顯示整個目錄下的檔案名稱，至於『首頁檔案檔名』則與 DirectoryIndex 設定值有關。</li>
<li>FollowSymLinks：這是 Follow Symbolic Links 的縮寫， 字面意義是讓連結檔可以生效的意思。我們知道首頁目錄在 &#x2F;var&#x2F;www&#x2F;html，既然是 WWW 的根目錄，理論上就像被 chroot 一般！ 一般來說被 chroot 的程式將無法離開其目錄，也就是說預設的情況下，你在 &#x2F;var&#x2F;www&#x2F;html 底下的連結檔只要連結到非此目錄的其他地方，則該連結檔預設是失效的。 但使用此設定即可讓連結檔有效的離開本目錄。</li>
<li>ExecCGI：讓此目錄具有執行 CGI 程式的權限，非常重要！舉例來說，之前熱門的OpenWebMail 使用了很多的 perl 的程式，你要讓 OpenWebMail 可以執行，就得要在該程式所在目錄擁有 ExecCGI 的權限才行喔！但請注意，不要讓所有目錄均可使用 ExecCGI ！</li>
<li>Includes：讓一些 Server-Side Include 程式可以運作。建議可以加上去！</li>
<li>MultiViews：這玩意兒有點像是多國語言的支援，與語系資料 (LanguagePriority) 有關。最常見在錯誤訊息的回報內容，在同一部主機中，可以依據用戶端的語系而給予不同的語言顯示呢！ 預設在錯誤回報訊息當中存在，你可以檢查一下&#x2F;var&#x2F;www&#x2F;error&#x2F; 目錄下的資料喔！</li>
</ul>
<p>AllowOverride:</p>
<p>表示是否允許額外設定檔 .htaccess 的某些參數覆寫？我們可以在 httpd.conf 內設定好所有的權限，不過如此一來若使用者自己的個人網頁想要修改權限時將會對管理員造成困擾。因此 Apache 預設可以讓使用者以目錄底下的 .htaccess 檔案內覆寫 <Directory> 內的某些功能參數。</p>
<ul>
<li>ALL：全部的權限均可被覆寫；</li>
<li>AuthConfig：僅有網頁認證 (帳號密碼) 可覆寫；</li>
<li>Indexes：僅允許 Indexes 方面的覆寫；</li>
<li>Limits：允許使用者利用 Allow, Deny 與 Order 管理可瀏覽的權限；</li>
<li>None：不可覆寫，亦即讓 .htaccess 檔案失效！</li>
</ul>
<p>Order:</p>
<p>決定此目錄是否可被 apache 的 PID 所瀏覽的權限設定啦！能否被瀏覽主要有兩種判定的方式：</p>
<ul>
<li>deny,allow：以 deny 優先處理，但沒有寫入規則的則預設為 allow 喔。</li>
<li>allow,deny：以 allow 為優先處理，但沒有寫入規則的則預設為 deny 喔。 所以在預設的環境中，因為是 allow,deny 所以預設為 deny (不可瀏覽)，不過在下一行有個</li>
<li>Allow from all，allow 優先處理，因此全部 (all) 用戶端皆可瀏覽啦！</li>
</ul>
<h2 id="1-重要目录以及文件"><a href="#1-重要目录以及文件" class="headerlink" title="1.重要目录以及文件"></a>1.重要目录以及文件</h2><h3 id="htdocs-目录下面"><a href="#htdocs-目录下面" class="headerlink" title="htdocs 目录下面"></a>htdocs 目录下面</h3><p>这是编译安装默认的站点目录.</p>
<h3 id="logs-目录下面"><a href="#logs-目录下面" class="headerlink" title="logs 目录下面"></a>logs 目录下面</h3><ul>
<li>access_log - 这是apache的默认访问日志,使用tail-faccess.og可以实时观看网站用户的访问情况.</li>
<li>error_log - 这是apache的错误日志文件,如果apache出现启动故障等问题,一定要看这个错误日志.</li>
<li>httpd.pid - http的pid文件,http进程启动后,会把所有进程的ID号写到此文件.</li>
</ul>
<h3 id="modules-目录"><a href="#modules-目录" class="headerlink" title="modules 目录"></a>modules 目录</h3><p>apache的模块目录,比如 php等.</p>
<h3 id="bin-目录下面"><a href="#bin-目录下面" class="headerlink" title="bin 目录下面"></a>bin 目录下面</h3><ul>
<li>ab - Apache HTTP服务器性能测试工具,简单&#x2F;易用.同类软件还有jmeter,loadrunner,webbench等.</li>
<li>apachectl - 这是apache的启动命令,apachectl是一个脚本.</li>
<li>apxs - Apache HTTP服务器编译和安装拓展模块的工具,在进行DSO方式编译模块时会用到,–with-apxs2&#x3D;&#x2F;application&#x2F;apache&#x2F;bin&#x2F;apxs</li>
<li>htcaheclean - 这是清理磁盘缓冲区的命令,需要在编译时指定相关参数才可以使用.</li>
<li>htpasswd - 建立和更新基本认证文件,如:配置nagios等监控服务时会用到.</li>
<li>httpd - Apache的控制命令程序,apachectl执行时会调用httpd</li>
<li>rotatelogs - apache自带的日志轮询命令.</li>
</ul>
<h3 id="conf-目录下面"><a href="#conf-目录下面" class="headerlink" title="conf 目录下面"></a>conf 目录下面</h3><ul>
<li>extra - 这是额外的apache配置文件的陆慕,这个目录里面的文件会经常访问,如:httpd-vhosts.conf默认就在这个目录.</li>
<li>httpd.conf - apache的主配置文件,这个文件也会经常访问修改,其中每一行的参数作用都应该弄清除明白</li>
</ul>
<h4 id="进入主配置文件http-conf"><a href="#进入主配置文件http-conf" class="headerlink" title="进入主配置文件http.conf"></a>进入主配置文件http.conf</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ServerRoot //根目录</span><br><span class="line">Listen //端口</span><br><span class="line">User</span><br><span class="line">Group</span><br><span class="line">ServerAdmin you@example.com</span><br><span class="line">DocumentRoot //站点根目录</span><br><span class="line"><span class="tag">&lt;<span class="name">Directory</span> /&gt;</span> //禁止任何人访问根目录</span><br><span class="line">    Options FollowSymLinks</span><br><span class="line">    AllowOverride None</span><br><span class="line">    Order dely,allow</span><br><span class="line">    Deny from all</span><br><span class="line"><span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//创建了新的站点目录</span><br><span class="line"><span class="tag">&lt;<span class="name">Directory</span> &quot;/<span class="attr">application</span>/<span class="attr">apache</span>/<span class="attr">htdocs</span>&quot;&gt;</span></span><br><span class="line">    Options Indexes FollowSymLinks //Indexes这个参数非常危险,会展现目录结构;优化是删除或者添加-Indexes;</span><br><span class="line">    AllowOverride None</span><br><span class="line">    Order allow,deny</span><br><span class="line">    Allow from all</span><br><span class="line"><span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>检查语法 : &#x2F;bin&#x2F;apachectl -graceful</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/6bb1d632/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/6bb1d632/" class="post-title-link" itemprop="url">Linux之负载均衡</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-10-26 22:56:01" itemprop="dateCreated datePublished" datetime="2017-10-26T22:56:01+00:00">2017-10-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Linux之负载均衡"><a href="#Linux之负载均衡" class="headerlink" title="Linux之负载均衡"></a>Linux之负载均衡</h1><h2 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h2><p>集群通信系统是一种用于集团调度指挥通信的移动通信系统，主要应用在专业移动通信领域。该系统具有的可用信道可为系统的全体用户共用，具有自动选择信道功能，它是共享资源、分担费用、共用信道设备及服务的多用途、高效能的无线调度通信系统。</p>
<ul>
<li>特点: 高性能</li>
</ul>
<h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><p>负载均衡，英文名称为Load Balance，其意思就是分摊到多个操作单元上进行执行，例如Web服务器、FTP服务器、企业关键应用服务器和其它关键任务服务器等，从而共同完成工作任务。</p>
<h2 id="方向代理"><a href="#方向代理" class="headerlink" title="方向代理"></a>方向代理</h2><p>反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。</p>
<h2 id="用Nginx-来做负载均衡"><a href="#用Nginx-来做负载均衡" class="headerlink" title="用Nginx 来做负载均衡"></a>用Nginx 来做负载均衡</h2><p>Nginx可以做反向代理.</p>
<h2 id="语法说明"><a href="#语法说明" class="headerlink" title="语法说明"></a>语法说明</h2><ol>
<li>upstream 模块应放于nginx.conf配置的http{}标签内.</li>
<li>upstream模块默认算法是wrr(权重轮询 weighted round-robin)</li>
</ol>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Server 10.0.10.8:80</td>
<td align="center">负载均衡后面的RS配置,可以是IP或域名,端口不写,默认是80;高并发场景IP要换成域名,通过DNS做负载均衡.</td>
</tr>
<tr>
<td align="center">weight</td>
<td align="center">权重,默认是1,权重越大接受的请求越多</td>
</tr>
<tr>
<td align="center">max_fails&#x3D;2</td>
<td align="center">最大尝试失败的次数,默认是1,-标识禁止失败尝试.一般建议2-3次</td>
</tr>
<tr>
<td align="center">backup</td>
<td align="center">热备配置(RSYNC节点的高可用)</td>
</tr>
<tr>
<td align="center">fail_timeout&#x3D;20s</td>
<td align="center">失败超时时间,默认是10s</td>
</tr>
<tr>
<td align="center">down</td>
<td align="center">标志服务器不可用</td>
</tr>
</tbody></table>
<h2 id="调度算法"><a href="#调度算法" class="headerlink" title="调度算法"></a>调度算法</h2><ol>
<li>静态调度: rr ,ip_hash , wrr</li>
<li>动态调度: least_conn , fair</li>
</ol>
<h3 id="一致性缓存"><a href="#一致性缓存" class="headerlink" title="一致性缓存"></a>一致性缓存</h3><p>由于url_hash在处理宕机或者新增的机器会对缓存压力比较大.</p>
<p>因此一致性hash可以减少宕机情况对整个服务器缓存动荡.</p>
<h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># Nginx:</span><br><span class="line"></span><br><span class="line"># ./configure --prefix=/application/nginx --user=nginx --group=nginx --with-http_ssl_module --with-http_stub_status_module</span><br><span class="line"></span><br><span class="line"># 配置均衡器</span><br><span class="line"># 需要的模块 : upstream ,http_proxy</span><br><span class="line"></span><br><span class="line"># vim lb.conf</span><br><span class="line">#--------------</span><br><span class="line"></span><br><span class="line"># 定义节点与调度算法</span><br><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com weight=5;</span><br><span class="line">    server backend2.example.com:800;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#http_proxy负责转发与算法</span><br><span class="line">#默认轮询算法(静态算法)</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>proxy_pass 模块用于转发用户的请求</p>
</blockquote>
<h3 id="2-运行流程"><a href="#2-运行流程" class="headerlink" title="2. 运行流程"></a>2. 运行流程</h3><p>Web服务器:</p>
<ol>
<li>172.16.177.137</li>
<li>172.16.177.138</li>
</ol>
<p>LB 服务器 :</p>
<p>172.16.177.139</p>
<p>目标域名:</p>
<ol>
<li>172.16.177.137 blog.test.org bbs.test.org</li>
<li>172.16.177.138 blog.test.org bbs.test.org</li>
<li>172.16.177.139 blog.test.org bbs.test.org</li>
</ol>
<p>在客户机上面添加LB服务器的解析</p>
<blockquote>
<p>echo “ 172.16.177.139 blog.test.org bbs.test.org” &gt;&gt; &#x2F;etc&#x2F;hosts</p>
</blockquote>
<p>客户端–访问blog域名–LB服务器解析–proxy_pass–Web服务器</p>
<h3 id="3-用户请求细节"><a href="#3-用户请求细节" class="headerlink" title="3.用户请求细节"></a>3.用户请求细节</h3><blockquote>
<p>[请求代理主机访问多虚拟主机]用户向代理服务器发送请求(包含请求头),再有代理服务器向后请求(会丢失请求头).</p>
</blockquote>
<p>proxy_set_header Host $host</p>
<h3 id="4-动静分离"><a href="#4-动静分离" class="headerlink" title="4. 动静分离"></a>4. 动静分离</h3><ul>
<li>当用户请求<a target="_blank" rel="noopener" href="http://www.test.com/upload/xx%E5%9C%B0%E5%9D%80%E5%AE%9E%E7%8E%B0%E7%94%B1upload%E4%B8%8A%E4%BC%A0%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82">www.test.com/upload/xx地址实现由upload上传服务器处理请求</a>.</li>
<li>当用户请求<a target="_blank" rel="noopener" href="http://www.test.com/static/xx%E5%9C%B0%E5%9D%80%E5%AE%9E%E7%8E%B0%E7%94%B1%E9%9D%99%E6%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B1%A0%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82">www.test.com/static/xx地址实现由静态服务器池处理请求</a>.</li>
<li>除此之外,对于其他访问请求,全都由默认的动态服务器池处理请求.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">upstream static_pools&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream upload_pools&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">upstream default_pools&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server&#123;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://default_pools;</span><br><span class="line">    &#125;</span><br><span class="line">    location /static/ &#123;</span><br><span class="line">        proxy_pass http://static_pools;</span><br><span class="line">    &#125;</span><br><span class="line">    location /upload/ &#123;</span><br><span class="line">        proxy_pass http://upload_pools;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-根据不同客户端返回响应内容"><a href="#5-根据不同客户端返回响应内容" class="headerlink" title="5.根据不同客户端返回响应内容"></a>5.根据不同客户端返回响应内容</h3><p>http_user_agent</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if($http_user_agent ~* &quot;MSIE&quot;)</span><br><span class="line">&#123;</span><br><span class="line">    proxy_pass http://...;</span><br><span class="line">&#125;</span><br><span class="line">if($http_user_agent ~* &quot;Chrome&quot;)</span><br><span class="line">&#123;</span><br><span class="line">    proxy_pass http://...;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/72a8feff/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/72a8feff/" class="post-title-link" itemprop="url">PHP相关过程的问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-10-23 22:54:31" itemprop="dateCreated datePublished" datetime="2017-10-23T22:54:31+00:00">2017-10-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="错误或者问题集锦"><a href="#错误或者问题集锦" class="headerlink" title="错误或者问题集锦"></a>错误或者问题集锦</h1><h2 id="1-用curl命令出现”file-not-found”"><a href="#1-用curl命令出现”file-not-found”" class="headerlink" title="1.用curl命令出现”file not found”"></a>1.用curl命令出现”file not found”</h2><p>这里可能是php解析出了问题,或者是配置php节点.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location ~* \.(ph|php5)?$</span><br><span class="line">&#123;</span><br><span class="line">    fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">    fastcgi_index index.php;</span><br><span class="line">    include fastcgi.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/c036635b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/c036635b/" class="post-title-link" itemprop="url">PHP</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-10-21 23:33:47" itemprop="dateCreated datePublished" datetime="2017-10-21T23:33:47+00:00">2017-10-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="LNMP之PHP"><a href="#LNMP之PHP" class="headerlink" title="LNMP之PHP"></a>LNMP之PHP</h1><h2 id="1-CGI"><a href="#1-CGI" class="headerlink" title="1.CGI"></a>1.CGI</h2><p>CGI(Common Gateway Interface),通用网关接口,用于HTTP服务器与其他机器上的程序服务通信交流的一种工具,CGI程序必须运行在网络服务器上.</p>
<ul>
<li>主要缺点: 性能差,因为每次HTTP服务器遇到动态程序都需要重新启动解析器来解析,然后再将结果返回给HTTP服务器.</li>
</ul>
<h2 id="2-FASTCGI"><a href="#2-FASTCGI" class="headerlink" title="2.FASTCGI"></a>2.FASTCGI</h2><p>是一个可伸缩,高速地在HTTP服务器和动态脚本语言间通信的接口.(Linux 下是Socket,也可以是ip_Socket)</p>
<ul>
<li>主要优点: 动态语言和HTTP服务器分离出来.主要支持Apache,Nginx,lighttpd.</li>
<li>接口采用C&#x2F;S结构,分为客户端(HTTP服务器)和服务端(动态语言解析服务器)</li>
<li>PHP动态语言服务端可以启动多个FastCGI的守护进程</li>
<li>http服务器通过 FastCGI客户端和动态语言FastCGI服务端通信.(例如php-fpm)</li>
</ul>
<h3 id="2-1-运行原理"><a href="#2-1-运行原理" class="headerlink" title="2.1.运行原理"></a>2.1.运行原理</h3><p>Nginx不支持对外部动态程序的直接调用或者解析,所有的外部程序(包括PHP)必须他通过FastCGI接口来调用.</p>
</br>

<p>FastCGI接口在Linux下是Socket(这个Socket可以是文件,也可以是ip socket).</p>
</br>

<p>为了调用CGI程序,还需要一个FastCGI的wrapper(wrapper可以理解成用于启动另一个程序的程序,包装),这个wrapper绑定在某一个固定socket上,如端口或者文件socket.</p>
</br>

<p>当Nginx将CGI请求发送给这个Socket的时候,通过FastCGI接口,wrapper接收到请求,然后派生出一个新的线程,这个线程调用解释器或者外部程序处理脚本并读取返回数据.</p>
</br>

<p>wrapper再将返回的数据通过FastCGI接口,沿着固定的socket传递给Nginx,最后Nginx将数据发送给客户端.</p>
<h2 id="3-安装PHP"><a href="#3-安装PHP" class="headerlink" title="3.安装PHP"></a>3.安装PHP</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">wget http://cn.php.net/get/php-5.3.27.tar.gz/from/cn2.php.net/mirror</span><br><span class="line"></span><br><span class="line">wget http://cn2.php.net/get/php-5.3.27.tar.gz/from/this/mirror</span><br><span class="line"></span><br><span class="line"># 安装相关的依赖库</span><br><span class="line"></span><br><span class="line"># 需要的软件有:zlib libxml libjpeg freetype libpng gd curl libiconv zlib-devel libxml2-devel libjpeg-devel freetype-devel libpng-devel gd-devel curl-devel</span><br><span class="line"></span><br><span class="line">yum install zlib-devel libxml2-devel libjpeg-devel libiconv-devel</span><br><span class="line">yum install freetype-devel libpng-devel gd-devel curl-devel</span><br><span class="line"></span><br><span class="line"># 安装libmcrypt库,在此采用的是epel源方法来安装libmcrypt包</span><br><span class="line"></span><br><span class="line">yum -y install libmcrypt</span><br><span class="line"></span><br><span class="line"># 执行安装脚本</span><br><span class="line">vim install.sh</span><br><span class="line">#---------------</span><br><span class="line">./configure \</span><br><span class="line">--prefix=/application/php-5.3.27 \</span><br><span class="line">--with-mysql=/application/mysql \</span><br><span class="line">--with-iconv-dir=/usr/local/libiconv \</span><br><span class="line">--with-freetype-dir \</span><br><span class="line">--with-jpeg-dir \</span><br><span class="line">--with-png-dir \</span><br><span class="line">--with-zlib \</span><br><span class="line">--with-libxml-dir=/usr \</span><br><span class="line">--enable-xml \</span><br><span class="line">--disable-rpath \</span><br><span class="line">--enable-safe-mode \</span><br><span class="line">--enable-bcmath \</span><br><span class="line">--enable-shmop \</span><br><span class="line">--enable-sysvsem \</span><br><span class="line">--enable-inline-optimization \</span><br><span class="line">--with-curlwrappers \</span><br><span class="line">--enable-mbregex \</span><br><span class="line">--enable-mbstring \</span><br><span class="line">--enable-fpm \</span><br><span class="line">--with-mcrypt \</span><br><span class="line">--with-gd \</span><br><span class="line">--enable-gd-native-ttf \</span><br><span class="line">--with-openssl \</span><br><span class="line">--with-mhash \</span><br><span class="line">--enable-pcntl \</span><br><span class="line">--enable-sockets \</span><br><span class="line">--with-xmlrpc \</span><br><span class="line">--enable-zip \</span><br><span class="line">--enable-soap \</span><br><span class="line">--enable-short-tags \</span><br><span class="line">--enable-zend-multibyte \</span><br><span class="line">--enable-static \</span><br><span class="line">--with-xsl \</span><br><span class="line">--with-fpm-user=nginx \</span><br><span class="line">--with-fpm-group=nginx \</span><br><span class="line">--enable-ftp</span><br><span class="line"></span><br><span class="line"># -------------</span><br><span class="line"></span><br><span class="line"># Before make</span><br><span class="line">ln -s /application/mysql/lib/libmysqlclient.so.18 /usr/lib64/</span><br><span class="line"></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"># 配置php解析文件</span><br><span class="line"># 在php主目录下</span><br><span class="line">cp php.ini-production   /application/php/lib/php.ini</span><br><span class="line"></span><br><span class="line">#在软件目录下的etc文件夹内</span><br><span class="line">cp php-fpm.conf.default  ./php-fpm.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 启动php进程</span><br><span class="line">/php/sbin/php-fpm</span><br><span class="line">lsof -i:9000</span><br><span class="line"></span><br><span class="line"># 测试</span><br><span class="line"># 在nginx的一个站点下写一个</span><br><span class="line"># test_phpinfo.php代码测试php</span><br><span class="line">#------</span><br><span class="line">&lt;?php</span><br><span class="line">    phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line">#-------</span><br><span class="line"></span><br><span class="line"># 编辑location节点</span><br><span class="line"># ------------</span><br><span class="line">location ~*.\.php  &#123;</span><br><span class="line">    fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 输入域名测试</span><br></pre></td></tr></table></figure>

<h3 id="3-1-知识补充-Nginx-location语法"><a href="#3-1-知识补充-Nginx-location语法" class="headerlink" title="3.1.知识补充:Nginx location语法"></a>3.1.知识补充:Nginx location语法</h3><ul>
<li>&#x3D; 严格匹配。如果这个查询匹配，那么将停止搜索并立即处理此请求。</li>
<li>~ 为区分大小写匹配(可用正则表达式)</li>
<li>!~为区分大小写不匹配</li>
<li>~* 为不区分大小写匹配(可用正则表达式)</li>
<li>!~*为不区分大小写不匹配</li>
<li>^~ 如果把这个前缀用于一个常规字符串,那么告诉nginx 如果路径匹配那么不测试正则表达式。</li>
</ul>
<h2 id="4-WordPress博客实战"><a href="#4-WordPress博客实战" class="headerlink" title="4.WordPress博客实战"></a>4.WordPress博客实战</h2><h3 id="4-1到官网下载tar文件"><a href="#4-1到官网下载tar文件" class="headerlink" title="4.1到官网下载tar文件"></a>4.1到官网下载tar文件</h3><p><a target="_blank" rel="noopener" href="http://www.wordpress.org/">www.wordpress.org</a></p>
<p>&lt;a href&#x3D;&#96;http:<a target="_blank" rel="noopener" href="http://www.wordpress.org/">www.wordpress.org</a> &gt;下载地址</a></p>
<h3 id="4-2解压安装"><a href="#4-2解压安装" class="headerlink" title="4.2解压安装"></a>4.2解压安装</h3><p>tar xvf wordpress.tar</p>
<p>复制当前整个目录到nginx的html的blog文件节点下.</p>
<h3 id="4-3修改blog节点的配置文件"><a href="#4-3修改blog节点的配置文件" class="headerlink" title="4.3修改blog节点的配置文件"></a>4.3修改blog节点的配置文件</h3><p>vim &#x2F;conf&#x2F;nginx.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name blog.test.org;</span><br><span class="line">    root html/blog;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        index index.php index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~*.\.(php|php5)?$</span><br><span class="line">    &#123;</span><br><span class="line">        fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">    include fastcgi.conf;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ngnix -t</span><br><span class="line"># ngnix -s reload</span><br></pre></td></tr></table></figure>

<h3 id="4-4出现的问题"><a href="#4-4出现的问题" class="headerlink" title="4.4出现的问题"></a>4.4出现的问题</h3><h4 id="403"><a href="#403" class="headerlink" title="403"></a>403</h4><p>这个问题可能是html目录下的权限问题导致的.</p>
<h4 id="没有安装mysql拓展"><a href="#没有安装mysql拓展" class="headerlink" title="没有安装mysql拓展"></a>没有安装mysql拓展</h4><p>默认的php配置文件在.&#x2F;lib下</p>
<ol>
<li>yum install mysql-devel</li>
<li>修改php目录下面的php.ini ,在里面添加两个命令 :</li>
</ol>
<p>extension&#x3D;mysql.so<br>extension&#x3D;”&#x2F;usr&#x2F;lib64&#x2F;php&#x2F;modules&#x2F;“</p>
<h4 id="4-3-1-location匹配字符讲解"><a href="#4-3-1-location匹配字符讲解" class="headerlink" title="4.3.1 location匹配字符讲解"></a>4.3.1 location匹配字符讲解</h4><ul>
<li>&#x3D; 开头表示精确匹配</li>
<li>^~ 开头表示uri以某个常规字符串开头，理解为匹配 url路径即可。nginx不对url做编码，因此请求为&#x2F;static&#x2F;20%&#x2F;aa，可以被规则^~ &#x2F;static&#x2F; &#x2F;aa匹配到（注意是空格）。</li>
<li>~ 开头表示区分大小写的正则匹配</li>
<li>~* 开头表示不区分大小写的正则匹配</li>
<li>!<del>和!</del>*分别为区分大小写不匹配及不区分大小写不匹配 的正则</li>
<li>&#x2F; 通用匹配，任何请求都会匹配到。</li>
</ul>
<h2 id="5-BBS实战"><a href="#5-BBS实战" class="headerlink" title="5.BBS实战"></a>5.BBS实战</h2><h3 id="5-1创建用户"><a href="#5-1创建用户" class="headerlink" title="5.1创建用户"></a>5.1创建用户</h3><h3 id="5-2创建配置文件"><a href="#5-2创建配置文件" class="headerlink" title="5.2创建配置文件"></a>5.2创建配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"></span><br><span class="line">    listen 80;</span><br><span class="line">    server_name bbs.test.org;</span><br><span class="line">    location / &#123;</span><br><span class="line">        index index.php index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">    location ~* \.(php|php5)?$ &#123;</span><br><span class="line">        fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        fastcgi_index index_php;</span><br><span class="line">        include fastcgi.conf;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-3将相关的文件放置html的节点下"><a href="#5-3将相关的文件放置html的节点下" class="headerlink" title="5.3将相关的文件放置html的节点下"></a>5.3将相关的文件放置html的节点下</h3><p>下载Discuz,解压,将.&#x2F;upload里面的内容解压至html&#x2F;bbs;</p>
<h3 id="5-4给该目录文件授权"><a href="#5-4给该目录文件授权" class="headerlink" title="5.4给该目录文件授权"></a>5.4给该目录文件授权</h3><p>因为我们是在root用户下面操作的,所以所有文件或文件夹,操作用户是root,属组也是root,而我们通过nginx连上的网页,用户默认为nginx,因此在安装的时候,会显示相关目录不能读写.</p>
<h3 id="5-5完成测试"><a href="#5-5完成测试" class="headerlink" title="5.5完成测试"></a>5.5完成测试</h3><p>安装完成后,需要将该虚拟主机的域名添加至hosts文件中.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/38/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/38/">38</a><span class="page-number current">39</span><a class="page-number" href="/page/40/">40</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/40/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Rohman.Zhu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
