<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"github.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="诺曼实验室">
<meta property="og:url" content="http://github.com/rohman-zhu/page/38/index.html">
<meta property="og:site_name" content="诺曼实验室">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Rohman.Zhu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://github.com/rohman-zhu/page/38/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh_cn","comments":"","permalink":"","path":"page/38/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>诺曼实验室</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">诺曼实验室</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Rohman.Zhu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">430</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">144</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/bba993c5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/bba993c5/" class="post-title-link" itemprop="url">LVS&Keepalived集群架构服务应用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-23 08:32:22" itemprop="dateCreated datePublished" datetime="2017-11-23T08:32:22+00:00">2017-11-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="LVS-Keepalive"><a href="#LVS-Keepalive" class="headerlink" title="LVS &amp; Keepalive"></a>LVS &amp; Keepalive</h1><p><code>http://www.linuxvirtualserver.org/zh/</code></p>
<h2 id="相关名词"><a href="#相关名词" class="headerlink" title="相关名词"></a>相关名词</h2><table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Virtual IP Address</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">Real Server IP Address</td>
<td align="center">在集群下面节点上使用的IP地址,物理IP地址</td>
</tr>
<tr>
<td align="center">Director IP Address</td>
<td align="center">用于连接内网的IP地址,实际为物理网卡的IP地址</td>
</tr>
<tr>
<td align="center">Client IP Address</td>
<td align="center">客户端用户计算机请求集群服务器的IP地址</td>
</tr>
</tbody></table>
<h2 id="LVS"><a href="#LVS" class="headerlink" title="LVS"></a>LVS</h2><p>Linux Virtual Server</p>
<blockquote>
<p>使用软件配置LVS时,不能直接配置内核中的ipvs,而是需要管理工具ipvsadm进行管理.</p>
</blockquote>
<p>小结笔记:</p>
<ol>
<li>实现负载调度的工具是IPVS,工作在LINUX内核层面</li>
<li>LVS自带的IPVS管理工具是ipvsadm</li>
<li>keepalived实现管理IPVS以及对负载均衡器的高可用.</li>
<li>RedHat工具Piranha_Web管理实现调度的工具IPVS</li>
</ol>
<h2 id="LVS-集群的三种模式"><a href="#LVS-集群的三种模式" class="headerlink" title="LVS 集群的三种模式"></a>LVS 集群的三种模式</h2><h3 id="ARP协议"><a href="#ARP协议" class="headerlink" title="ARP协议"></a>ARP协议</h3><p>Address Resolution Protocol , 地址解析协议,使用ARP协议可实现通过IP地址获得对应主机的物理地址(MAC).</p>
<p>32位的IP地址 –&gt; 48位的MAC地址</p>
<blockquote>
<p>ARP协议不需要配置服务<br>ARP协议要求通信的主机双方必须在同一个物理网段<br>ARP是第三层协议(OSI)</p>
</blockquote>
<h3 id="查询ARP"><a href="#查询ARP" class="headerlink" title="查询ARP"></a>查询ARP</h3><h4 id="Windows下"><a href="#Windows下" class="headerlink" title="Windows下"></a>Windows下</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># arp -a 查询所有缓存表</span><br><span class="line"># arp -d 清除ARP缓存表</span><br><span class="line"># arp -s 绑定ARP</span><br></pre></td></tr></table></figure>

<h4 id="Linux下"><a href="#Linux下" class="headerlink" title="Linux下"></a>Linux下</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -c 次数 -s 源</span></span><br><span class="line">/sbin/arping -I eth0 -c 3 -s 10.0.0.162 10.0.0.253</span><br><span class="line">/sbin/arping -U -I eth0 10.0.0.162</span><br><span class="line">NAME arping -send ARP REQUEST to a neighbour host</span><br><span class="line">SYNOPSIS arping [-c count][-w dead-line][-s <span class="built_in">source</span>] -I interface destination</span><br></pre></td></tr></table></figure>

<h4 id="ARP-缓存表是一把双刃剑"><a href="#ARP-缓存表是一把双刃剑" class="headerlink" title="ARP 缓存表是一把双刃剑"></a>ARP 缓存表是一把双刃剑</h4><ol>
<li>主机有了ARP缓存表,可以加快ARP的解析速度,减少局域网内广播风暴.</li>
<li>正时游了ARP缓存表,给恶意黑客带来了共计服务器主机的风险,这就是ARP欺骗攻击.</li>
<li>切换路由器,负载均衡器等设备时,可能会导致网络中断.</li>
</ol>
<h5 id="如何无缝添加新的路由器"><a href="#如何无缝添加新的路由器" class="headerlink" title="如何无缝添加新的路由器"></a>如何无缝添加新的路由器</h5><p>要求:</p>
<ol>
<li>旧的配置导入新的配置里面.</li>
<li>arping 指定客户端所有ARP缓存表.</li>
<li>切换路由器,负载均衡器等设备时,可以能会导致网络中断.</li>
</ol>
<h5 id="ARP的相关问题"><a href="#ARP的相关问题" class="headerlink" title="ARP的相关问题"></a>ARP的相关问题</h5><ol>
<li>ARP病毒,ARP欺骗</li>
<li>高可用服务器之间切换时要考虑ARP缓存问题</li>
<li>路由器等设备无缝迁移时要考虑ARP缓存问题</li>
</ol>
<h3 id="VS-NAT"><a href="#VS-NAT" class="headerlink" title="VS&#x2F;NAT"></a>VS&#x2F;NAT</h3><p>Virtual Server via Network Address Translation</p>
<blockquote>
<p>入站DNAT,出站SANT,入站出站都经过LVS,可以修改端口.</p>
</blockquote>
<h3 id="VS-DR"><a href="#VS-DR" class="headerlink" title="VS&#x2F;DR"></a>VS&#x2F;DR</h3><p>Virtual Server via Direct Routing(直接路由)</p>
<p>主要特征:</p>
<ul>
<li>LVS只负责入站请求</li>
</ul>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><ol>
<li>通过更改数据包的目标MAC地址实现数据包转发.</li>
<li>所有节点和LVS要处于一个局域网.</li>
</ol>
<blockquote>
<p>修改数据包的目的MAC地址,入站经过LVS,出站不经过LVS,直接返回给客户,不能改端口,LAN内使用</p>
</blockquote>
<h3 id="TUN"><a href="#TUN" class="headerlink" title="TUN"></a>TUN</h3><p>IP Tunneling</p>
<p>原理:</p>
<ol>
<li>负载均衡通过把请求的报文通过IP隧道的方式转发至真实服务器,而真实服务器将响应处理后返回客户端用户.(请求报文不经过原目的地址的改写(包括MAC),直接封装成另外的IP报文)</li>
<li>由于真实服务器将响应处理后的报文直接返回给客户端用户,因此,最好RSYNC有一个外网IP地址.</li>
</ol>
<blockquote>
<p>不改变数据包内容,数据包外部封装一个IP头,入站经过LVS,出站不经过LVS,直接返回客户,不能改端口,LAN&#x2F;WAN使用</p>
</blockquote>
<h3 id="FULLNAT"><a href="#FULLNAT" class="headerlink" title="FULLNAT"></a>FULLNAT</h3><p>Full Network Address Translation</p>
<h3 id="LVS调度算法"><a href="#LVS调度算法" class="headerlink" title="LVS调度算法"></a>LVS调度算法</h3><p>固定调度算法: rr , wrr , dh , sh<br>动态调度算法:</p>
<ul>
<li>wlc (Weighted Least-Connection 加权最小连接数调度)</li>
<li>lc (Least-Connection 最小连接数调度)</li>
<li>lblc (Locality-Based Least-Connection 基于地址的最小连接调度)</li>
<li>lblcr(Locality-Based Least-Connection with Replication 基于地址带重复最小连接数调度)</li>
</ul>
<blockquote>
<p>一般网络服务(类似Http&#x2F;Mail&#x2F;MySQL等)常用的调度LVS算法为:rr,wlc,wrr</p>
</blockquote>
<h3 id="实际安装"><a href="#实际安装" class="headerlink" title="实际安装"></a>实际安装</h3><p>注意:</p>
<ol>
<li>Centos5.x 使用1.24版本</li>
<li>Centos6.x 使用1.26版本</li>
<li>提前安装 : yum install libnl* popt* -y</li>
<li>安装完后,执行ipvsadm(modprobe ip_vs)把ip_vs模块加载到内核</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/7c7aeb92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/7c7aeb92/" class="post-title-link" itemprop="url">Python实战</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-21 23:39:59" itemprop="dateCreated datePublished" datetime="2017-11-21T23:39:59+00:00">2017-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Python实战–WebAPP"><a href="#Python实战–WebAPP" class="headerlink" title="Python实战–WebAPP"></a>Python实战–WebAPP</h1><p>这个项目是依托在Linux中,利用python编写的项目,最终要实现类似论坛的功能,可以查看文章,评论,对文章进行修改等…</p>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h2 id="功能模块"><a href="#功能模块" class="headerlink" title="功能模块"></a>功能模块</h2><h3 id="什么是ORM"><a href="#什么是ORM" class="headerlink" title="什么是ORM"></a>什么是ORM</h3><p>对象关系映射（英语：(Object Relational Mapping，简称ORM，或O&#x2F;RM，或O&#x2F;R mapping），是一种程序技术，用于实现面向对象编程语言里不同类型系统的数据之间的转换[1]  。从效果上说，它其实是创建了一个可在编程语言里使用的–“虚拟对象数据库”。<br>面向对象是从软件工程基本原则（如耦合、聚合、封装）的基础上发展起来的，而关系数据库则是从数学理论发展而来的，两套理论存在显著的区别。为了解决这个不匹配的现象，对象关系映射技术应运而生。<br>对象关系映射（Object-Relational Mapping）提供了概念性的、易于理解的模型化数据的方法。ORM方法论基于三个核心原则： 简单：以最基本的形式建模数据。 传达性：数据库结构被任何人都能理解的语言文档化。 精确性：基于数据模型创建正确标准化的结构。 典型地，建模者通过收集来自那些熟悉应用程序但不熟练的数据建模者的人的信息开发信息模型。建模者必须能够用非技术企业专家可以理解的术语在概念层次上与数据结构进行通讯。建模者也必须能以简单的单元分析信息，对样本数据进行处理。ORM专门被设计为改进这种联系。<br>简单的说：ORM相当于中继数据。具体到产品上，例如ADO.NET Entity Framework。DLINQ中实体类的属性[Table]就算是一种中继数据。</p>
<h2 id="未完待续"><a href="#未完待续" class="headerlink" title="未完待续"></a>未完待续</h2><p><code>https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001432339034336cbf72acd43354d72831461e3871d9f2e000</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/fee7288a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/fee7288a/" class="post-title-link" itemprop="url">Python学习笔记(四)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-20 09:12:19" itemprop="dateCreated datePublished" datetime="2017-11-20T09:12:19+00:00">2017-11-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Python-学习笔记-四"><a href="#Python-学习笔记-四" class="headerlink" title="Python 学习笔记 四"></a>Python 学习笔记 四</h1><h2 id="错误-调试"><a href="#错误-调试" class="headerlink" title="错误&#x2F;调试"></a>错误&#x2F;调试</h2><p>在操作系统提供的调用中，返回错误码非常常见。比如打开文件的函数open()，成功时返回文件描述符（就是一个整数），出错时返回-1。</p>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;try...&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> Error <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;except&#x27;</span>,e)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;finally...&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;End&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于没有错误发生，所以except语句块不会被执行，但是finally如果有，则一定会被执行（可以没有finally语句）。</p>
</blockquote>
<p>Python的错误其实也是class，所有的错误类型都继承自 <em>BaseException</em> ，所以在使用except时需要注意的是，它不但捕获该类型的错误，还把其子类也“一网打尽”。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    pass</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>(Exception e)</span><br><span class="line">&#123;</span><br><span class="line">    System.out.println(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果不捕获错误，自然可以让Python解释器来打印出错误堆栈，但程序也被结束了。既然我们能捕获错误，就可以把错误堆栈打印出来，然后分析错误原因，同时，让程序继续执行下去。</p>
<p>Python内置的logging模块可以非常容易地记录错误信息：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    logging.exception(e)</span><br></pre></td></tr></table></figure>

<h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><p>断言:</p>
<p>凡是用print()来辅助查看的地方，都可以用断言（assert）来替代：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>(<span class="params">s</span>):</span><br><span class="line">    n = <span class="built_in">int</span>(s</span><br><span class="line">    <span class="keyword">assert</span> n != <span class="number">0</span> , <span class="string">&#x27;n is zero&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>/n</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    foo(<span class="string">&#x27;0&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>assert的意思是，表达式n !&#x3D; 0应该是True，否则，根据程序运行的逻辑，后面的代码肯定会出错。</p>
<p>如果断言失败，assert语句本身就会抛出AssertionError</p>
<h2 id="IO编程"><a href="#IO编程" class="headerlink" title="IO编程"></a>IO编程</h2><p>IO编程中，Stream（流）是一个很重要的概念，可以把流想象成一个水管，数据就是水管里的水，但是只能单向流动。Input Stream就是数据从外面（磁盘、网络）流进内存，Output Stream就是数据从内存流到外面去。对于浏览网页来说，浏览器和新浪服务器之间至少需要建立两根水管，才可以既能发数据，又能收数据。</p>
<h3 id="文件读写"><a href="#文件读写" class="headerlink" title="文件读写"></a>文件读写</h3><p>以读文件的模式打开一个文件对象，使用Python内置的open()函数，传入文件名和标示符：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;/Users/michel/test.text&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line"><span class="comment">#读取成功,调用read()方法就可以一次读完全部能容</span></span><br><span class="line">f.read()</span><br><span class="line"><span class="comment">#最后有一步是关闭文件,释放资源</span></span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<p>标示符’r’表示读，这样，我们就成功地打开了一个文件。</p>
<ul>
<li><p>调用read()会一次性读取文件的全部内容，如果文件有10G，内存就爆了，所以，要保险起见，可以反复调用read(size)方法，每次最多读取size个字节的内容。</p>
</li>
<li><p>调用readline()可以每次读取一行内容，调用readlines()一次读取所有内容并按行返回list.</p>
</li>
</ul>
<p>设置字符编码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;/Users/michael/gbk.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line">f.read()</span><br></pre></td></tr></table></figure>

<p>写文件:</p>
<p>写文件和读文件是一样的，唯一区别是调用open()函数时，传入标识符’w’或者’wb’表示写文本文件或写二进制文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = <span class="built_in">open</span>(<span class="string">&#x27;/Users/michael/test.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.write(<span class="string">&#x27;Hello, world!&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.close()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当我们写文件时，操作系统往往不会立刻把数据写入磁盘，而是放到内存缓存起来，空闲的时候再慢慢写入。只有调用close()方法时，操作系统才保证把没有写入的数据全部写入磁盘。忘记调用close()的后果是数据可能只写了一部分到磁盘，剩下的丢失了。</p>
</blockquote>
<h3 id="StringIO-ByteIO"><a href="#StringIO-ByteIO" class="headerlink" title="StringIO &amp; ByteIO"></a>StringIO &amp; ByteIO</h3><p>这个不是对文件操作,而是对内存中的流来操作</p>
<h2 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h2><p>对于操作系统来说，一个任务就是一个进程（Process），比如打开一个浏览器就是启动一个浏览器进程，打开一个记事本就启动了一个记事本进程，打开两个记事本就启动了两个记事本进程，打开一个Word就启动了一个Word进程。</p>
<p>有些进程还不止同时干一件事，比如Word，它可以同时进行打字、拼写检查、打印等事情。在一个进程内部，要同时干多件事，就需要同时运行多个“子任务”，我们把进程内的这些“子任务”称为线程（Thread）。</p>
<h3 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h3><p>Unix&#x2F;Linux操作系统提供了一个fork()系统调用，它非常特殊。普通的函数调用，调用一次，返回一次，但是fork()调用一次，返回两次，因为操作系统自动把当前进程（称为父进程）复制了一份（称为子进程），然后，分别在父进程和子进程内返回。</p>
<p>子进程永远返回0，而父进程返回子进程的ID。这样做的理由是，一个父进程可以fork出很多子进程，所以，父进程要记下每个子进程的ID，而子进程只需要调用getppid()就可以拿到父进程的ID。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Process (%s) start ...&#x27;</span> % os.getpid())</span><br><span class="line"><span class="comment"># Only works on Unix/Linux/Mac</span></span><br><span class="line">pid = os.fork()</span><br><span class="line"><span class="keyword">if</span> pid == <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;child,parentpid is (%s)&#x27;</span> % os.getppid)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Parent&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>小结:</p>
<ul>
<li>Unix&#x2F;Linux下,可以用fork()调用实现多进程</li>
<li>要实现跨平台,可以使用multiprocessing</li>
<li>进程间通信是通过Queue,pipes实现的</li>
</ul>
<h3 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h3><p>Python的标准库提供了两个模块：_thread和threading，_thread是低级模块，threading是高级模块，对_thread进行了封装。绝大多数情况下，我们只需要使用threading这个高级模块。</p>
<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><ul>
<li>用\d可以匹配一个数字</li>
<li>\w可以匹配一个字母或数字</li>
<li>.可以匹配任意字符</li>
<li>用*表示任意个字符（包括0个）</li>
<li>用+表示至少一个字符</li>
<li>用?表示0个或1个字符</li>
<li>用{n}表示n个字符</li>
<li>用{n,m}表示n-m个字符</li>
<li>要做更精确地匹配，可以用[]表示范围</li>
<li>^表示行的开头，^\d表示必须以数字开头</li>
<li>$表示行的结束，\d$表示必须以数字结束。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#匹配010 - 12345</span></span><br><span class="line">正则表达式: \d&#123;<span class="number">3</span>&#125;\-\d&#123;<span class="number">5</span>&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/4a4c785/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/4a4c785/" class="post-title-link" itemprop="url">Python学习笔记(三)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-19 19:26:26" itemprop="dateCreated datePublished" datetime="2017-11-19T19:26:26+00:00">2017-11-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Python学习笔记-三"><a href="#Python学习笔记-三" class="headerlink" title="Python学习笔记 三"></a>Python学习笔记 三</h1><p>为了编写可维护的代码，我们把很多函数分组，分别放到不同的文件里，这样，每个文件包含的代码就相对较少，很多编程语言都采用这种组织代码的方式。在Python中，一个.py文件就称之为一个模块（Module）。</p>
<h2 id="模块-module"><a href="#模块-module" class="headerlink" title="模块 module"></a>模块 module</h2><blockquote>
<p>类似C语言中的include 或者 java中的import</p>
</blockquote>
<h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>在一个模块中，我们可能会定义很多函数和变量，但有的函数和变量我们希望给别人使用，有的函数和变量我们希望仅仅在模块内部使用。在Python中，是通过_前缀来实现的。</p>
<blockquote>
<p>private 在 python中用_代替</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_private_1</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, %s&#x27;</span> % name</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_private_2</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hi, %s&#x27;</span> % name</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">greeting</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(name) &gt; <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> _private_1(name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> _private_2(name)</span><br></pre></td></tr></table></figure>

<p>在模块里公开greeting()函数，而把内部逻辑用private函数隐藏起来了，这样，调用greeting()函数不用关心内部的private函数细节，这也是一种非常有用的代码封装和抽象的方法，即：</p>
<p>外部不需要引用的函数全部定义成private，只有外部需要引用的函数才定义为public。</p>
<h2 id="安装第三方模块"><a href="#安装第三方模块" class="headerlink" title="安装第三方模块"></a>安装第三方模块</h2><p>在命令提示窗口下运行’pip’命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 第三方库都会在Python官方的pypi.python.org网站注册，要安装一个第三方库，必须先知道该库的名称，可以在官网或者pypi上搜索，比如Pillow的名称叫Pillow，因此，安装Pillow的命令就是：</span><br><span class="line"># pip install Pillow</span><br></pre></td></tr></table></figure>

<h3 id="安装常用模块"><a href="#安装常用模块" class="headerlink" title="安装常用模块"></a>安装常用模块</h3><p>在使用Python时，我们经常需要用到很多第三方库，例如，上面提到的Pillow，以及MySQL驱动程序，Web框架Flask，科学计算Numpy等。用pip一个一个安装费时费力，还需要考虑兼容性。我们推荐直接使用Anaconda，这是一个基于Python的数据处理和科学计算平台，它已经内置了许多非常有用的第三方库，我们装上Anaconda，就相当于把数十个第三方模块自动安装好了，非常简单易用。</p>
<p>下载地址:<code>https://www.anaconda.com/download/#macos</code></p>
<p>默认情况下，Python解释器会搜索当前目录、所有已安装的内置模块和第三方模块，搜索路径存放在sys模块的path变量中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="keyword">import</span> sys</span><br><span class="line">&gt;&gt;&gt;sys.path</span><br><span class="line">&gt;&gt;&gt;添加路径</span><br><span class="line">&gt;&gt;&gt;sys.path.append(<span class="string">&#x27;new path&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>另外一种添加路径的方式:设置环境变量PYTHONPATH，该环境变量的内容会被自动添加到模块搜索路径中。设置方式与设置Path环境变量类似。注意只需要添加你自己的搜索路径，Python自己本身的搜索路径不受影响。</p>
</blockquote>
<h2 id="面向对象编程"><a href="#面向对象编程" class="headerlink" title="面向对象编程"></a>面向对象编程</h2><p>面向对象的设计思想是从自然界中来的，因为在自然界中，类（Class）和实例（Instance）的概念是很自然的。Class是一种抽象概念，比如我们定义的Class——Student，是指学生这个概念，而实例（Instance）则是一个个具体的Student，比如，Bart Simpson和Lisa Simpson是两个具体的Student。</p>
<p>所以，面向对象的设计思想是抽象出Class，根据Class创建Instance。</p>
<p>面向对象的抽象程度又比函数要高，因为一个Class既包含数据，又包含操作数据的方法。</p>
<h3 id="类与实例"><a href="#类与实例" class="headerlink" title="类与实例"></a>类与实例</h3><p><em>class</em> 后面紧接着是类名，即Student，类名通常是大写开头的单词，紧接着是(object)，表示该类是从哪个类继承下来的，如果没有合适的继承类，就使用object类，这是所有类最终都会继承的类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="comment">########</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init___</span>(<span class="params">self,name,score</span>):</span><br><span class="line">    <span class="variable language_">self</span>.name = name</span><br><span class="line">    <span class="variable language_">self</span>.score = score</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:特殊方法“__init__”前后分别有两个下划线！！！<br>注意: __init__ 方法的第一个参数永远是self，表示创建的实例本身，因此，在__init__方法内部，就可以把各种属性绑定到self，因为self就指向创建的实例本身。</p>
</blockquote>
<p>有了__init__方法，在创建实例的时候，就不能传入空的参数了，必须传入与__init__方法匹配的参数，但self不需要传，Python解释器自己会把实例变量传进去：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bart = Student(<span class="string">&#x27;Bart Simpason&#x27;</span>,<span class="number">58</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>第一个参数永远是实例变量self，并且，调用时，不用传递该参数。</p>
</blockquote>
<h3 id="访问限制"><a href="#访问限制" class="headerlink" title="访问限制"></a>访问限制</h3><p>如果要让内部属性不被外部访问，可以把属性的名称前加上两个下划线__，在Python中，实例的变量名如果以__开头，就变成了一个私有变量（private），只有内部可以访问，外部不能访问，所以，我们把Student类改一改：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init___</span>(<span class="params">self,name,score</span>):</span><br><span class="line">        <span class="variable language_">self</span>.__name = name</span><br><span class="line">        <span class="variable language_">self</span>.__score = score</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">print_score</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s:%s&#x27;</span> % (<span class="variable language_">self</span>.__name,<span class="variable language_">self</span>.__score))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>变量名类似__xxx__的，也就是以双下划线开头，并且以双下划线结尾的，是特殊变量，特殊变量是可以直接访问的，不是private变量</p>
</blockquote>
<p>双下划线不代表private</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">有些时候，你会看到以一个下划线开头的实例变量名，比如_name，这样的实例变量外部是可以访问的，但是，按照约定俗成的规定，当你看到这样的变量时，意思就是，“虽然我可以被访问，但是，请把我视为私有变量，不要随意访问”。</span><br><span class="line"></span><br><span class="line">双下划线开头的实例变量是不是一定不能从外部访问呢？其实也不是。不能直接访问__name是因为Python解释器对外把__name变量改成了_Student__name，所以，仍然可以通过_Student__name来访问__name变量</span><br></pre></td></tr></table></figure>

<hr>
<p>练习:写一个student类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">Object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name,general</span>):</span><br><span class="line">        <span class="variable language_">self</span>.__name = name</span><br><span class="line">        <span class="variable language_">self</span>.__general = general</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_general</span>(<span class="params">general</span>):</span><br><span class="line">        <span class="variable language_">self</span>.__general = general</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_general</span>(<span class="params">general</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.__general</span><br></pre></td></tr></table></figure>

<h3 id="继承和多态"><a href="#继承和多态" class="headerlink" title="继承和多态"></a>继承和多态</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>(<span class="title class_ inherited__">Object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">self</span>):</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;I am running&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="comment">#此时Dog类有父类Animal的方法,可以实例化并调用父类的方法</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于静态语言（例如Java）来说，如果需要传入Animal类型，则传入的对象必须是Animal类型或者它的子类，否则，将无法调用run()方法。</p>
</blockquote>
<p>对于Python这样的动态语言来说，则不一定需要传入Animal类型。我们只需要保证传入的对象有一个run()方法就可以了.</p>
<blockquote>
<p>这就是动态语言的“鸭子类型”，它并不要求严格的继承体系，一个对象只要“看起来像鸭子，走起路来像鸭子”，那它就可以被看做是鸭子。</p>
</blockquote>
<h3 id="获取对象信息"><a href="#获取对象信息" class="headerlink" title="获取对象信息"></a>获取对象信息</h3><h4 id="使用type"><a href="#使用type" class="headerlink" title="使用type()"></a>使用type()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="built_in">type</span>(<span class="number">123</span>)</span><br><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;int&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>

<h4 id="使用isinstance"><a href="#使用isinstance" class="headerlink" title="使用isinstance()"></a>使用isinstance()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;a = Animal()</span><br><span class="line">&gt;&gt;&gt;dog = Dog()</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">isinstance</span>(a,Animal)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;<span class="built_in">isinstance</span>(dog,Animal)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h4 id="使用dir"><a href="#使用dir" class="headerlink" title="使用dir()"></a>使用dir()</h4><p>如果要获得一个对象的所有属性和方法，可以使用dir()函数，它返回一个包含字符串的list</p>
<p>仅仅把属性和方法列出来是不够的，配合getattr()、setattr()以及hasattr()，我们可以直接操作一个对象的状态：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">class</span> <span class="title class_">MyObject</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line"><span class="meta">... </span>        <span class="variable language_">self</span>.x = <span class="number">9</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">def</span> <span class="title function_">power</span>(<span class="params">self</span>):</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> <span class="variable language_">self</span>.x * <span class="variable language_">self</span>.x</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj = MyObject()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hasattr</span>(obj, <span class="string">&#x27;x&#x27;</span>) <span class="comment"># 有属性&#x27;x&#x27;吗？</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.x</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hasattr</span>(obj, <span class="string">&#x27;y&#x27;</span>) <span class="comment"># 有属性&#x27;y&#x27;吗？</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">setattr</span>(obj, <span class="string">&#x27;y&#x27;</span>, <span class="number">19</span>) <span class="comment"># 设置一个属性&#x27;y&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hasattr</span>(obj, <span class="string">&#x27;y&#x27;</span>) <span class="comment"># 有属性&#x27;y&#x27;吗？</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">getattr</span>(obj, <span class="string">&#x27;y&#x27;</span>) <span class="comment"># 获取属性&#x27;y&#x27;</span></span><br><span class="line"><span class="number">19</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>obj.y <span class="comment"># 获取属性&#x27;y&#x27;</span></span><br><span class="line"><span class="number">19</span></span><br></pre></td></tr></table></figure>

<hr>
<p>练习 : 为了统计学生人数，可以给Student类增加一个类属性，每创建一个实例，该属性自动增加;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Count</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">Count</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        Count.count += <span class="number">1</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_Count</span>():</span><br><span class="line">        <span class="built_in">print</span>(Count.count)</span><br><span class="line">        <span class="keyword">return</span> Count.count</span><br></pre></td></tr></table></figure>

<h2 id="面向对象高级编程"><a href="#面向对象高级编程" class="headerlink" title="面向对象高级编程"></a>面向对象高级编程</h2><p>python允许动态为实例添加属性和方法…</p>
<h3 id="使用-slots"><a href="#使用-slots" class="headerlink" title="使用 __slots__"></a>使用 __slots__</h3><p>动态添加属性和方法:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="comment"># 给实例添加属性</span></span><br><span class="line">s = Student()</span><br><span class="line">s.name = <span class="string">&#x27;Micheal&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绑定方法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_age</span>(<span class="params">self,age</span>):</span><br><span class="line">    <span class="variable language_">self</span>.age = age</span><br><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> MethodType</span><br><span class="line">s.set_age = MethodType(set_age,s)</span><br><span class="line">s.set_age(<span class="number">25</span>)</span><br><span class="line"><span class="built_in">print</span>(s.age)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>给一个实例绑定的方法，对另一个实例是不起作用的</p>
</blockquote>
<p>要给所有实例都绑定方法,可以用class绑定方法:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_score</span>(<span class="params">self,score</span>):</span><br><span class="line">    <span class="variable language_">self</span>.score = score</span><br><span class="line">Student.set_score = set_score</span><br></pre></td></tr></table></figure>

<p>既然可以动态添加实例的属性,就可以限制添加属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    __slots__ = (<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 现在Student类只允许设置name和age</span></span><br></pre></td></tr></table></figure>

<h3 id="使用-property"><a href="#使用-property" class="headerlink" title="使用@property"></a>使用@property</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Screen</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">width</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.width</span><br><span class="line"><span class="meta">    @width.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">width</span>(<span class="params">self,vale</span>):</span><br><span class="line">        <span class="variable language_">self</span>.width = value</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">height</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.heigth</span><br><span class="line"><span class="meta">    @height.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">height</span>(<span class="params">self,value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.height = value</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>property要比setter先设置,否则会出现无法识别相关属性<br>NameError: name ‘xxx’ is not defined</p>
</blockquote>
<h3 id="多继承"><a href="#多继承" class="headerlink" title="多继承"></a>多继承</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Farther</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Monther</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Son</span>(Farther,Monther):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/7a57e7ae/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/7a57e7ae/" class="post-title-link" itemprop="url">Python学习笔记(二)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-18 17:54:04" itemprop="dateCreated datePublished" datetime="2017-11-18T17:54:04+00:00">2017-11-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Python-学习"><a href="#Python-学习" class="headerlink" title="Python 学习"></a>Python 学习</h1><h2 id="对集合的操作"><a href="#对集合的操作" class="headerlink" title="对集合的操作"></a>对集合的操作</h2><h3 id="切片Slice"><a href="#切片Slice" class="headerlink" title="切片Slice"></a>切片Slice</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一个集合L中有[1,2,3,4,5]这些元素,现在要把2与3取出来</span></span><br><span class="line">L[<span class="number">1</span>:<span class="number">4</span>]</span><br><span class="line"><span class="comment">#L[n:z] 数组的下标从0开始的,这里表示取了第n个元素,到z-1个元素</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Python支持L[-1]取倒数第一个元素，那么它同样支持倒数切片</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[1,2,3,4,5,6]</span></span><br><span class="line">&gt;&gt;&gt;L[-<span class="number">2</span>:-<span class="number">4</span>]</span><br><span class="line">[<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#间隔n个来取</span></span><br><span class="line">L[::n]</span><br></pre></td></tr></table></figure>

<h3 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h3><p>Python内置的enumerate函数可以把一个list变成索引-元素对，这样就可以在for循环中同时迭代索引和元素本身：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="keyword">for</span> i,value <span class="keyword">in</span> <span class="built_in">enumerate</span>([<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>]):</span><br><span class="line">    <span class="built_in">print</span>(i,value)</span><br></pre></td></tr></table></figure>

<p>通过collections模块的Iterable类型判断一个对象是否为可迭代对象:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> Iterable</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="string">&#x27;abc&#x27;</span>, Iterable) <span class="comment"># str是否可迭代</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], Iterable) <span class="comment"># list是否可迭代</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(<span class="number">123</span>, Iterable) <span class="comment"># 整数是否可迭代</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h3 id="生成列表"><a href="#生成列表" class="headerlink" title="生成列表"></a>生成列表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;[x*x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>)]</span><br><span class="line">[<span class="number">1</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">16</span>,<span class="number">25</span>,<span class="number">36</span>,<span class="number">49</span>,<span class="number">64</span>,<span class="number">81</span>,<span class="number">100</span>]</span><br><span class="line">&gt;&gt;&gt;[x*x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>) <span class="keyword">if</span> x%<span class="number">2</span> == <span class="number">0</span>]</span><br><span class="line">[<span class="number">4</span>,<span class="number">46</span>,<span class="number">64</span>,<span class="number">100</span>]</span><br><span class="line">&gt;&gt;&gt;[m + n <span class="keyword">for</span> m <span class="keyword">in</span> <span class="string">&#x27;ABC&#x27;</span> <span class="keyword">for</span> n <span class="keyword">in</span> <span class="string">&#x27;XYZ&#x27;</span>]</span><br><span class="line">[<span class="string">&#x27;AX&#x27;</span>,<span class="string">&#x27;AY&#x27;</span>,<span class="string">&#x27;AZ&#x27;</span>,<span class="string">&#x27;BX&#x27;</span>,<span class="string">&#x27;BY&#x27;</span>,<span class="string">&#x27;BZ&#x27;</span>,<span class="string">&#x27;CX&#x27;</span>,<span class="string">&#x27;CY&#x27;</span>,<span class="string">&#x27;CZ&#x27;</span>]</span><br><span class="line">&gt;&gt;&gt;d = &#123;<span class="string">&#x27;x&#x27;</span>:<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;y&#x27;</span>:<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;z&#x27;</span>:<span class="string">&#x27;C&#x27;</span>&#125;</span><br><span class="line">&gt;&gt;&gt;<span class="keyword">for</span> k , v <span class="keyword">in</span> d.items()</span><br><span class="line">    <span class="built_in">print</span>(k,<span class="string">&#x27;=&#x27;</span>,v)</span><br><span class="line">y=B</span><br><span class="line">x=A</span><br><span class="line">z=C</span><br><span class="line">&gt;&gt;&gt;<span class="comment">#列表生产式也可以使用两个变量来生成list</span></span><br><span class="line">&gt;&gt;&gt;d=&#123;<span class="string">&#x27;X&#x27;</span>:<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;Y&#x27;</span>:<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;Z&#x27;</span>:<span class="string">&#x27;C&#x27;</span>&#125;</span><br><span class="line">&gt;&gt;&gt;[k+<span class="string">&#x27;=&#x27;</span>+v <span class="keyword">for</span> k ,v <span class="keyword">in</span> d.items()]</span><br><span class="line">[<span class="string">&#x27;Y=B&#x27;</span>,<span class="string">&#x27;X=A&#x27;</span>,<span class="string">&#x27;Z=C&#x27;</span>]</span><br><span class="line">&gt;&gt;&gt;<span class="comment">#把一个list中所有的字符串都变成小写的:</span></span><br><span class="line">&gt;&gt;&gt;L = [<span class="string">&#x27;Hello&#x27;</span>,<span class="string">&#x27;World&#x27;</span>,<span class="string">&#x27;Apple&#x27;</span>]</span><br><span class="line">&gt;&gt;&gt;[s.lower() <span class="keyword">for</span> s <span class="keyword">in</span> L]</span><br><span class="line">[<span class="string">&#x27;hello&#x27;</span>,<span class="string">&#x27;world&#x27;</span>,<span class="string">&#x27;apple&#x27;</span>]</span><br></pre></td></tr></table></figure>

<hr>
<p>练习:把一个list [‘Hello’,’World’,18,’Apple’,None]里面的字符串都变成小写的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;L=[<span class="string">&#x27;Hello&#x27;</span>,<span class="string">&#x27;World&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;Apple&#x27;</span>,<span class="literal">None</span>]</span><br><span class="line">&gt;&gt;&gt;[s.lower() <span class="keyword">for</span> s <span class="keyword">in</span> L <span class="keyword">if</span> isinsistance(s,<span class="built_in">str</span>)]</span><br></pre></td></tr></table></figure>

<h3 id="生成器generate"><a href="#生成器generate" class="headerlink" title="生成器generate"></a>生成器generate</h3><p>generate说白了就是省空间的list</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="comment">#List</span></span><br><span class="line">&gt;&gt;&gt;L=[x*x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">&gt;&gt;&gt;<span class="comment">#Generate</span></span><br><span class="line">&gt;&gt;&gt;g=(x*x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line">&gt;&gt;&gt;打印用<span class="built_in">next</span>()函数,很像iterator.<span class="built_in">next</span>() -.-</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">next</span>(g)</span><br><span class="line"><span class="number">0</span></span><br><span class="line">&gt;&gt;&gt;<span class="comment">#generator保存的是算法，每次调用next(g)，就计算出g的下一个元素的值，直到计算到最后一个元素，没有更多的元素时，抛出StopIteration的错误。</span></span><br><span class="line">&gt;&gt;&gt;<span class="keyword">for</span> n <span class="keyword">in</span> g:</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line">&gt;&gt;&gt;<span class="comment">#一个函数定义中包含yield关键字，那么这个函数就不再是一个普通函数，而是一个generator;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<p>练习:写一个杨辉三角.</p>
<p><a target="_blank" rel="noopener" href='https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014317799226173f45ce40636141b6abc8424e12b5fb27000'>此处存疑</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">triangles</span>():</span><br><span class="line">    a=[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> a</span><br><span class="line">        a=[<span class="built_in">sum</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">zip</span>([<span class="number">0</span>+a,a+[<span class="number">0</span>]])]</span><br><span class="line"><span class="comment">#1</span></span><br><span class="line"><span class="comment">#11</span></span><br><span class="line"><span class="comment">#121</span></span><br><span class="line"><span class="comment">#1331</span></span><br><span class="line">n=<span class="number">0</span></span><br><span class="line">results=[]</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> triangles():</span><br><span class="line">    <span class="built_in">print</span>(t)</span><br><span class="line">    results.append()</span><br><span class="line">    n+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">results.append()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h3><p>可以直接作用于for循环的数据类型有以下几种:</p>
<ul>
<li>一类是集合数据类型，如list、tuple、dict、set、str等；</li>
<li>一类是generator，包括生成器和带yield的generator function。</li>
</ul>
<h2 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h2><h3 id="map"><a href="#map" class="headerlink" title="map()"></a>map()</h3><p>map()函数接收两个参数，一个是函数，一个是Iterable，map将传入的函数依次作用到序列的每个元素，并把结果作为新的Iterator返回。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">str</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]))</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce()"></a>reduce()</h3><p>reduce把一个函数作用在一个序列[x1, x2, x3, …]上，这个函数必须接收两个参数，reduce把结果继续和序列的下一个元素做累积计算，其效果就是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">fn</span>(<span class="params">x, y</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x * <span class="number">10</span> + y</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reduce(fn, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>])</span><br><span class="line"><span class="number">13579</span></span><br></pre></td></tr></table></figure>

<h3 id="filter"><a href="#filter" class="headerlink" title="filter()"></a>filter()</h3><p>filter()接收一个函数和一个序列,filter()把传入的函数依次作用于每个元素，然后根据返回值是True还是False决定保留还是丢弃该元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">is_odd</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">return</span> n % <span class="number">2</span> == <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>(<span class="built_in">filter</span>(is_odd, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">15</span>]))</span><br><span class="line"><span class="comment"># 结果: [1, 5, 9, 15]</span></span><br></pre></td></tr></table></figure>

<h3 id="sorted"><a href="#sorted" class="headerlink" title="sorted()"></a>sorted()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="comment">#sorted()函数也是一个高阶函数，它还可以接收一个key函数来实现自定义的排序，例如按绝对值大小排序：</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sorted</span>([<span class="number">36</span>, <span class="number">5</span>, -<span class="number">12</span>, <span class="number">9</span>, -<span class="number">21</span>], key=<span class="built_in">abs</span>)</span><br><span class="line">[<span class="number">5</span>, <span class="number">9</span>, -<span class="number">12</span>, -<span class="number">21</span>, <span class="number">36</span>]</span><br></pre></td></tr></table></figure>

<hr>
<p>练习:L &#x3D; [(‘Bob’, 75), (‘Adam’, 92), (‘Bart’, 66), (‘Lisa’, 88)],用sorted()分别对名字和成绩进行排序.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;L = [(<span class="string">&#x27;Bob&#x27;</span>, <span class="number">75</span>), (<span class="string">&#x27;Adam&#x27;</span>, <span class="number">92</span>), (<span class="string">&#x27;Bart&#x27;</span>, <span class="number">66</span>), (<span class="string">&#x27;Lisa&#x27;</span>, <span class="number">88</span>)]</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">sorted</span>(L)</span><br><span class="line">[(<span class="string">&#x27;Adam&#x27;</span>, <span class="number">92</span>), (<span class="string">&#x27;Bart&#x27;</span>, <span class="number">66</span>), (<span class="string">&#x27;Bob&#x27;</span>, <span class="number">75</span>), (<span class="string">&#x27;Lisa&#x27;</span>, <span class="number">88</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sorted by score</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">def_num</span>(<span class="params">t</span>):</span><br><span class="line">    <span class="keyword">return</span> t[<span class="number">1</span>]</span><br><span class="line">L.sort(key=def_num)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sorted by name</span></span><br><span class="line"><span class="comment"># Default:</span></span><br><span class="line">L.sort()</span><br><span class="line"><span class="comment"># Defined a function</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">def_name</span>(<span class="params">t</span>):</span><br><span class="line">    <span class="keyword">return</span> t[<span class="number">0</span>]</span><br><span class="line">L.sort(key=def_name)</span><br></pre></td></tr></table></figure>

<h3 id="返回函数"><a href="#返回函数" class="headerlink" title="返回函数"></a>返回函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">lazy_sum</span>(<span class="params">*args</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sum</span>():</span><br><span class="line">        ax = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> args:</span><br><span class="line">            ax = ax + n</span><br><span class="line">        <span class="keyword">return</span> ax</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span></span><br></pre></td></tr></table></figure>

<hr>
<p>闭包:</p>
<p>注意到返回的函数在其定义内部引用了局部变量args，所以，当一个函数返回了一个函数后，其内部的局部变量还被新函数引用，所以，闭包用起来简单，实现起来可不容易。</p>
<p>练习:利用闭包返回一个计数器函数，每次调用它返回递增整数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">createCounter</span>():</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">counter</span>():</span><br><span class="line">        <span class="keyword">nonlocal</span> count</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line">    <span class="keyword">return</span> counter</span><br><span class="line"><span class="comment"># PS: nonlocal是在python3中才可以用,python2.7中没有,解决方法是用列表list来处理</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createCounter</span>():</span><br><span class="line">    count = [<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">counter</span>():</span><br><span class="line">        count = count[<span class="number">0</span>] + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line">    <span class="keyword">return</span> counter</span><br></pre></td></tr></table></figure>

<h3 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h3><p>关键字lambda表示匿名函数，冒号前面的x表示函数参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;f = <span class="keyword">lambda</span> x : x*x</span><br><span class="line">&gt;&gt;&gt;f(<span class="number">5</span>)</span><br><span class="line"><span class="number">25</span></span><br></pre></td></tr></table></figure>

<hr>
<p>练习:用lambda改造下面函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">is_odd</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">return</span> n % <span class="number">2</span> == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">L = <span class="built_in">list</span>(<span class="built_in">filter</span>(is_odd, <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">20</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">################</span></span><br><span class="line"></span><br><span class="line">L = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x : x%<span class="number">2</span> == <span class="number">1</span>,<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>)))</span><br></pre></td></tr></table></figure>

<h3 id="Decorator"><a href="#Decorator" class="headerlink" title="Decorator"></a>Decorator</h3><p>在代码运行期间动态增加功能的方式，称之为“装饰器”（Decorator）。</p>
<p>&lt;a ‘href&#x3D;<a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014318435599930270c0381a3b44db991cd6d858064ac0000'%3E%E6%AD%A4%E5%A4%84%E5%AD%98%E7%96%91">https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014318435599930270c0381a3b44db991cd6d858064ac0000&#39;&gt;此处存疑</a></a></p>
<h3 id="Partial-function"><a href="#Partial-function" class="headerlink" title="Partial function"></a>Partial function</h3><p>简单总结functools.partial的作用就是，把一个函数的某些参数给固定住（也就是设置默认值），返回一个新的函数，调用这个新函数会更简单。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/297a89d9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/297a89d9/" class="post-title-link" itemprop="url">Python学习笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-17 22:59:55" itemprop="dateCreated datePublished" datetime="2017-11-17T22:59:55+00:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Python学习-–-基础学习"><a href="#Python学习-–-基础学习" class="headerlink" title="Python学习 – 基础学习"></a>Python学习 – 基础学习</h1><p>官方介绍略,这里只说python的缺点:</p>
<ol>
<li>运行速度慢，和C程序相比非常慢，因为Python是解释型语言，你的代码在执行时会一行一行地翻译成CPU能理解的机器码，这个翻译过程非常耗时，所以很慢。而C程序是运行前直接编译成CPU能执行的机器码，所以非常快。</li>
<li>代码不能加密。如果要发布你的Python程序，实际上就是发布源代码，这一点跟C语言不同，C语言不用发布源代码，只需要把编译后的机器码（也就是你在Windows上常见的xxx.exe文件）发布出去。要从机器码反推出C代码是不可能的，所以，凡是编译型的语言，都没有这个问题，而解释型的语言，则必须把源码发布出去。</li>
</ol>
<h2 id="安装Python"><a href="#安装Python" class="headerlink" title="安装Python"></a>安装Python</h2><p>这里有三种平台的安装文件:</p>
<ol>
<li>Mac : <code>https://www.python.org/ftp/python/3.6.3/python-3.6.3-macosx10.6.pkg</code></li>
<li>Linux 略</li>
<li>Windows 下载对应的exe安装文件即可</li>
</ol>
<p>检测是否安装成功:</p>
<ul>
<li>在Windows上运行Python时，请先启动命令行，然后运行python。</li>
<li>在Mac和Linux上运行Python时，请打开终端，然后运行python3。</li>
</ul>
<h2 id="Python解释器"><a href="#Python解释器" class="headerlink" title="Python解释器"></a>Python解释器</h2><p>当我们编写Python代码时，我们得到的是一个包含Python代码的以.py为扩展名的文本文件。要运行代码，就需要Python解释器去执行.py文件。<br>由于整个Python语言从规范到解释器都是开源的，所以理论上，只要水平够高，任何人都可以编写Python解释器来执行Python代码（当然难度很大）。事实上，确实存在多种Python解释器。</p>
<ol>
<li>CPython – 官方版本的解释器：CPython。这个解释器是用C语言开发的，所以叫CPython。在命令行下运行python就是启动CPython解释器。</li>
<li>IPython – 基于CPython之上的一个交互式解释器，也就是说，IPython只是在交互方式上有所增强，但是执行Python代码的功能和CPython是完全一样的。</li>
<li>PyPy – 另一个Python解释器，它的目标是执行速度。PyPy采用JIT技术，对Python代码进行动态编译（注意不是解释），所以可以显著提高Python代码的执行速度。</li>
<li>Jython – Jython是运行在Java平台上的Python解释器，可以直接把Python代码编译成Java字节码执行。</li>
<li>IronPython – IronPython和Jython类似，只不过IronPython是运行在微软.Net平台上的Python解释器，可以直接把Python代码编译成.Net的字节码。</li>
</ol>
<h2 id="开始编写python程序"><a href="#开始编写python程序" class="headerlink" title="开始编写python程序"></a>开始编写python程序</h2><h3 id="1-进入编辑界面-–-第一个程序"><a href="#1-进入编辑界面-–-第一个程序" class="headerlink" title="1.进入编辑界面 – 第一个程序"></a>1.进入编辑界面 – 第一个程序</h3><p>打开命令行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># python</span><br><span class="line"></span><br><span class="line">Python 2.7.10 (default, Feb  7 2017, 00:08:15)</span><br><span class="line">[GCC 4.2.1 Compatible Apple LLVM 8.0.0 (clang-800.0.34)] on darwin</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt;exit()</span><br></pre></td></tr></table></figure>

<p>在Python交互模式下输入exit()并回车，就退出了Python交互模式，并回到命令行模式;</p>
<p>如果要让Python打印出指定的文字，可以用print()函数，然后把希望打印的文字用单引号或者双引号括起来，但不能混用单引号和双引号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="built_in">print</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">print</span>(<span class="string">&quot;hello world&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>执行一个.py文件只能在命令行模式执行。</p>
<p>小结:</p>
<ul>
<li>在Python交互式模式下，可以直接输入代码，然后执行，并立刻得到结果。</li>
<li>在命令行模式下，可以直接运行.py文件。</li>
</ul>
<h4 id="1-1-输入"><a href="#1-1-输入" class="headerlink" title="1.1 输入"></a>1.1 输入</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;name = <span class="built_in">input</span>()</span><br></pre></td></tr></table></figure>

<h3 id="2-Python基础部分"><a href="#2-Python基础部分" class="headerlink" title="2.Python基础部分"></a>2.Python基础部分</h3><p>Python是一种计算机编程语言。计算机编程语言和我们日常使用的自然语言有所不同，最大的区别就是，自然语言在不同的语境下有不同的理解，而计算机要根据编程语言执行任务，就必须保证编程语言写出的程序决 <em>不能有歧义</em> ，所以，任何一种编程语言都有自己的一套语法，编译器或者解释器就是负责把符合语法的程序代码转换成CPU能够执行的机器码，然后执行。Python也不例外。</p>
<p>以#开头的语句是注释，注释是给人看的，可以是任意内容，解释器会忽略掉注释。其他每一行都是一个语句，当语句以冒号:结尾时，缩进的语句视为代码块。</p>
<blockquote>
<p>缩进有利有弊。好处是强迫你写出格式化的代码，但没有规定缩进是几个空格还是Tab。按照约定俗成的管理，应该始终坚持使用 <em>4个空格</em> 的缩进。</p>
</blockquote>
<h4 id="2-1-数据类型和变量"><a href="#2-1-数据类型和变量" class="headerlink" title="2.1 数据类型和变量"></a>2.1 数据类型和变量</h4><h5 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h5><ul>
<li>Python可以处理任意大小的整数，当然包括负整数，在程序中的表示方法和数学上的写法一模一样，例如：1，100，-8080，0，等等。</li>
<li>计算机由于使用二进制，所以，有时候用十六进制表示整数比较方便，十六进制用0x前缀和0-9，a-f表示，例如：0xff00，0xa5b4c3d2，等等。</li>
</ul>
<h5 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h5><p>浮点数也就是小数，之所以称为浮点数，是因为按照科学记数法表示时，一个浮点数的小数点位置是可变的，比如，1.23x109和12.3x108是完全相等的。浮点数可以用数学写法，如1.23，3.14，-9.01，等等。但是对于很大或很小的浮点数，就必须用科学计数法表示，把10用e替代，1.23x109就是1.23e9，或者12.3e8，0.000012可以写成1.2e-5，等等。</p>
<p>整数和浮点数在计算机内部存储的方式是不同的，整数运算永远是精确的（除法难道也是精确的？是的！），而浮点数运算则可能会有四舍五入的误差。</p>
<h5 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h5><p>字符串是以单引号’或双引号”括起来的任意文本，比如’abc’，”xyz”等等。请注意，’’或””本身只是一种表示方式，不是字符串的一部分，因此，字符串’abc’只有a，b，c这3个字符。如果’本身也是一个字符，那就可以用””括起来，比如”I’m OK”包含的字符是I，’，m，空格，O，K这6个字符。</p>
<ul>
<li><p>转义字符\可以转义很多字符，比如\n表示换行，\t表示制表符，字符\本身也要转义，所以\表示的字符就是\，可以在Python的交互式命令行用print()打印字符串看看：</p>
</li>
<li><p>如果字符串里面有很多字符都需要转义，就需要加很多\，为了简化，Python还允许用r’’表示’’内部的字符串默认不转义，可以自己试试：</p>
</li>
</ul>
<h5 id="布尔值"><a href="#布尔值" class="headerlink" title="布尔值"></a>布尔值</h5><p>布尔值和布尔代数的表示完全一致，一个布尔值只有True、False两种值，要么是True，要么是False，在Python中，可以直接用True、False表示布尔值（请注意大小写）.</p>
<p>布尔值可以用and、or和not运算。</p>
<ul>
<li>and运算是与运算，只有所有都为True，and运算结果才是True：</li>
<li>or运算是或运算，只要其中有一个为True，or运算结果就是True：</li>
<li>not运算是非运算，它是一个单目运算符，把True变成False，False变成True：</li>
</ul>
<h5 id="空值"><a href="#空值" class="headerlink" title="空值"></a>空值</h5><p>空值是Python里一个特殊的值，用None表示。None不能理解为0，因为0是有意义的，而None是一个特殊的空值。</p>
<h5 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h5><p>变量的概念基本上和初中代数的方程变量是一致的，只是在计算机程序中，变量不仅可以是数字，还可以是任意数据类型。</p>
<blockquote>
<p>变量在程序中就是用一个变量名表示了，变量名必须是大小写英文、数字和_的组合，且不能用数字开头</p>
</blockquote>
<p>python可以不指定变量类型</p>
<blockquote>
<p>这种变量本身类型不固定的语言称之为动态语言，与之对应的是静态语言。静态语言在定义变量时必须指定变量类型，如果赋值的时候类型不匹配，就会报错。例如Java是静态语言.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;a=<span class="string">&#x27;zrj&#x27;</span> <span class="comment">#解释器创建了字符串&#x27;zrj&#x27;和变量a，并把a指向&#x27;zrj&#x27;：</span></span><br><span class="line">&gt;&gt;&gt;b=a <span class="comment">#解释器创建了变量b，并把b指向a指向的字符串&#x27;zrj&#x27;：</span></span><br><span class="line">&gt;&gt;&gt;a=<span class="string">&#x27;genius&#x27;</span> <span class="comment">#解释器创建了字符串&#x27;genius&#x27;，并把a的指向改为&#x27;genius&#x27;，但b并没有更改</span></span><br><span class="line">&gt;&gt;&gt;<span class="built_in">print</span>(b)</span><br><span class="line">zrj</span><br></pre></td></tr></table></figure>

<h5 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h5><p>在Python中，通常用全部大写的变量名表示常量: PI&#x3D;3.1414926</p>
<h5 id="字符编码"><a href="#字符编码" class="headerlink" title="字符编码"></a>字符编码</h5><p>字符串也是一种数据类型,但字符串比较特殊的是还有一个编码问题.</p>
<p>用记事本编辑的时候，从文件读取的UTF-8字符被转换为Unicode字符到内存里，编辑完成后，保存的时候再把Unicode转换为UTF-8保存到文件：</p>
<p><img src="https://cdn.webxueyuan.com/cdn/files/attachments/001387245992536e2ba28125cf04f5c8985dbc94a02245e000/0" alt="Unicode编码"></p>
<p><img src="https://cdn.webxueyuan.com/cdn/files/attachments/001387245979827634fd6204f9346a1ae6358d9ed051666000/0" alt="浏览网页的时候，服务器会把动态生成的Unicode内容转换为UTF-8再传输到浏览器"></p>
<p>看到很多网页的源码上会有类似 &lt;meta charset&#x3D;”UTF-8” &#x2F;&gt; 的信息，表示该网页正是用的UTF-8编码。</p>
<p>在最新的Python 3版本中，字符串是以Unicode编码的，也就是说，Python的字符串支持多语言，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="built_in">print</span>(<span class="string">&#x27;包含中文的str&#x27;</span>)</span><br><span class="line">包含中文的<span class="built_in">str</span></span><br><span class="line">&gt;&gt;&gt;<span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) <span class="comment"># ord 函数获取字符的整数表示</span></span><br><span class="line"><span class="number">65</span></span><br><span class="line">&gt;&gt;&gt;char(<span class="number">65</span>) <span class="comment"># chr函数把编码转换为对应的字符</span></span><br><span class="line"><span class="string">&#x27;A&#x27;</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>由于Python的字符串类型是str，在内存中以Unicode表示，一个字符对应若干个字节。如果要在网络上传输，或者保存到磁盘上，就需要把str变为以字节为单位的bytes。</p>
<p>Python对bytes类型的数据用带b前缀的单引号或双引号表示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;x =<span class="string">b&#x27;ABC&#x27;</span></span><br><span class="line">&gt;&gt;&gt;<span class="string">&#x27;ABC&#x27;</span>.encode(<span class="string">&#x27;ascii&#x27;</span>) <span class="comment">#以Unicode表示的str通过encode()方法可以编码为指定的bytes</span></span><br><span class="line"><span class="string">b&#x27;ABC&#x27;</span></span><br><span class="line">&gt;&gt;&gt;<span class="string">b&#x27;ABC&#x27;</span>.decode(<span class="string">&#x27;ascii&#x27;</span>) <span class="comment">#从网络或磁盘上读取了字节流，那么读到的数据就是bytes。要把bytes变为str，就需要用decode()方法;</span></span><br><span class="line">&gt;&gt;&gt;<span class="string">b&#x27;ABC&#x27;</span>.decode(<span class="string">&#x27;utf-8&#x27;</span>,errors=<span class="string">&#x27;ignore&#x27;</span>) <span class="comment"># 如果bytes中只有一小部分无效的字节，可以传入errors=&#x27;ignore&#x27;忽略错误的字节</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>纯英文的str可以用ASCII编码为bytes，内容是一样的，含有中文的str可以用UTF-8编码为bytes。含有中文的str无法用ASCII编码，因为中文编码的范围超过了ASCII编码的范围，Python会报</p>
</blockquote>
<p>计算string包含多少字符,可以用len()函数(类似java的String.length()函数)</p>
<p>len()函数计算的是 <em>str的字符数</em> ，如果换成bytes，len()函数就计算字节数;</p>
<blockquote>
<p>如果Python源码中包含中文字符,那么在保存源码文件的时候,用UTF-8编码保存.</p>
</blockquote>
<p>格式化:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="string">&#x27;Hi, %s, you have $%d.&#x27;</span> % (<span class="string">&#x27;Michael&#x27;</span>, <span class="number">1000000</span>)</span><br></pre></td></tr></table></figure>

<p>这个类似C语言中的print语句,例如 : n&#x3D;100 ,print(“I have %d $”,n);</p>
<blockquote>
<p>%运算符就是用来格式化字符串的。在字符串内部，%s表示用字符串替换，%d表示用整数替换，有几个%?占位符，后面就跟几个变量或者值，顺序要对应好。如果只有一个%?，括号可以省略。</p>
</blockquote>
<p>常见的占位符:</p>
<table>
<thead>
<tr>
<th align="center">占位符</th>
<th align="center">替换内容</th>
</tr>
</thead>
<tbody><tr>
<td align="center">%d</td>
<td align="center">整数</td>
</tr>
<tr>
<td align="center">%f</td>
<td align="center">浮点数</td>
</tr>
<tr>
<td align="center">%s</td>
<td align="center">字符串</td>
</tr>
<tr>
<td align="center">%x</td>
<td align="center">十六进制整数</td>
</tr>
</tbody></table>
<blockquote>
<p>有些时候，字符串里面的%是一个普通字符怎么办？这个时候就需要转义，用%%来表示一个%</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="string">&#x27;This is %d %%&quot; % 60</span></span><br><span class="line"><span class="string">This is 60 %</span></span><br></pre></td></tr></table></figure>

<h4 id="list-和-tuple"><a href="#list-和-tuple" class="headerlink" title="list 和 tuple"></a>list 和 tuple</h4><p>Java中有list集合,python也有,python不需要new一个list集合,直接定义即可.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;classmates = [<span class="string">&quot;Zrj&quot;</span>,<span class="string">&quot;Roman&quot;</span>,<span class="string">&quot;Cheryl&quot;</span>]</span><br><span class="line">&gt;&gt;&gt;classmates</span><br><span class="line">[<span class="string">&quot;Zrj&quot;</span>,<span class="string">&quot;Roman&quot;</span>,<span class="string">&quot;Cheryl&quot;</span>]</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">len</span>(classmates) <span class="comment"># 显示list集合元素个数</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;classmates[<span class="number">0</span>] <span class="comment">#根据索引来获取元素,</span></span><br></pre></td></tr></table></figure>

<p>遍历list集合也不需要写个for循环,直接显示</p>
<p>显示list的元素个数,用len()函数 ,</p>
<p>一个list的元素可以是另一个list</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;p=[<span class="string">&#x27;asp&#x27;</span>,<span class="string">&#x27;php&#x27;</span>]</span><br><span class="line">&gt;&gt;&gt;a=[<span class="string">&#x27;python&#x27;</span>,p,<span class="string">&#x27;scheme&#x27;</span>]</span><br><span class="line">&gt;&gt;&gt;<span class="built_in">len</span>(a)</span><br><span class="line"><span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;a</span><br><span class="line">[<span class="string">&#x27;python&#x27;</span>,[<span class="string">&#x27;asp&#x27;</span>,<span class="string">&#x27;php&#x27;</span>],<span class="string">&#x27;scheme&#x27;</span>]</span><br></pre></td></tr></table></figure>

<hr>
<p>另一种有序列表叫元组,tuple . tuple和list非常类似，但是tuple一旦初始化就不能修改，比如同样是列出同学的名字</p>
<p>定义tuple:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;classmates=(<span class="string">&#x27;Zrj&#x27;</span>,<span class="string">&#x27;Romen&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment">#classmates这个tuple不能变了，它也没有append()，insert()这样的方法。其他获取元素的方法和list是一样的，你可以正常地使用classmates[0]，classmates[-1]，但不能赋值成另外的元素。</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>因为tuple不可变，所以代码更安全。如果可能，能用tuple代替list就尽量用tuple。</p>
</blockquote>
<p>Python在显示只有1个元素的tuple时，也会加一个逗号,，以免你误解成数学计算意义上的括号.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;t = (<span class="number">1</span>)</span><br><span class="line">&gt;&gt;&gt;t</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment">#定义的不是tuple，是1这个数！这是因为括号()既可以表示tuple，又可以表示数学公式中的小括号，这就产生了歧义，因此，Python规定，这种情况下，按小括号进行计算，计算结果自然是1。</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;t=(<span class="number">1</span>,)</span><br><span class="line">&gt;&gt;&gt;t</span><br><span class="line">(<span class="number">1</span>,)</span><br></pre></td></tr></table></figure>

<h5 id="可变的tuple"><a href="#可变的tuple" class="headerlink" title="可变的tuple"></a>可变的tuple</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;t=(<span class="number">1</span>,<span class="number">2</span>,[<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>])</span><br><span class="line">&gt;&gt;&gt;t</span><br><span class="line">(<span class="number">1</span>,<span class="number">2</span>,[<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.webxueyuan.com/cdn/files/attachments/001387269705541ad608276b6f7426ca59b8c2b19947243000/0" alt=";定义的三个变量"></p>
<p>表面上看，tuple的元素确实变了，但其实变的不是tuple的元素，而是list的元素。</p>
<blockquote>
<p>tuple一开始指向的list并没有改成别的list，所以，tuple所谓的“不变”是说，tuple的每个元素，指向永远不变。即指向’a’，就不能改成指向’b’，指向一个list，就不能改成指向其他对象，但指向的这个list本身是可变的！</p>
</blockquote>
<h4 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">age = <span class="number">20</span></span><br><span class="line"><span class="keyword">if</span> age &gt;= <span class="number">20</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Your age is&#x27;</span>,age)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;adult&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Your age is&#x27;</span>,age)</span><br></pre></td></tr></table></figure>

<p>如果if语句判断是True，就把缩进的两行print语句执行了,也可以给if添加一个else语句，意思是，如果if判断是False，不要执行if的内容，去把else执行了</p>
<blockquote>
<p>注意冒号’:’不要遗漏,同时每一个语句后面都不用加分号’;’</p>
</blockquote>
<p>多分支用elif</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">age = <span class="number">20</span></span><br><span class="line"><span class="keyword">if</span> age &gt;= <span class="number">20</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Your age is&#x27;</span>,age)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;adult&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> age &gt;= <span class="number">80</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;You are a old man&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Your age is&#x27;</span>,age)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>if语句执行有个特点，它是从上往下判断，如果在某个判断上是True，把该判断对应的语句执行后，就忽略掉剩下的elif和else.</p>
</blockquote>
<p>if语句可以简写:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#只要x是非零数值、非空字符串、非空list等，就判断为True，否则为False。</span></span><br><span class="line"><span class="keyword">if</span> x:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;True&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>输入函数input返回的是string类型,如果需要对string类型进行转义则需要int()函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="built_in">input</span>(<span class="string">&#x27;your age is&#x27;</span>)</span><br><span class="line">age = <span class="built_in">int</span>(i)</span><br><span class="line"><span class="keyword">if</span> age &lt; <span class="number">18</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;young man!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>int()函数发现一个字符串并不是合法的数字时就会报错，程序就退出了. 跟java的valueof()一样有检查检查功能.</p>
</blockquote>
<h4 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h4><h5 id="for-循环"><a href="#for-循环" class="headerlink" title="for 循环"></a>for 循环</h5><p>这的语法跟shell的语法类似</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">names=[<span class="string">&#x27;Zrj&#x27;</span>,<span class="string">&#x27;Roman&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br></pre></td></tr></table></figure>

<p>做一个累加的程序:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]:</span><br><span class="line">    <span class="built_in">sum</span> = <span class="built_in">sum</span> + x</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是1到100累加,在shell中是&#123;1..100&#125;,在python中可以用range(n)函数,这个是从0到n的整数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">101</span>):</span><br><span class="line">    <span class="built_in">sum</span> += x</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>一样的,不要忘记冒号’:’</p>
</blockquote>
<h5 id="while-循环"><a href="#while-循环" class="headerlink" title="while 循环"></a>while 循环</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">n = <span class="number">99</span></span><br><span class="line"><span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">sum</span> = <span class="built_in">sum</span> + n</span><br><span class="line">    n = n - <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>)</span><br></pre></td></tr></table></figure>

<h5 id="break-Continue"><a href="#break-Continue" class="headerlink" title="break , Continue"></a>break , Continue</h5><ul>
<li>在循环中，break语句可以提前退出循环</li>
<li>在循环过程中，也可以通过continue语句，跳过当前的这次循环，直接开始下一次循环</li>
</ul>
<h4 id="dict-set"><a href="#dict-set" class="headerlink" title="dict &amp; set"></a>dict &amp; set</h4><h5 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h5><p>Python内置了字典：dict的支持，dict全称dictionary，在其他语言中也称为map，使用键-值（key-value）存储，具有极快的查找速度。</p>
<blockquote>
<p>这类似java中的map</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;d = &#123;<span class="string">&#x27;Zrj&#x27;</span>:<span class="number">92</span>,<span class="string">&#x27;Roman&#x27;</span>:<span class="number">99</span>&#125;</span><br><span class="line">&gt;&gt;&gt;d[<span class="string">&#x27;Zrj&#x27;</span>]</span><br><span class="line"><span class="number">92</span></span><br><span class="line">&gt;&gt;&gt;d[<span class="string">&#x27;Zrj&#x27;</span>]=<span class="number">95</span> <span class="comment">#修改,由于一个key只能对应一个value，所以，多次对一个key放入value，后面的值会把前面的值冲掉：</span></span><br><span class="line">&gt;&gt;&gt;d[<span class="string">&#x27;Zrj&#x27;</span>]</span><br><span class="line"><span class="number">95</span></span><br></pre></td></tr></table></figure>

<p>判断dict是否有这个key,有两种方法:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="string">&#x27;Zrx&#x27;</span> <span class="keyword">in</span> d</span><br><span class="line"><span class="literal">False</span></span><br><span class="line">&gt;&gt;&gt;d.get(<span class="string">&#x27;Zrx&#x27;</span>)</span><br><span class="line">&gt;&gt;&gt;d.get(<span class="string">&#x27;Zrx&#x27;</span>,<span class="string">&#x27;False&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;False&#x27;</span></span><br></pre></td></tr></table></figure>

<p>删除一个key-value,可以用pop(key)的方法:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;d.pop(<span class="string">&#x27;Roman&#x27;</span>)</span><br><span class="line"><span class="number">99</span></span><br></pre></td></tr></table></figure>

<p>dict与list的特点对比:</p>
<table>
<thead>
<tr>
<th align="center">dict</th>
<th align="center">list</th>
</tr>
</thead>
<tbody><tr>
<td align="center">查找和插入速度极快,不会随着key的增减而变慢</td>
<td align="center">查找和插入的空间随着元素的增加而增加</td>
</tr>
<tr>
<td align="center">需要占用大量的内存,内存浪费</td>
<td align="center">占用空间小,浪费的内存很少</td>
</tr>
</tbody></table>
<blockquote>
<p>dict是用空间来换取时间的一种方法。</p>
</blockquote>
<h5 id="set"><a href="#set" class="headerlink" title="set"></a>set</h5><p>set和dict类似，也是一组key的集合，但不存储value。由于key不能重复，所以，在set中，没有重复的key。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="comment">#创建一个set , 需要提供一个list作为输入集合</span></span><br><span class="line">&gt;&gt;&gt;s =<span class="built_in">set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">&gt;&gt;&gt;s</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line">&gt;&gt;&gt;<span class="comment">#重复元素将被自动过滤掉</span></span><br><span class="line">&gt;&gt;&gt;s=<span class="built_in">set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>])</span><br><span class="line">&gt;&gt;&gt;s</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;</span><br><span class="line">&gt;&gt;&gt;通过add()方法将元素添加到<span class="built_in">set</span>中</span><br><span class="line">&gt;&gt;&gt;s.add(<span class="number">5</span>)</span><br><span class="line">&gt;&gt;&gt;s</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line">&gt;&gt;&gt;通过remove(key)方法可以删除元素</span><br><span class="line">&gt;&gt;&gt;s.remove(<span class="number">4</span>)</span><br><span class="line">&gt;&gt;&gt;s</span><br><span class="line">&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>&#125;</span><br><span class="line">&gt;&gt;&gt;<span class="comment">#set可以看成数学意义上的无序和无重复元素的集合，因此，两个set可以做数学意义上的交集、并集等操作</span></span><br><span class="line">&gt;&gt;&gt;s1= <span class="built_in">set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">&gt;&gt;&gt;s2= <span class="built_in">set</span>([<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line">&gt;&gt;&gt;s1 &amp; s2</span><br><span class="line">&#123;<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line">&gt;&gt;&gt;s1 | s2</span><br><span class="line">&gt;&gt;&gt;&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ul>
<li>求绝对值 abs()</li>
<li>最大值 max()</li>
<li>类型转换 int() , float() , str() , bool()</li>
</ul>
<p>函数名其实就是指向一个函数对象的引用，完全可以把函数名赋给一个变量，相当于给这个函数起了一个“别名”:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;a=<span class="built_in">abs</span></span><br><span class="line">&gt;&gt;&gt;a(-<span class="number">1</span>)</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>请使用迭代查找一个list中最小和最大值，并返回一个tuple：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Find the max and min number and return a tuple</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>():</span><br><span class="line">    <span class="comment">#Max</span></span><br><span class="line">    a = <span class="number">0</span></span><br><span class="line">    <span class="comment">#Min</span></span><br><span class="line">    b = <span class="number">99</span></span><br><span class="line">    <span class="keyword">for</span> i ,value <span class="keyword">in</span> <span class="built_in">enumerate</span>([<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]):</span><br><span class="line">        <span class="keyword">if</span> a &lt; value :</span><br><span class="line">            a = value</span><br><span class="line">        <span class="keyword">if</span> b &gt; value :</span><br><span class="line">            b = value</span><br><span class="line">    <span class="built_in">print</span>(a,b)ww</span><br><span class="line">    <span class="keyword">return</span> d = (a,b)</span><br></pre></td></tr></table></figure>

<hr>
<p>定义一个函数要使用def语句,一次写出 函数名 , 括号 , 括号中的参数 , 冒号 ; 然后，在缩进块中编写函数体，函数的返回值用return语句返回。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">my_abs</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">if</span> x &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> -x</span><br><span class="line"></span><br><span class="line"><span class="comment">#对参数类型做检查，只允许整数和浮点数类型的参数。数据类型检查可以用内置函数isinstance()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_abs</span>(<span class="params">x</span>):</span><br><span class="line">   <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(x,(<span class="built_in">int</span>,<span class="built_in">float</span>)):</span><br><span class="line">       <span class="keyword">raise</span> TypeError(<span class="string">&#x27;Bad operand type&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> x &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> -x</span><br></pre></td></tr></table></figure>

<blockquote>
<p>把my_abs()的函数定义保存为abstest.py文件了，那么，可以在该文件的当前目录下启动Python解释器，用from abstest import my_abs来导入my_abs()函数，注意abstest是文件名（不含.py扩展名）：</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="keyword">from</span> abstest <span class="keyword">import</span> my_abs</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_abs(-<span class="number">8</span>)</span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure>

<hr>
<p>如果想定义一个什么事也不做的空函数，可以用pass语句;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">nop</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pass语句什么都不做，那有什么用？实际上pass可以用来作为占位符，比如现在还没想好怎么写函数的代码，就可以先放一个pass，让代码能运行起来。</span></span><br></pre></td></tr></table></figure>

<hr>
<p>测试:写一个一元二次方程的求解程序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">a,b,c</span>):</span><br><span class="line">    <span class="keyword">if</span> b*b - <span class="number">4</span>*a*c &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Illegal args&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;x1=&quot;</span> , (-b + math.sqrt(b*b - <span class="number">4</span>*a*c))/(<span class="number">2</span>*a))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;x2=&quot;</span> , (-b - math.sqrt(b*b - <span class="number">4</span>*a*c))/(<span class="number">2</span>*a))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<hr>
<p>Python的函数定义非常简单，但灵活度却非常大。除了正常定义的必选参数外，还可以使用默认参数、可变参数和关键字参数，使得函数定义出来的接口，不但能处理复杂的参数，还可以简化调用者的代码。</p>
<blockquote>
<p>函数的参数跟C语言差不多,都有形参与实参的说法</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#给参数一个默认值</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">x,y=<span class="number">2</span></span>)</span><br></pre></td></tr></table></figure>

<p>需要注意:</p>
<ol>
<li>是必选参数在前，默认参数在后，否则Python的解释器会报错.(会产生歧义,fun(x,y&#x3D;2,z),用户调用fun(1,3)则会报错)</li>
<li>当函数有多个参数时，把变化大的参数放前面，变化小的参数放后面。变化小的参数就可以作为默认参数。</li>
</ol>
<blockquote>
<p>如果默认参数是一个list,记得要给list加上一个END,list.append(‘END’)</p>
</blockquote>
<hr>
<p>可变参数:</p>
<p>当函数有多个参数时，把变化大的参数放前面，变化小的参数放后面。变化小的参数就可以作为默认参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># a*a + b*b + c*c +...</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc</span>(<span class="params">*numbers</span>):</span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> numbers:</span><br><span class="line">        <span class="built_in">sum</span> = <span class="built_in">sum</span> + n*n</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果没有* 每次调用则需要传入一个list或者tuple</span></span><br></pre></td></tr></table></figure>

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>了解python的基础变量 , 集合 , 数组 , 函数的定义 , 在python中用缩进的规则来区分代码块,并且不要遗忘冒号 :</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/94fa7fb3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/94fa7fb3/" class="post-title-link" itemprop="url">Keepalived高可用集群</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-16 18:17:11" itemprop="dateCreated datePublished" datetime="2017-11-16T18:17:11+00:00">2017-11-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Keepalive"><a href="#Keepalive" class="headerlink" title="Keepalive"></a>Keepalive</h1><p>起初是为LVS设计的,专门用来监控LVS集群系统中各个服务节点的状态,后来又加入了VRRP的功能(Virtual Router Redundancy Protocol 虚拟路由器冗余协议),因此配合除了LVS服务外,也可以作为其他服务(nginx,haproxy)的高可用软件.</p>
<blockquote>
<p>VRRP出现是为了解决静态路由出现的单点故障问题.</p>
</blockquote>
<p>主要两大用户:healthcheck , failover</p>
<h2 id="VRRP"><a href="#VRRP" class="headerlink" title="VRRP"></a>VRRP</h2><p>Virtual Router Redundacy Protocol,解决静态路由器的单点故障,VRRP时通过一种竞选协议机制来将故障路由器的任务给某台VRRP.</p>
<ul>
<li>VRRP是通过IP多播的方式实现通信</li>
<li>主发包,备接包,当备接不到主发的包的时候,就启动接管程序接管主的资源.</li>
</ul>
<h2 id="failover"><a href="#failover" class="headerlink" title="failover"></a>failover</h2><p>实现LB Master主机和 Backup 主机之间故障转移何自动切换.(这里针对有两个负载均衡)</p>
<h2 id="healthcheck"><a href="#healthcheck" class="headerlink" title="healthcheck"></a>healthcheck</h2><ol>
<li>keepalived.conf里面配置就可以实现LVS.</li>
<li>keepalive可以对LVS下面的集群节点做监控检查.</li>
</ol>
<p>负载均衡定期检查RSYNC的可用性决定是否给其分发请求.</p>
<h2 id="keepalived-故障切换转移原理"><a href="#keepalived-故障切换转移原理" class="headerlink" title="keepalived 故障切换转移原理"></a>keepalived 故障切换转移原理</h2><ol>
<li>在keepalived directors正常工作时,主Director节点会不断向被节点广播心跳消息,告诉备节点设备–主节点设备正常.</li>
<li>当主节点发生故障时,备节点就无法检测到主节点的心跳,今儿调用自身的接管程序,接管主节点的IP资源与服务.</li>
<li>当主节点恢复时,备节点会释放主节点故障时自身接管的IP资源与服务,恢复到原来的自身备用角色.</li>
</ol>
<h2 id="配置keepalive"><a href="#配置keepalive" class="headerlink" title="配置keepalive"></a>配置keepalive</h2><p>官网 <code>http:\\www.keepalived.org</code></p>
<p>这里用的是 1.2.16 的版本.</p>
<p>相关的配置可以用man keepalived.conf查看,这里只列出80%</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ln -s /user/src/kernel/2.6 /usr/src/linux</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 到keepalive的文件包里面</span></span><br><span class="line"><span class="comment"># ./configure</span></span><br><span class="line"><span class="comment"># 出现以下相关内容即可</span></span><br><span class="line">Use IPVS Framework  : Yes</span><br><span class="line">IPVS <span class="built_in">sync</span> daemon support: Yes</span><br><span class="line">Use VRRP Framework : Yes</span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 规范启动</span></span><br><span class="line"><span class="comment"># cp /usr/local/etc/rc.d/init.d/keepalived /etc/init.d/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置启动脚本参数</span></span><br><span class="line"><span class="comment"># cp /usr/local/etc/sysconfig/keepalived /etc/sysconfig/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建默认的keepalived配置文件路径</span></span><br><span class="line"><span class="comment"># mkdir /etc/keepalived</span></span><br><span class="line"><span class="comment"># cp /usr/local/etc/keepalived/keepalived.conf /etc/keepalived</span></span><br></pre></td></tr></table></figure>

<p>keepalived的配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">!Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">!全局变量</span><br><span class="line">!Comments start with ’#’ or ’!’ to the end of the line and can start anywhere in a line.</span><br><span class="line">!contains subblocks of Global definitions, Static routes, and Static rules</span><br><span class="line">global_defs&#123;</span><br><span class="line">    notification_email&#123;</span><br><span class="line">        !管理员邮箱</span><br><span class="line">        admin@example.com</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from admin@example.com</span><br><span class="line">    !邮箱服务器的地址设置</span><br><span class="line">    smtp_server xx.xx.xx.xx</span><br><span class="line">    smtp_connect_timeout 30</span><br><span class="line"></span><br><span class="line">    !string,identifying the machine,(do not have to be hostname,default:localhostname)</span><br><span class="line">    router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">!Static routes/address/rules</span><br><span class="line">!Keepalived can configure static addresses, routes, and rules. These addresses are NOT moved by vrrpd, they stay on the machine.  If you already  have  IPs and routes on your machines and your machines can ping each other, you don’t need this section.</span><br><span class="line"></span><br><span class="line">static_ipaddress&#123;</span><br><span class="line">    192.168.1.2/24 dev eth0 scope global</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static_routes&#123;</span><br><span class="line">    192.168.1.1/24 via 192.168.1.100</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static_rules&#123;</span><br><span class="line">    from 192.168.1.1/24 table 1</span><br><span class="line">    to 192.168.1.1/24 table 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">!Adds a scritpt to be executed periodically.Its exit code will be recorded for all VRRP instances which are monitoring it with non-zero weight.</span><br><span class="line">vrrp_script &lt;SCRIPT_NAME&gt;&#123;</span><br><span class="line">    !path of the script to execute</span><br><span class="line">    script &lt;STRING&gt;|&lt;QUOTED-STRING&gt;</span><br><span class="line">    !seconds between script invocations,default 1 second</span><br><span class="line">    interval &lt;INTEGER&gt;</span><br><span class="line">    !seconds after which script is considered to have failed</span><br><span class="line">    timeout &lt;INTEGER&gt;</span><br><span class="line">    !adjust priority by this weight,default 2</span><br><span class="line">    weight &lt;INTEGER : -254..254&gt;</span><br><span class="line">    !required number of successes for OK transition</span><br><span class="line">    rise &lt;INTERGER&gt;</span><br><span class="line">    !required number of successes for KO transition</span><br><span class="line">    fall &lt;INTEGER&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">!describes the movable IP for each instance of a group in vrrp_sync_group.</span><br><span class="line">!Here are describes two IPs(on inside_network an on_outside_network)on machine &quot;my_hostname&quot;,!which belog to the group VG_1 and which will trasition together on any state change.</span><br><span class="line"></span><br><span class="line">vrrp_instance inside_network&#123;</span><br><span class="line">    !Initial state,MASTER | BACKUP</span><br><span class="line">    !As soon as the other machine(s) come up,</span><br><span class="line">    !an election will be held and the machine</span><br><span class="line">    !With the highest priority will become MASTER</span><br><span class="line">    !So the entry here do not matter a whole lot</span><br><span class="line">    state MASTER</span><br><span class="line"></span><br><span class="line">    !Interface for inside_network,bound by vrrp</span><br><span class="line">    interface eth0</span><br><span class="line"></span><br><span class="line">    !Use VRRP Virtual MAC.</span><br><span class="line">    use_vmac [&lt;VMAC_INTERFACE&gt;]</span><br><span class="line"></span><br><span class="line">    !Send/Recv VRRP messages from base interface instea dof</span><br><span class="line">    vmac_xmit_base</span><br><span class="line"></span><br><span class="line">    !force instance to use IPv6(when mixed IPv4 and IPv6 config)</span><br><span class="line">    native_ipv6</span><br><span class="line"></span><br><span class="line">    !Ignore VRRP interface faults(default unset)</span><br><span class="line">    dont_track_primary</span><br><span class="line"></span><br><span class="line">    ! optional,monitor these as well</span><br><span class="line">    ! go to FAULT state if any of these go down</span><br><span class="line">    track_interface&#123;</span><br><span class="line">        eth0</span><br><span class="line">        eth1</span><br><span class="line">        eth2 weight &lt;-254..254&gt;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ! add a tracking script to the interface (&lt;SCRIPT_NAME&gt;is the name of the vrrp_script entry)</span><br><span class="line">    track_script&#123;</span><br><span class="line">        &lt;SCRIPT_NAME&gt;</span><br><span class="line">        &lt;SCRIPT_NAME&gt; weight &lt;-254..254&gt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    !Default IP for binding vrrpd is the primary IP on interface.If you want to hid the location of vrrpd, use this IP as src_addr for multicast or unicast vrrp packets.(Since it is multicast,vrrpd will get the reply packet no matter what src_addr is used).</span><br><span class="line">    !Optional</span><br><span class="line">    mcast_src_ip &lt;IPADDR&gt;</span><br><span class="line">    unicast_src_ip &lt;IPADDR&gt;</span><br><span class="line">    ! VRRP version to run on interface</span><br><span class="line">    version&lt;2 or 3&gt;</span><br><span class="line"></span><br><span class="line">    !addresses add|del on change to MASTER , to BACKUP.With the same entries on other machines, the opposite transition will be occurring.</span><br><span class="line">    virtual_ipaddress&#123;</span><br><span class="line">        &lt;IPADDR&gt;/&lt;MASK&gt; brd &lt;IPADDR&gt; dev &lt;STRING&gt; scope &lt;SCOPE&gt; label &lt;LABEL&gt;</span><br><span class="line">        192.168.200.17/24 dev eth1</span><br><span class="line">        192.168.200.18/24 dev eth2 label eth2:1</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # Note: authentication was removed from the VRRPv2 specification by RFC3768 in 2004.</span><br><span class="line">    #    Use of this option is non-compliant and can cause problems; avoid using if possible,</span><br><span class="line">    #   except when using unicast, where it can be helpful.</span><br><span class="line">    authentication &#123;</span><br><span class="line">        # Authentication block</span><br><span class="line">        # PASS||AH</span><br><span class="line">        # PASS - Simple password (suggested)</span><br><span class="line">        # AH - IPSEC (not recommended))</span><br><span class="line">        auth_type PASS</span><br><span class="line">        # Password for accessing vrrpd.</span><br><span class="line">        # should be the same on all machines.</span><br><span class="line">        # Only the first eight (8) characters are used.</span><br><span class="line">        auth_pass 1234</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>主要配置:</p>
<ul>
<li>从文档中可以看到,我们需要配置主要有全局参数(global_defs),email &amp; router_id</li>
<li>如果有需要定时执行的脚本,则配置vrrp_script 块, script位置,interval,weight</li>
<li>配置主机标签vrrp_instance ,里面设置state,网卡接口,主机ip,virtual_id,优先级priorioty,adver_int,authentication,为主机虚拟ip,检测脚本</li>
<li>用上一个步骤里面的虚拟IP配置虚拟服务器</li>
</ul>
<p>主:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">!Configuration file for keepalived</span><br><span class="line">global_defs&#123;</span><br><span class="line">    notification_email&#123;</span><br><span class="line">        zhur0ngjian@126.com</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from zhur0ngjian@126.com</span><br><span class="line">    smtp_server 127.0.0.1</span><br><span class="line">    smtp_connect_timeout 30</span><br><span class="line">    router_id MASTER_ROUTER</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance V1_1&#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth1</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    mcast_src_ip 172.16.177.150</span><br><span class="line">    priority 50</span><br><span class="line">    adver_int 1</span><br><span class="line">    authentication&#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass chtopnet</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress&#123;</span><br><span class="line">        10.0.1.1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 10.0.1.1 80&#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    persistence_timeout 50</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 172.16.177.150 80 &#123;</span><br><span class="line">        weight 3</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">            connect_timeout 10</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    real_server 172.16.177.151 80&#123;</span><br><span class="line">        weight 3</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">            connect_timeout 10</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>被:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">!Configuration file for keepalived</span><br><span class="line">global_defs&#123;</span><br><span class="line">    notification_email&#123;</span><br><span class="line">        zhur0ngjian@126.com</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from zhur0ngjian@126.com</span><br><span class="line">    smtp_server 127.0.0.1</span><br><span class="line">    smtp_connect_timeout 30</span><br><span class="line">    router_id BACKUP_ROUTER</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance V1_1&#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth1</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    mcast_src_ip 172.16.177.151</span><br><span class="line">    priority 50</span><br><span class="line">    adver_int 1</span><br><span class="line">    authentication&#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass chtopnet</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress&#123;</span><br><span class="line">        10.0.1.1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 10.0.1.1 80&#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    persistence_timeout 50</span><br><span class="line">    protocol TCP</span><br><span class="line"></span><br><span class="line">    real_server 172.16.177.150 80 &#123;</span><br><span class="line">        weight 3</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">            connect_timeout 10</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    real_server 172.16.177.151 80&#123;</span><br><span class="line">        weight 3</span><br><span class="line">        TCP_CHECK &#123;</span><br><span class="line">            connect_timeout 10</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">            connect_port 80</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主备的配置文件需要注意:</p>
<ol>
<li>在vrrp_instance节点中,主备的实例名字可以不一样,但virtual_router_id必须一样.</li>
<li>virtual_router_id的作用是区分不同的vrrp组,因此在同一网段内,不同的vrrp组不能重复id.</li>
<li>一个 virtual_server节点中配置多个 real_server,需要注意 TCP_CHECK与’{‘ 之间的空格,如果没有空格,则从上往下数第二个real_server会识别不到.</li>
<li>VIP可以和主机真实IP地址不在同一个网段,但必须在环境中搭建VPN.</li>
</ol>
<p>启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># keeplived需要通过ip地址添加来启动服务</span><br><span class="line"># ip addr add 10.0.0.18/24 dev eth0</span><br><span class="line"># /etc/init.d/keepalived start</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对外提供服务的是VIP(virtual ip)</p>
</blockquote>
<h2 id="场景应用"><a href="#场景应用" class="headerlink" title="场景应用"></a>场景应用</h2><p>假设我们的集群架构中,有两台机器是作为LB存在,分别是LB1(主),LB2(备) ; 两台 LB 通过 <em>keepalive</em> 建立关系 , 当一台 _LB_挂了,立即启用 <em>备用LB</em> .</p>
<p>我用的 <em>load Balance</em> 软件是 Nginx , 所谓宕机就是 <em>Nginx</em> 和 <em>keepalive</em> 这两个服务停止了,然而当 <em>Nginx</em> 停止服务的时候 ,keepalive 是不能识别到的(Keepalive不会关闭,不会让 <em>备用LB</em> 接管 <em>主LB</em> 接受到的请求)</p>
<p>因此,我们要写一个监控Nginx状态的脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Monitoring Nginx status</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="subst">$(ps -ef|grep <span class="string">&quot;nginx : master process&quot;</span>|grep -v grep)</span>&quot;</span>==<span class="string">&quot;&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    /application/nginx/sbin/nginx</span><br><span class="line">    <span class="built_in">sleep</span> 5</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="subst">$(ps -ef|grep <span class="string">&quot;nginx : master process&quot;</span>|grep -v grep)</span>&quot;</span>==<span class="string">&quot;&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">    killall keepalived</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>升级版:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/keepaalived/check_nginx.sh</span></span><br><span class="line">Count1=<span class="string">&quot;netstat -antp |grep -v grep|grep nginx|wc -l&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$Count1</span> -eq 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    /application/nginx/sbin/nginx</span><br><span class="line">    <span class="built_in">sleep</span> 2</span><br><span class="line">    Count2=<span class="string">&quot;netstat -antp|grep -v grep|grep nginx|wc -l&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$Count2</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        /etc/init.d/keepalived stop</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>这个脚本可以放到 <em>keepalived.conf</em> 里面 <em>vrrp_script</em> 节点中,这里可以每隔相应的时间执行一次脚本.</p>
<p>在工作时,keepalived根据用户设定的策略判断服务器上的程序是否正常运行,如果故障则将这台服务器从热备组移出.</p>
<p>在实例中重要参数: nopreempt , 当主LB挂了,备LB接管,主恢复,不自动接管</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/61d1add5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/61d1add5/" class="post-title-link" itemprop="url">Linux之kickstart无人值守系统装系统</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-14 15:48:16" itemprop="dateCreated datePublished" datetime="2017-11-14T15:48:16+00:00">2017-11-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="无人值守装系统-PXE-APACHE-DHCP-TFTP-KICKSTART"><a href="#无人值守装系统-PXE-APACHE-DHCP-TFTP-KICKSTART" class="headerlink" title="无人值守装系统(PXE+APACHE+DHCP+TFTP+KICKSTART)"></a>无人值守装系统(PXE+APACHE+DHCP+TFTP+KICKSTART)</h1><ul>
<li>DHCP_Server 用于给客户端提供IP地址以及PXE文件的位置.</li>
<li>Web_Server 存放系统镜像以及kickstart的配置文件.</li>
<li>TFTP_Server 存放PXE文件以及相关的启动文件</li>
</ul>
<hr>
<p>相关IP地址:</p>
<ul>
<li>DHCP_Server:192.168.1.2</li>
<li>Web_Server:192.168.1.3</li>
<li>TFTP_Server:192.168.1.4</li>
</ul>
<h2 id="1-1-什么是PXE"><a href="#1-1-什么是PXE" class="headerlink" title="1.1 什么是PXE"></a>1.1 什么是PXE</h2><p>PXE(preboot execute environment，预启动执行环境)是由Intel公司开发的最新技术，工作于Client&#x2F;Server的网络模式，支持工作站通过网络从远端服务器下载映像，并由此支持通过网络启动操作系统，</p>
<p>在启动过程中，终端要求服务器分配IP地址，再用TFTP（trivial file transfer protocol）或MTFTP(multicast trivial file transfer protocol)协议下载一个启动软件包到本机内存中执行，由这个启动软件包完成终端（客户端）基本软件设置，从而引导预先安装在服务器中的终端操作系统。</p>
<h2 id="1-2-PXE工作过程"><a href="#1-2-PXE工作过程" class="headerlink" title="1.2 PXE工作过程"></a>1.2 PXE工作过程</h2><p><img src="http://images.cnitblog.com/blog/370046/201406/152331547498487.jpg" alt="PXE工作原理示意图"></p>
<p>PXE客户端 (发送UDP广播请求)-&gt; DHCP服务 (DHCP服务器提供信息) -&gt; PXE客户端 (请求下载启动文件)-&gt; TFTP服务 (响应并提供文件)-&gt; PXE 客户端 (请求下载自动应答文件) -&gt; Http服务 (客户端安装操作系统) -&gt; PXE客户端</p>
<h3 id="1-2-1-获取相关的pxe程序"><a href="#1-2-1-获取相关的pxe程序" class="headerlink" title="1.2.1 获取相关的pxe程序"></a>1.2.1 获取相关的pxe程序</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 安装syslinux</span><br><span class="line"># syslinux是一个引导加载程序,而且兼容各种介质.syslinux是一个小型的Linux操作系统,目的是简化首次安装Linux的时间,并建立维护或者其他特殊用途的启动盘</span><br><span class="line"># yum install syslinux</span><br><span class="line"></span><br><span class="line"># 将Linux的pxe文件复制到TFTP文件夹中(TFTP下面会讲到安装,默认启动的路径在/var/lib/tftpboot/)</span><br><span class="line"># cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line"># 将iso镜像中的/image/pxeboot/initrd.img和vmlinux复制到/var/lib/tftpboot/下</span><br><span class="line"># scp -P22 root@192.168.1.3:/var/www/html/cdrom/images/pxeboot/&#123;initrd.im,gvmlinuz&#125; /var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line"># 复制iso镜像中的/isolinux/*.msg 到 /var/lib/tftpboot/文件夹中</span><br><span class="line"># cp /var/www/html/cdrom/isolinux/*.msg /var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line"># 在/var/lib/tftpboot/中创建一个pxelinux.cfg目录</span><br><span class="line"># mkdir /var/lib/tftpboot/pxelinux.cfg</span><br><span class="line"></span><br><span class="line"># 将iso镜像中的/isolinux目录中的isolinux.cfg复制到pxelinux.cfg目录下,同时改名为default</span><br><span class="line"># cp /var/www/html/cdrom/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改default文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 设置启动的是&#x27;label ks&#x27;中的内容</span><br><span class="line">default ks</span><br><span class="line"># 显示 &#x27;boot:&#x27;提示符.为&#x27;0&#x27;时则不显示,将会直接启动&#x27;default&#x27;参数中指定的内容.</span><br><span class="line">prompt 1</span><br><span class="line">#在用户输入之前的超时时间,单位为0.1秒</span><br><span class="line">timeout 6</span><br><span class="line"># 显示某个文件的内容,注意文件的路径.</span><br><span class="line"># 默认是在/var/lib/tftpboot/目录下</span><br><span class="line"># 也可以指定其他的全路径下的msg文件</span><br><span class="line">display boot.msg</span><br><span class="line"></span><br><span class="line"># &#x27;label&#x27;指定在&#x27;boot&#x27;提示符下输入的关键字,比如boot:linux[ENTER],这个会启动&#x27;label linux&#x27;下标记的kernel和initrd.img文件</span><br><span class="line">label linux</span><br><span class="line">    # kernel 参数指定要启动的内核</span><br><span class="line">    kernel vmlinuz</span><br><span class="line">    # append指定追加给内核的参数,能够在grub里使用的追加给内核的参数.</span><br><span class="line">    append initrd=initrd.img</span><br><span class="line">label ks</span><br><span class="line">    kernel vmlinuz</span><br><span class="line">    #指定ks.cfg文件</span><br><span class="line">    append ks=http://192.168.1.3/ks.cfg initrd=initrd.img</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Linux初始RAM磁盘（initrd）是在系统引导过程中挂载的一个临时根文件系统，用来支持两阶段的引导过程。initrd文件中包含了各种可执行程序和驱动程序，它们可以用来挂载实际的根文件系统，然后再将这个 initrd RAM磁盘卸载，并释放内存。在很多嵌入式Linux系统中，initrd 就是最终的根文件系统。</p>
</blockquote>
<h2 id="2-DHCP服务器安装"><a href="#2-DHCP服务器安装" class="headerlink" title="2. DHCP服务器安装"></a>2. DHCP服务器安装</h2><p>DHCP（Dynamic Host Configuration Protocol，动态主机配置协议）是一个局域网的网络协议，使用UDP协议工作， 主要有两个用途：给内部网络或网络服务供应商自动分配IP地址，给用户或者内部网络管理员作为对所有计算机作中央管理的手段.</p>
<p>在本次案例中,DHCP服务器用于给客户机分配IP地址以及TFTP服务器的IP地址.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 安装DHCP服务</span><br><span class="line"># yum -y install dhcp</span><br><span class="line"></span><br><span class="line"># 复制配置模板文件到DHCP的配置目录中</span><br><span class="line"># cp -f /usr/share/doc/dhcp-4.1.1/dhcpd.conf/sample /etc/dhcp/dhcpd.conf</span><br><span class="line"></span><br><span class="line"># 修改/etc/dhcp/dhcp.conf配置文件,内容如下:</span><br><span class="line"># vi /etc/dhcp/dhcp.conf</span><br><span class="line"># ---</span><br><span class="line">ddns-update-style interim;</span><br><span class="line">ignore client-updates;</span><br><span class="line"># pxelinux启动文件位置;</span><br><span class="line">filename &quot;pxelinux.0&quot;;</span><br><span class="line"># TFTP Server的IP地址;</span><br><span class="line">next-server 192.168.1.4;</span><br><span class="line"></span><br><span class="line">subnet 192.168.1.0 netmask 255.255.255.0&#123;</span><br><span class="line">    option routers 192.168.1.4;</span><br><span class="line">    option subnet-mask 255.255.255.0;</span><br><span class="line"></span><br><span class="line">    range dynamic-bootp 192.168.1.100 192.168.1.200;</span><br><span class="line">    default-lease-time 21600;</span><br><span class="line">    max-lease-time 43000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 启动DHCP服务</span><br><span class="line"># /etc/init.d/dhcpd start</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里有可能会出现客户机无法找到ip地址,需要关闭防火墙和selinux.</p>
</blockquote>
<h2 id="3-TFTP-Server-安装与配置"><a href="#3-TFTP-Server-安装与配置" class="headerlink" title="3.TFTP_Server 安装与配置"></a>3.TFTP_Server 安装与配置</h2><p>TFTP（Trivial File Transfer Protocol,简单文件传输协议）是TCP&#x2F;IP协议族中的一个用来在客户机与服务器之间进行简单文件传输的协议，提供不复杂、开销不大的文件传输服务。端口号为69。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 安装tftp-server</span><br><span class="line"># yum install tftp-server -y</span><br><span class="line"></span><br><span class="line"># 编辑tftp服务的配置</span><br><span class="line"># vi /etc/xinetd.d/tftp</span><br><span class="line"># ---</span><br><span class="line">service tftp</span><br><span class="line">&#123;</span><br><span class="line">    socket_type = dgram</span><br><span class="line">    protocol = udp</span><br><span class="line">    wait = yes</span><br><span class="line">    user = root</span><br><span class="line">    server = /usr/sbin/in.tftpd</span><br><span class="line">    server_args = -s /var/lib/tftpboot</span><br><span class="line">    disable = no</span><br><span class="line">    per_source = 11</span><br><span class="line">    cps = 100 2</span><br><span class="line">    flags = IPv4</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 启动服务</span><br><span class="line"># /etc/init.d/xinetd restart</span><br></pre></td></tr></table></figure>

<h2 id="4-安装HTTP服务"><a href="#4-安装HTTP服务" class="headerlink" title="4. 安装HTTP服务"></a>4. 安装HTTP服务</h2><p>可以用 <em>Apache</em> 或者 <em>Nginx</em> , 具体安装教程在以往的文章中由详细记录.</p>
<blockquote>
<p>创建一个站点目录挂载光盘镜像.</p>
</blockquote>
<h2 id="6-创建ks-cfg"><a href="#6-创建ks-cfg" class="headerlink" title="6.创建ks.cfg"></a>6.创建ks.cfg</h2><h3 id="6-1-语法"><a href="#6-1-语法" class="headerlink" title="6.1 语法"></a>6.1 语法</h3><ul>
<li>命令段</li>
<li>脚本段</li>
</ul>
<h3 id="6-2-定制配置文件"><a href="#6-2-定制配置文件" class="headerlink" title="6.2 定制配置文件"></a>6.2 定制配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#platform=x86, AMD64, or Intel EM64T</span><br><span class="line">#version=DEVEL</span><br><span class="line"># Firewall configuration</span><br><span class="line">firewall --disabled</span><br><span class="line"># Install OS instead of upgrade</span><br><span class="line">install</span><br><span class="line"># Use network installation</span><br><span class="line">url --url=http://192.168.1.3/cdrom/</span><br><span class="line">#这个选项告诉安装程序：到服务器192.168.1.3 的HTTP根目录下的cdrom 文件夹下寻找安装介质</span><br><span class="line"># Root password</span><br><span class="line">rootpw --iscrypted $1$vsvtP./e$6PVMNfJd.shq2LgFJjYfA1</span><br><span class="line"># System authorization information</span><br><span class="line">auth  --useshadow  --enablemd5</span><br><span class="line"># Use graphical install</span><br><span class="line">graphical</span><br><span class="line">firstboot --disable</span><br><span class="line"># System keyboard</span><br><span class="line">keyboard us</span><br><span class="line"># System language</span><br><span class="line">lang en_US</span><br><span class="line"># SELinux configuration</span><br><span class="line">selinux --disabled</span><br><span class="line"># Installation logging level</span><br><span class="line">logging --level=info</span><br><span class="line"># Reboot after installation</span><br><span class="line">reboot</span><br><span class="line"># System timezone</span><br><span class="line">timezone  --isUtc Asia/Shanghai</span><br><span class="line"># Network information</span><br><span class="line">network  --bootproto=dhcp --device=eth0 --onboot=on</span><br><span class="line"># System bootloader configuration</span><br><span class="line"># Redhat system</span><br><span class="line"># key --skip</span><br><span class="line"></span><br><span class="line">bootloader --append=&quot;rhgb quiet&quot; --location=mbr --driveorder=sda</span><br><span class="line"></span><br><span class="line"># Clear the Master Boot Record</span><br><span class="line">zerombr</span><br><span class="line"># Partition clearing information</span><br><span class="line">clearpart --all --initlabel</span><br><span class="line"># Disk partitioning information</span><br><span class="line">part /boot --fstype=&quot;ext4&quot; --size=200</span><br><span class="line">part swap --fstype=&quot;swap&quot; --size=1024</span><br><span class="line">part / --fstype=&quot;ext4&quot; --size=8192</span><br><span class="line">part /home --fstype=&quot;ext4&quot; --size=2048</span><br><span class="line"></span><br><span class="line">%packages</span><br><span class="line">@base</span><br><span class="line"></span><br><span class="line">%end</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/14a7ca93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/14a7ca93/" class="post-title-link" itemprop="url">MySQL的引擎</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-10 20:37:23" itemprop="dateCreated datePublished" datetime="2017-11-10T20:37:23+00:00">2017-11-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="MySQL引擎"><a href="#MySQL引擎" class="headerlink" title="MySQL引擎"></a>MySQL引擎</h1><p>常用的为MyISAM 与 InnoDB.</p>
<h2 id="MyISAM引擎"><a href="#MyISAM引擎" class="headerlink" title="MyISAM引擎"></a>MyISAM引擎</h2><p>MySQL关系数据库管理系统的默认储存引擎(MySQL5.5.5以前).</p>
<p>特点:</p>
<ol>
<li>不支持事务</li>
<li>表级锁定,数据库更新的时候,锁定整张表</li>
<li>读写相互阻塞</li>
<li>只会缓存索引</li>
<li>读取速度较快,占用资源小</li>
<li>不支持外键约束</li>
</ol>
<p>适用的生产场景:</p>
<ol>
<li>不需要事务支持的业务</li>
<li>一般为读数据比较多的应用,读写都频繁的场景不适用.</li>
<li>读取并发访问相对较低的业务.</li>
<li>数据修改相对较小的业务.</li>
</ol>
<p>调优:</p>
<ol>
<li>设置合适的索引</li>
<li>调整读写优先级,根据实际需求确保重要操作更优先执行.</li>
<li>启用延迟插入改善大批量写入性能.(降低写入频率,尽可能多条数据一次性写入)</li>
<li>尽量顺序操作让insert数据都写入尾部,减少阻塞</li>
<li>分解时间长的SQL操作,降低单个操作的阻塞时间.</li>
<li>降低并发数(减少对MySQL访问).</li>
</ol>
<p>重要参数:</p>
<blockquote>
<p>查看 heavy-4G.my</p>
</blockquote>
<h2 id="InnoDB引擎"><a href="#InnoDB引擎" class="headerlink" title="InnoDB引擎"></a>InnoDB引擎</h2><p>特点:</p>
<ol>
<li>支持事务</li>
<li>行级锁定</li>
<li>读写阻塞与事务隔离级别相关</li>
<li>具有非常高效的缓存特性:能缓存索引,也能缓存数据.</li>
<li>整个表和主键以Cluster方式存储.</li>
<li>支持分区,表控件</li>
<li>支持外键约束</li>
<li>相比于MyISAM引擎,InnoDB对硬件资源要求比较高</li>
<li>所有Secondary Index 都会保存主键信息.</li>
</ol>
<p>调优:</p>
<ol>
<li>建立有效索引避免全表扫描,因为会使用表锁</li>
<li>尽可能缓存所有的索引和数据,提高响应速度,减少磁盘IO消耗</li>
<li>合理设置innodb_flush_log_at_trx_commit参数值,不要过度追求安全性.(如果innodb_flush_at_trx_commit的值为0,log,buffer每秒会被刷写日志文件到磁盘,提交事务的时候不做任何操作.)</li>
<li>在大批量小插入的时候,尽量自己控制事务而不要使用autocommit自动提交.</li>
<li>主键尽可能小,避免给Secondary index带来过大的控件负担</li>
<li>避免主键更新,因为会带来大量的数据更新</li>
</ol>
<h2 id="查看引擎"><a href="#查看引擎" class="headerlink" title="查看引擎"></a>查看引擎</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; show engines;</span><br></pre></td></tr></table></figure>

<h2 id="更改引擎"><a href="#更改引擎" class="headerlink" title="更改引擎"></a>更改引擎</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; 永久生效</span><br><span class="line">mysql &gt; ALTER TABLE [tableName] ENGINE = EngineName;</span><br></pre></td></tr></table></figure>

<p>多表批量更改,先查找所有表,然后再更改.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://github.com/rohman-zhu/posts/239f14e0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Rohman.Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="诺曼实验室">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 诺曼实验室">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/239f14e0/" class="post-title-link" itemprop="url">SQL语句详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2017-11-09 17:20:39" itemprop="dateCreated datePublished" datetime="2017-11-09T17:20:39+00:00">2017-11-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-22 05:27:48" itemprop="dateModified" datetime="2024-12-22T05:27:48+00:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Structure-Query-Language"><a href="#Structure-Query-Language" class="headerlink" title="Structure Query Language"></a>Structure Query Language</h1><p>一般分为三类:</p>
<ol>
<li>DDL(Data Definition Language) – 数据定义语言(CREAT,EALTER,DROP),管理基础数据,例如:库,表;</li>
<li>DCL(Data Control Language) – 数据控制语言(GRANT,REVOKE,COMMIT,ROLLBACK),用户授权,权限回收,数据提交回滚</li>
<li>DML(Data Manipulation Language) – 数据操作语言 (SELECT,INSERT,DELETE,UPDATE),针对数据库里的表与记录</li>
</ol>
<h2 id="常见应用"><a href="#常见应用" class="headerlink" title="常见应用"></a>常见应用</h2><h3 id="1-创建数据库"><a href="#1-创建数据库" class="headerlink" title="1. 创建数据库"></a>1. 创建数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create database &lt;DatabaseName&gt;;</span><br><span class="line"></span><br><span class="line">* 创建指定字符集的数据库:</span><br><span class="line"></span><br><span class="line">create database &lt;DatabaseName&gt; CHARACTER SET [Charset] [Description] [Default collattion];</span><br><span class="line"></span><br><span class="line">* 查看字符集</span><br><span class="line"></span><br><span class="line">show character set;</span><br></pre></td></tr></table></figure>

<p>默认使用utf-8</p>
<h3 id="2-删除数据库"><a href="#2-删除数据库" class="headerlink" title="2.删除数据库"></a>2.删除数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">drop database &lt;databaseName&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-连接数据库"><a href="#3-连接数据库" class="headerlink" title="3.连接数据库"></a>3.连接数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use &lt;databaseName&gt;</span><br><span class="line"></span><br><span class="line">不切换数据库,用 database.table</span><br><span class="line"></span><br><span class="line">例如:</span><br><span class="line"></span><br><span class="line">select user,host from mysql.user</span><br></pre></td></tr></table></figure>

<h3 id="4-授权"><a href="#4-授权" class="headerlink" title="4.授权"></a>4.授权</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">命令 : 授权命令 对应权限 目标 用户名和客户机 密码</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all on *.* to &#x27;&#x27;@&#x27;localhost&#x27; identified by &#x27;12345&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="5-为表创建索引"><a href="#5-为表创建索引" class="headerlink" title="5.为表创建索引"></a>5.为表创建索引</h3><p>加快语句查询速度.</p>
<h4 id="5-1-主键索引"><a href="#5-1-主键索引" class="headerlink" title="5.1 主键索引"></a>5.1 主键索引</h4><p>一个表只能有一个主键索引列,可以有多个普通列索引.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">在建表的时候添加</span><br><span class="line"></span><br><span class="line"># 主键索引</span><br><span class="line">primary key(列名)</span><br><span class="line"></span><br><span class="line"># 普通索引</span><br><span class="line">Key index_name(列名)</span><br><span class="line"></span><br><span class="line">mysql &gt; alter table [table_name] [add|drop] index_name(ColumName);</span><br><span class="line"></span><br><span class="line"># 指定某一个列中的前几个字符,例如 student 表的name varchar(20)</span><br><span class="line">mysql &gt; create index index_name to student(name(8))</span><br></pre></td></tr></table></figure>

<ul>
<li>PRI为主键索引的标识</li>
<li>MUL为普通索引的标识</li>
</ul>
<h4 id="5-2-联合索引"><a href="#5-2-联合索引" class="headerlink" title="5.2 联合索引"></a>5.2 联合索引</h4><p>具有前缀特性,举个例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 有三个字段 A B C</span><br><span class="line"></span><br><span class="line"># 创建联合索引 index(A,B,C)</span><br><span class="line"></span><br><span class="line">那么在查询的时候,索引的位置只能是以下三种情况:</span><br><span class="line"></span><br><span class="line">A</span><br><span class="line"></span><br><span class="line">A B</span><br><span class="line"></span><br><span class="line">A B C</span><br><span class="line"></span><br><span class="line">===============以下情况则不允许出现================</span><br><span class="line"></span><br><span class="line">A C</span><br><span class="line"></span><br><span class="line">B C</span><br><span class="line"></span><br><span class="line">C</span><br></pre></td></tr></table></figure>

<p>因此,我们创建的时候,要考虑到以下因素:</p>
<blockquote>
<p>经常用于条件查询的字段,放在前面,例如经常查 学号(A),再查年龄(B),那么创建联合索引就可以是index(A,B)</p>
</blockquote>
<h4 id="5-3唯一索引"><a href="#5-3唯一索引" class="headerlink" title="5.3唯一索引"></a>5.3唯一索引</h4><h4 id="5-4-关于索引的相关问题"><a href="#5-4-关于索引的相关问题" class="headerlink" title="5.4 关于索引的相关问题"></a>5.4 关于索引的相关问题</h4><h5 id="1-既然索引可以加快查询速度-那么就给所有列都添加索引-可以吗"><a href="#1-既然索引可以加快查询速度-那么就给所有列都添加索引-可以吗" class="headerlink" title="1.既然索引可以加快查询速度,那么就给所有列都添加索引,可以吗"></a>1.既然索引可以加快查询速度,那么就给所有列都添加索引,可以吗</h5><p>因为索引占系统空间,而且更新数据库也需要更新索引数据,因此索引并不是越多越好.例如,几百行的小表上无需建立索引,更新频繁,读取比较少的表要少建立索引.</p>
<h5 id="2-需要在哪些列上创建索引"><a href="#2-需要在哪些列上创建索引" class="headerlink" title="2.需要在哪些列上创建索引"></a>2.需要在哪些列上创建索引</h5><ul>
<li>索引一定要创建在where后的条件列上,而不是select后的选择数据列上.</li>
<li>索引建立在_唯一值_多的大表上的列建立索引.(只有男&#x2F;女的列上不适合建立索引)</li>
</ul>
<h3 id="6-用explain优化SQL语句查询"><a href="#6-用explain优化SQL语句查询" class="headerlink" title="6.用explain优化SQL语句查询"></a>6.用explain优化SQL语句查询</h3><ol>
<li>抓慢查询: a. show full prcesslist;(现场抓) b.分析慢查询日志.(配置文件中添加long_query_time &#x3D;1 log-slow-queries &#x3D; &#x2F;..&#x2F;..&#x2F;xx.log log_queries_not_using_indexes)</li>
<li>explain语句检查索引执行情况</li>
<li>对需要建索引的列建立索引.</li>
</ol>
<h3 id="7-profile功能对SQL语句进行优化"><a href="#7-profile功能对SQL语句进行优化" class="headerlink" title="7.profile功能对SQL语句进行优化"></a>7.profile功能对SQL语句进行优化</h3><h3 id="8-增删表的字段"><a href="#8-增删表的字段" class="headerlink" title="8.增删表的字段"></a>8.增删表的字段</h3><p>alter table table_name add 字段 类型 其他;</p>
<h3 id="9-中文数据乱码问题"><a href="#9-中文数据乱码问题" class="headerlink" title="9.中文数据乱码问题"></a>9.中文数据乱码问题</h3><p>设置好以下字符集(UTF-8):</p>
<ul>
<li>Linux 客户端字符集</li>
<li>Linux 服务端字符集</li>
<li>数据库 客户端字符集</li>
<li>数据库 服务端字符集</li>
<li>具体数据库的字符集</li>
<li>表的字符集</li>
<li>PHP&#x2F;Java程序字符集</li>
</ul>
<h4 id="9-1-解决方法"><a href="#9-1-解决方法" class="headerlink" title="9.1 解决方法"></a>9.1 解决方法</h4><h5 id="临时生效-set-names-字符集"><a href="#临时生效-set-names-字符集" class="headerlink" title="临时生效:set names 字符集"></a>临时生效:set names 字符集</h5><p>相当于</p>
<p>SET character_set_client &#x3D; 字符集<br>SET character_set_results &#x3D; 字符集<br>SET character_setconnection &#x3D; 字符集</p>
<p>查看字符集更改</p>
<p>show variable like “character%”</p>
<h5 id="永久生效-mysql-–default-character-set-utf8"><a href="#永久生效-mysql-–default-character-set-utf8" class="headerlink" title="永久生效 :mysql –default-character-set &#x3D; utf8"></a>永久生效 :mysql –default-character-set &#x3D; utf8</h5><p>登录数据库的时候指定字符集</p>
<h5 id="配置文件-my-cnf更改mysqld标签下面"><a href="#配置文件-my-cnf更改mysqld标签下面" class="headerlink" title="配置文件:my.cnf更改mysqld标签下面"></a>配置文件:my.cnf更改mysqld标签下面</h5><p>在 [mysqld] 下边添加: init_connect &#x3D; ‘SET NAMES 字符集’</p>
<blockquote>
<p>客户端字符集更改,默认配置文件在&#x2F;etc&#x2F;my.cnf</p>
</blockquote>
<h5 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h5><p>在配置文件中修改[mysqld]标签下的参数,相当于在登录mysql后,修改了以下两个参数:</p>
<ul>
<li>character_set_database | gbk</li>
<li>character_set_server | gbk</li>
</ul>
<p>客户端[mysql]修改后,相当于登录mysql后,修改了以下两个参数:</p>
<ul>
<li>character_set_database</li>
<li>character_set_results</li>
<li>character_set_client</li>
</ul>
<p>另外,数据有中文与英文,建议用”utf-8”字符集.</p>
<h3 id="10-MySQL日志"><a href="#10-MySQL日志" class="headerlink" title="10.MySQL日志"></a>10.MySQL日志</h3><h4 id="10-1错误日志"><a href="#10-1错误日志" class="headerlink" title="10.1错误日志"></a>10.1错误日志</h4><ol>
<li>在配置文件中的 [mysqld_safe] 的 log-error 设置</li>
<li>启动命令添加 –log-error</li>
</ol>
<h4 id="10-2查询日志"><a href="#10-2查询日志" class="headerlink" title="10.2查询日志"></a>10.2查询日志</h4><p>在数据库中,用命令查看相关命令show variables like ‘general_log%’</p>
<p>更改(临时生效),set global general_log_file&#x3D;”全路径”</p>
<p>在配置文件中添加 general-log-file&#x3D;”全路径”</p>
<h4 id="10-3慢查询日志"><a href="#10-3慢查询日志" class="headerlink" title="10.3慢查询日志"></a>10.3慢查询日志</h4><p>这里面记录查询时间超过指定时间的语句</p>
<p>log-slow-queries&#x3D;”全路径”</p>
<p>使用mysqlsla分析慢查询,定时发给相关人员邮箱.</p>
<h4 id="10-4二进制日志"><a href="#10-4二进制日志" class="headerlink" title="10.4二进制日志"></a>10.4二进制日志</h4><p>在配置文件中,把 log_bin 打开开关, log-bin &#x3D; “全路径”</p>
<p>作用:</p>
<ol>
<li>记录更改的SQL语句</li>
<li>主从复制</li>
<li>做增量备份</li>
</ol>
<p>三种模式:</p>
<h5 id="1-Row-Level"><a href="#1-Row-Level" class="headerlink" title="1. Row Level"></a>1. Row Level</h5><p>优点 : 记录了每一个SQL执行语句的细节.<br>缺点 : 性能不足.</p>
<h5 id="2-Statement-Level-默认"><a href="#2-Statement-Level-默认" class="headerlink" title="2. Statement Level(默认)"></a>2. Statement Level(默认)</h5><p>优点 : 提高效率<br>缺点 : 简略记录SQL语句,会导致从库无法执行执行.(例如使用了一些特殊功能的语句)</p>
<h5 id="3-Mixed"><a href="#3-Mixed" class="headerlink" title="3. Mixed"></a>3. Mixed</h5><p>会分析SQL语句,根据情况选择Statement或者Row模式.</p>
<blockquote>
<p>如果对数据库要求较多,则选择Mixed</p>
</blockquote>
<h3 id="11-恢复数据库source命令"><a href="#11-恢复数据库source命令" class="headerlink" title="11.恢复数据库source命令"></a>11.恢复数据库source命令</h3><p>source 备份文件的全路径</p>
<h3 id="12-mysqlbinlog命令"><a href="#12-mysqlbinlog命令" class="headerlink" title="12.mysqlbinlog命令"></a>12.mysqlbinlog命令</h3><p>主要用于增量恢复,原本是二进制的内容解析成SQL语句.</p>
<ul>
<li>参数 :-d 指定对应的库</li>
</ul>
<ol>
<li>条件: 全备份与全备后的binlog</li>
<li>关键点 : G点 ,确定全备份之后时刻binlog文件及位置</li>
<li>恢复时尽量对外停止服务</li>
</ol>
<blockquote>
<p>如果不能停止对外服务,要怎么做?</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/37/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/37/">37</a><span class="page-number current">38</span><a class="page-number" href="/page/39/">39</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/">43</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/39/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Rohman.Zhu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
